import{j as e,d8 as Z,l as h,r as M,Q as $,S as I,cl as R,C as H,ck as x,d9 as ee,q as ie,a1 as se,da as te,db as ae,dc as ne,dd as re,k as j,de as oe,df as le,dg as de,dh as ce,di as me}from"./main-1.0.23.js";import{u as B,S as pe,a as ue,I as V,b as xe,c as ge,d as z,D as he,e as fe,f as je,g as be,h as ye,T as Se,M as ve,P as ke}from"./useMetadataColumns-1.0.23-85b79404.js";import{u as Te}from"./useTableSortableColumns-1.0.23-d43f93d8.js";import{a as A,u as we}from"./RestApi-1.0.23-cc179eb9.js";import{r as Ae}from"./index.esm-1.0.23-da98f1a9.js";import{v as _,w as Ee,k as Pe,a3 as Ne,a4 as Me,a5 as De,t as Le,a6 as Ce,a7 as Fe,a8 as Re,a9 as Oe,aa as Be,ab as _e}from"./index.esm-1.0.23-ba0465a2.js";import{T as P,C as Ge}from"./ConfirmDialog-1.0.23-f318040f.js";import{u as E}from"./useTableUpdater-1.0.23-f1f702eb.js";import{B as c}from"./Spinner-1.0.23-90ab83ff.js";import{F as w}from"./FormLabel-1.0.23-71a056b2.js";import{S as X}from"./Slider-1.0.23-75ca4c04.js";import{F as S,a as v}from"./FormHelperText-1.0.23-83597bdf.js";import{P as q}from"./PremiumFeature-1.0.23-8dd1a29b.js";import{u as Ue}from"./useStoreTable-1.0.23-508477d7.js";import{A as J}from"./AdminTheme-1.0.23-7044caf5.js";import{c as We,d as Ve,b as ze}from"./index.esm-1.0.23-9200891c.js";import{A as G,a as U}from"./AccordionSummary-1.0.23-078f8091.js";import{A as W}from"./AccordionDetails-1.0.23-ad785ba6.js";import{F as k}from"./FormControlLabel-1.0.23-1ad68af6.js";import{S as T}from"./Switch-1.0.23-86b06b05.js";import{R as He}from"./RadioGroup-1.0.23-053476ee.js";import{R as O}from"./Radio-1.0.23-7006053b.js";import{T as L}from"./TextField-1.0.23-1657e9d4.js";import{L as qe}from"./Link-1.0.23-48d9bdb4.js";import{A as b,a as y}from"./AggregationLabelsEnum-1.0.23-30d037e3.js";import{A as Qe}from"./Autocomplete-1.0.23-a5bc1209.js";import{C as Xe}from"./Checkbox-1.0.23-e63c68aa.js";import{I as N}from"./iconBase-1.0.23-43ac6f06.js";import{D as Je}from"./useTheme-1.0.23-55aea9bb.js";import"./useFormStore-1.0.23-90f12904.js";import"./CardContent-1.0.23-cd3f2c87.js";import"./Typography-1.0.23-19a0fd3e.js";import"./ActionsDml-1.0.23-e3901c9d.js";import"./MenuItem-1.0.23-0a5da249.js";import"./Menu-1.0.23-e889464a.js";import"./ThemeProvider-1.0.23-f3e5cbc1.js";import"./Popover-1.0.23-6c9c65a6.js";import"./Modal-1.0.23-3fe42627.js";import"./Grow-1.0.23-40b2ff68.js";import"./index-1.0.23-fea3ac27.js";import"./Stepper-1.0.23-3d0d410f.js";import"./createSvgIcon-1.0.23-f9410a01.js";import"./StepContent-1.0.23-0707671d.js";import"./Collapse-1.0.23-a92fc278.js";import"./DialogContent-1.0.23-79893b13.js";import"./useFormControl-1.0.23-a0ae6ce7.js";import"./index-1.0.23-9af490ae.js";import"./useControlled-1.0.23-1e71c28b.js";import"./useSlot-1.0.23-b9d48820.js";import"./createStyled-1.0.23-528f26c2.js";import"./SwitchBase-1.0.23-adccc77c.js";import"./Close-1.0.23-ea28bfa6.js";import"./Popper-1.0.23-4a0d0616.js";import"./colorManipulator-1.0.23-e382be1d.js";const Ye=({appId:t,columnIndex:o,tableColumn:i})=>{const d=A(),s=E(t);return e.jsxs(c,{sx:{margin:"0 1rem 2rem 1rem"},children:[e.jsx(w,{children:"Width"}),e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"1fr auto",gridGap:"30px",alignItems:"center"},children:[e.jsx(X,{min:60,max:420,step:1,value:i.width,marks:[{value:60,label:"60"},{value:120,label:"120"},{value:180,label:"180"},{value:240,label:"240"},{value:300,label:"320"},{value:360,label:"360"},{value:420,label:"420"}],valueLabelDisplay:"auto",onChange:(a,m)=>{d(Z({appId:t,index:o,width:m})),s(!0),a.stopPropagation()}}),e.jsx("span",{children:"px"})]}),e.jsx(S,{children:e.jsxs(v,{children:["Column width is relative when responsiveness = ",e.jsx("strong",{children:"auto column hiding"}),"."]})})]})},Ke=({appId:t,columnIndex:o,tableColumn:i})=>{var p,n,f,C,F;h.debug(t,o,i),A();const d=Ue(t),s=M.useMemo(()=>$(I.getState(),t),[]);B(t,s);const[a,m]=M.useState(!1);M.useState(!1),E(t);const l=!0;return e.jsxs(G,{disableGutters:!0,children:[e.jsxs(U,{expandIcon:e.jsx(_,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(We,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Column actions"})]}),e.jsxs(W,{sx:{display:"grid",paddingTop:"1rem"},children:[e.jsxs(c,{sx:{margin:"0 10px",display:"grid",gridTemplateColumns:"auto"},children:[i.computedField?e.jsx(k,{control:e.jsx(T,{checked:!1,disabled:!0}),label:"Enable inline search",labelPlacement:"end"}):e.jsx(k,{control:e.jsx(T,{checked:i.inlineSearch&&!l,disabled:l,onChange:(u,D)=>{u.stopPropagation()}}),label:"Enable column filter",labelPlacement:"end"}),i.inlineSearch&&!l&&e.jsxs(c,{children:[e.jsxs(He,{sx:{flexDirection:"column",alignContent:"flex-start",marginLeft:"20px",marginTop:"10px",marginBottom:"10px"},children:[e.jsxs(w,{className:"align-label-radio",children:[e.jsx(O,{checked:i.inlineSearchEnum===R.SEARCHBOX,disabled:!0,onChange:u=>{u.stopPropagation()}}),"Searchbox"]}),e.jsxs(w,{className:"align-label-radio",children:[e.jsx(O,{checked:i.inlineSearchEnum===R.DROPDOWN,disabled:!0,onChange:u=>{u.stopPropagation()}}),"Drop-down list"]}),e.jsxs(w,{className:"align-label-radio",children:[e.jsx(O,{checked:i.inlineSearchEnum===R.MULTISELECT,disabled:!0,onChange:u=>{u.stopPropagation()}}),"Multi-select drop-down list"]}),e.jsxs(w,{className:"align-label-radio",children:[e.jsx(O,{checked:i.inlineSearchEnum===R.SEARCHPANE,disabled:!0,onChange:u=>{u.stopPropagation()}}),"Search pane"]})]}),i.lookup!==void 0&&((p=i.lookup)==null?void 0:p.loadOnStartup)!==!0&&e.jsx(S,{sx:{marginBottom:"20px",marginLeft:"5px"},children:e.jsxs(v,{sx:{color:(n=J)==null?void 0:n.palette.error.main,"& svg":{marginRight:"5px",verticalAlign:"middle"}},children:[e.jsx(Ee,{size:"18px"}),e.jsx("span",{children:"Drop-down lists are only supported for lookups loaded into memory on startup."})]})}),e.jsx(L,{fullWidth:!0,type:"number",label:"Order",value:i.columnFilterOrder,helperText:"Position of column filter in search panel.",disabled:!0,onChange:u=>{u.stopPropagation()},sx:{marginLeft:"15px",marginBottom:"20px"}})]}),((f=s==null?void 0:s.privs)==null?void 0:f.update)&&s.primary_key.length>0&&e.jsx(e.Fragment,{children:!i.computedField&&!i.columnName.startsWith(H.relationTablePrefix)&&!(((C=d==null?void 0:d.state)==null?void 0:C.masterDetailConditions)!==void 0&&((F=d==null?void 0:d.state)==null?void 0:F.masterDetailConditions[i.columnName])!==void 0)?e.jsx(k,{control:e.jsx(T,{checked:i.visible&&i.inlineEditing,disabled:!0,onChange:(u,D)=>{u.stopPropagation()}}),label:"Enable inline editing",labelPlacement:"end"}):e.jsx(k,{control:e.jsx(T,{checked:!1,disabled:!0}),label:"Enable inline editing",labelPlacement:"end"})})]}),!1,e.jsxs(v,{component:"div",sx:{marginTop:"30px"},children:[e.jsx(c,{children:e.jsxs(qe,{sx:{textDecoration:"none",cursor:"pointer",display:"inline-flex","& svg":{fontSize:"1rem",marginRight:"2px"}},onClick:()=>m(!a),children:[e.jsx(Pe,{}),"What are column actions?"]})}),a&&e.jsxs(c,{sx:{marginTop:"20px",display:"grid",gap:"20px"},children:[e.jsx(c,{children:"Column actions are inline actions added to a table column to enhance usability and user-friendliness."}),e.jsx(c,{children:e.jsx("strong",{children:"Column filtering"})}),e.jsx(c,{children:"When column filtering is enabled, a search field is added to the table for performing column-specific searches. A search box allows wildcard searches, while drop-down lists perform exact searches. Exact searches can improve performance, especially when the searched columns are well-indexed."}),e.jsx(c,{children:"To enable the column filter feature, go to the TABLE section under Column Filters. You can also change the position of the column filters."}),e.jsx(c,{children:"The global filter performs a wildcard search. This feature can be disabled in the TABLE section under Global filter."}),e.jsx(c,{children:e.jsx("strong",{children:"Inline editing"})}),e.jsx(c,{children:"Inline editing allows users to change table columns directly, without needing to open a data entry form. This feature is not available for primary key fields. Drop-down lists are automatically generated for enum and set data types."})]})]}),e.jsx(q,{})]})]})},Ze=({appId:t,columnIndex:o,tableColumn:i})=>{var l,p;const d=A(),s=E(t),a=B(t),m=(n,f)=>{h.debug(n,f)};return e.jsxs(G,{disableGutters:!0,children:[e.jsxs(U,{expandIcon:e.jsx(_,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(Ve,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Column settings"})]}),e.jsxs(W,{sx:{display:"grid",gridGap:"2rem",paddingTop:"1rem"},children:[(i.computedField||a[i.columnName]!==void 0&&(x(a[i.columnName].data_type)==="float"||x(a[i.columnName].data_type)==="number"||x(a[i.columnName].data_type)==="time"||x(a[i.columnName].data_type,!0)==="date"||x(a[i.columnName].data_type,!0)==="datetime"||x(a[i.columnName].data_type,!0)==="timestamp"||x(a[i.columnName].data_type,!0)==="time"))&&e.jsx(c,{children:e.jsxs(S,{children:[e.jsx(k,{control:e.jsx(T,{checked:!1,disabled:!0,onClick:n=>{n.stopPropagation()}}),label:"Localize",labelPlacement:"end"}),e.jsx(v,{children:i.computedField||a[i.columnName]!==void 0&&(x(a[i.columnName].data_type)==="float"||x(a[i.columnName].data_type)==="number")?"Localizes decimal and thousands seperators.":"Localizes date and time fields."})]})}),(a[i.columnName]!==void 0&&x(a[i.columnName].data_type,!0)==="float"||i.computedField!==void 0)&&e.jsxs(S,{children:[e.jsx(w,{children:"Decimals"}),e.jsx(X,{min:0,max:6,value:i.decimals,marks:[{value:0,label:"0"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"},{value:5,label:"5"},{value:6,label:"∞"}],valueLabelDisplay:"auto",disabled:!0,onChange:(n,f)=>{h.debug(f),n.stopPropagation()}}),e.jsx(v,{children:"Number of decimals displayed."})]}),a[i.columnName]!==void 0&&i.localize&&(x(a[i.columnName].data_type,!0)==="datetime"||x(a[i.columnName].data_type,!0)==="timestamp")&&e.jsx(c,{children:x(a[i.columnName].data_type)==="date"&&e.jsx(S,{children:e.jsx(k,{control:e.jsx(T,{checked:!1,disabled:!0,onClick:n=>{n.stopPropagation()}}),label:"Add trailing zeros to days and month",labelPlacement:"end"})})}),e.jsxs(S,{children:[e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"10px",alignItems:"center"},children:[e.jsx(L,{type:"text",variant:"outlined",label:"Prefix",value:i.prefix,disabled:!0,InputLabelProps:{shrink:!0},onChange:n=>{n.stopPropagation()}}),e.jsx(L,{type:"text",variant:"outlined",label:"Suffix",value:i.suffix,disabled:!0,InputLabelProps:{shrink:!0},onChange:n=>{n.stopPropagation()}})]}),e.jsx(v,{children:"Adds a prefix and/or suffix to the column content (also added to inline text and number fields)."})]}),e.jsxs(S,{children:[e.jsx(L,{type:"text",variant:"outlined",label:"CSS classes",fullWidth:!0,value:i.classNames,disabled:!0,InputLabelProps:{shrink:!0},onChange:n=>{n.stopPropagation()}}),e.jsx(v,{children:"CSS classes (seperated by spaces) for custom styling."})]}),e.jsxs(S,{children:[e.jsx(k,{control:e.jsx(T,{checked:i.allowMarkup,onChange:(n,f)=>{d(ee({appId:t,index:o,allowMarkup:f})),s(!0),n.stopPropagation()}}),label:"Allow inline HTML",labelPlacement:"end"}),e.jsxs(v,{children:["Allows markup in column content. ",e.jsx("span",{style:{...i.allowMarkup&&{color:((p=(l=J)==null?void 0:l.palette)==null?void 0:p.error.main)??"red"}},children:"Enabling this feature may pose a risk of cross-site scripting (XSS) attacks."})]})]}),e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"auto"},children:[e.jsx(k,{control:e.jsx(T,{checked:!1,disabled:!0,onClick:n=>{ie.appFeature===!0&&m(o,!i.visibleTablet),n.stopPropagation()}}),label:"Show column on tablet",labelPlacement:"end"}),e.jsx(k,{control:e.jsx(T,{checked:!1,disabled:!0,onClick:n=>{n.stopPropagation()}}),label:"Show column on mobile",labelPlacement:"end"})]}),e.jsx(q,{single:!1,margin:"0"})]})]})},$e=[{key:b.SUM,label:y.SUM},{key:b.MIN,label:y.MIN},{key:b.MAX,label:y.MAX},{key:b.AVG,label:y.AVG},{key:b.COUNT,label:y.COUNT},{key:b.UNIQUE,label:y.UNIQUE},{key:b.STD,label:y.STD},{key:b.VARIANCE,label:y.VARIANCE},{key:b.MEDIAN,label:y.MEDIAN}],Q=[...$e],Ie=({appId:t,columnIndex:o,tableColumn:i})=>{h.debug(t,o,i),A(),E(t);const d=B(t),s=M.useMemo(()=>{var a;return(i==null?void 0:i.aggregation)===void 0?[]:(a=i==null?void 0:i.aggregation)==null?void 0:a.map(m=>Q.filter(l=>l.key===m)[0])},[i==null?void 0:i.aggregation]);return!se(t)||i.computedField===void 0&&x(d[i.columnName].data_type)!=="number"?null:e.jsxs(G,{disableGutters:!0,children:[e.jsxs(U,{expandIcon:e.jsx(_,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(ze,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Aggregations"})]}),e.jsxs(W,{sx:{marginTop:"10px"},children:[e.jsxs(S,{fullWidth:!0,children:[e.jsx(Qe,{multiple:!0,options:Q,disabled:!0,disableCloseOnSelect:!0,getOptionLabel:a=>a.label,value:s,onChange:(a,m)=>{a.stopPropagation()},renderOption:(a,m,{selected:l})=>e.jsxs("li",{...a,children:[e.jsx(Xe,{icon:e.jsx(Ne,{}),checkedIcon:e.jsx(Me,{}),style:{marginRight:8},checked:l}),m.label]}),renderInput:a=>e.jsx(L,{...a,label:"Select from list"})}),e.jsx(v,{children:"Allows multiple selections. Displayed in order of entry."})]}),e.jsx(q,{})]})]})},ei=({appId:t,columnIndex:o,tableColumn:i})=>{h.debug(t,o,i);const d=A(),s=E(t),m=B(t)[i.columnName],l=(p,n)=>{d(te({appId:t,columnName:i.columnName})),d(ae({appId:t,columnName:i.columnName})),d(ne({appId:t,index:p,lookup:n})),s(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(Ye,{appId:t,columnIndex:o,tableColumn:i}),e.jsx(Ze,{appId:t,columnIndex:o,tableColumn:i}),e.jsx(Ke,{appId:t,columnIndex:o,tableColumn:i}),e.jsx(pe,{appId:t,columnIndex:o,tableColumn:i,columnMetaData:m,setLookup:l}),e.jsx(Ie,{appId:t,columnIndex:o,tableColumn:i}),e.jsx(ue,{columnMetaData:m})]})},ii=({appId:t,columnIndex:o,tableType:i})=>{h.debug(t,o,i);const d=A(),s=we(r=>re(r,t,o));h.debug("tableColumn",s);const a=E(t),[m,l]=M.useState(!1),[p,n]=M.useState(void 0),f=r=>{r!==void 0&&(d(oe({appId:t,index:r})),a(!0))},C=(r,g)=>{h.debug(r,g),d(le({appId:t,index:r,visible:g})),a(!0)},F=(r,g)=>{h.debug(r,g),d(de({appId:t,index:r,queryable:g})),a(!0)},u=(r,g)=>{h.debug(r,g),d(ce({appId:t,index:r,orderable:g})),a(!0)},D=(r,g)=>{d(me({appId:t,index:r,alignment:g})),a(!0)},Y=(r,g,K)=>(h.debug(r,g,K),e.jsxs(e.Fragment,{children:[e.jsx(c,{sx:{"& svg":{pointerEvents:"none",opacity:"0.5"}},children:e.jsx(xe,{id:r,enabled:!1},r)}),e.jsxs(c,{sx:{display:"inline-grid",gridTemplateColumns:s.computedField!==void 0?"auto auto":"auto",justifyContent:"start",alignItems:"center",gap:"10px","& svg":{opacity:"0.5"}},children:[s.computedField!==void 0&&e.jsx(Ae,{}),e.jsx(w,{children:g})]})]}));return e.jsxs(e.Fragment,{children:[e.jsxs(G,{disableGutters:!0,slotProps:{transition:{unmountOnExit:!0}},children:[e.jsxs(U,{className:"pp-column-settings",expandIcon:e.jsx(_,{}),sx:{justifyContent:"space-between",position:"relative"},children:[i!==""&&e.jsx(c,{sx:{position:"absolute",top:"5px",right:"5px",fontSize:"50%"},children:i}),e.jsx(c,{sx:{display:"grid",gridTemplateColumns:"auto 1fr",alignItems:"center","& svg":{display:"flex"}},children:Y(s.columnName,s.columnLabel,o)}),e.jsxs("div",{style:{display:"inline-grid",gridTemplateColumns:"40px 40px 40px 40px"},children:[e.jsx(P,{title:"Visibility",position:"bottom",children:e.jsx(N,{onClick:r=>{C(o,!s.visible),r.stopPropagation()},children:e.jsx(V,{checked:s.visible,children:e.jsx(De,{})})})}),s.computedField?e.jsx(P,{title:"Edit",position:"bottom",children:e.jsx("span",{children:e.jsx(N,{disabled:!0,onClick:r=>{r.stopPropagation()},children:e.jsx(Ce,{})})})}):e.jsx(P,{title:"Searchable",position:"bottom",children:e.jsx(N,{onClick:r=>{F(o,!s.queryable),r.stopPropagation()},children:e.jsx(V,{checked:s.queryable,alignRight:!1,children:e.jsx(Le,{})})})}),s.computedField?e.jsx(P,{title:"Delete",position:"bottom",children:e.jsx(N,{onClick:r=>{n(o),l(!0),r.stopPropagation()},children:e.jsx(Re,{})})}):e.jsx(P,{title:"Sortable",position:"bottom",disabled:s.visible===!1,children:e.jsx(N,{disabled:s.visible===!1,onClick:r=>{u(o,!s.orderable),r.stopPropagation()},children:e.jsx(V,{checked:s.orderable,forceOff:s.visible===!1,children:e.jsx(Fe,{})})})}),e.jsx(P,{title:"Alignment",position:"bottom",disabled:s.visible===!1,children:e.jsxs(N,{disabled:s.visible===!1,onClick:r=>{s.alignment===j.LEFT?D(o,j.CENTER):s.alignment===j.CENTER?D(o,j.RIGHT):s.alignment===j.RIGHT&&D(o,j.LEFT),a(!0),r.stopPropagation()},children:[s.alignment===j.LEFT&&e.jsx(Oe,{}),s.alignment===j.CENTER&&e.jsx(Be,{}),s.alignment===j.RIGHT&&e.jsx(_e,{})]})})]})]}),e.jsx(W,{children:e.jsx(ei,{appId:t,columnIndex:o,tableColumn:s})})]},o),e.jsx(Ge,{title:"Delete computed field?",message:"Are you sure you want to delete this computed field? This action cannot be undone!",open:m,setOpen:l,onConfirm:()=>f(p)})]})},ss=({appId:t,metaData:o})=>{h.debug(t,o),A();const i=ge(z(ke),z(ve),z(Se));E(t);const d=l=>{const{active:p,over:n}=l;h.debug(p,n),p==null||p.id,n==null||n.id},s=Te(t),a=()=>(s==null?void 0:s.filter(l=>l.startsWith(H.relationTablePrefix)).length)>0,m=l=>a()?l.startsWith(H.relationTablePrefix)?"Relation Table Column":"Join Table Column":"";return s===void 0||s.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx(he,{autoScroll:!0,sensors:i,collisionDetection:fe,onDragEnd:d,children:e.jsx(je,{items:s,children:s.map((l,p)=>e.jsx(be,{id:l,children:e.jsx(ii,{appId:t,columnIndex:p,tableType:m(l)})},l))})}),e.jsx(ye,{appId:t,target:Je.TABLE})]})};export{ss as default};
