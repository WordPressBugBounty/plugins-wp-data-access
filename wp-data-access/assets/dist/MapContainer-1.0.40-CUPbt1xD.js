const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Alert-1.0.40-Bz3Zj62D.js","./cm-1.0.40-DO7MoydR.js","./redux-1.0.40-W_04YL6Z.js","./vendor-1.0.40-CN03Eozo.js","./index-1.0.40-D3XFZfpM.js","./iconBase-1.0.40-CH6TO7hF.js","./Typography-1.0.40-oRKYqE3b.js","./lib-1.0.40-CJM-IO_o.js","./loglevel-1.0.40-BZ7XahX3.js","./lodash-1.0.40-yZQKpWII.js","./moment-1.0.40-C5S46NFB.js","./useEnhancedEffect-1.0.40-DvrM_gBo.js","./AlertTitle-1.0.40-BbdAhoXf.js","./createSvgIcon-1.0.40-DryBVjDb.js","./Close-1.0.40-DOQmTCBQ.js","./Settings-1.0.40-qr787GPg.js","./main-1.0.40.js","./notistack-1.0.40-HUa4vT_u.js","./hooks-1.0.40-DoKijNI1.js","./BuilderMenu-1.0.40-wmot84K1.js","./index-1.0.40-DmMQghWt.js","./Spinner-1.0.40-Bmn0_C4u.js","./ConfirmDialog-1.0.40-DRjx8-xC.js","./AdminTheme-1.0.40-B669Ow89.js","./Menu-1.0.40-BKp7UqHL.js","./ThemeProvider-1.0.40-D9QtC9zH.js","./MenuItem-1.0.40-UKMJrtYZ.js","./Tooltip-1.0.40-C5SL6QF3.js","./Tooltip-1.0.40--D4jr2go.css","./ActionsSettings-1.0.40-eUdZc7P-.js","./RestApi-1.0.40-Uj1ofskP.js","./TargetEnum-1.0.40-CIW1jlU5.js","./useMapUpdater-1.0.40-BcGwfhdr.js","./DynamicModeEnum-1.0.40-BXuL5kgA.js","./TabPanel-1.0.40-svpV7m9Q.js","./useThemeProps-1.0.40-CnqSFvnT.js","./getThemeProps-1.0.40-CtGZuG5N.js","./settings-1.0.40-Bx2jvYL6.css"])))=>i.map(i=>d[i]);
import{_ as Me}from"./main-1.0.40.js";import{j as d}from"./cm-1.0.40-DO7MoydR.js";import{r as a,R as k}from"./redux-1.0.40-W_04YL6Z.js";import{r as Le,e as $}from"./notistack-1.0.40-HUa4vT_u.js";import{g as Be}from"./vendor-1.0.40-CN03Eozo.js";import{af as De,l as I,aj as Ue,d as He,ak as Ge,a7 as Ze,ae as $e,r as Je,a6 as qe,C as Ke,ai as Ve,al as F,am as We}from"./lib-1.0.40-CJM-IO_o.js";import{u as Ye,a as ke}from"./hooks-1.0.40-DoKijNI1.js";import{a as Xe}from"./AdminTheme-1.0.40-B669Ow89.js";import{a as Qe}from"./RestApi-1.0.40-Uj1ofskP.js";import"./dompurify-1.0.40-DhD2mIk-.js";import"./moment-1.0.40-C5S46NFB.js";import{u as et}from"./useMetadata-1.0.40-DdsiIGYX.js";import{u as tt,a as nt,L as rt}from"./useRemoveAppFromStore-1.0.40-DxUqDH6k.js";import{A as ot,T as xe,f as it,M as at}from"./index-1.0.40-DmMQghWt.js";import{B as W,S as st}from"./Spinner-1.0.40-Bmn0_C4u.js";import{T as me}from"./Tooltip-1.0.40-Czv1q8N-.js";import{I as ge}from"./iconBase-1.0.40-CH6TO7hF.js";import{F as lt}from"./FallbackSpinner-1.0.40-Bwyy_LaW.js";import{A as ut,u as ct}from"./AppTheme-1.0.40-whCBYKjb.js";import{a as dt}from"./index-1.0.40-BIp4XK-5.js";import{S as ft}from"./Select-1.0.40-Db-Xnyoo.js";import{M as mt}from"./MenuItem-1.0.40-UKMJrtYZ.js";import{T as gt,a as pe}from"./ToggleButtonGroup-1.0.40-NUyVrBPO.js";import{g as pt}from"./tab-1.0.40-BzKjBB9y.js";import{T as he}from"./ThemeProvider-1.0.40-D9QtC9zH.js";import"./loglevel-1.0.40-BZ7XahX3.js";import"./lodash-1.0.40-yZQKpWII.js";import"./Typography-1.0.40-oRKYqE3b.js";import"./lang-1.0.40-D4Y70Q_T.js";import"./useEnhancedEffect-1.0.40-DvrM_gBo.js";import"./useControlled-1.0.40-B7yPDtn1.js";import"./Popper-1.0.40-Jt4gcDMJ.js";import"./index-1.0.40-xxiPHCiq.js";import"./getThemeProps-1.0.40-CtGZuG5N.js";import"./Menu-1.0.40-BKp7UqHL.js";import"./utils-1.0.40-iop7lDec.js";import"./useFormControl-1.0.40-BL8koKXQ.js";import"./createSvgIcon-1.0.40-DryBVjDb.js";var V,ve;function ht(){return ve||(ve=1,V=function t(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var o,s,r;if(Array.isArray(e)){if(o=e.length,o!=n.length)return!1;for(s=o;s--!==0;)if(!t(e[s],n[s]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(r=Object.keys(e),o=r.length,o!==Object.keys(n).length)return!1;for(s=o;s--!==0;)if(!Object.prototype.hasOwnProperty.call(n,r[s]))return!1;for(s=o;s--!==0;){var i=r[s];if(!t(e[i],n[i]))return!1}return!0}return e!==e&&n!==n}),V}var vt=ht();const yt=Be(vt);function w(){return w=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)({}).hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},w.apply(null,arguments)}function B(t,e){if(t==null)return{};var n={};for(var o in t)if({}.hasOwnProperty.call(t,o)){if(e.indexOf(o)!==-1)continue;n[o]=t[o]}return n}function bt(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var o=n.call(t,e);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function Ct(t){var e=bt(t,"string");return typeof e=="symbol"?e:e+""}const z={NOT_LOADED:"NOT_LOADED",LOADING:"LOADING",LOADED:"LOADED",FAILED:"FAILED",AUTH_FAILURE:"AUTH_FAILURE"},Mt="https://maps.googleapis.com/maps/api/js";class H{static async load(e,n){var o;const s=e.libraries?e.libraries.split(","):[],r=this.serializeParams(e);this.listeners.push(n),(o=window.google)!=null&&(o=o.maps)!=null&&o.importLibrary?(this.serializedApiParams||(this.loadingStatus=z.LOADED),this.notifyLoadingStatusListeners()):(this.serializedApiParams=r,this.initImportLibrary(e)),this.serializedApiParams&&this.serializedApiParams!==r&&console.warn("[google-maps-api-loader] The maps API has already been loaded with different parameters and will not be loaded again. Refresh the page for new values to have effect.");const i=["maps",...s];await Promise.all(i.map(l=>google.maps.importLibrary(l)))}static serializeParams(e){return[e.v,e.key,e.language,e.region,e.authReferrerPolicy,e.solutionChannel].join("/")}static initImportLibrary(e){if(window.google||(window.google={}),window.google.maps||(window.google.maps={}),window.google.maps.importLibrary){console.error("[google-maps-api-loader-internal]: initImportLibrary must only be called once");return}let n=null;const o=()=>n||(n=new Promise((s,r)=>{var i;const l=document.createElement("script"),u=new URLSearchParams;for(const[m,g]of Object.entries(e)){const y=m.replace(/[A-Z]/g,h=>"_"+h[0].toLowerCase());u.set(y,String(g))}u.set("loading","async"),u.set("callback","__googleMapsCallback__"),l.async=!0,l.src=Mt+"?"+u.toString(),l.nonce=((i=document.querySelector("script[nonce]"))==null?void 0:i.nonce)||"",l.onerror=()=>{this.loadingStatus=z.FAILED,this.notifyLoadingStatusListeners(),r(new Error("The Google Maps JavaScript API could not load."))},window.__googleMapsCallback__=()=>{this.loadingStatus=z.LOADED,this.notifyLoadingStatusListeners(),s()},window.gm_authFailure=()=>{this.loadingStatus=z.AUTH_FAILURE,this.notifyLoadingStatusListeners()},this.loadingStatus=z.LOADING,this.notifyLoadingStatusListeners(),document.head.append(l)}),n);google.maps.importLibrary=s=>o().then(()=>google.maps.importLibrary(s))}static notifyLoadingStatusListeners(){for(const e of this.listeners)e(this.loadingStatus)}}H.loadingStatus=z.NOT_LOADED;H.serializedApiParams=void 0;H.listeners=[];const Lt=["onLoad","onError","apiKey","version","libraries"],kt=["children"],xt="GMP_visgl_rgmlibrary_v1_default",G=k.createContext(null);function Et(){const[t,e]=a.useState({});return{mapInstances:t,addMapInstance:(r,i="default")=>{e(l=>w({},l,{[i]:r}))},removeMapInstance:(r="default")=>{e(i=>B(i,[r].map(Ct)))},clearMapInstances:()=>{e({})}}}function It(t){const{onLoad:e,onError:n,apiKey:o,version:s,libraries:r=[]}=t,i=B(t,Lt),[l,u]=a.useState(H.loadingStatus),[m,g]=a.useReducer((c,b)=>c[b.name]?c:w({},c,{[b.name]:b.value}),{}),y=a.useMemo(()=>r==null?void 0:r.join(","),[r]),h=a.useMemo(()=>JSON.stringify(w({apiKey:o,version:s},i)),[o,s,i]),p=a.useCallback(async c=>{var b;if(m[c])return m[c];if(!((b=google)!=null&&(b=b.maps)!=null&&b.importLibrary))throw new Error("[api-provider-internal] importLibrary was called before google.maps.importLibrary was defined.");const M=await window.google.maps.importLibrary(c);return g({name:c,value:M}),M},[m]);return a.useEffect(()=>{(async()=>{try{const c=w({key:o},i);s&&(c.v=s),(y==null?void 0:y.length)>0&&(c.libraries=y),(c.channel===void 0||c.channel<0||c.channel>999)&&delete c.channel,c.solutionChannel===void 0?c.solutionChannel=xt:c.solutionChannel===""&&delete c.solutionChannel,await H.load(c,b=>u(b));for(const b of["core","maps",...r])await p(b);e&&e()}catch(c){n?n(c):console.error("<ApiProvider> failed to load the Google Maps JavaScript API",c)}})()},[o,y,h]),{status:l,loadedLibraries:m,importLibrary:p}}const Ot=t=>{const{children:e}=t,n=B(t,kt),{mapInstances:o,addMapInstance:s,removeMapInstance:r,clearMapInstances:i}=Et(),{status:l,loadedLibraries:u,importLibrary:m}=It(n),g=a.useMemo(()=>({mapInstances:o,addMapInstance:s,removeMapInstance:r,clearMapInstances:i,status:l,loadedLibraries:u,importLibrary:m}),[o,s,r,i,l,u,m]);return k.createElement(G.Provider,{value:g},e)};function At(t,e){for(const n of Pt){const o=e[n],s=Ee[n];a.useEffect(()=>{if(!t||!o)return;const r=google.maps.event.addListener(t,s,i=>{o(_t(s,t,i))});return()=>r.remove()},[t,s,o])}}function _t(t,e,n){const o={type:t,map:e,detail:{},stoppable:!1,stop:()=>{}};if(St.includes(t)){const r=o,i=e.getCenter(),l=e.getZoom(),u=e.getHeading()||0,m=e.getTilt()||0,g=e.getBounds();return(!i||!g||!Number.isFinite(l))&&console.warn("[createEvent] at least one of the values from the map returned undefined. This is not expected to happen. Please report an issue at https://github.com/visgl/react-google-maps/issues/new"),r.detail={center:(i==null?void 0:i.toJSON())||{lat:0,lng:0},zoom:l||0,heading:u,tilt:m,bounds:(g==null?void 0:g.toJSON())||{north:90,east:180,south:-90,west:-180}},r}else if(wt.includes(t)){var s;if(!n)throw new Error("[createEvent] mouse events must provide a srcEvent");const r=o;return r.domEvent=n.domEvent,r.stoppable=!0,r.stop=()=>n.stop(),r.detail={latLng:((s=n.latLng)==null?void 0:s.toJSON())||null,placeId:n.placeId},r}return o}const Ee={onBoundsChanged:"bounds_changed",onCenterChanged:"center_changed",onClick:"click",onContextmenu:"contextmenu",onDblclick:"dblclick",onDrag:"drag",onDragend:"dragend",onDragstart:"dragstart",onHeadingChanged:"heading_changed",onIdle:"idle",onIsFractionalZoomEnabledChanged:"isfractionalzoomenabled_changed",onMapCapabilitiesChanged:"mapcapabilities_changed",onMapTypeIdChanged:"maptypeid_changed",onMousemove:"mousemove",onMouseout:"mouseout",onMouseover:"mouseover",onProjectionChanged:"projection_changed",onRenderingTypeChanged:"renderingtype_changed",onTilesLoaded:"tilesloaded",onTiltChanged:"tilt_changed",onZoomChanged:"zoom_changed",onCameraChanged:"bounds_changed"},St=["bounds_changed","center_changed","heading_changed","tilt_changed","zoom_changed"],wt=["click","contextmenu","dblclick","mousemove","mouseout","mouseover"],Pt=Object.keys(Ee);function Nt(t,e){const n=a.useRef(void 0);(!n.current||!yt(e,n.current))&&(n.current=e),a.useEffect(t,n.current)}const Tt=new Set(["backgroundColor","clickableIcons","controlSize","disableDefaultUI","disableDoubleClickZoom","draggable","draggableCursor","draggingCursor","fullscreenControl","fullscreenControlOptions","gestureHandling","headingInteractionEnabled","isFractionalZoomEnabled","keyboardShortcuts","mapTypeControl","mapTypeControlOptions","mapTypeId","maxZoom","minZoom","noClear","panControl","panControlOptions","restriction","rotateControl","rotateControlOptions","scaleControl","scaleControlOptions","scrollwheel","streetView","streetViewControl","streetViewControlOptions","styles","tiltInteractionEnabled","zoomControl","zoomControlOptions"]);function jt(t,e){const n={},o=Object.keys(e);for(const s of o)Tt.has(s)&&(n[s]=e[s]);Nt(()=>{t&&t.setOptions(n)},[n])}function Ie(){var t;return((t=a.useContext(G))==null?void 0:t.status)||z.NOT_LOADED}function Rt(t,e){const{viewport:n,viewState:o}=e,s=!!n;return a.useLayoutEffect(()=>{if(!t||!o)return;const{latitude:r,longitude:i,bearing:l,pitch:u,zoom:m}=o;t.moveCamera({center:{lat:r,lng:i},heading:l,tilt:u,zoom:m+1})},[t,o]),s}function zt(t){return!t||typeof t!="object"||!("lat"in t&&"lng"in t)?!1:Number.isFinite(t.lat)&&Number.isFinite(t.lng)}function Oe(t){return zt(t)?t:t.toJSON()}function Ft(t,e,n){const o=n.center?Oe(n.center):null;let s=null,r=null;o&&Number.isFinite(o.lat)&&Number.isFinite(o.lng)&&(s=o.lat,r=o.lng);const i=Number.isFinite(n.zoom)?n.zoom:null,l=Number.isFinite(n.heading)?n.heading:null,u=Number.isFinite(n.tilt)?n.tilt:null;a.useLayoutEffect(()=>{if(!t)return;const m={};let g=!1;s!==null&&r!==null&&(e.current.center.lat!==s||e.current.center.lng!==r)&&(m.center={lat:s,lng:r},g=!0),i!==null&&e.current.zoom!==i&&(m.zoom=i,g=!0),l!==null&&e.current.heading!==l&&(m.heading=l,g=!0),u!==null&&e.current.tilt!==u&&(m.tilt=u,g=!0),g&&t.moveCamera(m)})}const Bt=()=>{const t={position:"absolute",top:0,left:0,bottom:0,right:0,zIndex:999,display:"flex",flexFlow:"column nowrap",textAlign:"center",justifyContent:"center",fontSize:".8rem",color:"rgba(0,0,0,0.6)",background:"#dddddd",padding:"1rem 1.5rem"};return k.createElement("div",{style:t},k.createElement("h2",null,"Error: AuthFailure"),k.createElement("p",null,"A problem with your API key prevents the map from rendering correctly. Please make sure the value of the ",k.createElement("code",null,"APIProvider.apiKey")," prop is correct. Check the error-message in the console for further details."))};function Dt(){const[t,e]=a.useState(null),n=a.useCallback(o=>e(o),[e]);return[t,n]}function Ae(){return Ie()===z.LOADED}function Ut(){const[,t]=a.useReducer(e=>e+1,0);return t}function Ht(t,e){const n=t.getCenter(),o=t.getZoom(),s=t.getHeading()||0,r=t.getTilt()||0,i=t.getBounds();(!n||!i||!Number.isFinite(o))&&console.warn("[useTrackedCameraState] at least one of the values from the map returned undefined. This is not expected to happen. Please report an issue at https://github.com/visgl/react-google-maps/issues/new"),Object.assign(e.current,{center:(n==null?void 0:n.toJSON())||{lat:0,lng:0},zoom:o||0,heading:s,tilt:r})}function Gt(t){const e=Ut(),n=a.useRef({center:{lat:0,lng:0},heading:0,tilt:0,zoom:0});return a.useEffect(()=>{if(!t)return;const o=google.maps.event.addListener(t,"bounds_changed",()=>{Ht(t,n),e()});return()=>o.remove()},[t,e]),n}const Zt=["id","defaultBounds","defaultCenter","defaultZoom","defaultHeading","defaultTilt","reuseMaps","renderingType","colorScheme"],$t=["padding"];class K{static has(e){return this.entries[e]&&this.entries[e].length>0}static pop(e){return this.entries[e]&&this.entries[e].pop()||null}static push(e,n){this.entries[e]||(this.entries[e]=[]),this.entries[e].push(n)}}K.entries={};function Jt(t,e){const n=Ae(),[o,s]=a.useState(null),[r,i]=Dt(),l=Gt(o),{id:u,defaultBounds:m,defaultCenter:g,defaultZoom:y,defaultHeading:h,defaultTilt:p,reuseMaps:c,renderingType:b,colorScheme:M}=t,C=B(t,Zt),L=t.zoom!==void 0||t.defaultZoom!==void 0,P=t.center!==void 0||t.defaultCenter!==void 0;!m&&(!L||!P)&&console.warn("<Map> component is missing configuration. You have to provide zoom and center (via the `zoom`/`defaultZoom` and `center`/`defaultCenter` props) or specify the region to show using `defaultBounds`. See https://visgl.github.io/react-google-maps/docs/api-reference/components/map#required"),!C.center&&g&&(C.center=g),!C.zoom&&Number.isFinite(y)&&(C.zoom=y),!C.heading&&Number.isFinite(h)&&(C.heading=h),!C.tilt&&Number.isFinite(p)&&(C.tilt=p);for(const A of Object.keys(C))C[A]===void 0&&delete C[A];const _=a.useRef(void 0);return a.useEffect(()=>{if(!r||!n)return;const{addMapInstance:A,removeMapInstance:x}=e,{mapId:S}=t,T=`${S||"default"}:${b||"default"}:${M||"LIGHT"}`;let N,O;if(c&&K.has(T)?(O=K.pop(T),N=O.getDiv(),r.appendChild(N),O.setOptions(C),setTimeout(()=>O.setCenter(O.getCenter()),0)):(N=document.createElement("div"),N.style.height="100%",r.appendChild(N),O=new google.maps.Map(N,w({},C,b?{renderingType:b}:{},M?{colorScheme:M}:{}))),s(O),A(O,u),m){const{padding:D}=m,U=B(m,$t);O.fitBounds(U,D)}else(!L||!P)&&O.fitBounds({east:180,west:-180,south:-90,north:90});if(_.current){const{mapId:D,cameraState:U}=_.current;D!==S&&O.setOptions(U)}return()=>{_.current={mapId:S,cameraState:l.current},N.remove(),c?K.push(T,O):google.maps.event.clearInstanceListeners(O),s(null),x(u)}},[r,n,u,t.mapId,t.renderingType,t.colorScheme]),[o,i,l]}const _e=k.createContext(null),Se=t=>{const{children:e,id:n,className:o,style:s}=t,r=a.useContext(G),i=Ie();if(!r)throw new Error("<Map> can only be used inside an <ApiProvider> component.");const[l,u,m]=Jt(t,r);Ft(l,m,t),At(l,t),jt(l,t);const g=Rt(l,t),y=!!t.controlled;a.useEffect(()=>{if(l)return g&&l.setOptions({disableDefaultUI:!0}),(g||y)&&l.setOptions({gestureHandling:"none",keyboardShortcuts:!1}),()=>{l.setOptions({gestureHandling:t.gestureHandling,keyboardShortcuts:t.keyboardShortcuts})}},[l,g,y,t.gestureHandling,t.keyboardShortcuts]);const h=t.center?Oe(t.center):null;let p=null,c=null;h&&Number.isFinite(h.lat)&&Number.isFinite(h.lng)&&(p=h.lat,c=h.lng);const b=a.useMemo(()=>{var L,P,_,A,x;return{center:{lat:(L=p)!=null?L:0,lng:(P=c)!=null?P:0},zoom:(_=t.zoom)!=null?_:0,heading:(A=t.heading)!=null?A:0,tilt:(x=t.tilt)!=null?x:0}},[p,c,t.zoom,t.heading,t.tilt]);a.useLayoutEffect(()=>{if(!l||!y)return;l.moveCamera(b);const L=l.addListener("bounds_changed",()=>{l.moveCamera(b)});return()=>L.remove()},[l,y,b]);const M=a.useMemo(()=>w({width:"100%",height:"100%",position:"relative",zIndex:g?-1:0},s),[s,g]),C=a.useMemo(()=>({map:l}),[l]);return i===z.AUTH_FAILURE?k.createElement("div",{style:w({position:"relative"},o?{}:M),className:o},k.createElement(Bt,null)):k.createElement("div",w({ref:u,"data-testid":"map",style:o?void 0:M,className:o},n?{id:n}:{}),l?k.createElement(_e.Provider,{value:C},e):null)};Se.deckGLViewProps=!0;const ye=new Set;function Y(...t){const e=JSON.stringify(t);ye.has(e)||(ye.add(e),console.error(...t))}const we=(t=null)=>{const e=a.useContext(G),{map:n}=a.useContext(_e)||{};if(e===null)return Y("useMap(): failed to retrieve APIProviderContext. Make sure that the <APIProvider> component exists and that the component you are calling `useMap()` from is a sibling of the <APIProvider>."),null;const{mapInstances:o}=e;return t!==null?o[t]||null:n||o.default||null};function qt(t){const e=Ae(),n=a.useContext(G);return a.useEffect(()=>{!e||!n||n.importLibrary(t)},[e,n,t]),(n==null?void 0:n.loadedLibraries[t])||null}function J(t,e,n){a.useEffect(()=>{if(!t||!e||!n)return;const o=google.maps.event.addListener(t,e,n);return()=>o.remove()},[t,e,n])}function q(t,e,n){a.useEffect(()=>{t&&(t[e]=n)},[t,e,n])}function be(t,e,n){a.useEffect(()=>{if(!(!t||!e||!n))return t.addEventListener(e,n),()=>t.removeEventListener(e,n)},[t,e,n])}function Kt(t){return t.nodeType===Node.ELEMENT_NODE}const Pe=k.createContext(null),Vt={BOTTOM:["50%","100%"]},Wt=({children:t,styles:e,className:n,anchorPoint:o})=>{const[s,r]=o??Vt.BOTTOM;let i=`-${s}`,l=`-${r}`;s.trimStart().startsWith("-")&&(i=s.substring(1)),r.trimStart().startsWith("-")&&(l=r.substring(1));const u=`translate(50%, 100%) translate(${i}, ${l})`;return k.createElement("div",{style:{transform:u}},k.createElement("div",{className:n,style:e},t))};function Yt(t){const[e,n]=a.useState(null),[o,s]=a.useState(null),r=we(),i=qt("marker"),{children:l,onClick:u,className:m,onMouseEnter:g,onMouseLeave:y,onDrag:h,onDragStart:p,onDragEnd:c,collisionBehavior:b,clickable:M,draggable:C,position:L,title:P,zIndex:_}=t,A=a.Children.count(l);return a.useEffect(()=>{if(!r||!i)return;const x=new i.AdvancedMarkerElement;x.map=r,n(x);let S=null;return A>0&&(S=document.createElement("div"),S.isCustomMarker=!0,x.content=S,s(S)),()=>{var T;x.map=null,(T=S)==null||T.remove(),n(null),s(null)}},[r,i,A]),a.useEffect(()=>{!e||!e.content||A>0||(e.content.className=m||"")},[e,m,A]),q(e,"position",L),q(e,"title",P??""),q(e,"zIndex",_),q(e,"collisionBehavior",b),a.useEffect(()=>{e&&(C!==void 0?e.gmpDraggable=C:h||p||c?e.gmpDraggable=!0:e.gmpDraggable=!1)},[e,C,h,c,p]),a.useEffect(()=>{if(!e)return;const x=M!==void 0||!!u||!!g||!!y;e.gmpClickable=x,x&&e!=null&&e.content&&Kt(e.content)&&(e.content.style.pointerEvents="none",e.content.firstElementChild&&(e.content.firstElementChild.style.pointerEvents="all"))},[e,M,u,g,y]),J(e,"click",u),J(e,"drag",h),J(e,"dragstart",p),J(e,"dragend",c),be(e==null?void 0:e.element,"mouseenter",g),be(e==null?void 0:e.element,"mouseleave",y),[e,o]}const Xt=a.forwardRef((t,e)=>{const{children:n,style:o,className:s,anchorPoint:r}=t,[i,l]=Yt(t),u=a.useMemo(()=>i?{marker:i}:null,[i]);return a.useImperativeHandle(e,()=>i,[i]),l?k.createElement(Pe.Provider,{value:u},Le.createPortal(k.createElement(Wt,{anchorPoint:r,styles:o,className:s},n),l)):null});function Qt(){const[t,e]=a.useState(null);return[a.useCallback(o=>{e(o)},[]),t]}const en=["onClick","onDrag","onDragStart","onDragEnd","onMouseOver","onMouseOut"];function tn(t){const[e,n]=a.useState(null),o=we(),{onClick:s,onDrag:r,onDragStart:i,onDragEnd:l,onMouseOver:u,onMouseOut:m}=t,g=B(t,en),{position:y,draggable:h}=g;return a.useEffect(()=>{if(!o){o===void 0&&console.error("<Marker> has to be inside a Map component.");return}const p=new google.maps.Marker(g);return p.setMap(o),n(p),()=>{p.setMap(null),n(null)}},[o]),a.useEffect(()=>{if(!e)return;const p=e,c=google.maps.event;return s&&c.addListener(p,"click",s),r&&c.addListener(p,"drag",r),i&&c.addListener(p,"dragstart",i),l&&c.addListener(p,"dragend",l),u&&c.addListener(p,"mouseover",u),m&&c.addListener(p,"mouseout",m),e.setDraggable(!!h),()=>{c.clearInstanceListeners(p)}},[e,h,s,r,i,l,u,m]),a.useEffect(()=>{e&&g&&e.setOptions(g)},[e,g]),a.useEffect(()=>{h||!y||!e||e.setPosition(y)},[h,y,e]),e}a.forwardRef((t,e)=>{const n=tn(t);return a.useImperativeHandle(e,()=>n,[n]),k.createElement(k.Fragment,null)});const nn=t=>{var e;const n=(e=a.useContext(Pe))==null?void 0:e.marker,o=a.useMemo(()=>document.createElement("div"),[]);return a.useEffect(()=>{var s;if(!n){n===void 0&&console.error("The <Pin> component can only be used inside <AdvancedMarker>.");return}t.glyph&&t.children&&Y("The <Pin> component only uses children to render the glyph if both the glyph property and children are present."),a.Children.count(t.children)>1&&Y("Passing multiple children to the <Pin> component might lead to unexpected results.");const r=w({},t),i=new google.maps.marker.PinElement(r);t.children&&(i.glyph=o);const l=(s=n.content)==null||(s=s.firstChild)==null?void 0:s.firstChild;for(;l!=null&&l.firstChild;)l.removeChild(l.firstChild);l&&l.appendChild(i.element)},[n,o,t]),Le.createPortal(t.children,o)},Ne=({mapData:t,poi:e,markerOptions:n,isRoot:o})=>{const[s,r]=Qt(),[i,l]=a.useState(!1),[u,m]=a.useState(!1),[g,y]=a.useState(void 0);a.useEffect(()=>{},[t.userInteraction.markerInteraction.enabled,t.userInteraction.markerInteraction.style.background,u,i]);const[h,p]=a.useState(void 0);a.useEffect(()=>{},[t.userInteraction.markerInteraction.enabled,t.userInteraction.markerInteraction.style.borderColor,u,i]);const[c,b]=a.useState(void 0);a.useEffect(()=>{},[t.userInteraction.markerInteraction.enabled,t.userInteraction.markerInteraction.style.glyphColor,u,i]);const[M,C]=a.useState(0);return a.useEffect(()=>{},[t.userInteraction.markerInteraction.enabled,t.userInteraction.markerInteraction.scale,u,i]),isNaN(e.location.lat)||isNaN(e.location.lng)?null:d.jsxs(d.Fragment,{children:[d.jsx(Xt,{ref:s,title:e.title,position:{lat:Number(e.location.lat),lng:Number(e.location.lng)},onMouseEnter:()=>{t.userInteraction.markerInteraction.enabled&&m(!0)},onMouseLeave:()=>{t.userInteraction.markerInteraction.enabled&&m(!1)},onClick:()=>{l(!i)},className:"pp-marker"+(o===!0?" pp-root-marker":""),zIndex:u||i?1:void 0,children:d.jsx(nn,{background:g,borderColor:h,glyph:n.glyph,glyphColor:c,scale:(n.scale??1)+(u||i?M:0)})},e.key),!1]})},rn={background:void 0,borderColor:void 0,glyph:void 0,glyphColor:void 0,scale:void 0},Te=t=>De({},rn,t),on=({mapData:t,rows:e})=>{var o;const n=s=>Te({});return((o=t==null?void 0:t.state)==null?void 0:o.locations)===void 0?null:d.jsx(d.Fragment,{children:t.state.locations.map((s,r)=>s?d.jsx(Ne,{mapData:t,poi:s,markerOptions:n()},s.key):null)})},an=t=>{const e=Ye(n=>n.maps[t]);return I.debug("mapData",e),e},sn=({appId:t,title:e,showToolBar:n,isExploring:o,isBuilderEnabled:s,appLanguage:r,elevation:i})=>{const l=ke(),u=tt();return d.jsx(d.Fragment,{children:n&&d.jsx(ot,{className:"pp-header",elevation:i,position:"relative",sx:{margin:"0 0 5px 0",borderRadius:"4px"},children:d.jsxs(xe,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[d.jsx(W,{sx:{display:"block",whiteSpace:"nowrap",fontSize:"18px",lineHeight:"18px",fontWeight:"bold",textOverflow:"ellipsis",overflow:"hidden",marginRight:"10px"},children:e}),d.jsxs(W,{sx:{display:"flex",gap:"10px",justifyContent:"center",alignItems:"center"},children:[s&&d.jsx(me,{title:"Map Builder",className:"pp-builder-button",children:d.jsx(ge,{sx:{color:"inherit",padding:0},onClick:()=>{l(Ue({appId:t}))},children:d.jsx(it,{})})}),o&&d.jsx(me,{title:r.close,children:d.jsx(ge,{sx:{color:"inherit",padding:0},onClick:()=>{l(He({isActive:!1,appDbId:0})),l(Ge({appId:t})),u(t),l(Ze())},children:d.jsx(at,{})})})]})]})})})},ln=({mapRadius:t,setMapRadius:e,radiusUnit:n,setRadiusUnit:o,searchRadius:s})=>d.jsxs(xe,{className:"pp-map-toolbar",sx:{justifyContent:"end",alignItems:"center",gap:"12px","&.pp-map-toolbar":{paddingRight:"12px"}},children:[d.jsxs(ft,{MenuProps:{id:"pp-map-radius"},value:t,sx:{height:"40px",background:"none padding-box rgb(255, 255, 255)","& svg":{width:"40px"}},onChange:r=>{e(Number(r.target.value))},startAdornment:d.jsx(dt,{}),children:[...s.map(r=>d.jsx(mt,{value:r,children:r},r))]}),d.jsxs(gt,{value:n,exclusive:!0,onChange:(r,i)=>{i!==null&&o(i)},sx:{height:"40px",background:"none padding-box rgb(255, 255, 255)"},children:[d.jsx(pe,{value:"km",children:"KM"}),d.jsx(pe,{value:"miles",children:"Miles"})]})]}),Ce=a.lazy(()=>Me(()=>import("./Alert-1.0.40-Bz3Zj62D.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url)),un=a.lazy(()=>Me(()=>import("./Settings-1.0.40-qr787GPg.js"),__vite__mapDeps([15,16,1,2,3,17,7,8,9,10,18,19,5,6,11,20,21,22,23,24,25,26,27,28,29,30,31,32,4,33,34,35,36,37]),import.meta.url)),Kn=({appId:t,mapSetup:e,tableStore:n,shortcodeArgs:o})=>{var Q,ee,te,ne,re,oe,ie,ae,se;I.debug(t,e);const s=ke(),r=an(t),i=et(t),l=nt(t),u=Xe(),m=rt,g=ct(),y=ut(g,Je.table,$e.form),[h,p]=a.useState([]),[c,b]=a.useState(!1),[M,C]=a.useState(r.initialLocation.static),[L,P]=a.useState({lat:void 0,lng:void 0});a.useEffect(()=>{r.initialLocation.static||(navigator.geolocation?navigator.geolocation.getCurrentPosition(v=>{v.coords===void 0?(I.error("ERROR - Could not determine user location"),$("Could not determine user location",{variant:"error"})):P({lat:v.coords.latitude,lng:v.coords.longitude}),C(!0)},v=>{I.error("ERROR - ",v),$(v.message,{variant:"error"}),C(!0)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):(I.error("Geolocation is not supported by this browser."),$("Geolocation is not supported by this browser",{variant:"error"}),C(!0)))},[]);const[_,A]=a.useState(r.userInteraction.defaultRadius),[x,S]=a.useState(r.userInteraction.distanceUnit),T=a.useMemo(()=>{var j;let v={};try{const f=JSON.parse((j=i==null?void 0:i.app)==null?void 0:j.container[0].cnt_cls);Array.isArray(f)&&f.map(E=>{E.columnName&&E.isSelected!==void 0&&(v[E.columnName]=E.isSelected)})}catch(f){I.error("Invalid JSON - map columns"),I.error(f),$("Invalid JSON, check console",{variant:"error"})}return v},[]),N=a.useMemo(()=>qe(i),[t]);a.useEffect(()=>{M&&n===void 0&&O()},[M,_,x]);const O=async()=>{var v,j;await Qe(Ke.appUrlAppSelect,{client_side:!0,app_id:(v=i==null?void 0:i.src)==null?void 0:v.app_id,cnt_id:(j=i==null?void 0:i.src)==null?void 0:j.cnt_id,col:T,media:[],search_data_types:(()=>{const f={};return Object.keys(T).map(E=>{const R=i==null?void 0:i.columns.filter(Z=>Z.column_name===E);if(Array.isArray(R)&&R.length===1)return f[E]=R[0].data_type}),f})(),search_custom:pt(r.setup.defaultWhere),shortcode_params:o,geo_radius:r.userInteraction.enabled?(()=>{const f=X();return{col:{lat:e.columnLatitude,lng:e.columnLongitude},loc:{lat:f==null?void 0:f.lat,lng:f==null?void 0:f.lng},radius:_,unit:x}})():{}}).then(f=>{var R,Z,le,ue,ce,de,fe;I.debug(f),Array.isArray((R=f==null?void 0:f.data)==null?void 0:R.data)&&p(f.data.data);let E={};if(((le=(Z=i==null?void 0:i.app)==null?void 0:Z.app[0])==null?void 0:le.app_theme)!==void 0&&((ce=(ue=i==null?void 0:i.app)==null?void 0:ue.app[0])==null?void 0:ce.app_theme)!==null&&((fe=(de=i==null?void 0:i.app)==null?void 0:de.app[0])==null?void 0:fe.app_theme)!=="")try{E=JSON.parse(i.app.app[0].app_theme)}catch(Fe){I.error("Invalid JSON - theme settings"),I.error(Fe)}E===!1&&(E={}),I.debug(E),s(Ve({appId:t,themeState:E}))}).catch(f=>{I.error(f)})},D=v=>{if(v.toLocaleUpperCase().startsWith("POINT("))return v.substring(6,v.length-1).split(" ")[0]},U=v=>{if(v.toLocaleUpperCase().startsWith("POINT("))return v.substring(6,v.length-1).split(" ")[1]};if(a.useEffect(()=>{const v=n===void 0?h:n.state.mapData;if(Array.isArray(v)){const j=v.filter(f=>f[e.columnLatitude]!==null&&f[e.columnLongitude]!==null&&(e.columnLatitude===e.columnLongitude||!isNaN(f[e.columnLatitude])&&!isNaN(f[e.columnLongitude]))).map(f=>{if(I.debug(f),e.columnLatitude===e.columnLongitude){const E=D(f[e.columnLatitude]),R=U(f[e.columnLongitude]);if(E&&R)return{key:String(f[e.columnLatitude]),location:{lat:Number(E),lng:Number(R)},title:F(r.mapMarkers.marker.title,f),header:F(r.mapMarkers.marker.header,f),content:F(r.mapMarkers.marker.content,f)}}else return{key:String(f[e.columnLatitude])+String(f[e.columnLongitude]),location:{lat:Number(f[e.columnLatitude]),lng:Number(f[e.columnLongitude])},title:F(r.mapMarkers.marker.title,f),header:F(r.mapMarkers.marker.header,f),content:F(r.mapMarkers.marker.content,f)}});s(We({appId:t,property:{locations:j}}))}},[r.mapMarkers.marker,h,n==null?void 0:n.state.mapData]),e.columnLatitude==""||e.columnLongitude=="")return d.jsx(a.Suspense,{children:d.jsx(Ce,{severity:"error",message:"Latitude and/or longitude column not defined - use App Manager to fix issue",close:!1})});if(e.apiKey==="")return d.jsx(a.Suspense,{children:d.jsx(Ce,{severity:"error",message:"Missing Google Maps API Key - use App Manager to fix issue",close:!1})});const X=()=>{if(r.initialLocation.static&&!isNaN(r.initialLocation.staticMarker.location.lat)&&!isNaN(r.initialLocation.staticMarker.location.lng))return{lat:Number(r.initialLocation.staticMarker.location.lat),lng:Number(r.initialLocation.staticMarker.location.lng)};if(L.lat&&L.lng)return{lat:L.lat,lng:L.lng}},je=()=>Te({}),Re=()=>n!==void 0?"0":r.userInteraction.enabled?"calc(138px + 2em)":"calc(69px + 2em)";if(!M)return d.jsx(lt,{});const[ze]=a.useState(((te=window.PP_APP_CONFIG[(ee=(Q=i==null?void 0:i.app)==null?void 0:Q.app[0])==null?void 0:ee.app_id])==null?void 0:te.hideTitleBar)===!0);return d.jsxs(W,{className:"pp-map",sx:{...((ne=r==null?void 0:r.setup)==null?void 0:ne.width)&&((re=r==null?void 0:r.setup)==null?void 0:re.widthUnit)&&((oe=r==null?void 0:r.setup)==null?void 0:oe.height)&&((ie=r==null?void 0:r.setup)==null?void 0:ie.heightUnit)&&{"&.pp-map":{width:r.setup.width+r.setup.widthUnit,height:r.setup.height+r.setup.heightUnit,marginBottom:Re()}}},children:[d.jsx(he,{theme:y,children:d.jsx(Ot,{apiKey:e.apiKey,onLoad:()=>{I.debug("Google Maps API has loaded..."),b(!0)},onError:v=>{I.error(v),I.error("Make sure your Google Maps API key is correctly entered in the App Manager and correctly defined in your Google Cloud Platform Console.")},children:c&&d.jsxs(d.Fragment,{children:[n===void 0&&ze!==!0&&d.jsx(sn,{appId:t,title:((se=(ae=i==null?void 0:i.app)==null?void 0:ae.app[0])==null?void 0:se.app_title)??"Map Builder",showToolBar:!0,isExploring:(i==null?void 0:i.isExploring)===!0,isBuilderEnabled:N,appLanguage:m,elevation:4}),r.userInteraction.enabled&&d.jsx(ln,{mapRadius:_,setMapRadius:A,radiusUnit:x,setRadiusUnit:S,searchRadius:r.userInteraction.searchRadius}),d.jsxs(Se,{mapId:t,mapTypeId:r.setup.startMode,fullscreenControl:l==null?void 0:l.allowFullScreen,defaultCenter:X(),defaultZoom:r.setup.initialZoom,gestureHandling:r.setup.gestureHandling,disableDefaultUI:!r.setup.googleMapsButtons,style:{width:"100%",height:"100%"},children:[r.initialLocation.showStaticMarker&&(r.initialLocation.static||L.lat!==void 0&&L.lng!==void 0)&&d.jsx(Ne,{mapData:r,poi:r.initialLocation.static?r.initialLocation.staticMarker:{key:"user-location",location:{lat:L.lat??0,lng:L.lng??0},title:r.initialLocation.staticMarker.title,header:r.initialLocation.staticMarker.header,content:r.initialLocation.staticMarker.content},markerOptions:je(),isRoot:!0}),d.jsx(on,{mapData:r,rows:h})]})]})})}),N&&d.jsx(a.Suspense,{fallback:d.jsx(st,{}),children:d.jsx(he,{theme:u,children:d.jsx(un,{appId:t})})})]})};export{Kn as default};
