import{l as t,aw as a,p as Y,aQ as L,Y as Se,aR as he,aS as Ne,av as d,aT as G,aU as Pe,S as Ce,aN as De,am as Ie,A,aV as Ae,b as Te,ax as xe,ay as Je,aW as Re,aA as ve,aX as we,aY as Ee,aZ as Fe,az as Ue}from"./lib-1.0.32-CBsDffd2.js";import{a as Me}from"./RestApi-1.0.32-Bp_RRidr.js";const Ve=(c,w)=>({app_id:c,cnt_id:w}),Be=(c,w)=>({dbs:c,tbl:w}),Ge=(c,w)=>{t.debug(c,w);const y=Me(),_e=(i,n,e,T)=>{var m,v,J,f,N,_,O,E,F,U,M,V,s,o,S,q,W,k,z,Q,X,Z,H,K,$,ee,le,se,te,re,oe,ne,ue,me,ce,ie,pe,be,ge,ae,fe;t.debug(e);const h=(m=e.access.insert)==null?void 0:m.some(r=>r.toUpperCase()==="POST"),P=(v=e.access.update)==null?void 0:v.some(r=>r.toUpperCase()==="POST"),b=(J=e.access.delete)==null?void 0:J.some(r=>r.toUpperCase()==="POST");e.src=Be(i,n),e.privs={select:!0,insert:h,update:P,delete:b};let l={};((_=(N=(f=e==null?void 0:e.settings)==null?void 0:f.ui)==null?void 0:N.global)==null?void 0:_.table)!==!1?(l=a({},Y,(F=(E=(O=e==null?void 0:e.settings)==null?void 0:O.ui)==null?void 0:E.global)==null?void 0:F.table),(S=(o=(s=(V=(M=(U=e==null?void 0:e.settings)==null?void 0:U.ui)==null?void 0:M.global)==null?void 0:V.table)==null?void 0:s.table)==null?void 0:o.pagination)!=null&&S.rowsPerPage&&(l.table.pagination.rowsPerPage=[...e.settings.ui.global.table.table.pagination.rowsPerPage]),(Q=(z=(k=(W=(q=e==null?void 0:e.settings)==null?void 0:q.ui)==null?void 0:W.global)==null?void 0:k.table)==null?void 0:z.table)!=null&&Q.defaultOrderBy&&(l.table.defaultOrderBy=[...e.settings.ui.global.table.table.defaultOrderBy])):l=a({},Y,{table:{transactions:{insert:h,update:P,delete:b},bulkActions:{pdf:!1,csv:!0,json:!0,excel:!1,xml:!0,sql:!0,delete:(X=e==null?void 0:e.privs)==null?void 0:X.delete}}});const R=[];for(let r=0;r<e.columns.length;r++)R[r]=L(e.columns[r].column_name,e.table_labels[e.columns[r].column_name]??e.columns[r].column_name);const g=[];if(Array.isArray(l.columns)&&l.columns.length>0){for(let r=0;r<l.columns.length;r++){const B=Se(e,l.columns[r].columnName);B!==void 0?g.push(a({},R[B],l.columns[r])):g.push(a({},L(e.columns[r].column_name),l.columns[r]))}l.columns=g}else l.columns=R;l.table.largeTableSupport.saved===he.AUTO?l.table.largeTableSupport.actual=Ne(e):l.table.largeTableSupport.actual=l.table.largeTableSupport.saved,t.debug(l);let u={...d};((K=(H=(Z=e==null?void 0:e.settings)==null?void 0:Z.ui)==null?void 0:H.global)==null?void 0:K.form)!==!1&&(u=a({},d,(le=(ee=($=e==null?void 0:e.settings)==null?void 0:$.ui)==null?void 0:ee.global)==null?void 0:le.form));const C=[];for(let r=0;r<e.columns.length;r++)C[r]=G(e.columns[r].column_name,e.form_labels[e.columns[r].column_name]??e.columns[r].column_name);const D=[];if(Array.isArray(u.columns)&&u.columns.length>0){for(let r=0;r<u.columns.length;r++){const B=Se(e,u.columns[r].columnName);B!==void 0?D.push(a({},C[B],u.columns[r])):D.push(a({},G(u.columns[r].column_name),u.columns[r]))}u.columns=D}else u.columns=C;const I=Pe.getSelectors().selectSelected(Ce.getState().explorer);t.debug("selected",I),I&&I[i]==="wp"&&((te=(se=e==null?void 0:e.settings)==null?void 0:se.wp)==null?void 0:te.tables)!==void 0&&Array.isArray(e.settings.wp.tables)&&e.settings.wp.tables.includes(n)&&(u.form={...De},u.form.preserveSpacesOnUpdate=!0);let x={};if(((ne=(oe=(re=e==null?void 0:e.settings)==null?void 0:re.ui)==null?void 0:oe.global)==null?void 0:ne.theme)!==void 0&&((ce=(me=(ue=e==null?void 0:e.settings)==null?void 0:ue.ui)==null?void 0:me.global)==null?void 0:ce.theme)!==null&&((be=(pe=(ie=e==null?void 0:e.settings)==null?void 0:ie.ui)==null?void 0:pe.global)==null?void 0:be.theme)!=="")try{x=JSON.parse((fe=(ae=(ge=e==null?void 0:e.settings)==null?void 0:ge.ui)==null?void 0:ae.global)==null?void 0:fe.theme)}catch(r){t.error("Invalid JSON - theme settings"),t.error(r)}x===!1&&(x={});const p=a({},Ie,x);return j(e,l,u,p,T===!0)},Oe=(i,n,e,T,h,P)=>{var F,U,M,V;t.debug(i,n,e,T,h);const b=n.app.app[0];t.debug(b);const l=n.app.container[0];t.debug(l);let R={};try{R=JSON.parse(b.app_settings)}catch(s){t.error("Invalid JSON - app settings"),t.error(s)}t.debug(R);let g={};try{g=JSON.parse(l.cnt_cls)}catch(s){t.error("Invalid JSON - app columns"),t.error(s)}t.debug(g);const u=b.app_type,C=Number(u)===A.DATAENTRY||Number(u)===A.MASTERDETAIL||Number(u)===A.REGISTRATION,D=Number(u)===A.DATAENTRY||Number(u)===A.MASTERDETAIL||Number(u)===A.REGISTRATION||Number(u)===A.UPDATEFORM,I=Number(u)===A.DATAENTRY||Number(u)===A.MASTERDETAIL||Number(u)===A.REGISTRATION;t.debug(C,D,I),n.src=Ve(i,l.cnt_id),n.privs={select:!0,insert:C,update:D,delete:I};const x=a({},Y,{table:{transactions:{insert:C,update:D,delete:I},bulkActions:{pdf:!1,csv:!0,json:!0,excel:!1,xml:!0,sql:!0,delete:(F=n==null?void 0:n.privs)==null?void 0:F.delete}}});t.debug(x);let p={};if(l.cnt_table!==void 0&&l.cnt_table!==null&&l.cnt_table!=="")try{p=JSON.parse(l.cnt_table)}catch(s){t.error("Invalid JSON - table settings"),t.error(s)}t.debug(p);const m=a({},x,p);(M=(U=p==null?void 0:p.table)==null?void 0:U.pagination)!=null&&M.rowsPerPage&&(m.table.pagination.rowsPerPage=[...p.table.pagination.rowsPerPage]),(V=p==null?void 0:p.table)!=null&&V.defaultOrderBy&&(m.table.defaultOrderBy=[...p.table.defaultOrderBy]),t.debug(m);const v=[];for(let s=0;s<g.length;s++)g[s].isSelected===!0&&v.push(L(g[s].columnName,n.table_labels[g[s].columnName]??g[s].columnName,!0));if(t.debug(v),Array.isArray(m.columns)&&m.columns.length>0){const s=[];for(let o=0;o<m.columns.length;o++)if(m.columns[o].computedField!==void 0)s.push(a({},L(m.columns[o].columnName),m.columns[o]));else{const S=Ae(v,m.columns[o].columnName);S!==void 0&&s.push(a({},v[S],m.columns[o]))}v.map(o=>{s.filter(S=>S.columnName===o.columnName).length===0&&s.push(o)}),t.debug(s),m.columns=s}else m.columns=v;if(m.table.largeTableSupport.saved===he.AUTO?m.table.largeTableSupport.actual=Ne(n):m.table.largeTableSupport.actual=m.table.largeTableSupport.saved,(n==null?void 0:n.isRelationSelectionTable)===!0&&(p==null?void 0:p.columns)!==void 0&&Array.isArray(p.columns)){const s=[];p.columns.map(o=>{if(o.columnName.startsWith(Te.relationTablePrefix)){const S={...o};S.columnName=o.columnName.substring(Te.relationTablePrefix.length),s.push(S)}}),m.columns=[...s]}t.debug(m);let J={};if((l==null?void 0:l.cnt_form)!==void 0&&(l==null?void 0:l.cnt_form)!==null&&(l==null?void 0:l.cnt_form)!==""||n.useRform===!0&&(l==null?void 0:l.cnt_rform)!==void 0&&(l==null?void 0:l.cnt_rform)!==null&&(l==null?void 0:l.cnt_rform)!=="")try{n.useRform===!0?J=JSON.parse(l.cnt_rform):J=JSON.parse(l.cnt_form)}catch(s){t.error("Invalid JSON - form settings"),t.error(s)}t.debug(J);const f=a({},d,J);t.debug(f);const N=[];for(let s=0;s<g.length;s++)g[s].isSelected===!0&&N.push(G(g[s].columnName,n.form_labels[g[s].columnName]??g[s].columnName,!0));if(t.debug(N),Array.isArray(f.columns)&&f.columns.length>0){const s=[];for(let o=0;o<f.columns.length;o++)if(f.columns[o].computedField!==void 0)s.push(a({},N[o],f.columns[o]));else{const S=Ae(N,f.columns[o].columnName);S!==void 0&&s.push(a({},N[S],f.columns[o]))}N.map(o=>{s.filter(S=>S.columnName===o.columnName).length===0&&s.push(o)}),f.columns=s}else f.columns=N;t.debug(f);let _={};if((b==null?void 0:b.app_theme)!==void 0&&(b==null?void 0:b.app_theme)!==null&&(b==null?void 0:b.app_theme)!=="")try{_=JSON.parse(b.app_theme)}catch(s){t.error("Invalid JSON - theme settings"),t.error(s)}_===!1&&(_={}),t.debug(_),h!==void 0&&(n.appRootId=h);let O={};if((l==null?void 0:l.cnt_chart)!==void 0&&(l==null?void 0:l.cnt_chart)!==null&&(l==null?void 0:l.cnt_chart)!=="")try{O=JSON.parse(l.cnt_chart)}catch(s){t.error("Invalid JSON - chart settings"),t.error(s)}O===!1&&(O={}),t.debug(O);const E=a({},xe,O);return t.debug(E),y(Je({appId:c,chartState:E})),j(n,m,f,_,e===!0,P)},ye=(i,n)=>{t.debug(i);const e=i.app.app[0];t.debug(e);let T={};try{T=JSON.parse(e.app_settings)}catch(h){t.error("Invalid JSON - app settings"),t.error(h)}return t.debug(T),y(Re({appId:c,apps:i.app.apps,titles:i.app.titles,appSettings:T})),y(ve({appId:c,metaData:{...i,isExploring:n??!1}})),!0},j=(i,n,e,T,h,P)=>(t.debug(i),y(ve({appId:c,metaData:{...i}})),y(we({appId:c,tableState:n,tableAccess:{insert:i.privs.insert,update:i.privs.update,delete:i.privs.delete},isView:Ee(i),exploring:h})),y(Fe({appId:c,formState:e})),y(Ue({appId:c,themeState:T})),P!==void 0&&P(),!0);return{prepareAdminStore:_e,prepareAppStore:Oe,prepareApp:ye}};var Le=(c=>(c[c.ADMIN=0]="ADMIN",c[c.APP=1]="APP",c))(Le||{});export{Ve as D,Le as S,Ge as u};
