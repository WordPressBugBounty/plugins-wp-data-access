import{j as s}from"./cm-1.0.24-lBsX3THK.js";import{r as _}from"./redux-1.0.24-Bx8jJ3ee.js";import{l as e,C as k,L as E,bq as J,cd as M}from"./lib-1.0.24-up-HxGpi.js";import{a as R}from"./RestApi-1.0.24-BCmVwqnT.js";import{c as B,d as L,e as T,f as q,g as z}from"./index-1.0.24-DqBQ5tn0.js";import{M as D}from"./index.esm-1.0.24-BcBy0Voo.js";import"./useTheme-1.0.24-CdGcp-pX.js";import{F as U}from"./FormHelperText-1.0.24-dIoAVumM.js";import{B as S}from"./CardContent-1.0.24-DpYcLPhl.js";import"./vendor-1.0.24-BmpNFhoq.js";import"./loglevel-1.0.24-BZ7XahX3.js";import"./lodash-1.0.24-CC2RnyUh.js";import"./moment-1.0.24-C5S46NFB.js";import"./iconBase-1.0.24-C7lJg7VQ.js";import"./Typography-1.0.24-DtpcakL_.js";import"./index-1.0.24-COcPbr-v.js";import"./index-1.0.24-CyelUMLZ.js";import"./notistack-1.0.24-EH6RgmCJ.js";import"./useFormControl-1.0.24-BVJe4wXv.js";const $="Upload or select %s from your WordPress media library",pr=({appId:d,columnName:o,columnValue:m,columnMetaData:f,onColumnChange:x,columnMedia:u,mediaType:p,locale:w,language:G,formMode:h,storeColumn:y})=>{e.debug(d,o,m,f,u,p);const I=_.useRef(null),v=R(),N=_.useMemo(()=>D,[]),F=r=>{if(e.debug(r),r!=null&&r.id&&(r!=null&&r.url)&&(r!=null&&r.mime)&&(r!=null&&r.title))return{value:r.id,media:{url:r.url,mime_type:r.mime,title:r.title}}},A=()=>{e.debug("update media");const r=J(f.data_type)!=="number";e.debug(r);let t="media",a="";switch(p){case"WP-Image":t="images(s)",a="image";break;case"WP-Audio":t="audio",a="audio";break;case"WP-Video":t="video(s)",a="video";break}e.debug(t,a);const n=window.wp.media({title:$.replace("%s",t),button:{text:"Select"},library:{type:a},multiple:r,render:!1});e.debug(n),n.on("select",function(){const l=[];if(r){const i=n.state().get("selection").toJSON();e.debug(i),i.map(P=>{e.debug(P);const W=F(P);W&&l.push(W)})}else{const i=F(n.state().get("selection").first().toJSON());i&&l.push(i)}e.debug(l);const c=[],g=[];for(let i=0;i<l.length;i++)c.push(l[i].value),g.push(JSON.stringify(l[i].media));e.debug(c,g),x(o,c.toString()),v(M({appId:d,columnName:o,columnValue:g}))}),n.open()},V=()=>{e.debug("delete media"),x(o,null),v(M({appId:d,columnName:o,columnValue:[]}))},C=r=>{switch(p){case"WP-Image":return s.jsx("img",{src:r.url,title:r.title,alt:r.title});case"WP-Attachment":{const t=r.mime_type.split("/");return s.jsxs("a",{href:r.url,title:r.title,target:"_blank",className:"pp-hyperlink",children:[s.jsxs("div",{children:[t[0]==="image"&&s.jsx(B,{}),t[0]==="audio"&&s.jsx(L,{}),t[0]==="video"&&s.jsx(T,{}),t[0]==="application"?t[1]==="pdf"?s.jsx(q,{}):s.jsx(z,{}):s.jsx(s.Fragment,{})]}),s.jsx("div",{className:"link-label",children:r.title})]})}case"WP-Audio":return s.jsx("audio",{controls:!0,children:s.jsx("source",{src:r.url,type:r.mime_type})});case"WP-Video":return s.jsx("video",{controls:!0,children:s.jsx("source",{src:r.url,type:r.mime_type})})}};return s.jsxs("div",{className:`media ${p}`,children:[s.jsxs(U,{children:[u==null?void 0:u.map(r=>{try{if(r===null||r==="")return null;const t=JSON.parse(r);return t!=null&&t.url?s.jsx("div",{ref:I,className:"content",children:C(t)},t.url):null}catch(t){return e.error("Invalid media properties",t),s.jsx("span",{children:"Error reading media"})}}),s.jsx("input",{type:"hidden",value:m??""})]}),s.jsxs("div",{className:"actions",children:[s.jsx(S,{variant:"outlined",onClick:A,disabled:!k.appPlugin||h===E.VIEW||y.updatable===!1,children:N.select}),s.jsx(S,{variant:"outlined",onClick:V,disabled:!k.appPlugin||h===E.VIEW||y.updatable===!1,children:w.delete})]})]})};export{pr as default};
