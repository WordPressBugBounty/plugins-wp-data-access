import{l as o,r as l,b3 as le,j as s,e as i,C as c,bK as _,bM as U,a8 as $}from"./main-1.0.18.js";import{a as pe,u as ce,b as ue}from"./RestApi-1.0.18-cb72bd79.js";import{u as de,T as u,d as me,e as xe,a as he,b as ge}from"./ActionsAdmin-1.0.18-de8008ec.js";import{C as k}from"./ConfirmDialog-1.0.18-eb1f3988.js";import{B as n,S as je}from"./Spinner-1.0.18-de8df990.js";import{b as ve}from"./index.esm-1.0.18-32f5cee0.js";import{C as fe}from"./index-1.0.18-744bc51a.js";import{B as x}from"./CardContent-1.0.18-3d5e5525.js";import{F as E,a as be}from"./FormHelperText-1.0.18-8b4ce85f.js";import{I as z,S as R,T as L}from"./TextField-1.0.18-cf148b4e.js";import{M as d}from"./MenuItem-1.0.18-0088f2a2.js";import{F as J}from"./FormControlLabel-1.0.18-2840e084.js";import{S as K}from"./Switch-1.0.18-cbb6329b.js";import{T as we}from"./Tooltip-1.0.18-5f32f0fd.js";import"./Typography-1.0.18-dc3c0740.js";import"./AdminTheme-1.0.18-73e13a4f.js";import"./DialogContent-1.0.18-5570cba4.js";import"./index.esm-1.0.18-12f13c4a.js";import"./iconBase-1.0.18-3c21f5e2.js";import"./Modal-1.0.18-870f459d.js";import"./useFormControl-1.0.18-87a8487d.js";import"./FormLabel-1.0.18-47dbe87d.js";import"./Menu-1.0.18-e8cb0649.js";import"./ThemeProvider-1.0.18-247b72cc.js";import"./Popover-1.0.18-54868205.js";import"./Grow-1.0.18-4ebc2ce8.js";import"./useControlled-1.0.18-12a74006.js";import"./createSvgIcon-1.0.18-dcf0276e.js";import"./createStyled-1.0.18-b238c9ff.js";import"./SwitchBase-1.0.18-e2aa3211.js";import"./index-1.0.18-ff546563.js";import"./Popper-1.0.18-20544c9b.js";const es=({dbs:r,tbl:a,typ:p,metaData:t})=>{var W,q,M,V,G,O,Q,H;o.debug(r,a,p,t);const h=pe(),[j,X]=l.useState("sql"),[w,Y]=l.useState(!0),[f,Z]=l.useState(""),[N,D]=l.useState(r),[y,ee]=l.useState(""),[S,se]=l.useState(!0),[ne,I]=l.useState(!1),[re,A]=l.useState(!1),[ie,P]=l.useState(!1),[te,C]=l.useState(!1),v=de();o.debug(v);const B=l.useMemo(()=>{const e=[];for(const m in v)e.push(m);return e},[v]);o.debug(B);const g=ce(e=>le(e));o.debug(g);const[b,F]=l.useState(v[r].pdsDbs===!0?((M=(q=(W=t==null?void 0:t.settings)==null?void 0:W.wp)==null?void 0:q.connect)==null?void 0:M.interval)??"":""),[T,oe]=l.useState(v[r].pdsDbs===!0?((O=(G=(V=t==null?void 0:t.settings)==null?void 0:V.wp)==null?void 0:G.connect)==null?void 0:O.unit)??"":""),ae=e=>{ue.post(t.settings.wp.homea+"?action=wpda_pds_update_interval",e,{headers:{"Content-Type":"multipart/form-data"}}).then(m=>{o.error(e,m)}).catch(m=>{o.error("error",m)})};return s.jsxs(s.Fragment,{children:[s.jsxs(n,{sx:{margin:0,padding:0,"& .pp-action":{display:"grid",gridTemplateColumns:"150px 1fr",alignItems:"center",margin:0,padding:"30px",borderBottom:"1px solid #ddd"},"& .pp-action button":{width:"120px"}},children:[p===u.TABLE&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsxs("form",{action:t.settings.wp.home+"?action=wpda_export",method:"post",target:"_blank",children:[s.jsx("input",{type:"hidden",name:"type",value:"table"}),s.jsx("input",{type:"hidden",name:"wpdaschema_name",value:r}),s.jsx("input",{type:"hidden",name:"table_names",value:a}),s.jsx("input",{type:"hidden",name:"format_type",value:j}),s.jsx("input",{type:"hidden",name:"include_table_settings",value:j==="sql"&&w?"on":"off"}),s.jsx("input",{type:"hidden",name:"_wpnonce",value:t.settings.wp.aonce.split("-")[0]}),s.jsx(x,{variant:"contained",type:"submit",children:"Export"})]})}),s.jsxs(n,{sx:{display:"grid"},children:[s.jsxs(E,{children:[s.jsx(z,{variant:"outlined",children:"Export to"}),s.jsxs(R,{MenuProps:{id:"pp-select-menu"},label:"Export to",value:j,onChange:e=>{X(e.target.value)},children:[s.jsx(d,{value:"sql",children:"SQL"},"sql"),s.jsx(d,{value:"csv",children:"CSV"},"csv"),s.jsx(d,{value:"json",children:"JSON"},"json"),s.jsx(d,{value:"excel",children:"Excel"},"excel"),s.jsx(d,{value:"xml",children:"XML"},"xml")]})]}),s.jsx(J,{sx:{visibility:j==="sql"?"visible":"hidden",height:j==="sql"?"auto":0,marginTop:j==="sql"?"10px":0,marginLeft:0},control:s.jsx(K,{checked:w,onClick:e=>{Y(!w),e.stopPropagation()}}),label:"With table settings",labelPlacement:"end"})]})]}),g[r]!=="system"&&(g[r]!=="wp"||!t.settings.wp.tables.includes(a))&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsx(x,{variant:"contained",onClick:()=>{a!==f&&f.trim()!==""?I(!0):i("Nothing to rename",{variant:"error"})},children:"Rename"})}),s.jsx(n,{children:s.jsx(L,{label:p===u.TABLE?"New table name":"New view name",value:f,onChange:e=>{Z(e.target.value)},fullWidth:!0})})]}),p===u.TABLE&&s.jsxs(n,{className:"pp-action",children:[s.jsxs(n,{children:[s.jsx(x,{variant:"contained",onClick:()=>{y.trim()!==""?(C(!0),me(r,N,a,y,S,e=>{if(o.debug(e),e!=null&&e.code&&(e==null?void 0:e.message)!==void 0)switch(e.code){case"ok":h(_({dbs:r})),i(e.message,{variant:"success"});break;case"info":i(e.message,{variant:"info"});break;default:o.error(e),i(e.message??c.contactSupport,{variant:"error"})}else o.error(e),i(c.contactSupport,{variant:"error"});C(!1)},e=>{o.error("error",e),i(e??c.contactSupport,{variant:"error"}),C(!1)})):i("Nothing to rename",{variant:"error"})},children:"Copy"}),s.jsx(J,{control:s.jsx(K,{checked:S,onClick:e=>{se(!S),e.stopPropagation()}}),label:"Copy data",labelPlacement:"end",sx:{height:"56px"}}),s.jsx(n,{sx:{display:te?"block":"none","& > div":{marginRight:"30px"},"& span.MuiCircularProgress-root, svg":{height:"20px !important",width:"20px !important"}},children:s.jsx(je,{title:"Copying..."})})]}),s.jsxs(n,{sx:{display:"grid",gridGap:"10px"},children:[s.jsxs(E,{fullWidth:!0,children:[s.jsx(z,{variant:"outlined",children:"To database"}),s.jsxs(R,{MenuProps:{id:"pp-select-menu"},label:"To database",value:N,onChange:e=>{D(e.target.value)},children:[...B.map(e=>s.jsx(d,{value:e,children:e},e))]})]}),s.jsx(L,{label:"To table name",value:y,onChange:e=>{ee(e.target.value)},fullWidth:!0})]})]}),p===u.TABLE&&g[r]!=="system"&&(g[r]!=="wp"||!t.settings.wp.tables.includes(a))&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsx(x,{variant:"contained",onClick:()=>{A(!0)},children:"Truncate"})}),s.jsxs(n,{sx:{display:"grid",gridGap:"5px"},children:[s.jsx("span",{children:"Deletes all data permanently."}),s.jsx("strong",{children:"This action cannot be undone!"})]})]}),g[r]!=="system"&&(g[r]!=="wp"||!t.settings.wp.tables.includes(a))&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsx(x,{variant:"contained",onClick:()=>{P(!0)},children:"Drop"})}),s.jsxs(n,{sx:{display:"grid",gridGap:"5px"},children:[p==u.VIEW?s.jsx("span",{children:"Deletes view permanently."}):s.jsx("span",{children:"Deletes table and all data permanently."}),s.jsx("strong",{children:"This action cannot be undone!"})]})]}),p===u.TABLE&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsxs("form",{method:"POST",action:t.settings.wp.home+"?page=wpda_designer",children:[s.jsx("input",{type:"hidden",name:"action",value:"edit"}),s.jsx("input",{type:"hidden",name:"action2",value:"init"}),s.jsx("input",{type:"hidden",name:"wpda_schema_name",value:r}),s.jsx("input",{type:"hidden",name:"wpda_schema_name_re",value:r}),s.jsx("input",{type:"hidden",name:"wpda_table_name",value:a}),s.jsx("input",{type:"hidden",name:"wpda_table_name_re",value:a}),s.jsx("input",{type:"hidden",name:"_wpnonce",value:t.settings.wp.alter}),s.jsx("input",{type:"hidden",name:"page_number",value:"1"}),s.jsx("input",{type:"hidden",name:"caller",value:"dataexplorer"}),s.jsx(x,{variant:"contained",type:"submit",children:"ALTER"})]})}),s.jsx(n,{sx:{display:"grid",gridGap:"5px"},children:"Loads table into the Data Designer."})]}),v[r].pdsDbs===!0&&((H=(Q=t==null?void 0:t.settings)==null?void 0:Q.wp)==null?void 0:H.connect)!==!1&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsx(x,{variant:"contained",onClick:()=>{if(b!==""&&b>0&&T!==""){const e=new FormData;e.append("wpnonce",t.settings.wp.refresh),e.append("schema_name",r),e.append("table_name",a),e.append("interval",b.toString()),e.append("unit",T),ae(e)}else i("Please enter valid scheduled update values",{variant:"error"})},children:"Refresh"})}),s.jsxs(n,{sx:{display:"grid",gridGap:"5px"},children:[s.jsx(n,{children:"Next scheduled update"}),s.jsxs(n,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",justifyContent:"start",alignItems:"center",gap:"5px"},children:[s.jsx(L,{type:"number",inputProps:{min:0},value:b,autoComplete:"off",onChange:e=>{const m=e.target.value.replaceAll("-","");F(m===""?"":Number(m))}}),s.jsxs(R,{MenuProps:{id:"pp-select-menu"},value:T,onChange:e=>{oe(e.target.value)},children:[s.jsx(d,{value:""}),s.jsx(d,{value:"hour",children:"hour"}),s.jsx(d,{value:"day",children:"day"})]})]}),s.jsx(E,{children:s.jsx(be,{children:"Enter and press REFRESH to apply"})})]})]}),t.create!==""&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsx(fe,{text:t.create,onCopy:()=>{i("SQL was copied to your clipboard",{variant:"info"})},children:s.jsx(we,{title:"Copy SQL to clipboard",children:s.jsx(x,{variant:"contained",endIcon:s.jsx(ve,{}),sx:{display:"flex",alignItems:"flex-start","& svg":{width:"50%"}},children:"SQL"})})})}),s.jsx(n,{sx:{display:"grid",gridGap:"5px"},children:s.jsx(n,{sx:{whiteSpace:"pre-wrap",fontSize:"70%"},children:t.create})})]})]}),s.jsx(k,{title:`Rename ${p===u.VIEW?"view":"table"}?`,message:"This can affect existing apps using this table!",open:ne,setOpen:I,onConfirm:()=>{xe(r,a,f,e=>{if(o.debug(e),e!=null&&e.code&&(e==null?void 0:e.message)!==void 0)switch(e.code){case"ok":p===u.VIEW?h(U({dbs:r})):h(_({dbs:r})),h($({})),i(e.message,{variant:"success"});break;case"info":i(e.message,{variant:"info"});break;default:o.error(e),i(e.message??c.contactSupport,{variant:"error"})}else o.error(e),i(c.contactSupport,{variant:"error"})},e=>{o.error("error",e),i(e??c.contactSupport,{variant:"error"})})}}),s.jsx(k,{title:"Truncate table?",message:"This action cannot be undone!",open:re,setOpen:A,onConfirm:()=>{he(r,a,e=>{if(o.debug(e),e!=null&&e.code&&(e==null?void 0:e.message)!==void 0)switch(e.code){case"ok":i(e.message,{variant:"success"});break;case"info":i(e.message,{variant:"info"});break;default:o.error(e),i(e.message??c.contactSupport,{variant:"error"})}else o.error(e),i(c.contactSupport,{variant:"error"})},e=>{o.error("error",e),i(e??c.contactSupport,{variant:"error"})})}}),s.jsx(k,{title:`Drop ${p===u.VIEW?"view":"table"}?`,message:"This action cannot be undone!",open:ie,setOpen:P,onConfirm:()=>{ge(r,a,p,e=>{if(o.debug(e),e!=null&&e.code&&(e==null?void 0:e.message)!==void 0)switch(e.code){case"ok":p===u.VIEW?h(U({dbs:r})):h(_({dbs:r})),h($({})),i(e.message,{variant:"success"});break;case"info":i(e.message,{variant:"info"});break;default:o.error(e),i(e.message??c.contactSupport,{variant:"error"})}else o.error(e),i(c.contactSupport,{variant:"error"})},e=>{o.error("error",e),i(e??c.contactSupport,{variant:"error"})})}})]})};export{es as default};
