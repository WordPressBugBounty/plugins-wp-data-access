import{r as i,j as e,aq as be,l as n,ar as je,a as J,as as Ae,a6 as Ce,a7 as Te,at as ve,a2 as ye,S as W,y as pe,au as _e,av as Ee,a5 as ke,f as le,a9 as Me,aw as Be,_ as K,ax as I,ay as Fe,P as Ne,A as ee,az as Oe,an as Pe,b as Re,aA as we,e as O,C as B,aB as Le,H as ze,aC as He,aD as We,aE as De,aF as Ve,aG as $e,aH as Ge}from"./main-1.0.18.js";import{b as Je}from"./ActionsApp-1.0.18-0ab2bedd.js";import{u as D,a as H,R as Ue}from"./RestApi-1.0.18-cb72bd79.js";import{u as te,S as se,D as Ye}from"./usePrepareStore-1.0.18-44f9cb72.js";import{u as qe,C as Ke}from"./Chart-1.0.18-142bb265.js";import{R as Xe,B as Qe,a as Ze,T as Ie,b as et,c as re}from"./TabPanel-1.0.18-2d718e76.js";import{T as $,C as tt}from"./ConfirmDialog-1.0.18-eb1f3988.js";import{e as st,C as rt,A as ce,T as ue,M as me}from"./index.esm-1.0.18-12f13c4a.js";import{A as ae,a as at}from"./AdminTheme-1.0.18-73e13a4f.js";import{u as ot,g as he,B as it,D as X,R as nt,C as pt,b as lt,a as de,d as ct,e as ut,f as xe,A as fe}from"./useTheme-1.0.18-c1f3f722.js";import{a as mt}from"./ActionsSettings-1.0.18-41fd8841.js";import{B as F,S as U}from"./Spinner-1.0.18-de8df990.js";import{T as ht}from"./Typography-1.0.18-dc3c0740.js";import{I as P}from"./iconBase-1.0.18-3c21f5e2.js";import{C as oe,a as ie,B as G}from"./CardContent-1.0.18-3d5e5525.js";import{T as ne}from"./Tabs-1.0.18-d7d53c1e.js";import{v as dt,F as Y}from"./FallbackSpinner-1.0.18-e10446f4.js";import{T as q}from"./ThemeProvider-1.0.18-247b72cc.js";import xt from"./Alert-1.0.18-8e754392.js";import{T as ge}from"./Tooltip-1.0.18-5f32f0fd.js";import{M as ft}from"./MenuItem-1.0.18-0088f2a2.js";import{M as gt}from"./Menu-1.0.18-e8cb0649.js";import"./useScreenSize-1.0.18-62aeb4c4.js";import"./Modal-1.0.18-870f459d.js";import"./DialogContent-1.0.18-5570cba4.js";import"./colorManipulator-1.0.18-95bf61ec.js";import"./TargetEnum-1.0.18-b82380d5.js";import"./createSvgIcon-1.0.18-dcf0276e.js";import"./index.esm-1.0.18-bb69b89a.js";import"./AlertTitle-1.0.18-0fd475c6.js";import"./index-1.0.18-ff546563.js";import"./useSlot-1.0.18-71f9e7ae.js";import"./Close-1.0.18-d90e9fa7.js";import"./Popper-1.0.18-20544c9b.js";import"./useControlled-1.0.18-12a74006.js";import"./Grow-1.0.18-4ebc2ce8.js";import"./Popover-1.0.18-54868205.js";const St=({appRootId:t,appId:r,appDbId:u,isVisible:m,fullScreen:p})=>{const[s,h]=i.useState(!1);return i.useEffect(()=>{m&&!s&&h(!0)},[m]),s?e.jsx(F,{className:"pp-apps-root"+(m?"":" pp-element-hide"),sx:{"& .pp-app-container .pp-component header.pp-header":{margin:0,visibility:"hidden",position:"absolute",left:-99999}},children:e.jsx(Bt,{appId:r,appDbId:u,fullScreen:p,appRootId:t})}):null},bt=t=>{const r=D(u=>be(u,t));return n.debug("activeAppId",r,t),r},jt=t=>{const r=D(u=>je(u,t));return n.debug("appData",r),r},At=({appId:t})=>{const r=H(),u=ot(t),m=he(t),p=jt(t);return e.jsx(ge,{title:e.jsx(it,{details:u,mode:p==null?void 0:p.mode}),className:"pp-builder-button",children:e.jsx(P,{sx:{color:"inherit",padding:0},onClick:()=>{var s,h;((h=(s=m==null?void 0:m.app)==null?void 0:s.app[0])==null?void 0:h.app_type)==J.CHART?r(Ae({appId:t})):(p==null?void 0:p.mode)===X.FORM?r(Ce({appId:t})):r(Te({appId:t}))},children:e.jsx(st,{})})})},Ct=({appDbId:t,appTitle:r,setActiveApp:u,handleClose:m})=>e.jsx(ft,{onClick:()=>{u(t),m()},children:e.jsx("span",{children:r})}),Tt=({apps:t,setActiveApp:r})=>{const[u,m]=i.useState(null),p=!!u,s=l=>{m(l.currentTarget),l.stopPropagation()},h=()=>{m(null)};return e.jsxs(F,{sx:{position:"relative"},children:[e.jsx(P,{sx:{color:"inherit",padding:0},onClick:s,children:e.jsx(rt,{})}),e.jsxs(gt,{anchorEl:u,open:p,onClose:h,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},sx:{marginTop:"8px","& ul":{padding:"0 !important"},"& ul li":{padding:"12px 24px 12px 18px !important"}},children:[...t.apps.map(l=>t.titles[l]===void 0?null:e.jsx(Ct,{appDbId:l,appTitle:t.titles[l],setActiveApp:r,handleClose:h}))]})]})},vt=({appId:t})=>{var c;n.debug(t);const r=H(),u=nt(),m=pt(),p=D(o=>ve(o,t));n.debug("apps",p);const s=i.useMemo(()=>{const o={};return Array.isArray(p.apps)&&p.apps.length>0&&p.apps.map(a=>{o[a]=dt()}),o},[]),h=lt(t),l=i.useMemo(()=>ye(W.getState(),t),[]),T=i.useMemo(()=>{var o,a;return((a=(o=l==null?void 0:l.app)==null?void 0:o.app[0])==null?void 0:a.app_title)!==""?l.app.app[0].app_title:"WP Data Access"},[]),d=bt(t),v=o=>{r(Be({appId:t,activeAppId:o}))};de(s[d]);const y=ct(s[d]),x=ut(s[d]),b=xe(s[d]),A=fe(b,y,x),[S,k]=i.useState(pe.appOrig.appFullscreen===!0);n.debug("appFullScreen",S);const j=D(o=>_e(o));n.debug("appData",j),i.useEffect(()=>{n.debug("setFullScreen",s,S),Object.keys(s).map(o=>{r(Ee({appId:s[Number(o)],fullScreen:S??!1}))})},[j,S]);const _=((c=j[s[d]])==null?void 0:c.mode)??X.TABLE;n.debug("mode",_);let M={};const g=()=>null;return p===void 0||Object.keys(s).length===0?e.jsx(U,{}):e.jsx(q,{theme:A,children:e.jsxs(F,{className:"pp-apps-container",sx:{...S?M:{},"& .pp-element-hide":{visibility:"hidden",position:"absolute",left:-99999}},children:[e.jsx(ce,{className:"pp-apps-header",position:"relative",sx:{margin:"0 0 5px 0"},children:e.jsxs(ue,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(F,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center",gap:"5px","& span":{whiteSpace:"nowrap",fontSize:"18px",lineHeight:"18px",fontWeight:"bold"},"& span.pp-header-title":{minWidth:0,textOverflow:"ellipsis",overflow:"hidden",marginRight:"10px"}},children:[e.jsx("span",{children:e.jsx(Tt,{apps:p,setActiveApp:v})}),e.jsxs("span",{className:"pp-header-title",children:[T," - ",p.titles[d]]})]}),e.jsxs(F,{sx:{display:"flex",gap:"10px",justifyContent:"center",alignItems:"center"},children:[ke(l)&&e.jsx(At,{appId:s[d]}),g(),(l==null?void 0:l.isExploring)&&e.jsx(ge,{title:h.close,children:e.jsx(P,{sx:{color:"inherit",padding:0},onClick:()=>{r(le({isActive:!1,appDbId:0})),m(t),u(t),r(Me({})),Object.keys(s).map(o=>{m(s[o]),u(s[o])})},children:e.jsx(me,{})})})]})]})}),...p.apps.map(o=>e.jsx(St,{appRootId:t,appId:s[o],appDbId:o,isVisible:o===d,fullScreen:S}))]})})},yt=i.lazy(()=>K(()=>import("./SettingsChart-1.0.18-2e1987f1.js"),["./SettingsChart-1.0.18-2e1987f1.js","./main-1.0.18.js","./index.esm-1.0.18-12f13c4a.js","./Typography-1.0.18-dc3c0740.js","./iconBase-1.0.18-3c21f5e2.js","./DefaultChartColors-1.0.18-47ca3b11.js","./RestApi-1.0.18-cb72bd79.js","./index-1.0.18-bd94b546.js","./FormHelperText-1.0.18-8b4ce85f.js","./useFormControl-1.0.18-87a8487d.js","./ToggleButtonGroup-1.0.18-02ae4565.js","./colorManipulator-1.0.18-95bf61ec.js","./FormLabel-1.0.18-47dbe87d.js","./RadioGroup-1.0.18-4960e4a8.js","./Radio-1.0.18-210e4079.js","./SwitchBase-1.0.18-e2aa3211.js","./useControlled-1.0.18-12a74006.js","./createSvgIcon-1.0.18-dcf0276e.js","./Modal-1.0.18-870f459d.js","./Slider-1.0.18-32b00bb2.js","./ThemeProvider-1.0.18-247b72cc.js","./index-1.0.18-ff546563.js","./Spinner-1.0.18-de8df990.js","./Divider-1.0.18-eca54fd7.js","./MenuItem-1.0.18-0088f2a2.js","./Menu-1.0.18-e8cb0649.js","./Popover-1.0.18-54868205.js","./Grow-1.0.18-4ebc2ce8.js","./TextField-1.0.18-cf148b4e.js","./InputAdornment-1.0.18-958a8148.js","./AccordionSummary-1.0.18-f9e114cf.js","./useSlot-1.0.18-71f9e7ae.js","./Collapse-1.0.18-8e581380.js","./AccordionDetails-1.0.18-2900e110.js","./PremiumFeature-1.0.18-2f6283b7.js","./index.esm-1.0.18-32f5cee0.js","./AdminTheme-1.0.18-73e13a4f.js","./FormControlLabel-1.0.18-2840e084.js","./createStyled-1.0.18-b238c9ff.js","./Switch-1.0.18-cbb6329b.js","./ChartTypes-1.0.18-62bfd1db.js","./Autocomplete-1.0.18-a264f80a.js","./Close-1.0.18-d90e9fa7.js","./Popper-1.0.18-20544c9b.js"],import.meta.url)),_t=i.lazy(()=>K(()=>import("./ThemeSettings-1.0.18-a19ba407.js"),["./ThemeSettings-1.0.18-a19ba407.js","./main-1.0.18.js","./RestApi-1.0.18-cb72bd79.js","./Typography-1.0.18-dc3c0740.js","./useTheme-1.0.18-c1f3f722.js","./colorManipulator-1.0.18-95bf61ec.js","./iconBase-1.0.18-3c21f5e2.js","./PremiumFeature-1.0.18-2f6283b7.js","./index.esm-1.0.18-32f5cee0.js","./AdminTheme-1.0.18-73e13a4f.js","./FormLabel-1.0.18-47dbe87d.js","./useFormControl-1.0.18-87a8487d.js","./index.esm-1.0.18-12f13c4a.js","./index-1.0.18-e1774a35.js","./Spinner-1.0.18-de8df990.js","./FormHelperText-1.0.18-8b4ce85f.js","./Switch-1.0.18-cbb6329b.js","./SwitchBase-1.0.18-e2aa3211.js","./useControlled-1.0.18-12a74006.js","./index-1.0.18-ff546563.js","./FormControlLabel-1.0.18-2840e084.js","./createStyled-1.0.18-b238c9ff.js","./Slider-1.0.18-32b00bb2.js","./ThemeProvider-1.0.18-247b72cc.js","./Link-1.0.18-41cc6055.js","./RadioGroup-1.0.18-4960e4a8.js","./Radio-1.0.18-210e4079.js","./createSvgIcon-1.0.18-dcf0276e.js","./Modal-1.0.18-870f459d.js","./CssUnitTextField-1.0.18-6aa39ec4.js","./TextField-1.0.18-cf148b4e.js","./Menu-1.0.18-e8cb0649.js","./Popover-1.0.18-54868205.js","./Grow-1.0.18-4ebc2ce8.js","./CardContent-1.0.18-3d5e5525.js","./AccordionSummary-1.0.18-f9e114cf.js","./useSlot-1.0.18-71f9e7ae.js","./Collapse-1.0.18-8e581380.js","./AccordionDetails-1.0.18-2900e110.js"],import.meta.url)),Et=({appId:t})=>{var c,o;const r=H(),[u,m]=i.useState(I(W.getState(),t));i.useState(Fe(W.getState(),t));const p=de(t),s=qe(t),[h,l]=i.useState(!1),[T,d]=i.useState(!1),[v,y]=i.useState("1"),x=(a,E)=>{y(E)},b=()=>{r(Oe({})),l(!1)},A=()=>{h?d(!0):(j(),b())},S=a=>{n.debug(a),r(Pe({appId:t,property:a})),l(!0)},k=a=>{r(Re({anchor:a}))},j=()=>{r(we({appId:t,chartState:u}))},_=()=>{mt(t,a=>{if(n.debug(a),a!=null&&a.code&&(a==null?void 0:a.message)!==void 0)switch(a.code){case"ok":m(I(W.getState(),t)),O(a.message,{variant:"success"});break;case"info":O(a.message,{variant:"info"});break;default:n.error(a),O(a.message??B.contactSupport,{variant:"error"})}},a=>{n.error("error",a),O(a??B.contactSupport,{variant:"error"})}),l(!1)},M=()=>{h?(_(),setTimeout(()=>{b()},1e3)):b()},g=((c=ae)==null?void 0:c.palette.mode)===Ne.LIGHT?(o=ae)==null?void 0:o.palette.primary.main:"";return e.jsx(e.Fragment,{children:s&&e.jsxs(e.Fragment,{children:[e.jsxs(Xe,{closeDrawer:A,children:[e.jsx(ce,{position:"static",elevation:4,sx:{borderRadius:0},children:e.jsxs(ue,{className:"pp-setting-toolbar",sx:{borderRadius:0},children:[e.jsx(ht,{variant:"h5",noWrap:!0,component:"div",className:"unselectable",sx:{flexGrow:1,paddingLeft:"6px"},children:"Chart Builder"}),e.jsx($,{title:"Dock to left",position:"bottom",children:e.jsx(P,{onClick:()=>{k(ee.LEFT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(Qe,{})})}),e.jsx($,{title:"Dock to right",position:"bottom",children:e.jsx(P,{onClick:()=>{k(ee.RIGHT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(Ze,{})})}),e.jsx($,{title:"Close",position:"bottom",children:e.jsx(P,{onClick:A,size:"large",color:"inherit",sx:{fontSize:"1.4em"},children:e.jsx(me,{})})})]})}),e.jsx(oe,{className:"pp-settings-container",children:e.jsx(ie,{sx:{padding:0,margin:0},children:e.jsxs(Ie,{value:v,children:[e.jsxs(et,{variant:"fullWidth",textColor:"primary",onChange:x,sx:{width:"100%",height:"80px",padding:0,margin:0,backgroundColor:"rgb(242, 242, 242)"},children:[e.jsx(ne,{label:"Chart",value:"1",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}}),e.jsx(ne,{label:"Theme",value:"2",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}})]}),e.jsxs(F,{sx:{margin:0,padding:0,overflowX:"hidden",overflowY:"auto",height:"calc(100vh - 250px)","& > div.MuiTabPanel-root":{padding:0}},children:[e.jsx(re,{value:"1",children:e.jsx(i.Suspense,{fallback:e.jsx(U,{}),children:e.jsx(yt,{appId:t,chartSettings:p,updateSettings:S})})}),e.jsx(re,{value:"2",children:e.jsx(i.Suspense,{fallback:e.jsx(U,{}),children:e.jsx(_t,{appId:t,source:X.TABLE,setIsUpdated:l})})})]})]})})}),e.jsx(oe,{className:"pp-setting-footer",sx:{borderRadius:0,backgroundColor:g},children:e.jsxs(ie,{className:"pp-setting-footer-buttons",sx:{borderRadius:0},children:[e.jsx(G,{variant:"outlined",className:"footer_action_button_apply",onClick:_,children:"Apply"}),e.jsx(G,{variant:"outlined",className:"footer_action_button",onClick:M,children:"OK"}),e.jsx(G,{variant:"outlined",className:"footer_action_button",onClick:A,children:"Cancel"})]})})]}),e.jsx(tt,{title:"Close Chart Builder?",message:"All uncommitted changes will be lost!",open:T,setOpen:d,onConfirm:()=>{j(),b()},onKeep:()=>{b()}})]})})},kt=({appId:t,appDbId:r})=>{n.debug(t,r);const u=H(),[m,p]=i.useState(!1),s=he(t),h=xe(t),l=fe(h,ze.table,Le.form),T=i.useMemo(()=>at(),[]),d=x=>{switch(x.substring(0,x.indexOf("(")).toLowerCase()){case"decimal":case"double":case"double precision":case"float":case"real":case"bit":case"tinyint":case"smallint":case"int":case"integer":case"mediumint":case"bigint":return"number";case"time":return"time";case"date":return"date";case"datetime":case"timestamp":return"datetime"}return"text"},v=()=>{Ue(pe.appUrlChartData,{app_id:r},x=>{var b,A,S,k,j,_,M,g,c,o,a,E;if(n.debug(x),(x==null?void 0:x.data)!==void 0){if(Array.isArray(x.data)){const R=x.data,w=[];x.explain.map(f=>{f.Type?w.push(d(f.Type)):f.type?w.push(d(f.type)):f.TYPE&&w.push(d(f.TYPE))}),n.debug(w);const N=[],Q=[];Object.keys(R[0]).map(f=>Q.push(f)),N.push(Q);for(let f=0;f<R.length;f++){const V=[];Object.keys(R[f]).map((Z,Se)=>w[Se]==="text"?V.push(R[f][Z]):V.push(Number(R[f][Z]))),N.push(V)}n.debug(N);let C={};if(((A=(b=s==null?void 0:s.app)==null?void 0:b.app[0])==null?void 0:A.app_theme)!==void 0&&((k=(S=s==null?void 0:s.app)==null?void 0:S.app[0])==null?void 0:k.app_theme)!==null&&((_=(j=s==null?void 0:s.app)==null?void 0:j.app[0])==null?void 0:_.app_theme)!=="")try{C=JSON.parse(s.app.container[0].cnt_chart)}catch(f){n.error("Invalid JSON - theme settings"),n.error(f)}C===!1&&(C={}),n.debug(C);const L=He({},We,C);L.data=N,L.majorAxisColumn=N[0][0],L.minorAxisColumns=N[0].slice(1),Array.isArray(C==null?void 0:C.chartTypes)&&C.chartTypes.length>0&&(L.chartType=C.chartTypes[0]),u(De({appId:t,chartState:L}));let z={};if(((g=(M=s==null?void 0:s.app)==null?void 0:M.app[0])==null?void 0:g.app_theme)!==void 0&&((o=(c=s==null?void 0:s.app)==null?void 0:c.app[0])==null?void 0:o.app_theme)!==null&&((E=(a=s==null?void 0:s.app)==null?void 0:a.app[0])==null?void 0:E.app_theme)!=="")try{z=JSON.parse(s.app.app[0].app_theme)}catch(f){n.error("Invalid JSON - theme settings"),n.error(f)}z===!1&&(z={}),n.debug(z),u(Ve({appId:t,themeState:z})),p(!0)}}else n.error("Error loading chart data")},()=>{n.error("Error loading chart data")})};i.useEffect(()=>{v()},[]);const y=i.useMemo(()=>!0,[]);return m?e.jsxs(e.Fragment,{children:[e.jsx(q,{theme:l,children:e.jsx(Ke,{appId:t,isBuilderEnabled:y,isToolbarEnabled:!0,isExploring:s==null?void 0:s.isExploring})}),y&&e.jsx(q,{theme:T,children:e.jsx(Et,{appId:t})})]}):e.jsx(Y,{})},Mt=i.lazy(()=>K(()=>import("./ThemeContainer-1.0.18-fbd92e13.js").then(t=>t.T),["./ThemeContainer-1.0.18-fbd92e13.js","./main-1.0.18.js","./RestApi-1.0.18-cb72bd79.js","./Typography-1.0.18-dc3c0740.js","./useTheme-1.0.18-c1f3f722.js","./colorManipulator-1.0.18-95bf61ec.js","./iconBase-1.0.18-3c21f5e2.js","./index.esm-1.0.18-12f13c4a.js","./FallbackSpinner-1.0.18-e10446f4.js","./Spinner-1.0.18-de8df990.js","./Tooltip-1.0.18-5f32f0fd.js","./ThemeProvider-1.0.18-247b72cc.js","./Popper-1.0.18-20544c9b.js","./useControlled-1.0.18-12a74006.js","./Grow-1.0.18-4ebc2ce8.js"],import.meta.url)),Bt=({appId:t,appDbId:r,designMode:u,staticFilter:m,shortcodeArgs:p,fullScreen:s,isExploring:h,appRootId:l})=>{n.debug(t,r,u,m,p,s,h);const T=H(),[d,v]=i.useState(""),[y,x]=i.useState(!1),[b,A]=i.useState(!1),[S,k]=i.useState(!1),{prepareAppStore:j}=te(t,se.APP),{prepareApp:_}=te(t,se.APP);i.useEffect(()=>{y||M()},[r]);const M=()=>{Je(r,g=>{var o,a;const c=g==null?void 0:g.data;if(n.debug("response data",c),c.app&&c.app.app&&Array.isArray(c.app.app)&&c.app.container&&Array.isArray(c.app.container)&&c.app.apps&&Array.isArray(c.app.apps))if(c.app.app[0].app_type==J.APPCONTAINER)_(c,h),A(!0),x(!0);else if(c.app.app[0].app_type==J.CHART){const E={...c};E.src=Ye(r,(a=(o=c==null?void 0:c.app)==null?void 0:o.container[0])==null?void 0:a.cnt_id),h===!0&&(E.isExploring=!0),l!==void 0&&(E.appRootId=l),T($e({appId:t,metaData:E})),k(!0),x(!0)}else j(r,c,u===!0,void 0,l,()=>{})?(T(Ge({appId:t,staticFilter:m,shortcodeArgs:p})),x(!0)):v(B.contactSupport);else O(B.contactSupport,{variant:"error"}),v(B.contactSupport)},g=>{n.error("error",g),O(g??B.contactSupport,{variant:"error"}),v(g??B.contactSupport)})};return d!==""?e.jsx(i.Suspense,{children:e.jsx(xt,{severity:"error",message:d,close:!0,setClose:()=>{T(le({isActive:!1,appDbId:0}))}})}):y?b?e.jsx(vt,{appId:t}):S?e.jsx(kt,{appId:t,appDbId:r}):e.jsx(F,{id:"pp-app-"+t,className:"pp-app-container pp-app-"+r,sx:{[`&#pp-app-${t} .pp-column-search-field ul`]:{marginLeft:0,padding:0},[`&#pp-app-${t} .pp-global-search-field input, &#pp-app-${t} .pp-column-search-field input`]:{boxSizing:"content-box"},[`&#pp-app-${t} .pp-form form input`]:{boxSizing:"content-box"}},children:e.jsx(i.Suspense,{fallback:e.jsx(Y,{}),children:e.jsx(Mt,{appId:t})})}):e.jsx(Y,{})};export{Bt as default};
