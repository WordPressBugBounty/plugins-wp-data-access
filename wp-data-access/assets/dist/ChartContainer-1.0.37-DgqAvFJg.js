const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SettingsChart-1.0.37-Ccr4azRK.js","./cm-1.0.37-CEr77VZi.js","./redux-1.0.37-C4JSQ-MG.js","./vendor-1.0.37-CN03Eozo.js","./index-1.0.37-B60ShF2d.js","./iconBase-1.0.37-DRohixw7.js","./Typography-1.0.37-DjtXWQnP.js","./lib-1.0.37-Czwr-8r3.js","./loglevel-1.0.37-BZ7XahX3.js","./lodash-1.0.37-Dx3wKrSf.js","./moment-1.0.37-C5S46NFB.js","./useEnhancedEffect-1.0.37-UwysO4qr.js","./notistack-1.0.37-CEqipxDI.js","./DefaultChartColors-1.0.37-BjH175G4.js","./hooks-1.0.37-DW0_oiBB.js","./FormHelperText-1.0.37-ylnS0Km6.js","./utils-1.0.37-iop7lDec.js","./useFormControl-1.0.37-BcUwa2qz.js","./ToggleButtonGroup-1.0.37-BCHx2oZO.js","./FormLabel-1.0.37-BQP5Nx_Z.js","./RadioGroup-1.0.37-CARB8om5.js","./Radio-1.0.37-C5rUTiNk.js","./SwitchBase-1.0.37-Bwy1aBhJ.js","./useControlled-1.0.37-DyimEgDk.js","./createSvgIcon-1.0.37-DXsAQOmB.js","./Slider-1.0.37-R1cUZahP.js","./ThemeProvider-1.0.37-Cyf1xy26.js","./visuallyHidden-1.0.37-Dan1xhjv.js","./Menu-1.0.37-Ca8DeoO3.js","./Spinner-1.0.37-CwhfSVqI.js","./Divider-1.0.37-PDNfV3Nd.js","./MenuItem-1.0.37-JkRcsicb.js","./TextField-1.0.37-CCe4G0U1.js","./Select-1.0.37-B5ZKqjeL.js","./InputAdornment-1.0.37-Bm1BNe28.js","./AccordionSummary-1.0.37-Dp-yE6bD.js","./Collapse-1.0.37-DaP8rsgI.js","./AccordionDetails-1.0.37-CWpLs4PS.js","./PremiumFeature-1.0.37-BKt66-Fr.js","./index-1.0.37-CK0QxOhD.js","./AdminTheme-1.0.37-7PLndQ8H.js","./FormControlLabel-1.0.37-BLp4PuCc.js","./Switch-1.0.37-D8L-tSJ8.js","./ChartTypes-1.0.37-CDO5weV_.js","./Autocomplete-1.0.37-5_yZAyWV.js","./Close-1.0.37-Yr1E1-6A.js","./Popper-1.0.37-CSsNCozr.js","./ThemeSettings-1.0.37-Bw_m4zMJ.js","./useTheme-1.0.37-D4xQQypV.js","./index-1.0.37-9tYvXmzh.js","./index-1.0.37-D4zhytA1.js","./getThemeProps-1.0.37-BGc0S4YC.js","./Stack-1.0.37-BFfovUQt.js","./useThemeProps-1.0.37-CD9ZXLtG.js","./Link-1.0.37-B0loYHQn.js","./CssUnitTextField-1.0.37-Cdr3oKtg.js","./ConfirmDialog-1.0.37-BDQ_OfRf.js","./DynamicModeEnum-1.0.37-BXuL5kgA.js","./ResizableDrawer-1.0.37-C5w2uIZI.js","./useScreenSize-1.0.37-X1Uq-TFD.js"])))=>i.map(i=>d[i]);
import{j as e}from"./cm-1.0.37-CEr77VZi.js";import{r as n}from"./redux-1.0.37-C4JSQ-MG.js";import{u as te,C as se}from"./Chart-1.0.37-BPm1pFP4.js";import{_ as U}from"./main-1.0.37.js";import{a0 as K,S as L,a1 as re,P as oe,a as q,s as ie,l as a,a2 as ae,a3 as ne,a4 as ce,b as I,a5 as le,r as me,Z as pe,a6 as ue,a7 as he,a8 as de,a9 as fe,C as xe}from"./lib-1.0.37-Czwr-8r3.js";import{T as z,C as W,a as X}from"./Tooltip-1.0.37-D_uDknxi.js";import{B as ge,a as Se,b as be,T as Ce,c as Z}from"./TabPanel-1.0.37-CPE-1h3v.js";import{A as je,T as Te,M as _e,H as ye}from"./index-1.0.37-B60ShF2d.js";import{B as F,C as ke}from"./ConfirmDialog-1.0.37-BDQ_OfRf.js";import{A as Q,a as Ae}from"./AdminTheme-1.0.37-7PLndQ8H.js";import{a as D}from"./hooks-1.0.37-DW0_oiBB.js";import{a as Ee}from"./useChartSettings-1.0.37-DyLw1xR9.js";import{D as ve}from"./DynamicModeEnum-1.0.37-BXuL5kgA.js";import{a as Be}from"./ActionsSettings-1.0.37-DQdLIvID.js";import{e as N}from"./notistack-1.0.37-CEqipxDI.js";import{B as Ne,S as V}from"./Spinner-1.0.37-CwhfSVqI.js";import{f as Pe}from"./index-1.0.37-LxgxH_yq.js";import{T as Re}from"./Typography-1.0.37-DjtXWQnP.js";import{I as J}from"./iconBase-1.0.37-DRohixw7.js";import{R as we}from"./RestApi-1.0.37-CcjslynE.js";import{u as Me}from"./useTheme-1.0.37-D4xQQypV.js";import{u as Oe,A as Le}from"./AppTheme-1.0.37-DOXnENpA.js";import{F as ze}from"./FallbackSpinner-1.0.37-DAc7pvnM.js";import{T as $}from"./ThemeProvider-1.0.37-Cyf1xy26.js";import"./vendor-1.0.37-CN03Eozo.js";import"./useRemoveAppFromStore-1.0.37-HphIv4xo.js";import"./lang-1.0.37-CfHlhLgz.js";import"./Tooltip-1.0.37-BLWvlO4a.js";import"./useControlled-1.0.37-DyimEgDk.js";import"./Popper-1.0.37-CSsNCozr.js";import"./useEnhancedEffect-1.0.37-UwysO4qr.js";import"./loglevel-1.0.37-BZ7XahX3.js";import"./lodash-1.0.37-Dx3wKrSf.js";import"./moment-1.0.37-C5S46NFB.js";import"./Menu-1.0.37-Ca8DeoO3.js";import"./MenuItem-1.0.37-JkRcsicb.js";import"./useThemeProps-1.0.37-CD9ZXLtG.js";import"./getThemeProps-1.0.37-BGc0S4YC.js";import"./TargetEnum-1.0.37-CIW1jlU5.js";import"./index-1.0.37-D4zhytA1.js";const Fe=n.lazy(()=>U(()=>import("./SettingsChart-1.0.37-Ccr4azRK.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46]),import.meta.url)),Ve=n.lazy(()=>U(()=>import("./ThemeSettings-1.0.37-Bw_m4zMJ.js"),__vite__mapDeps([47,1,2,3,14,7,8,9,10,48,38,39,5,6,11,40,19,17,4,12,49,50,51,29,15,16,42,22,23,52,53,25,26,27,28,41,54,20,21,24,55,32,33,56,57,35,36,37]),import.meta.url)),Je=n.lazy(()=>U(()=>import("./ResizableDrawer-1.0.37-C5w2uIZI.js"),__vite__mapDeps([58,1,2,3,59,7,8,9,10,14,6,26,11,5,4,12,28]),import.meta.url)),Ue=({appId:o})=>{var S,b;const m=D(),[_,P]=n.useState(K.getSelectors().selectChart(L.getState().charts,o)),[G,s]=n.useState(re.getSelectors().selectThemeById(L.getState().themes,o)),R=Ee(o),w=te(o),[y,l]=n.useState(!1),[M,h]=n.useState(!1),i=()=>{m(ne()),l(!1)},p=()=>{y?h(!0):(f(),i())},k=t=>{a.debug(t),m(ae({appId:o,property:t})),l(!0)},d=t=>{m(ie({anchor:t}))},f=()=>{m(ce({appId:o,chartState:_}))},x=()=>{Be(o,t=>{if(a.debug(t),t!=null&&t.code&&(t==null?void 0:t.message)!==void 0)switch(t.code){case"ok":P(K.getSelectors().selectChart(L.getState().charts,o)),N(t.message,{variant:"success"});break;case"info":N(t.message,{variant:"info"});break;default:a.error(t),N(t.message??I.contactSupport,{variant:"error"})}},t=>{a.error("error",t),N(t??I.contactSupport,{variant:"error"})}),l(!1)},A=()=>{y?(x(),setTimeout(()=>{i()},1e3)):i()},E=((S=Q)==null?void 0:S.palette.mode)===oe.LIGHT?(b=Q)==null?void 0:b.palette.primary.main:"",[g,v]=n.useState(0),B=n.useMemo(()=>[{title:"Chart",icon:e.jsx(ye,{})},{title:"Theme",icon:e.jsx(Pe,{})}],[]);return e.jsx(e.Fragment,{children:w&&e.jsxs(e.Fragment,{children:[e.jsx(n.Suspense,{fallback:e.jsx(V,{}),children:e.jsxs(Je,{closeDrawer:p,children:[e.jsxs(je,{position:"static",elevation:4,sx:{borderRadius:0},children:[e.jsxs(Te,{className:"pp-setting-toolbar",sx:{borderRadius:0},children:[e.jsx(Re,{variant:"h5",noWrap:!0,component:"div",className:"unselectable",sx:{flexGrow:1,paddingLeft:"6px"},children:"Chart Builder"}),e.jsx(z,{title:"Dock to left",position:"bottom",children:e.jsx(J,{onClick:()=>{d(q.LEFT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(ge,{})})}),e.jsx(z,{title:"Dock to right",position:"bottom",children:e.jsx(J,{onClick:()=>{d(q.RIGHT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(Se,{})})}),e.jsx(z,{title:"Close",position:"bottom",children:e.jsx(J,{onClick:p,size:"large",color:"inherit",sx:{fontSize:"1.4em"},children:e.jsx(_e,{})})})]}),e.jsx(be,{menuItems:B,menuIndex:g,setMenu:v})]}),e.jsx(W,{className:"pp-settings-container",children:e.jsx(X,{sx:{padding:0,margin:0},children:e.jsx(Ce,{value:g,children:e.jsxs(Ne,{sx:{margin:0,padding:0,overflowX:"hidden",overflowY:"auto",height:"calc(100vh - 250px)","& > div.MuiTabPanel-root":{padding:0}},children:[e.jsx(Z,{value:0,children:e.jsx(n.Suspense,{fallback:e.jsx(V,{}),children:e.jsx(Fe,{appId:o,chartSettings:R,updateSettings:k})})}),e.jsx(Z,{value:1,children:e.jsx(n.Suspense,{fallback:e.jsx(V,{}),children:e.jsx(Ve,{appId:o,source:ve.TABLE,setIsUpdated:l})})})]})})})}),e.jsx(W,{className:"pp-setting-footer",sx:{borderRadius:0,backgroundColor:E},children:e.jsxs(X,{className:"pp-setting-footer-buttons",sx:{borderRadius:0},children:[e.jsx(F,{variant:"outlined",className:"footer_action_button_apply",onClick:x,children:"Apply"}),e.jsx(F,{variant:"outlined",className:"footer_action_button",onClick:A,children:"OK"}),e.jsx(F,{variant:"outlined",className:"footer_action_button",onClick:p,children:"Cancel"})]})})]})}),e.jsx(ke,{title:"Close Chart Builder?",message:"All uncommitted changes will be lost!",open:M,setOpen:h,onConfirm:()=>{f(),i()},onKeep:()=>{i()}})]})})},vt=({appId:o,appDbId:m})=>{a.debug(o,m);const _=D(),[P,G]=n.useState(!1),s=Oe(o),R=Me(),w=Le(R,me.table,le.form),y=n.useMemo(()=>Ae(),[]),l=i=>{switch(i.substring(0,i.indexOf("(")).toLowerCase()){case"decimal":case"double":case"double precision":case"float":case"real":case"bit":case"tinyint":case"smallint":case"int":case"integer":case"mediumint":case"bigint":return"number";case"time":return"time";case"date":return"date";case"datetime":case"timestamp":return"datetime"}return"text"},M=()=>{we(xe.appUrlChartData,{app_id:m},i=>{var p,k,d,f,x,A,E,g,v,B,S,b;if(a.debug(i),(i==null?void 0:i.data)!==void 0){if(Array.isArray(i.data)){const t=i.data,C=[];i.explain.map(r=>{r.Type?C.push(l(r.Type)):r.type?C.push(l(r.type)):r.TYPE&&C.push(l(r.TYPE))}),a.debug(C);const u=[],H=[];Object.keys(t[0]).map(r=>H.push(r)),u.push(H);for(let r=0;r<t.length;r++){const O=[];Object.keys(t[r]).map((Y,ee)=>C[ee]==="text"?O.push(t[r][Y]):O.push(Number(t[r][Y]))),u.push(O)}a.debug(u);let c={};if(((k=(p=s==null?void 0:s.app)==null?void 0:p.container[0])==null?void 0:k.cnt_chart)!==void 0&&((f=(d=s==null?void 0:s.app)==null?void 0:d.container[0])==null?void 0:f.cnt_chart)!==null&&((A=(x=s==null?void 0:s.app)==null?void 0:x.container[0])==null?void 0:A.cnt_chart)!=="")try{c=JSON.parse(s.app.container[0].cnt_chart)}catch(r){a.error("Invalid JSON - chart settings"),a.error(r)}c===!1&&(c={}),a.debug(c);const j=ue({},he,c);j.data=u,j.majorAxisColumn=u[0][0],j.minorAxisColumns=u[0].slice(1),Array.isArray(c==null?void 0:c.chartTypes)&&c.chartTypes.length>0&&(j.chartType=c.chartTypes[0]),_(de({appId:o,chartState:j}));let T={};if(((g=(E=s==null?void 0:s.app)==null?void 0:E.app[0])==null?void 0:g.app_theme)!==void 0&&((B=(v=s==null?void 0:s.app)==null?void 0:v.app[0])==null?void 0:B.app_theme)!==null&&((b=(S=s==null?void 0:s.app)==null?void 0:S.app[0])==null?void 0:b.app_theme)!=="")try{T=JSON.parse(s.app.app[0].app_theme)}catch(r){a.error("Invalid JSON - theme settings"),a.error(r)}T===!1&&(T={}),a.debug(T),_(fe({appId:o,themeState:T})),G(!0)}}else a.error("Error loading chart data")},()=>{a.error("Error loading chart data")})};n.useEffect(()=>{M()},[]);const h=n.useMemo(()=>pe(s),[s]);return P?e.jsxs(e.Fragment,{children:[e.jsx($,{theme:w,children:e.jsx(se,{appId:o,isBuilderEnabled:h,isToolbarEnabled:!0,isExploring:(s==null?void 0:s.isExploring)===!0})}),h&&e.jsx($,{theme:y,children:e.jsx(Ue,{appId:o})})]}):e.jsx(ze,{})};export{vt as default};
