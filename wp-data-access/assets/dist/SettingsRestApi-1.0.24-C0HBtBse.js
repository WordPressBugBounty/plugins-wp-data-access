import{j as e}from"./cm-1.0.24-lBsX3THK.js";import{v as G,w as U}from"./index-1.0.24-CyelUMLZ.js";import{a as H}from"./RestApi-1.0.24-BCmVwqnT.js";import{l as h,R as S,bl as W,bm as Y,bn as R}from"./lib-1.0.24-up-HxGpi.js";import{r as v}from"./redux-1.0.24-Bx8jJ3ee.js";import{c as B}from"./index-1.0.24-vo0tC6xY.js";/* empty css                    */import{A as I}from"./Accordion-1.0.24-uvRe3lte.js";import{A as F}from"./AccordionSummary-1.0.24-B564M2Bj.js";import{A as M}from"./AccordionDetails-1.0.24-DwKVwnKj.js";import{B as f}from"./Spinner-1.0.24-DzEoy0TD.js";import{F as _}from"./FormLabel-1.0.24-DNrTGbzF.js";import{F as C}from"./FormControlLabel-1.0.24-jTuSRk-Y.js";import{S as y}from"./Switch-1.0.24-BzowSg2t.js";import{F as Z,a as w}from"./FormHelperText-1.0.24-dIoAVumM.js";import{R as q}from"./RadioGroup-1.0.24-C4yZZRVK.js";import{R as z}from"./Radio-1.0.24-DPbrWB-2.js";import{A as k,C as L}from"./Autocomplete-1.0.24-C17x-b9y.js";import{T as N}from"./TextField-1.0.24-CX3Aj71c.js";import{u as J}from"./ExplorerActionAdmin-1.0.24-6f0rLxx2.js";import{u as K}from"./useExplorer-1.0.24-Cts7Zoll.js";import"./vendor-1.0.24-BmpNFhoq.js";import"./Typography-1.0.24-DtpcakL_.js";import"./iconBase-1.0.24-C7lJg7VQ.js";import"./notistack-1.0.24-EH6RgmCJ.js";import"./loglevel-1.0.24-BZ7XahX3.js";import"./lodash-1.0.24-CC2RnyUh.js";import"./moment-1.0.24-C5S46NFB.js";import"./Menu-1.0.24-Bmzze4W5.js";import"./ThemeProvider-1.0.24-koXQmW7k.js";import"./useControlled-1.0.24-DnsqB4VW.js";import"./Collapse-1.0.24-Xb_bb7om.js";import"./useFormControl-1.0.24-BVJe4wXv.js";import"./SwitchBase-1.0.24-k3CO2XxE.js";import"./createSvgIcon-1.0.24-BKX7HR5-.js";import"./Close-1.0.24-16O9KsVp.js";import"./Popper-1.0.24-pV6SBss6.js";import"./main-1.0.24.js";import"./TabPanel-1.0.24-DAjZ0-bn.js";import"./DialogContent-1.0.24-o2zFJd9S.js";import"./ConfirmDialog-1.0.24-5s_WiKiN.js";import"./AdminTheme-1.0.24-DxOFSSNd.js";import"./CardContent-1.0.24-DpYcLPhl.js";import"./ActionsExplorer-1.0.24-C9nnL7_n.js";import"./index-1.0.24-B9zHNwKy.js";import"./settings-1.0.24-CtEnxau0.js";import"./MenuItem-1.0.24-cnqjqUCU.js";import"./ActionsDml-1.0.24-BgEAxcii.js";import"./ExplorerActionEnum-1.0.24-eclZgKpy.js";import"./useUiExplorerAction-1.0.24-DqHIrYIX.js";var p=(r=>(r.SELECT="select",r.INSERT="insert",r.UPDATE="update",r.DELETE="delete",r))(p||{}),P=(r=>(r.GET="GET",r.POST="POST",r))(P||{});const A=({restApi:r,action:a,roles:T,users:i,setRestApi:u,expanded:d,setExpanded:l})=>{h.debug(r,a,T,i,d);const O=(s,o)=>{const c=B(r);if(o)c.methods.push(s);else{const m=c.methods.indexOf(s);m>-1&&c.methods.splice(m,1)}h.debug(s,o,c),u(c)},b=s=>{h.debug(s),u({...r,authorization:s})},j=s=>{h.debug(s),u({...r,authorized_roles:s.map(o=>o.key)})},E=s=>{h.debug(s),u({...r,authorized_users:s.map(o=>o.key)})},x=v.useMemo(()=>T.filter(s=>r.authorized_roles.includes(s.key)),[r.authorized_roles,T]),g=v.useMemo(()=>i.filter(s=>r.authorized_users.includes(s.key)),[r.authorized_users,i]);return e.jsxs(I,{disableGutters:!0,expanded:d===a.toString(),onChange:()=>{d===a.toString()?l(""):l(a)},children:[e.jsx(F,{expandIcon:e.jsx(G,{}),sx:{textTransform:"capitalize"},children:a}),e.jsx(M,{children:e.jsxs(f,{sx:{display:"grid",gridGap:"20px"},children:[e.jsx(_,{children:"Supported HTTP methods"}),e.jsxs(f,{children:[e.jsx(C,{control:e.jsx(y,{checked:r.methods.includes(P.GET),onChange:(s,o)=>{O(P.GET,o),s.stopPropagation()}}),label:"GET",labelPlacement:"end"}),e.jsx(C,{control:e.jsx(y,{checked:r.methods.includes(P.POST),onChange:(s,o)=>{O(P.POST,o),s.stopPropagation()}}),label:"POST",labelPlacement:"end"})]}),e.jsx(_,{children:"Authorization"}),e.jsxs(Z,{sx:{marginLeft:"-10px"},children:[e.jsxs(q,{children:[e.jsxs(_,{className:"align-label-radio",sx:{cursor:"pointer"},children:[e.jsx(z,{checked:r.authorization===S.AUTHORIZED,onChange:s=>{b(S.AUTHORIZED),s.stopPropagation()}}),"Authorized access only"]}),e.jsxs(f,{sx:{display:"grid",gridGap:"10px",margin:"20px 10px 20px 42px"},children:[e.jsx(k,{multiple:!0,disableCloseOnSelect:!0,options:T,getOptionLabel:s=>s.value,value:x,onChange:(s,o)=>{j(o)},renderInput:s=>e.jsx(N,{...s,label:"Roles"}),renderTags:(s,o)=>s.map((c,m)=>{const{key:t,...n}=o({index:m});return e.jsx(L,{variant:"outlined",label:c.value,...n},t)})}),e.jsx(k,{multiple:!0,disableCloseOnSelect:!0,options:i,getOptionLabel:s=>s.value,value:g,onChange:(s,o)=>{E(o)},renderInput:s=>e.jsx(N,{...s,label:"Users"}),renderTags:(s,o)=>s.map((c,m)=>{const{key:t,...n}=o({index:m});return e.jsx(L,{variant:"outlined",label:c.value,...n},t)})})]}),e.jsxs(_,{className:"align-label-radio",sx:{cursor:"pointer"},children:[e.jsx(z,{checked:r.authorization===S.ANONYMOUS,onChange:s=>{b(S.ANONYMOUS),s.stopPropagation()}}),"Anonymous access"]})]}),r.authorization===S.ANONYMOUS&&r.methods.length>0&&e.jsxs(f,{sx:{marginTop:"10px",marginLeft:"10px"},children:[(a===p.INSERT||a===p.UPDATE||a===p.DELETE)&&e.jsx(w,{children:"This setting allows non-authorized users to modify this table"}),a===p.SELECT&&e.jsx(w,{children:"This setting allows non-authorized users to query this table"})]})]})]})})]})},Ze=({dbs:r,tbl:a,typ:T,metaData:i,setIsUpdated:u})=>{var s,o,c,m;h.debug(r,a,T,i);const d=H(),l=J(),b=K().selected,[j,E]=v.useState(""),x=[];if(((o=(s=i==null?void 0:i.settings)==null?void 0:s.wp)==null?void 0:o.roles)!==void 0)for(const t in i.settings.wp.roles)x.push({key:t,value:i.settings.wp.roles[t]});h.debug(x);const g=[];if(((m=(c=i==null?void 0:i.settings)==null?void 0:c.wp)==null?void 0:m.users)!==void 0)for(const t in i.settings.wp.users)g.push({key:t,value:i.settings.wp.users[t]});return h.debug(g),e.jsxs(I,{disableGutters:!0,slotProps:{transition:{unmountOnExit:!0}},children:[e.jsx(F,{expandIcon:e.jsx(G,{}),children:"REST API"}),e.jsx(M,{children:e.jsxs(f,{children:[e.jsx(C,{control:e.jsx(y,{checked:l.rest_api!==null,onClick:t=>{l.rest_api!==null?d(W({})):d(Y({})),u(!0),t.stopPropagation()}}),label:"Enable REST API",labelPlacement:"end"}),l.rest_api!==null&&e.jsxs(f,{sx:{marginTop:"20px"},children:[e.jsx(A,{restApi:l.rest_api.select,action:p.SELECT,roles:x,users:g,setRestApi:t=>{const n={...l.rest_api};n[p.SELECT]=t,d(R({rest_api:n})),u(!0)},expanded:j,setExpanded:E}),e.jsx(A,{restApi:l.rest_api.insert,action:p.INSERT,roles:x,users:g,setRestApi:t=>{const n={...l.rest_api};n[p.INSERT]=t,d(R({rest_api:n})),u(!0)},expanded:j,setExpanded:E}),e.jsx(A,{restApi:l.rest_api.update,action:p.UPDATE,roles:x,users:g,setRestApi:t=>{const n={...l.rest_api};n[p.UPDATE]=t,d(R({rest_api:n})),u(!0)},expanded:j,setExpanded:E}),e.jsx(A,{restApi:l.rest_api.delete,action:p.DELETE,roles:x,users:g,setRestApi:t=>{const n={...l.rest_api};n[p.DELETE]=t,d(R({rest_api:n})),u(!0)},expanded:j,setExpanded:E})]}),b[r]==="system"||b[r]==="wp"&&i.settings.wp.tables.includes(a)&&e.jsxs(w,{sx:{display:"inline-grid",gridTemplateColumns:"20px auto",gridGap:"5px",marginTop:"20px",alignItems:"center","& svg":{fontSize:"20px"}},children:[e.jsx(U,{}),"We discourage enabling REST API services for WordPress and system tables"]})]})})]})};export{Ze as default};
