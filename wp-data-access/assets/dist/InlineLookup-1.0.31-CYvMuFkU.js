import{j as C}from"./cm-1.0.31-BzgG35ZX.js";import{r as n}from"./redux-1.0.31-CuzmJMK6.js";import{l as m,b as V,bP as U}from"./lib-1.0.31-BbX3jq4e.js";import{l as O}from"./ActionsDml-1.0.31-DnIQKtBi.js";import{u as X,a as Y}from"./RestApi-1.0.31-C4KxgDIV.js";import{c as Z}from"./useTheme-1.0.31-BXg8i2QZ.js";import{g as $}from"./TableQuery-1.0.31-s1kaUzCT.js";import{i as D}from"./index-1.0.31-C4m7fjwq.js";import{F as M}from"./FormHelperText-1.0.31-CQcG9a5q.js";import{A as R}from"./Autocomplete-1.0.31-DLbMViDM.js";import{T as I}from"./TextField-1.0.31-TtMrk-_t.js";import"./vendor-1.0.31-BmpNFhoq.js";import"./loglevel-1.0.31-BZ7XahX3.js";import"./lodash-1.0.31-BtCjXqrS.js";import"./moment-1.0.31-C5S46NFB.js";import"./index-1.0.31-DboOrfK9.js";import"./Typography-1.0.31-BdhCS1KD.js";import"./cjs-1.0.31-B-_HdexB.js";import"./iconBase-1.0.31-C37NsRUm.js";import"./notistack-1.0.31-CuGQWCbt.js";import"./main-1.0.31.js";import"./useStoreTable-1.0.31-CksmwD3u.js";import"./ConfirmDialog-1.0.31-bZDmgpd0.js";import"./AdminTheme-1.0.31-QbwKcRV7.js";import"./DialogContent-1.0.31-_6ykng6a.js";import"./SanitizeComponent-1.0.31-Dhv0AQbJ.js";import"./dompurify-1.0.31-CCJo14B2.js";import"./index-1.0.31-C_6FsHsh.js";import"./tanstack-1.0.31-DxTNlTkm.js";import"./index.esm-1.0.31-BlNbk2TL.js";import"./createSvgIcon-1.0.31-BC4iq9Gi.js";import"./Collapse-1.0.31-CkBm-DA4.js";import"./Tooltip-1.0.31-crORCg22.js";import"./Popper-1.0.31-QmfursjS.js";import"./useControlled-1.0.31-27-LkxG9.js";import"./Spinner-1.0.31-Be7r01J6.js";import"./FormControlLabel-1.0.31-VNfgE3Oe.js";import"./useFormControl-1.0.31-2YJOQA8g.js";import"./Checkbox-1.0.31-vMcA9dS9.js";import"./SwitchBase-1.0.31-AIM_3--O.js";import"./Menu-1.0.31-BOTBPSPr.js";import"./InputAdornment-1.0.31-DPyTBX7W.js";import"./TimePicker-1.0.31-BANN2pIs.js";import"./useMobilePicker-1.0.31-DH3b4aWb.js";import"./index-1.0.31-545nqCBP.js";import"./visuallyHidden-1.0.31-Dan1xhjv.js";import"./ListItem-1.0.31-CWrAezii.js";import"./timeViewRenderers-1.0.31-CeUACARG.js";import"./MenuItem-1.0.31-CTowyoSp.js";import"./DateTimePicker-1.0.31-D95kRUCa.js";import"./Tabs-1.0.31-XRJEidP6.js";import"./dateViewRenderers-1.0.31-B5XFWF81.js";import"./Divider-1.0.31-BWKAGEdz.js";import"./DatePicker-1.0.31-wKpNLdLs.js";import"./Stack-1.0.31-Bz9nXUZB.js";import"./Slider-1.0.31-BDZ4XVru.js";import"./ListItemIcon-1.0.31-BCafYY7N.js";import"./Radio-1.0.31-DbEe8Ljo.js";import"./AlertTitle-1.0.31-Zosaacrw.js";import"./Close-1.0.31-BTPwVQpD.js";import"./Switch-1.0.31-LPOyRUXk.js";import"./index.esm-1.0.31-BcBy0Voo.js";import"./TableContainer-1.0.31-D5nXSZNu.js";import"./FallbackSpinner-1.0.31-B4qqxHwC.js";import"./ActionsSettings-1.0.31-Cf56Toxs.js";import"./TargetEnum-1.0.31-DPFnTxiX.js";import"./ScopeEnum-1.0.31-B4DDvIDj.js";import"./index-1.0.31-ujFQUobk.js";import"./TabPanel-1.0.31-CQFpWPRX.js";import"./useTableUpdater-1.0.31-BVeL37Z7.js";import"./settings-1.0.31-zyRrYuee.js";import"./useScreenSize-1.0.31-DKas25yF.js";import"./ThemeContainer-1.0.31-D01zq5BI.js";import"./useTableColumnOrder-1.0.31-CvAinKiB.js";import"./FormLabel-1.0.31-7Vju-x1c.js";const w=(p,e)=>{const u=X(c=>c.lookups[p]!==void 0?c.lookups[p][e]:void 0);return m.debug("lookup",u),u},Ne=({value:p,columnState:e,columnMetaData:u,setValue:c,saveChanges:P,appId:a,currentRow:f,storeRow:N,row:T})=>{var L,j;m.debug(p,e,u,a,f,N,T);const F=Y(),h=Z(a),[q,W]=n.useState(!1),[x,_]=n.useState(p);n.useEffect(()=>{m.debug("useEffect",e.columnName,x,p,f[e.columnName]),N!==void 0&&N[e.columnName]!==void 0&&x!==p&&(P(),_(p))},[p]);const k=w(a,e.columnName),[g,b]=n.useState([]);m.debug("lov",g);const[d,H]=n.useState(Array.isArray((L=e.lookup)==null?void 0:L.dynamicConditions)?(j=e.lookup)==null?void 0:j.dynamicConditions.map(o=>({columnName:o.lookupColumnName,columnValue:f[o.tableColumnName]??""})):[]);m.debug("conditions",d),n.useEffect(()=>{if(k!==void 0)if(Object.keys(k).length>0){const o=[];for(const l in k)o.push({key:l,value:k[l]});b(o)}else d.length===0&&z();else b([])},[k]);const z=()=>{if(!q&&g.length===0){W(!0);const o=e.lookup;if(o!==void 0){const l=h.isRelationSelectionTable===!0?V.relationTablePrefix+e.columnName:e.columnName;O(a,"table",l,o.key,o.value,{},{},i=>{m.debug(i.data);const t={};for(let r=0;r<i.data.length;r++)if(!o.value.includes(","))t[i.data[r].key]=i.data[r].value;else{const s=o.value.split(",");t[i.data[r].key]=s.map(v=>i.data[r][v])}m.debug(t),F(U({appId:a,columnName:e.columnName,lookup:t}))},i=>{m.error(i)})}}else m.error("Error loading lookup - please check server response")};n.useEffect(()=>{var o,l;if(Object.keys(d).length>0&&d.length>0){const i=Array.isArray((o=e.lookup)==null?void 0:o.dynamicConditions)?(l=e.lookup)==null?void 0:l.dynamicConditions.map(r=>({columnName:r.lookupColumnName,columnValue:f[r.tableColumnName]??""})):[];m.debug("reload lookup?",d,i);const t={};if(i.length>0&&i.map(r=>{t[r.columnName]=r.columnValue}),D(d,i))m.debug("reloading dynamic lookup",e.columnName,i,t),A(t);else{const r={};i.length>0&&i.map(s=>{r[s.columnName]=s.columnValue}),H(i),i.filter(s=>s.columnValue===""||s.columnValue===null).length===0?A(r):b([])}}},[f]);const A=(o={})=>{const l=e.lookup;if(l!==void 0){const i=h.isRelationSelectionTable===!0?V.relationTablePrefix+e.columnName:e.columnName;O(a,"table",i,l.key,l.value,o,{},t=>{var r,s,v;if(m.debug(t.data),!((r=e.lookup)!=null&&r.value.includes(",")))b(t.data);else{const J=(s=e.lookup)==null?void 0:s.value.split(","),E=[];for(let y=0;y<t.data.length;y++){const K=J.map(Q=>t.data[y][Q]).join(((v=e.lookup)==null?void 0:v.delimiter)??"");E.push({key:t.data[y].key,value:K})}b(E)}},t=>{m.error(t)})}},B=o=>{var l;return Array.isArray(o.value)?o.value.join(((l=e.lookup)==null?void 0:l.delimiter)??""):o.value},G=n.useMemo(()=>g.filter(o=>o.key===p)[0]??null,[g,p]);return C.jsx("div",{onClick:o=>{o.stopPropagation()},children:C.jsx(M,{fullWidth:!0,onClick:o=>{o.stopPropagation()},children:C.jsx(R,{className:"pp-inline-editing",multiple:!1,fullWidth:!0,autoHighlight:!0,disableClearable:u.is_nullable==="NO",options:g,getOptionLabel:o=>B(o),value:G,onChange:(o,l)=>{c(l!==null?l.key:null),o.stopPropagation()},renderInput:o=>C.jsx(I,{label:u.formLabel,required:u.is_nullable==="NO",...o,sx:$(e)})})})})};export{Ne as default};
