import{l as x,r as v,j as e,R as f,bH as H,aO as W,cc as Y,cd as B,ce as R}from"./main-1.0.23.js";import{v as I,w as Z}from"./index.esm-1.0.23-ba0465a2.js";import{a as q,u as z}from"./RestApi-1.0.23-cc179eb9.js";import{c as J}from"./index-1.0.23-fea3ac27.js";/* empty css                    */import{A as F,a as M}from"./AccordionSummary-1.0.23-078f8091.js";import{A as U}from"./AccordionDetails-1.0.23-ad785ba6.js";import{B as b}from"./Spinner-1.0.23-90ab83ff.js";import{F as _}from"./FormLabel-1.0.23-71a056b2.js";import{F as C}from"./FormControlLabel-1.0.23-1ad68af6.js";import{S as y}from"./Switch-1.0.23-86b06b05.js";import{F as K,a as w}from"./FormHelperText-1.0.23-83597bdf.js";import{R as Q}from"./RadioGroup-1.0.23-053476ee.js";import{R as k}from"./Radio-1.0.23-7006053b.js";import{A as L,C as N}from"./Autocomplete-1.0.23-a5bc1209.js";import{T as G}from"./TextField-1.0.23-1657e9d4.js";import"./Typography-1.0.23-19a0fd3e.js";import"./iconBase-1.0.23-43ac6f06.js";import"./index-1.0.23-9af490ae.js";import"./useSlot-1.0.23-b9d48820.js";import"./useControlled-1.0.23-1e71c28b.js";import"./Collapse-1.0.23-a92fc278.js";import"./useFormControl-1.0.23-a0ae6ce7.js";import"./createStyled-1.0.23-528f26c2.js";import"./SwitchBase-1.0.23-adccc77c.js";import"./createSvgIcon-1.0.23-f9410a01.js";import"./Modal-1.0.23-3fe42627.js";import"./Close-1.0.23-ea28bfa6.js";import"./Popper-1.0.23-4a0d0616.js";import"./Menu-1.0.23-e889464a.js";import"./ThemeProvider-1.0.23-f3e5cbc1.js";import"./Popover-1.0.23-6c9c65a6.js";import"./Grow-1.0.23-40b2ff68.js";var a=(r=>(r.SELECT="select",r.INSERT="insert",r.UPDATE="update",r.DELETE="delete",r))(a||{}),S=(r=>(r.GET="GET",r.POST="POST",r))(S||{});const A=({restApi:r,action:p,roles:T,users:i,setRestApi:d,expanded:u,setExpanded:n})=>{x.debug(r,p,T,i,u);const j=(s,o)=>{const c=J(r);if(o)c.methods.push(s);else{const t=c.methods.indexOf(s);t>-1&&c.methods.splice(t,1)}x.debug(s,o,c),d(c)},h=s=>{x.debug(s),d({...r,authorization:s})},E=s=>{x.debug(s),d({...r,authorized_roles:s.map(o=>o.key)})},m=s=>{x.debug(s),d({...r,authorized_users:s.map(o=>o.key)})},g=v.useMemo(()=>T.filter(s=>r.authorized_roles.includes(s.key)),[r.authorized_roles,T]),P=v.useMemo(()=>i.filter(s=>r.authorized_users.includes(s.key)),[r.authorized_users,i]);return e.jsxs(F,{disableGutters:!0,expanded:u===p.toString(),onChange:()=>{u===p.toString()?n(""):n(p)},children:[e.jsx(M,{expandIcon:e.jsx(I,{}),sx:{textTransform:"capitalize"},children:p}),e.jsx(U,{children:e.jsxs(b,{sx:{display:"grid",gridGap:"20px"},children:[e.jsx(_,{children:"Supported HTTP methods"}),e.jsxs(b,{children:[e.jsx(C,{control:e.jsx(y,{checked:r.methods.includes(S.GET),onChange:(s,o)=>{j(S.GET,o),s.stopPropagation()}}),label:"GET",labelPlacement:"end"}),e.jsx(C,{control:e.jsx(y,{checked:r.methods.includes(S.POST),onChange:(s,o)=>{j(S.POST,o),s.stopPropagation()}}),label:"POST",labelPlacement:"end"})]}),e.jsx(_,{children:"Authorization"}),e.jsxs(K,{sx:{marginLeft:"-10px"},children:[e.jsxs(Q,{children:[e.jsxs(_,{className:"align-label-radio",sx:{cursor:"pointer"},children:[e.jsx(k,{checked:r.authorization===f.AUTHORIZED,onChange:s=>{h(f.AUTHORIZED),s.stopPropagation()}}),"Authorized access only"]}),e.jsxs(b,{sx:{display:"grid",gridGap:"10px",margin:"20px 10px 20px 42px"},children:[e.jsx(L,{multiple:!0,disableCloseOnSelect:!0,options:T,getOptionLabel:s=>s.value,value:g,onChange:(s,o)=>{E(o)},renderInput:s=>e.jsx(G,{...s,label:"Roles"}),renderTags:(s,o)=>s.map((c,t)=>{const{key:l,...O}=o({index:t});return e.jsx(N,{variant:"outlined",label:c.value,...O},l)})}),e.jsx(L,{multiple:!0,disableCloseOnSelect:!0,options:i,getOptionLabel:s=>s.value,value:P,onChange:(s,o)=>{m(o)},renderInput:s=>e.jsx(G,{...s,label:"Users"}),renderTags:(s,o)=>s.map((c,t)=>{const{key:l,...O}=o({index:t});return e.jsx(N,{variant:"outlined",label:c.value,...O},l)})})]}),e.jsxs(_,{className:"align-label-radio",sx:{cursor:"pointer"},children:[e.jsx(k,{checked:r.authorization===f.ANONYMOUS,onChange:s=>{h(f.ANONYMOUS),s.stopPropagation()}}),"Anonymous access"]})]}),r.authorization===f.ANONYMOUS&&r.methods.length>0&&e.jsxs(b,{sx:{marginTop:"10px",marginLeft:"10px"},children:[(p===a.INSERT||p===a.UPDATE||p===a.DELETE)&&e.jsx(w,{children:"This setting allows non-authorized users to modify this table"}),p===a.SELECT&&e.jsx(w,{children:"This setting allows non-authorized users to query this table"})]})]})]})})]})},Ce=({dbs:r,tbl:p,typ:T,metaData:i,setIsUpdated:d})=>{var P,s,o,c;x.debug(r,p,T,i);const u=q(),n=z(t=>H(t));x.debug(n);const j=z(t=>W(t));x.debug(j);const[h,E]=v.useState(""),m=[];if(((s=(P=i==null?void 0:i.settings)==null?void 0:P.wp)==null?void 0:s.roles)!==void 0)for(const t in i.settings.wp.roles)m.push({key:t,value:i.settings.wp.roles[t]});x.debug(m);const g=[];if(((c=(o=i==null?void 0:i.settings)==null?void 0:o.wp)==null?void 0:c.users)!==void 0)for(const t in i.settings.wp.users)g.push({key:t,value:i.settings.wp.users[t]});return x.debug(g),e.jsxs(F,{disableGutters:!0,slotProps:{transition:{unmountOnExit:!0}},children:[e.jsx(M,{expandIcon:e.jsx(I,{}),children:"REST API"}),e.jsx(U,{children:e.jsxs(b,{children:[e.jsx(C,{control:e.jsx(y,{checked:n.rest_api!==null,onClick:t=>{n.rest_api!==null?u(Y({})):u(B({})),d(!0),t.stopPropagation()}}),label:"Enable REST API",labelPlacement:"end"}),n.rest_api!==null&&e.jsxs(b,{sx:{marginTop:"20px"},children:[e.jsx(A,{restApi:n.rest_api.select,action:a.SELECT,roles:m,users:g,setRestApi:t=>{const l={...n.rest_api};l[a.SELECT]=t,u(R({rest_api:l})),d(!0)},expanded:h,setExpanded:E}),e.jsx(A,{restApi:n.rest_api.insert,action:a.INSERT,roles:m,users:g,setRestApi:t=>{const l={...n.rest_api};l[a.INSERT]=t,u(R({rest_api:l})),d(!0)},expanded:h,setExpanded:E}),e.jsx(A,{restApi:n.rest_api.update,action:a.UPDATE,roles:m,users:g,setRestApi:t=>{const l={...n.rest_api};l[a.UPDATE]=t,u(R({rest_api:l})),d(!0)},expanded:h,setExpanded:E}),e.jsx(A,{restApi:n.rest_api.delete,action:a.DELETE,roles:m,users:g,setRestApi:t=>{const l={...n.rest_api};l[a.DELETE]=t,u(R({rest_api:l})),d(!0)},expanded:h,setExpanded:E})]}),j[r]==="system"||j[r]==="wp"&&i.settings.wp.tables.includes(p)&&e.jsxs(w,{sx:{display:"inline-grid",gridTemplateColumns:"20px auto",gridGap:"5px",marginTop:"20px",alignItems:"center","& svg":{fontSize:"20px"}},children:[e.jsx(Z,{}),"We discourage enabling REST API services for WordPress and system tables"]})]})})]})};export{Ce as default};
