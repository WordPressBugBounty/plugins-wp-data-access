import{r as i,l as L,j as g,ac as B,d as k,ax as U,Z as q,_ as x}from"./main-1.0.23.js";import{a as _,R as N,b as V,c as H,g as G}from"./useTheme-1.0.23-55aea9bb.js";import{B as D}from"./Spinner-1.0.23-90ab83ff.js";import{A as Q,T as K,e as Y,M as Z}from"./index.esm-1.0.23-ba0465a2.js";import{a as $,u as J}from"./RestApi-1.0.23-cc179eb9.js";import{T as I}from"./Tooltip-1.0.23-1b58a848.js";import{I as T,P as X}from"./iconBase-1.0.23-43ac6f06.js";function tt(n,a,t){i.useEffect(()=>{if(!document)return;const e=document.querySelector('script[src="'.concat(n,'"]'));if(e!=null&&e.dataset.loaded){a==null||a();return}const r=e||document.createElement("script");e||(r.src=n);const o=()=>{r.dataset.loaded="1",a==null||a()};return r.addEventListener("load",o),t&&r.addEventListener("error",t),e||document.head.append(r),()=>{r.removeEventListener("load",o),t&&r.removeEventListener("error",t)}},[])}function et(n){let{chartVersion:a="current",chartPackages:t=["corechart","controls"],chartLanguage:e="en",mapsApiKey:r}=n;const[o,s]=i.useState(null),[c,d]=i.useState(!1);return tt("https://www.gstatic.com/charts/loader.js",()=>{const l=window==null?void 0:window.google;l&&(l.charts.load(a,{packages:t,language:e,mapsApiKey:r}),l.charts.setOnLoadCallback(()=>{s(l)}))},()=>{d(!0)}),[o,c]}function ot(n){let{onLoad:a,onError:t,...e}=n;const[r,o]=et(e);return i.useEffect(()=>{r&&a&&a(r)},[r]),i.useEffect(()=>{o&&t&&t()},[o]),null}const W={legend_toggle:!1,options:{},legendToggle:!1,getChartWrapper:()=>{},spreadSheetQueryParameters:{headers:1,gid:1},rootProps:{},chartWrapperParams:{}};let S=0;const rt=()=>(S+=1,"reactgooglegraph-".concat(S)),at=["#3366CC","#DC3912","#FF9900","#109618","#990099","#3B3EAC","#0099C6","#DD4477","#66AA00","#B82E2E","#316395","#994499","#22AA99","#AAAA11","#6633CC","#E67300","#8B0707","#329262","#5574A6","#3B3EAC"],st=async function(n,a){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return new Promise((e,r)=>{const o="".concat(t.headers?"headers=".concat(t.headers):"headers=0"),s="".concat(t.query?"&tq=".concat(encodeURIComponent(t.query)):""),c="".concat(t.gid?"&gid=".concat(t.gid):""),d="".concat(t.sheet?"&sheet=".concat(t.sheet):""),l="".concat(t.access_token?"&access_token=".concat(t.access_token):""),h="".concat(o).concat(c).concat(d).concat(s).concat(l),p="".concat(a,"/gviz/tq?").concat(h);new n.visualization.Query(p).send(f=>{f.isError()?r("Error in query:  ".concat(f.getMessage()," ").concat(f.getDetailedMessage())):e(f.getDataTable())})})},{Provider:nt,Consumer:it}=i.createContext(W),lt=n=>{let{children:a,value:t}=n;return i.createElement(nt,{value:t},a)},P=n=>{let{render:a}=n;return i.createElement(it,null,t=>a(t))},ct="#CCCCCC";class ht extends i.Component{componentDidMount(){this.draw(this.props),window.addEventListener("resize",this.onResize),(this.props.legend_toggle||this.props.legendToggle)&&this.listenToLegendToggle()}componentWillUnmount(){const{google:a,googleChartWrapper:t}=this.props;window.removeEventListener("resize",this.onResize),a.visualization.events.removeAllListeners(t),t.getChartType()==="Timeline"&&t.getChart()&&t.getChart().clearChart()}componentDidUpdate(){this.draw(this.props)}render(){return null}constructor(...a){super(...a),this.state={hiddenColumns:[]},this.listenToLegendToggle=()=>{const{google:t,googleChartWrapper:e}=this.props;t.visualization.events.addListener(e,"select",()=>{const o=e.getChart().getSelection(),s=e.getDataTable();if(o.length===0||o[0].row||!s)return;const c=o[0].column,d=this.getColumnID(s,c);this.state.hiddenColumns.includes(d)?this.setState(l=>({...l,hiddenColumns:[...l.hiddenColumns.filter(h=>h!==d)]})):this.setState(l=>({...l,hiddenColumns:[...l.hiddenColumns,d]}))})},this.applyFormatters=(t,e)=>{const{google:r}=this.props;for(let o of e)switch(o.type){case"ArrowFormat":{new r.visualization.ArrowFormat(o.options).format(t,o.column);break}case"BarFormat":{new r.visualization.BarFormat(o.options).format(t,o.column);break}case"ColorFormat":{const s=new r.visualization.ColorFormat(o.options),{ranges:c}=o;for(let d of c)s.addRange(...d);s.format(t,o.column);break}case"DateFormat":{new r.visualization.DateFormat(o.options).format(t,o.column);break}case"NumberFormat":{new r.visualization.NumberFormat(o.options).format(t,o.column);break}case"PatternFormat":{new r.visualization.PatternFormat(o.options).format(t,o.column);break}}},this.getColumnID=(t,e)=>t.getColumnId(e)||t.getColumnLabel(e),this.draw=async t=>{let{data:e,diffdata:r,rows:o,columns:s,options:c,legend_toggle:d,legendToggle:l,chartType:h,formatters:p,spreadSheetUrl:C,spreadSheetQueryParameters:f}=t;const{google:v,googleChartWrapper:m}=this.props;let u,w=null;if(r){const b=v.visualization.arrayToDataTable(r.old),E=v.visualization.arrayToDataTable(r.new);w=v.visualization[h].prototype.computeDiff(b,E)}e!==null?Array.isArray(e)?u=v.visualization.arrayToDataTable(e):u=new v.visualization.DataTable(e):o&&s?u=v.visualization.arrayToDataTable([s,...o]):C?u=await st(v,C,f):u=v.visualization.arrayToDataTable([]);const y=u.getNumberOfColumns();for(let b=0;b<y;b+=1){const E=this.getColumnID(u,b);if(this.state.hiddenColumns.includes(E)){const j=u.getColumnLabel(b),O=u.getColumnId(b),M=u.getColumnType(b);u.removeColumn(b),u.addColumn({label:j,id:O,type:M})}}const z=m.getChart();m.getChartType()==="Timeline"&&z&&z.clearChart(),m.setChartType(h),m.setOptions(c||{}),m.setDataTable(u),m.draw(),this.props.googleChartDashboard!==null&&this.props.googleChartDashboard.draw(u),w&&(m.setDataTable(w),m.draw()),p&&(this.applyFormatters(u,p),m.setDataTable(u),m.draw()),(l===!0||d===!0)&&this.grayOutHiddenColumns({options:c})},this.grayOutHiddenColumns=t=>{let{options:e}=t;const{googleChartWrapper:r}=this.props,o=r.getDataTable();if(!o)return;const s=o.getNumberOfColumns();if(this.state.hiddenColumns.length>0===!1)return;const d=Array.from({length:s-1}).map((l,h)=>{const p=this.getColumnID(o,h+1);return this.state.hiddenColumns.includes(p)?ct:e&&e.colors?e.colors[h]:at[h]});r.setOptions({...e,colors:d}),r.draw()},this.onResize=()=>{const{googleChartWrapper:t}=this.props;t.draw()}}}class dt extends i.Component{componentDidMount(){}componentWillUnmount(){}shouldComponentUpdate(){return!1}render(){const{google:a,googleChartWrapper:t,googleChartDashboard:e}=this.props;return i.createElement(P,{render:r=>i.createElement(ht,Object.assign({},r,{google:a,googleChartWrapper:t,googleChartDashboard:e}))})}}class pt extends i.Component{shouldComponentUpdate(){return!1}listenToEvents(a){let{chartEvents:t,google:e,googleChartWrapper:r}=a;if(t){e.visualization.events.removeAllListeners(r);for(let s of t){var o=this;const{eventName:c,callback:d}=s;e.visualization.events.addListener(r,c,function(){for(var l=arguments.length,h=new Array(l),p=0;p<l;p++)h[p]=arguments[p];d({chartWrapper:r,props:o.props,google:e,eventArgs:h})})}}}componentDidMount(){var a;const{google:t,googleChartWrapper:e}=this.props;this.listenToEvents({chartEvents:((a=this.propsFromContext)===null||a===void 0?void 0:a.chartEvents)||null,google:t,googleChartWrapper:e})}render(){return this.props,i.createElement(P,{render:a=>(this.propsFromContext=a,null)})}constructor(a){super(a),this.propsFromContext=null}}let A=0;class ut extends i.Component{componentDidMount(){const{options:a,google:t,chartType:e,chartWrapperParams:r,toolbarItems:o,getChartEditor:s,getChartWrapper:c}=this.props,d={chartType:e,options:a,containerId:this.getGraphID(),...r},l=new t.visualization.ChartWrapper(d);l.setOptions(a||{}),c&&c(l,t);const h=new t.visualization.Dashboard(this.dashboard_ref),p=this.addControls(l,h);o&&t.visualization.drawToolbar(this.toolbar_ref.current,o);let C=null;s&&(C=new t.visualization.ChartEditor,s({chartEditor:C,chartWrapper:l,google:t})),this.setState({googleChartEditor:C,googleChartControls:p,googleChartDashboard:h,googleChartWrapper:l,isReady:!0})}componentDidUpdate(){if(!this.state.googleChartWrapper||!this.state.googleChartDashboard||!this.state.googleChartControls)return;const{controls:a}=this.props;if(a)for(let t=0;t<a.length;t+=1){const{controlType:e,options:r,controlWrapperParams:o}=a[t];o&&"state"in o&&this.state.googleChartControls[t].control.setState(o.state),this.state.googleChartControls[t].control.setOptions(r),this.state.googleChartControls[t].control.setControlType(e)}}shouldComponentUpdate(a,t){return this.state.isReady!==t.isReady||a.controls!==this.props.controls}render(){const{width:a,height:t,options:e,style:r}=this.props,o={height:t||e&&e.height,width:a||e&&e.width,...r};return this.props.render?i.createElement("div",{ref:this.dashboard_ref,style:o},i.createElement("div",{ref:this.toolbar_ref,id:"toolbar"}),this.props.render({renderChart:this.renderChart,renderControl:this.renderControl,renderToolbar:this.renderToolBar})):i.createElement("div",{ref:this.dashboard_ref,style:o},this.renderControl(s=>{let{controlProp:c}=s;return c.controlPosition!=="bottom"}),this.renderChart(),this.renderControl(s=>{let{controlProp:c}=s;return c.controlPosition==="bottom"}),this.renderToolBar())}constructor(...a){var t;super(...a),t=this,this.state={googleChartWrapper:null,googleChartDashboard:null,googleChartControls:null,googleChartEditor:null,isReady:!1},this.graphID=null,this.dashboard_ref=i.createRef(),this.toolbar_ref=i.createRef(),this.getGraphID=()=>{const{graphID:e,graph_id:r}=this.props;let o;return!e&&!r?this.graphID?o=this.graphID:o=rt():e&&!r?o=e:r&&!e?o=r:o=e,this.graphID=o,this.graphID},this.getControlID=(e,r)=>{A+=1;let o;return typeof e>"u"?o="googlechart-control-".concat(r,"-").concat(A):o=e,o},this.addControls=(e,r)=>{const{google:o,controls:s}=this.props,c=s?s.map((l,h)=>{const{controlID:p,controlType:C,options:f,controlWrapperParams:v}=l,m=this.getControlID(p,h);return{controlProp:l,control:new o.visualization.ControlWrapper({containerId:m,controlType:C,options:f,...v})}}):null;if(!c)return null;r.bind(c.map(l=>{let{control:h}=l;return h}),e);for(let l of c){const{control:h,controlProp:p}=l,{controlEvents:C=[]}=p;for(let f of C){var d=this;const{callback:v,eventName:m}=f;o.visualization.events.removeListener(h,m,v),o.visualization.events.addListener(h,m,function(){for(var u=arguments.length,w=new Array(u),y=0;y<u;y++)w[y]=arguments[y];v({chartWrapper:e,controlWrapper:h,props:d.props,google:o,eventArgs:w})})}}return c},this.renderChart=()=>{const{width:e,height:r,options:o,style:s,className:c,rootProps:d,google:l}=this.props,h={height:r||o&&o.height,width:e||o&&o.width,...s};return i.createElement("div",Object.assign({id:this.getGraphID(),style:h,className:c},d),this.state.isReady&&this.state.googleChartWrapper!==null?i.createElement(i.Fragment,null,i.createElement(dt,{googleChartWrapper:this.state.googleChartWrapper,google:l,googleChartDashboard:this.state.googleChartDashboard}),i.createElement(pt,{googleChartWrapper:this.state.googleChartWrapper,google:l})):null)},this.renderControl=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:r=>!0;return t.state.isReady&&t.state.googleChartControls!==null?i.createElement(i.Fragment,null,t.state.googleChartControls.filter(r=>{let{controlProp:o,control:s}=r;return e({control:s,controlProp:o})}).map(r=>{let{control:o,controlProp:s}=r;return i.createElement("div",{key:o.getContainerId(),id:o.getContainerId()})})):null},this.renderToolBar=()=>this.props.toolbarItems?i.createElement("div",{ref:this.toolbar_ref}):null}}class R extends i.Component{render(){const{chartLanguage:a,chartPackages:t,chartVersion:e,mapsApiKey:r,loader:o,errorElement:s}=this.props;return i.createElement(lt,{value:this.props},this.state.loadingStatus==="ready"&&this.state.google!==null?i.createElement(ut,Object.assign({},this.props,{google:this.state.google})):this.state.loadingStatus==="errored"&&s?s:o,i.createElement(ot,{chartLanguage:a,chartPackages:t,chartVersion:e,mapsApiKey:r,onLoad:this.onLoad,onError:this.onError}))}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}isFullyLoaded(a){const{controls:t,toolbarItems:e,getChartEditor:r}=this.props;return a&&a.visualization&&a.visualization.ChartWrapper&&a.visualization.Dashboard&&(!t||a.visualization.ChartWrapper)&&(!r||a.visualization.ChartEditor)&&(!e||a.visualization.drawToolbar)}constructor(...a){super(...a),this._isMounted=!1,this.state={loadingStatus:"loading",google:null},this.onLoad=t=>{if(this.props.onLoad&&this.props.onLoad(t),this.isFullyLoaded(t))this.onSuccess(t);else{const e=setInterval(()=>{const r=window.google;this._isMounted?r&&this.isFullyLoaded(r)&&(clearInterval(e),this.onSuccess(r)):clearInterval(e)},1e3)}},this.onSuccess=t=>{this.setState({loadingStatus:"ready",google:t})},this.onError=()=>{this.setState({loadingStatus:"errored"})}}}R.defaultProps=W;var F;(function(n){n.annotation="annotation",n.annotationText="annotationText",n.certainty="certainty",n.emphasis="emphasis",n.interval="interval",n.scope="scope",n.style="style",n.tooltip="tooltip",n.domain="domain"})(F||(F={}));const gt=i.forwardRef((n,a)=>{const t=_(n.appId),[e,r]=i.useState();return i.useEffect(()=>{e==null||e.draw()},[n.chartWidth]),i.useImperativeHandle(a,()=>({getChartImageURI(){var o;try{return((o=e==null?void 0:e.getChart())==null?void 0:o.getImageURI())??""}catch(s){return L.error(s),""}}})),g.jsx(D,{className:"pp-chart-google-container",sx:{...((t==null?void 0:t.chartType)??"")==="Table"&&{marginRight:"50px"}},children:g.jsx(R,{chartType:(t==null?void 0:t.chartType)??"BarChart",data:t==null?void 0:t.data,options:t==null?void 0:t.options,width:"100%",height:((t==null?void 0:t.height)??400)+"px",style:{overflow:"hidden"},getChartWrapper:o=>{r(o)}})})}),mt=({appId:n,title:a,isBuilderEnabled:t,isExploring:e,fullScreen:r,setFullScreen:o})=>{const s=$(),c=N(),d=V(n);H(n);const l=()=>null,h="pp-remove-body-vertical-scrollbar";return g.jsx(Q,{className:"pp-chart-toolbar",position:"static",elevation:4,sx:{borderRadius:"4px",marginBottom:"5px"},children:g.jsxs(K,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center",position:"relative"},children:[g.jsx(D,{sx:{whiteSpace:"nowrap",fontSize:"18px",lineHeight:"18px",fontWeight:"bold",minWidth:0,textOverflow:"ellipsis",marginRight:"10px"},children:a}),g.jsxs(D,{sx:{display:"flex",gap:"10px",justifyContent:"center",alignItems:"center"},children:[t&&g.jsx(I,{title:"Chart Builder",children:g.jsx(T,{sx:{color:"inherit"},onClick:()=>{s(B({appId:n}))},children:g.jsx(Y,{})})}),l(),e&&g.jsx(I,{title:d.close,children:g.jsx(T,{sx:{color:"inherit",padding:0},onClick:()=>{var p;(p=window.document.getElementById(h))==null||p.remove(),window.document.body.classList.remove("pp-fullscreen"),s(k({isActive:!1,appDbId:0})),s(U({appId:n})),c(n),s(q({}))},children:g.jsx(Z,{})})})]})]})})},Ct=n=>{const a=J(t=>t.ui.chartSettings.isOpen&&t.ui.chartSettings.appId===n);return L.debug("chartSettingsVisible",a),a};i.lazy(()=>x(()=>import("./ChartPrintIcon-1.0.23-31d00792.js"),["./ChartPrintIcon-1.0.23-31d00792.js","./main-1.0.23.js","./index.esm-1.0.23-ba0465a2.js","./Typography-1.0.23-19a0fd3e.js","./iconBase-1.0.23-43ac6f06.js","./useChartType-1.0.23-a57d25eb.js","./RestApi-1.0.23-cc179eb9.js"],import.meta.url));i.lazy(()=>x(()=>import("./ChartSelection-1.0.23-dba91940.js"),["./ChartSelection-1.0.23-dba91940.js","./main-1.0.23.js","./ChartTypeSelection-1.0.23-1c3ed074.js","./ChartTypes-1.0.23-6413b499.js","./index.esm-1.0.23-da98f1a9.js","./iconBase-1.0.23-43ac6f06.js","./Typography-1.0.23-19a0fd3e.js","./FormHelperText-1.0.23-83597bdf.js","./useFormControl-1.0.23-a0ae6ce7.js","./TextField-1.0.23-1657e9d4.js","./index.esm-1.0.23-ba0465a2.js","./FormLabel-1.0.23-71a056b2.js","./Menu-1.0.23-e889464a.js","./ThemeProvider-1.0.23-f3e5cbc1.js","./Popover-1.0.23-6c9c65a6.js","./Modal-1.0.23-3fe42627.js","./Grow-1.0.23-40b2ff68.js","./useControlled-1.0.23-1e71c28b.js","./createSvgIcon-1.0.23-f9410a01.js","./MenuItem-1.0.23-0a5da249.js","./ListItemIcon-1.0.23-db4c6871.js","./RestApi-1.0.23-cc179eb9.js","./FormControlLabel-1.0.23-1ad68af6.js","./createStyled-1.0.23-528f26c2.js","./Switch-1.0.23-86b06b05.js","./SwitchBase-1.0.23-adccc77c.js","./index-1.0.23-9af490ae.js","./DefaultChartColors-1.0.23-9262ec62.js","./index-1.0.23-fea3ac27.js","./ToggleButtonGroup-1.0.23-fd9018f0.js","./colorManipulator-1.0.23-e382be1d.js","./RadioGroup-1.0.23-053476ee.js","./Radio-1.0.23-7006053b.js","./Slider-1.0.23-75ca4c04.js","./Spinner-1.0.23-90ab83ff.js","./Divider-1.0.23-d1a6ffad.js","./InputAdornment-1.0.23-4e3a41ab.js","./useTheme-1.0.23-55aea9bb.js","./useStoreTable-1.0.23-508477d7.js","./CardContent-1.0.23-cd3f2c87.js","./CardHeader-1.0.23-edc42c3d.js","./TabPanel-1.0.23-ecd53346.js","./Tabs-1.0.23-d047285a.js"],import.meta.url));i.lazy(()=>x(()=>import("./ChartPrint-1.0.23-7bff6230.js"),["./ChartPrint-1.0.23-7bff6230.js","./main-1.0.23.js","./SanitizeComponent-1.0.23-8b51bdfd.js","./purify.es-1.0.23-68816782.js","./index.esm-1.0.23-ba0465a2.js","./Typography-1.0.23-19a0fd3e.js","./iconBase-1.0.23-43ac6f06.js","./useChartType-1.0.23-a57d25eb.js","./RestApi-1.0.23-cc179eb9.js","./Modal-1.0.23-3fe42627.js","./Spinner-1.0.23-90ab83ff.js","./Slider-1.0.23-75ca4c04.js","./ThemeProvider-1.0.23-f3e5cbc1.js","./index-1.0.23-9af490ae.js","./useControlled-1.0.23-1e71c28b.js"],import.meta.url));const xt=({appId:n,isBuilderEnabled:a,isToolbarEnabled:t,chartWidth:e,isTableChart:r,isExploring:o})=>{var p,C;const s=G(n);_(n),Ct(n);const[c,d]=i.useState(!1);i.useState(!1),i.useState(!1);const l=i.useRef(),h="pp-remove-body-vertical-scrollbar";return i.useEffect(()=>{if(s.appRootId===void 0)return()=>{var f;(f=window.document.getElementById(h))==null||f.remove(),window.document.body.classList.remove("pp-fullscreen")}},[c]),g.jsxs(D,{sx:{...c&&{display:"grid",gridTemplateRows:"auto 1fr",position:"fixed",top:0,left:0,inset:0,margin:0,padding:0,height:"100vh",width:"100vw",overflow:"hidden",zIndex:9999999,"& header.pp-chart-toolbar":{borderRadius:0,margin:0}}},children:[t&&s.appRootId===void 0&&g.jsx(mt,{appId:n,title:((C=(p=s==null?void 0:s.app)==null?void 0:p.app[0])==null?void 0:C.app_title)??"Chart",isBuilderEnabled:a,isExploring:o??!1,fullScreen:c,setFullScreen:d}),g.jsxs(X,{id:"pp-chart-"+n,className:"pp-chart-paper",elevation:4,sx:{position:"relative",width:e?(e??360)+"px":"100%",backgroundColor:"white",borderRadius:"4px","& div, & svg":{borderRadius:"4px"},"& div.google-visualization-table":{width:"100%"},"& table.google-visualization-table-table":{width:"100%"}},children:[!1,g.jsx(gt,{appId:n,chartWidth:e,ref:l})]}),!1]})};export{xt as C,Ct as u};
