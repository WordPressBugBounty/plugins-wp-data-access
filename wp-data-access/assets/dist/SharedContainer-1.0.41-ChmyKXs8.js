const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./TableContainer-1.0.41-BCfBk3XE.js","./cm-1.0.41-DxZ4itL_.js","./redux-1.0.41-DJjpZqD1.js","./vendor-1.0.41-CN03Eozo.js","./AdminTheme-1.0.41-4tiUoVeb.js","./lib-1.0.41-DFdWuh_n.js","./loglevel-1.0.41-BZ7XahX3.js","./lodash-1.0.41-Cd8grAqB.js","./moment-1.0.41-C5S46NFB.js","./Typography-1.0.41-BIN1Ddvh.js","./main-1.0.41.js","./notistack-1.0.41-Bq-EKqc7.js","./tanstack-1.0.41-m5KXsrwn.js","./FallbackSpinner-1.0.41-2QUzxGrn.js","./Spinner-1.0.41-fWZy8imI.js","./hooks-1.0.41-sDnKeMy7.js","./ActionsSettings-1.0.41-3gFM2W6T.js","./RestApi-1.0.41-CZ_yORv3.js","./TargetEnum-1.0.41-CIW1jlU5.js","./Tooltip-1.0.41-BQBkdKQ5.js","./Tooltip-1.0.41--D4jr2go.css","./ScopeEnum-1.0.41-B4DDvIDj.js","./index-1.0.41-DGYaemnA.js","./iconBase-1.0.41-BNQFQdHp.js","./useEnhancedEffect-1.0.41-BVsyj6AW.js","./index-1.0.41-CpXj521P.js","./BuilderMenu-1.0.41-CI6mFW4W.js","./ConfirmDialog-1.0.41-NKESMhfW.js","./Menu-1.0.41-DBfdBNVU.js","./ThemeProvider-1.0.41-D1lNQgXT.js","./MenuItem-1.0.41-DCc8qvzQ.js","./useTableUpdater-1.0.41-B3-EY98i.js","./DynamicModeEnum-1.0.41-BXuL5kgA.js","./useFormDetails-1.0.41-B5EIEVl2.js","./useRemoveAppFromStore-1.0.41-CfqgzE5H.js","./lang-1.0.41-Bm0VdcRH.js","./CardContent-1.0.41-Cwtu331C.js","./TabPanel-1.0.41-BJuUpIHA.js","./useThemeProps-1.0.41-BJkkrkB6.js","./getThemeProps-1.0.41-BXG_2HDV.js","./settings-1.0.41-Bx2jvYL6.css","./Row-1.0.41-DWhffjUX.js","./useTableSettings-1.0.41-Bn9BidSd.js","./useChartSettings-1.0.41-B9jmOMx5.js","./useStoreTable-1.0.41-B5fmNNPS.js","./ActionsDml-1.0.41--r5h77NM.js","./useMetadata-1.0.41-DKmF8A3i.js","./useStoreFormSettings-1.0.41-6QwIhzSX.js","./AppTheme-1.0.41-BMrYDtWL.js","./index-1.0.41-zQwWCc96.js","./useScreenSize-1.0.41-B3FN-Ith.js","./dompurify-1.0.41-DhD2mIk-.js","./dayjs.min-1.0.41-CD-l-E21.js","./AlertDialog-1.0.41-BPsbbiwH.js","./SanitizeComponent-1.0.41-B18z6eJi.js","./Tooltip-1.0.41-g4uuOuci.js","./useControlled-1.0.41-BEhJe3xs.js","./Popper-1.0.41-Dl4_0sfD.js","./Alert-1.0.41-DzeUA8Nx.js","./AlertTitle-1.0.41-DjDM8Ttb.js","./createSvgIcon-1.0.41-0lRWzB2Q.js","./Close-1.0.41-Dkp5SdDZ.js","./Settings-1.0.41-qjMc4iHO.js","./TableMapDock-1.0.41-BApq_G52.js","./MapPrepare-1.0.41-DTWLc2Gj.js","./TableChartDock-1.0.41-CpgSqYSa.js","./Chart-1.0.41-ezidIvc3.js"])))=>i.map(i=>d[i]);
import{_ as ne,R as tn}from"./main-1.0.41.js";import{j as t}from"./cm-1.0.41-DxZ4itL_.js";import{r as l,R as nn}from"./redux-1.0.41-DJjpZqD1.js";import{l as i,ba as Ot,b8 as Pt,b9 as on,bb as U,P as sn,v as rn,bc as ln,bd as Ve,S as oe,be as ze,G as an,bf as bt,bg as _t,bh as Le,bi as un,bj as $e,_ as Xe,bk as Ae,bl as cn,A as Je,bm as Be,X as Nt,b as dn,bn as qe,bo as jt,g as mn,Y as fn,d as gn,ag as xn,$ as hn,bp as pn,bq as bn,br as _n,bs as jn}from"./lib-1.0.41-DFdWuh_n.js";import{u as K,a as Te}from"./hooks-1.0.41-sDnKeMy7.js";import{B as k,S as Ze}from"./Spinner-1.0.41-fWZy8imI.js";import{a as Sn}from"./AdminTheme-1.0.41-4tiUoVeb.js";import{u as Ke}from"./useStoreTable-1.0.41-B5fmNNPS.js";import{s as wn,u as St,i as wt}from"./ActionsDml-1.0.41--r5h77NM.js";import{e as L}from"./notistack-1.0.41-Bq-EKqc7.js";import{u as Qe}from"./useMetadata-1.0.41-DKmF8A3i.js";import"./moment-1.0.41-C5S46NFB.js";import{u as Vt,a as Tn}from"./useChartSettings-1.0.41-B9jmOMx5.js";import{a6 as yn,p as En,A as Lt,T as At,a7 as Tt,m as yt,f as Bt,M as Ut,G as Rn}from"./index-1.0.41-CpXj521P.js";import{u as Ie}from"./useStoreFormSettings-1.0.41-6QwIhzSX.js";import{u as Dt,C as Cn,B as vn}from"./useFormDetails-1.0.41-B5EIEVl2.js";import{a as et,u as Fn}from"./useRemoveAppFromStore-1.0.41-CfqgzE5H.js";import{a as Mn,A as kn,u as On}from"./AppTheme-1.0.41-BMrYDtWL.js";import{u as Ht}from"./useScreenSize-1.0.41-B3FN-Ith.js";import{e as Pn,B as se,C as Nn}from"./ConfirmDialog-1.0.41-NKESMhfW.js";import"./dompurify-1.0.41-DhD2mIk-.js";import{I as re,P as Et}from"./iconBase-1.0.41-BNQFQdHp.js";import{d as Ue}from"./dayjs.min-1.0.41-CD-l-E21.js";import{T as Wt}from"./ThemeProvider-1.0.41-D1lNQgXT.js";import{D as te}from"./DynamicModeEnum-1.0.41-BXuL5kgA.js";import{F as Ge}from"./FallbackSpinner-1.0.41-2QUzxGrn.js";import{A as Vn}from"./AlertDialog-1.0.41-BPsbbiwH.js";import{S as Rt}from"./SanitizeComponent-1.0.41-B18z6eJi.js";import{T as Ct}from"./Tooltip-1.0.41-g4uuOuci.js";const De=e=>{const s=K(r=>{var u,x;return(x=(u=r.forms[e])==null?void 0:u.state)==null?void 0:x.data});return i.debug("data",s,e),s};var He=(e=>(e[e.SELECT=0]="SELECT",e[e.INSERT=1]="INSERT",e[e.UPDATE=2]="UPDATE",e[e.DELETE=3]="DELETE",e[e.EXPORT=4]="EXPORT",e[e.IMPORT=5]="IMPORT",e[e.VIEW=6]="VIEW",e))(He||{});l.lazy(()=>ne(()=>import("./TableContainer-1.0.41-BCfBk3XE.js").then(e=>e.T),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40]),import.meta.url));l.lazy(()=>ne(()=>import("./TableContainer-1.0.41-BCfBk3XE.js").then(e=>e.T),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40]),import.meta.url));const Yt=e=>4,Ln=e=>{const s=K(r=>{var u;return((u=r.forms[e])==null?void 0:u.columns)??[]});return i.debug("storeColumns",s),s},vt=e=>{const s=K(r=>r.forms[e]!==void 0?r.forms[e].columns.filter(u=>u.more).length>0:!1);return i.debug("hasMoreColumns",s),s},An=e=>{const s=K(r=>{var u,x;return((x=(u=r.forms[e])==null?void 0:u.state)==null?void 0:x.more)??!1});return i.debug("moreState",s),s},Bn=e=>{const s=K(r=>{var u,x;return(x=(u=r.forms[e])==null?void 0:u.state)==null?void 0:x.initialData});return i.debug("initialData",s),s},zt=e=>({}),$t=e=>(De(e),r=>{}),Un=e=>(Te(),(r,u)=>{}),Dn=(e,s)=>(Te(),(u,x)=>{}),Hn=l.lazy(()=>ne(()=>import("./Row-1.0.41-DWhffjUX.js"),__vite__mapDeps([41,10,1,2,3,11,5,6,7,8,15,42,43,34,35,14,9,4,44,45,17,46,25,23,24,47,33,32,48,49,39,50,27,51,52,29,13,53,54,55,56,57]),import.meta.url)),Wn=({appId:e,metaData:s,primaryKey:r,formMode:u,formUuid:x})=>{var y;i.debug(e,s,r,u,x);const T=Ie(),N=et(e),S=De(e),w=Bn(e),v=zt(),Q=$t(e),D=Un(),O=Dn();l.useEffect(()=>{var V;Ot(s)&&((V=v==null?void 0:v.onRowInit)==null?void 0:V.enabled)==!0&&Pt(v.onRowInit.code??"",on(s),!1,{mode:u,getColumnValue:Q,setColumnValue:D,setColumnStyle:O})},[]);const[g,h]=l.useState("30px");return l.useEffect(()=>{},[T.spacing]),t.jsx("form",{id:x,className:"pp-form-content",onSubmit:V=>(V.preventDefault(),!1),children:t.jsx(k,{className:"pp-form-grid",sx:{display:"grid",gridTemplateColumns:{lg:`repeat(${T.cellsPerRow}, 1fr)`,md:"repeat("+Math.min(T.cellsPerRow,2)+", 1fr)",xs:"1fr"},gap:g,marginBottom:0,background:T.showGrid?((y=Mn)==null?void 0:y.palette.mode)===sn.LIGHT?"repeating-linear-gradient( -45deg, transparent, transparent 10px, #eee 10px, #eee 20px )":"repeating-linear-gradient( -45deg, transparent, transparent 10px, #111 10px, #111 20px )":"","& p.MuiFormHelperText-root":{...u===U.VIEW&&!0&&{display:"none"}}},children:t.jsx(l.Suspense,{fallback:t.jsx(Ze,{}),children:t.jsx(Hn,{appId:e,metaData:s,data:S,initialData:w,primaryKey:r,formMode:u,formSettings:T,language:N.language})})})})},Yn=e=>{const s=K(r=>{var u,x;return((x=(u=r.forms[e])==null?void 0:u.state)==null?void 0:x.m2mUpdate)??!1});return i.debug("m2mUpdate",s),s},zn=nn.memo(({code:e,safeMode:s,isExpression:r,args:u})=>{const x=Pt(e,s,r,u);return window.jQuery&&x instanceof window.jQuery&&x.html(),null}),$n=e=>{const s=K(r=>r.forms[e]);return i.debug("formStore",s),s},Gn=({appId:e,setPrimaryKey:s,tableInstance:r,tableRowIndex:u})=>{i.debug(u);const x=$n(e),[T,N]=l.useState(u),[S,w]=l.useState(0);return l.useEffect(()=>{if(r)if(S===-1){const v=r.getState().pagination.pageSize-1;r!=null&&r.getRowModel().rows[v]&&(N(v),s(v),w(0))}else S===1&&r!=null&&r.getRowModel().rows[0]&&(N(0),s(0),w(0))},[r==null?void 0:r.getState().pagination.pageIndex,r==null?void 0:r.getRowModel().rows]),!x.form.addNavigationButtons||r===void 0||T===void 0?null:t.jsxs(k,{children:[t.jsx(re,{color:"primary",disabled:T===0&&!r.getCanPreviousPage()||S!==0,onClick:()=>{T>0?(N(T-1),s(T-1)):(w(-1),r.previousPage())},children:t.jsx(yn,{})}),t.jsx(re,{color:"primary",disabled:T+1===r.getRowCount()%r.getState().pagination.pageSize&&!r.getCanNextPage()||S!==0,onClick:()=>{(T+1)%r.getState().pagination.pageSize>0?(N(T+1),s(T+1)):(w(1),r.nextPage())},children:t.jsx(En,{})})]})},Ft=l.lazy(()=>ne(()=>import("./Alert-1.0.41-DzeUA8Nx.js"),__vite__mapDeps([58,1,2,3,22,23,9,5,6,7,8,24,59,60,61]),import.meta.url)),Mt=({appId:e,primaryKey:s,formMode:r,showTable:u,showForm:x,detailKey:T,children:N,relationAppId:S,relTab:w,joinTab:v,isEmbedded:Q,masterAppId:D,isModal:O,tableInstance:g,tableRowIndex:h})=>{var it,lt,at,ut,ct,dt;i.debug(e,s,r,T,S,w,v,Q,D,O);const y=Te(),V=l.useRef(null),ie=Ln(e),j=Vt(e),le=Yt(),H=Ke(e),I=et(e),G=zt();$t(e);const[A,ae]=l.useState(s),[X,ue]=l.useState(r),J=l.useMemo(()=>rn(),[]),[ce,de]=l.useState(!1),[he,We]=l.useState(""),o=Qe(e),me=De(e),F=ln((it=o==null?void 0:o.app)==null?void 0:it.container[0]),pe=Yn(e),W=Qe(D??""),fe=De(D??""),ye=Dt(e),[be,_e]=l.useState(null);l.useEffect(()=>{i.debug(pe,e),pe===!0&&(i.debug("setM2MUpdate: false"),ee(!1,()=>{},()=>{},()=>{y(bt({appId:e,update:!1}))}))},[pe]);const Ye=n=>{var d;const a=(d=g==null?void 0:g.getRowModel().rows[n])==null?void 0:d.original;if(i.debug("setPrimaryKey",a,n),a){const p={...s};Object.keys(s).map(c=>{p[c]=a[c]}),i.debug("newPrimaryKey",p),Ee(p),ae(p)}};l.useEffect(()=>{s===null?Re():Object.keys(s).length>0?Ee(s):de(!0)},[s]);const Ee=n=>{wn(e,n,o==null?void 0:o.media,a=>{if(i.debug(a),(a==null?void 0:a.code)==="ok"){if(Array.isArray(a.data)&&a.data.length>0){const d={...a.data[0]},p={...a.context};delete p.debug,y(ze({appId:e,data:d,context:p})),a.data.length>1?_e("Query returned more than one row. Check configuration."):_e(null)}else{const d={...a.context};delete d.debug,y(ze({appId:e,data:{},context:d})),_e("Invalid primary key. Check configuration.")}de(!0)}else L(j.invalidResponse,{variant:"error"})},a=>{i.error("error",a),We(a??j.invalidResponse)},!1,w)},Re=()=>{var n,a;if(o.columns&&Array.isArray(o.columns)){const d={},p=Ve.getSelectors().selectFormColumns(oe.getState().forms,e),c=Object.fromEntries(p.map(b=>[b.columnName,b.defaultValue]));i.debug("defaultValues",c);for(let b=0;b<o.columns.length;b++)d[o.columns[b].column_name]=null,c[o.columns[b].column_name]!==void 0&&(c[o.columns[b].column_name]==="@wpda_wp_user_id"?d[o.columns[b].column_name]=(a=(n=o==null?void 0:o.settings)==null?void 0:n.env)==null?void 0:a.id:c[o.columns[b].column_name]==="@now"?o.columns[b]==="date"?d[o.columns[b].column_name]=Ue(Date.now()).format("YYYY-MM-DD"):d[o.columns[b].column_name]=Ue(Date.now()).format("YYYY-MM-DD HH:mm:ss"):o.columns[b].column_default!==null&&o.columns[b].column_default!=="NULL"&&o.columns[b].column_default!==""?o.columns[b].column_default==="CURRENT_TIMESTAMP"?o.columns[b]==="date"?d[o.columns[b].column_name]=Ue(Date.now()).format("YYYY-MM-DD"):d[o.columns[b].column_name]=Ue(Date.now()).format("YYYY-MM-DD HH:mm:ss"):d[o.columns[b].column_name]=o.columns[b].column_default:d[o.columns[b].column_name]=c[o.columns[b].column_name]);i.debug(d),y(ze({appId:e,data:d,context:{media:{}}})),i.debug("init"),de(!0)}},je=()=>{let n="";for(const a in o.columns)o.columns[a].extra==="auto_increment"&&(n=o.columns[a].column_name);return i.debug(n),n},Se=n=>{var b;const a=(b=Ve.getSelectors().selectFormState(oe.getState().forms,e))==null?void 0:b.validation;i.debug("rowValidation",a);let d=!1;for(const m in a)if(a[m].error===!0&&a[m].type===Le.COLUMN){d=!0;break}if(d)return i.debug("validateForm returned errors"),!1;let p=!0;const c=je();for(const m in n){const f=un(o,m);let R=!0;f.column_name!==c&&f.is_nullable==="NO"&&(n[m]===null||n[m]==="")&&(r===U.UPDATE||r===U.INSERT&&(f.column_default===null||f.column_default==="NULL"||f.column_default==="")||M.preserveSpacesOnUpdate===!1&&n[m]==="")&&(y($e({appId:e,columnName:m,columnError:!0,columnText:j.mandatoryField,columnType:Le.FORM})),R=!1,p=!1);const C=Ve.getSelectors().selectFormColumns(oe.getState().forms,e);let z;for(let E=0;E<C.length;E++)C[E].columnName===m&&(z=C[E]);if(i.debug(z),R&&f.data_type==="time"){const E=n[m];if(E.length===6){let $=E.substring(2,3),B=E.substring(4,5);(Number($)>5||Number(B)>5)&&(y($e({appId:e,columnName:m,columnError:!0,columnText:j.mandatoryField,columnType:Le.FORM})),R=!1,p=!1)}}R&&y($e({appId:e,columnName:m,columnError:!1,columnText:"",columnType:Le.FORM}))}return p},Ce=()=>{},we=n=>{},ee=(n,a,d,p)=>{var b;const c=(b=Ve.getSelectors().selectFormState(oe.getState().forms,e))==null?void 0:b.data;if(i.debug(c),Ce()!==!1)if(Se(c)){if(A!==null){const m={};Object.keys(c).map(f=>{ie.map(R=>{f===R.columnName&&R.updatable&&(m[f]=c[f])})}),i.debug(m),St(e,A,m,f=>{var R;if(i.debug(f),f!=null&&f.code&&(f!=null&&f.message)){switch(f.code){case"ok":L(j.updatedSuccessful,{variant:"success"}),((R=f.context)==null?void 0:R.updated)!==void 0&&Object.keys(f.context.updated).map(C=>{y(jt({appId:e,columnName:C,columnValue:f.context.updated[C]}))}),n&&(a!==void 0&&a(A),setTimeout(()=>{u(!0,S)},1e3)),p&&p();break;case"info":L(j.nothingToUpdate,{variant:"info"}),n&&(a!==void 0&&a(A),setTimeout(()=>{u(!0,S)},1e3)),p&&p();break;default:i.error(f),L(f.message??j.invalidResponse,{variant:"error"}),n&&u(!0,S)}we(f==null?void 0:f.code)}else i.error(f),L(j.invalidResponse,{variant:"error"})},f=>{i.error("error",f),L(f??j.invalidResponse,{variant:"error"})},!1,v,w)}else y(an({appId:e,property:{isRowCountUpdated:!0}})),wt(e,c,m=>{if(i.debug(m),m!=null&&m.code&&(m!=null&&m.message)){let f;const R={};switch(m.code){case"ok":L(j.insertSuccessful,{variant:"success"}),f=je();for(let C=0;C<o.primary_key.length;C++){const z=mn(o,o.primary_key[C]);let E;z!==void 0&&(E=o==null?void 0:o.columns[z]),f!==""&&f===(E==null?void 0:E.column_name)?R[o.primary_key[C]]=m.context.insert_id:R[o.primary_key[C]]=c[o.primary_key[C]]}if((F==null?void 0:F.cardinality)===Be.ONE_TO_ONE){const C={};W!=null&&W.primary_key&&Array.isArray(W==null?void 0:W.primary_key)&&(W==null||W.primary_key.map(E=>C[E]=fe[E]));const z={};if(F.join_condition!==void 0){const E=F.join_condition.split(",");for(let $=0;$<E.length;$++){const B=E[$].split("=");B.length===2&&(z[B[0]]=R[B[1]])}}St(e,C,z,()=>{Object.keys(fe).map(E=>{if(F.join_condition!==void 0){const $=F.join_condition.split(",");for(let B=0;B<$.length;B++){const xe=$[B].split("=");xe.length===2&&xe[0]===E&&D&&y(jt({appId:D,columnName:E,columnValue:me[xe[1]]}))}}})},()=>{})}if(n){a!==void 0&&a(R),u(!0,S);return}x(R,He.UPDATE),d&&d(),p&&p();break;default:i.error(m),L(m.message??j.invalidResponse,{variant:"error"})}we(m==null?void 0:m.code)}else i.error(m),L(j.invalidResponse,{variant:"error"})},m=>{i.error("error",m),L(m??j.invalidResponse,{variant:"error"})},!1,v,w);i.debug(S),S!==void 0&&(i.debug("setM2MUpdate: true"),y(bt({appId:S,update:!0})))}else i.error("Validation failed: ",c)},ve=()=>be===null?null:t.jsx(l.Suspense,{children:t.jsx(k,{sx:{marginTop:"30px"},children:t.jsx(Ft,{severity:"error",message:be,close:!1})})}),Fe=n=>{if(n!==null&&Se(me)){const a=qe.getSelectors().selectTableById(oe.getState().tables,e),d=a.state.relation.relation_join_condition.split(",").map(c=>c.split("=")),p={...a.state.detailKey};d.map(c=>{p[c[0]]=n[c[1]]}),wt(e,p,c=>{if(i.debug(c),c!=null&&c.code&&(c!=null&&c.message))switch(c.code){case"ok":i.debug("Added relation to join table",c);break;default:i.error(c),L(c.message??j.invalidResponse,{variant:"error"})}else i.error(c),L(j.invalidResponse,{variant:"error"})},c=>{i.error(c),L(c??j.invalidResponse,{variant:"error"})},!1,!0,!1)}},[Me,ke]=l.useState(void 0),Oe=()=>{try{ee(!1,()=>{},()=>{var a,d,p,c,b,m,f,R,C,z,E,$,B,xe,mt,ft,gt,xt,ht,pt;const n=JSON.parse((d=(a=o==null?void 0:o.app)==null?void 0:a.app[0])==null?void 0:d.app_settings);if(i.debug(n),((c=(p=n==null?void 0:n.settings)==null?void 0:p.app_registration)==null?void 0:c.showMessage)===!0&&((m=(b=n==null?void 0:n.settings)==null?void 0:b.app_registration)==null?void 0:m.message)!==void 0&&((R=(f=n==null?void 0:n.settings)==null?void 0:f.app_registration)==null?void 0:R.message)!==null&&((z=(C=n==null?void 0:n.settings)==null?void 0:C.app_registration)==null?void 0:z.message.trim())!==""&&ke(($=(E=n==null?void 0:n.settings)==null?void 0:E.app_registration)==null?void 0:$.message),((xe=(B=n==null?void 0:n.settings)==null?void 0:B.app_registration)==null?void 0:xe.allowUpdates)!==!0&&(ue(U.VIEW),((ft=(mt=n==null?void 0:n.settings)==null?void 0:mt.app_registration)==null?void 0:ft.showUrl)===!0&&((xt=(gt=n==null?void 0:n.settings)==null?void 0:gt.app_registration)==null?void 0:xt.url)!=="")){const en=((pt=(ht=n==null?void 0:n.settings)==null?void 0:ht.app_registration)==null?void 0:pt.urlTime)??3;setTimeout(()=>{window.location.href=n.settings.app_registration.url},en)}})}catch(n){i.error("Invalid JSON - app settings"),i.error(n),L(dn.contactSupport,{variant:"error"})}},Pe=()=>{ee(!1)},Ne=()=>{var a,d,p;const n=qe.getSelectors().selectTableById(oe.getState().tables,e);i.debug((a=n==null?void 0:n.state)==null?void 0:a.relation),((p=(d=n==null?void 0:n.state)==null?void 0:d.relation)==null?void 0:p.cardinality)===Be.MANY_TO_MANY?ee(!0,Fe):ee(!0)},_=()=>{u(!0,S)},M=Ie(),q=vt(e),Y=vt(S??""),P=An(e),Z=l.useRef(null),Gt=Ht(),[ge,Jt]=l.useState((lt=Z==null?void 0:Z.current)==null?void 0:lt.offsetWidth),[qt,Qt]=l.useState({paddingTop:"50px",paddingBottom:"50px",paddingLeft:"50px",paddingRight:"50px"}),[Xt,tt]=l.useState("30px"),[Zt,nt]=l.useState("");if(l.useEffect(()=>{if(Z.current!==null){Jt(Z.current.offsetWidth);let n=ge<600?.3:ge<900?.6:1;(O??!1)===!0&&(n=1),Qt({paddingTop:`calc(${n} * 50px)`,paddingBottom:`calc(${n} * 50px)`,paddingLeft:`calc(${n} * 50px)`,paddingRight:`calc(${n} * 50px)`}),ge<600?(tt("10px"),nt("10px")):ge<900&&(tt("20px"),nt("20px"))}},[Gt.width,Z.current,M.spacing]),he!=="")return t.jsx(l.Suspense,{children:t.jsx(Ft,{severity:"error",message:he,close:!1})});const ot=()=>t.jsx(Wn,{appId:e,metaData:o,primaryKey:A,formMode:X,formUuid:J}),Kt=()=>t.jsxs(t.Fragment,{children:[t.jsx(re,{color:"inherit",onClick:()=>{const n={appId:e};i.debug(F),F!=null&&(n.hideThemeSettings=!0),S!==void 0&&(n.isRelationForm=!0),y(Nt(n))},children:t.jsx(Bt,{})}),t.jsx(re,{color:"inherit",onClick:()=>{_()},children:t.jsx(Ut,{})})]}),It=l.useMemo(()=>{var n,a,d,p,c;return(n=o==null?void 0:o.src)!=null&&n.app_id&&((d=(a=o==null?void 0:o.app)==null?void 0:a.app[0])==null?void 0:d.app_title)!==""?o.app.app[0].app_title:(p=o==null?void 0:o.src)!=null&&p.dbs&&((c=o==null?void 0:o.src)!=null&&c.tbl)?o.src.dbs+" - "+o.src.tbl:"WP Data Access"},[]),st=(((ut=(at=H==null?void 0:H.table)==null?void 0:at.modal)==null?void 0:ut.maxHeight)??95)+(((dt=(ct=H==null?void 0:H.table)==null?void 0:ct.modal)==null?void 0:dt.maxHeightUnit)??"vh"),rt=()=>{var n,a,d;return t.jsxs(Et,{elevation:le,ref:V,children:[(O??!1)===!0&&t.jsx(Lt,{sx:{position:"unset",borderBottomRightRadius:0,borderBottomLeftRadius:0,boxShadow:"none"},children:t.jsxs(At,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(k,{sx:{display:"flex",alignItems:"center",cursor:"move",gap:"2px","& svg":{width:"2em",height:"2em"}},id:_t(o,"title"),children:t.jsx(k,{sx:{display:"block",whiteSpace:"nowrap",fontSize:"18px",lineHeight:"18px",fontWeight:"bold",textOverflow:"ellipsis",overflow:"hidden",marginRight:"10px"},children:It})}),t.jsx(k,{children:(O??!1)===!0&&Xe(o)&&t.jsx(t.Fragment,{children:Kt()})})]})}),t.jsxs(k,{style:qt,sx:{...(O??!1)===!0&&ye!==void 0&&{maxHeight:`calc(${st} - 240px)`,overflow:"auto",backgroundColor:"transparent",border:"none",borderRadius:0}},children:[t.jsxs(k,{sx:{margin:0,padding:"5px 0",...(O??!1)===!0&&ye===void 0&&{maxHeight:`calc(${st} - 240px)`,overflow:"auto"}},children:[ot(),N,ve()]}),t.jsxs(k,{sx:{marginTop:{marginTop:Xt},paddingRight:{paddingRight:Zt},padding:0,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(k,{sx:{display:"flex",gap:"8px"},children:[s!=null&&Object.keys(s).length>0&&t.jsx(Gn,{appId:e,tableInstance:g,tableRowIndex:h,setPrimaryKey:Ye}),!1,(q||Y)&&t.jsx(t.Fragment,{children:ge<600?t.jsx(re,{color:"primary",onClick:()=>{y(Ae({appId:e,more:!P})),S!==void 0&&y(Ae({appId:S,more:!P}))},children:P?t.jsx(Tt,{}):t.jsx(yt,{})}):t.jsx(se,{variant:"outlined",startIcon:P?t.jsx(Tt,{}):t.jsx(yt,{}),onClick:()=>{y(Ae({appId:e,more:!P})),S!==void 0&&y(Ae({appId:S,more:!P}))},children:P?j.less:j.more})}),((n=G==null?void 0:G.customActionsBottom)==null?void 0:n.enabled)===!0&&Ot(o)&&t.jsx(t.Fragment,{children:t.jsx(zn,{code:G.customActionsBottom.code??"",safeMode:I.safeMode,isExpression:!1,args:{row:me,mode:cn[r]}})}),t.jsx(k,{className:"pp-registration-form-message",children:Me})]}),t.jsx(k,{sx:{...ge<600&&{marginLeft:"0 !important","& button":{marginLeft:"2px",padding:"6px"}}},children:r!==U.VIEW?t.jsx(t.Fragment,{children:((d=(a=o==null?void 0:o.app)==null?void 0:a.app[0])==null?void 0:d.app_type)==Je.REGISTRATION&&H.state.masterDetailConditions===void 0?t.jsx(t.Fragment,{children:(X===U.INSERT||X===U.UPDATE)&&t.jsx(se,{variant:"contained",onClick:Oe,type:"submit",form:J,sx:{marginLeft:"8px"},children:j.ok})}):t.jsxs(t.Fragment,{children:[t.jsx(se,{variant:"contained",onClick:Pe,type:"submit",form:J,disabled:be!==null,children:j.apply}),(F==null?void 0:F.cardinality)!==Be.ONE_TO_ONE&&t.jsxs(t.Fragment,{children:[t.jsx(se,{variant:"outlined",onClick:Ne,sx:{marginLeft:"8px"},children:j.ok}),t.jsx(se,{variant:"outlined",onClick:_,sx:{marginLeft:"8px"},children:j.cancel})]})]})}):t.jsx(t.Fragment,{children:(F==null?void 0:F.cardinality)!==Be.ONE_TO_ONE&&t.jsx(se,{variant:"contained",onClick:_,children:j.back})})})]}),t.jsx(t.Fragment,{children:!1})]})]})};return Q?ot():(l.useEffect(()=>{var n;Z.current!==null&&((n=window.document.getElementById(`pp-app-${e}`))==null||n.scrollIntoView())},[Z.current]),t.jsx("div",{className:`${e}_wrapper pp-form`,ref:Z,style:{scrollMarginTop:"70px"},children:ce&&me!==null?t.jsx(t.Fragment,{children:(O??!1)===!0?t.jsx(t.Fragment,{children:t.jsx(Pn,{handle:"#"+_t(o,"title"),nodeRef:V,offsetParent:document.body,children:rt()})}):t.jsx(t.Fragment,{children:rt()})}):t.jsx(Et,{style:{padding:"50px"},elevation:le,children:t.jsx(Ze,{title:j.loadingData})})}))},Jn=l.lazy(()=>ne(()=>import("./Settings-1.0.41-qjMc4iHO.js"),__vite__mapDeps([62,10,1,2,3,11,5,6,7,8,15,4,9,16,17,18,21,19,20,22,23,24,25,26,14,27,28,29,30,46,32,36,37,38,39,44,45,43,34,35,47,33,48,49,50,51,52,13,53,54,55,56,57,40]),import.meta.url)),kt=({appId:e,primaryKey:s,formMode:r,showTable:u,showForm:x,metaData:T,detailKey:N,selectionForm:S,masterAppId:w,tableInstance:v,tableRowIndex:Q})=>{i.debug(e,s,r,T,N,S,w);const D=Sn(),g=Ke(e).table;i.debug("relationship",null);const y=l.useMemo(()=>{},[]);i.debug("relationAppId",y);const V=()=>null,ie=()=>null,j=()=>null,le=()=>{var I,G,A,ae,X,ue,J,ce;return t.jsx(Rn,{open:!0,className:"pp-form-modal",sx:{zIndex:9999990},children:t.jsx(k,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",minWidth:(((I=g==null?void 0:g.modal)==null?void 0:I.minWidth)??60)+(((G=g==null?void 0:g.modal)==null?void 0:G.minWidthUnit)??"vw"),maxWidth:(((A=g==null?void 0:g.modal)==null?void 0:A.maxWidth)??90)+(((ae=g==null?void 0:g.modal)==null?void 0:ae.maxWidthUnit)??"vw"),minHeight:(((X=g==null?void 0:g.modal)==null?void 0:X.minHeight)??0)+(((ue=g==null?void 0:g.modal)==null?void 0:ue.minHeightUnit)??"vh"),maxHeight:(((J=g==null?void 0:g.modal)==null?void 0:J.maxHeight)??95)+(((ce=g==null?void 0:g.modal)==null?void 0:ce.maxHeightUnit)??"vh"),backgroundColor:"transparent"},children:t.jsx(Mt,{appId:e,primaryKey:s,formMode:r,showTable:u,showForm:x,detailKey:N,relationAppId:y,masterAppId:w,isModal:!0,tableInstance:v,tableRowIndex:Q,children:ie()})})})},H=()=>t.jsx(Mt,{appId:e,primaryKey:s,formMode:r,showTable:u,showForm:x,detailKey:N,relationAppId:y,masterAppId:w,tableInstance:v,tableRowIndex:Q,children:ie()});return t.jsxs(t.Fragment,{children:[S===!0?t.jsx(t.Fragment,{children:V()}):t.jsx(t.Fragment,{children:g.formModal===!0?t.jsx(t.Fragment,{children:le()}):t.jsx(t.Fragment,{children:H()})}),t.jsx(t.Fragment,{children:Xe(T)&&t.jsx(Wt,{theme:D,children:t.jsx(l.Suspense,{fallback:t.jsx(Ze,{}),children:t.jsx(Jn,{appId:e})})})}),j()]})},qn=e=>{const s=K(r=>{var u,x;return((x=(u=r.tables[e])==null?void 0:u.state)==null?void 0:x.fullScreen)??!1});return i.debug("fullScreen",s),s},Qn=()=>{const e=K(s=>s.ui);return i.debug("uiSetting",e),e},Xn=e=>(Te(),{builtinLog:e,builtinShowAlert:(x,T)=>{},builtinShowConfirm:(x,T,N)=>{},builtinShowSnackbar:(x,T)=>{}}),Zn=({label:e})=>t.jsx(se,{variant:"contained",color:"primary",children:e}),Kn=l.lazy(()=>ne(()=>import("./TableContainer-1.0.41-BCfBk3XE.js").then(e=>e.T),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40]),import.meta.url));l.lazy(()=>ne(()=>import("./TableMapDock-1.0.41-BApq_G52.js"),__vite__mapDeps([63,1,2,3,64,10,11,5,6,7,8,46,15,13,14,9,23,24]),import.meta.url));l.lazy(()=>ne(()=>import("./TableChartDock-1.0.41-CpgSqYSa.js"),__vite__mapDeps([65,1,2,3,66,10,11,5,6,7,8,43,34,35,15,14,9,25,23,24,55,29,56,57,46]),import.meta.url));const In=({appId:e})=>{var Re,je,Se,Ce,we,ee,ve,Fe,Me,ke,Oe,Pe,Ne;i.debug(e);const s=Te(),r=Fn(),u=Cn(),x=Yt(),T=Dt(e);Tn(e);const S=Ke(e).table,w=Qn();Ht();const v=Ie(),Q=On(),D=kn(Q,S,v),O=Vt(e),g="pp-remove-body-vertical-scrollbar",h=Qe(e),y=l.useMemo(()=>{var _,M,q,Y,P;return(_=h==null?void 0:h.src)!=null&&_.app_id&&((q=(M=h==null?void 0:h.app)==null?void 0:M.app[0])==null?void 0:q.app_title)!==""?h.app.app[0].app_title:(Y=h==null?void 0:h.src)!=null&&Y.dbs&&((P=h==null?void 0:h.src)!=null&&P.tbl)?h.src.dbs+" - "+h.src.tbl:"WP Data Access"},[]),V=`_reactRoots_${e.replaceAll("-","_")}`;l.useEffect(()=>()=>{window[V]&&delete window[V]},[]);const{builtinLog:ie,builtinShowAlert:j,builtinShowConfirm:le,builtinShowSnackbar:H}=Xn(i);window.wpda={log:ie,alert:j,confirm:le,snackbar:H,button:(_,M)=>{window.document.querySelectorAll(`#${_}`).forEach(q=>{const Y=window[V]||new Map;window[V]=Y;let P=Y.get(q);P||(P=tn.createRoot(q),Y.set(q,P)),P.render(t.jsx(Wt,{theme:l.useMemo(()=>D,[]),children:t.jsx(Zn,{label:M})}))})}};const I=qn(e);l.useEffect(()=>(i.debug(I),()=>{var _;(_=window.document.getElementById(g))==null||_.remove(),window.document.body.classList.remove("pp-fullscreen")}),[I]);const G=l.useMemo(()=>qe.getSelectors().selectTableExploring(oe.getState().tables,e),[e]);i.debug("tableExploring",G);const[A,ae]=l.useState(((je=(Re=h==null?void 0:h.app)==null?void 0:Re.app[0])==null?void 0:je.app_type)==Je.REGISTRATION?te.FORM:te.TABLE),[X,ue]=l.useState(!1),J=_=>{s(_n({appId:e,mode:_})),ae(_)};l.useEffect(()=>{window.ppShowForm=function(_){i.debug(_),he(_),J(te.FORM)}},[e]);const ce=(_,M)=>{i.debug(_,M),jn(e)&&(u(e),M!==void 0&&(r(M),u(M))),_&&ue(!X),J(te.TABLE)},[de,he]=l.useState(null),[We,o]=l.useState(U.VIEW),[me,F]=l.useState(void 0),[pe,W]=l.useState(void 0),fe=(_,M,q,Y)=>{switch(i.debug(_,M,Y),M){case He.INSERT:o(U.INSERT);break;case He.UPDATE:o(U.UPDATE);break;default:o(U.VIEW)}he(_),F(q),W(Y),J(te.FORM)};let ye={};et(e);const[be]=l.useState(((we=window.PP_APP_CONFIG[(Ce=(Se=h==null?void 0:h.app)==null?void 0:Se.app[0])==null?void 0:Ce.app_id])==null?void 0:we.hideTitleBar)===!0),_e=()=>null,Ye=()=>t.jsx(l.Suspense,{fallback:t.jsx(Ge,{title:O.loadingForm}),children:t.jsx(kt,{appId:e,primaryKey:de,formMode:U.INSERT,showTable:()=>{},showForm:fe,metaData:h})}),Ee=()=>{var _,M;return((M=(_=h==null?void 0:h.app)==null?void 0:_.app[0])==null?void 0:M.app_type)==Je.REGISTRATION?Ye():t.jsxs(t.Fragment,{children:[t.jsxs(l.Suspense,{fallback:t.jsx(Ge,{title:O.loadingTable}),children:[!1,t.jsx(Kn,{appId:e,display:A===te.TABLE,refresh:X,showForm:fe,metaData:h}),!1]}),A===te.FORM&&t.jsx(l.Suspense,{fallback:t.jsx(Ge,{title:O.loadingForm}),children:t.jsx(kt,{appId:e,primaryKey:de,formMode:We,showTable:ce,showForm:fe,metaData:h,tableInstance:me,tableRowIndex:pe})})]})};return t.jsxs(k,{className:"pp-component",sx:I?ye:{},children:[be!==!0&&t.jsx(Lt,{className:"pp-header",elevation:x,position:"relative",sx:{margin:"0 0 5px 0"},children:t.jsxs(At,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(k,{sx:{display:"block",whiteSpace:"nowrap",fontSize:"18px",lineHeight:"18px",fontWeight:"bold",textOverflow:"ellipsis",overflow:"hidden",marginRight:"10px"},children:y}),t.jsxs(k,{sx:{display:"flex",gap:"10px",justifyContent:"center",alignItems:"center"},children:[Xe(h)&&t.jsx(Ct,{title:t.jsx(vn,{details:T,mode:A}),className:"pp-builder-button",children:t.jsx(re,{sx:{color:"inherit",padding:0},onClick:()=>{A===te.FORM?s(Nt({appId:e})):s(fn({appId:e}))},children:t.jsx(Bt,{})})}),_e(),G&&t.jsx(Ct,{title:O.close,children:t.jsx(re,{sx:{color:"inherit",padding:0},onClick:()=>{var _;(_=window.document.getElementById(g))==null||_.remove(),window.document.body.classList.remove("pp-fullscreen"),h.src.app_id?s(gn({isActive:!1,appDbId:0})):s(xn()),u(e),r(e),s(hn())},children:t.jsx(Ut,{})})})]})]})}),Ee(),((ee=w.builtins.alert)==null?void 0:ee.title)&&((ve=w.builtins.alert)==null?void 0:ve.message)&&t.jsx(Vn,{title:(Fe=w.builtins.alert)==null?void 0:Fe.title,message:t.jsx(Rt,{html:(Me=w.builtins.alert)==null?void 0:Me.message}),open:!0,setOpen:()=>{s(pn())}}),((ke=w.builtins.confirm)==null?void 0:ke.title)&&((Oe=w.builtins.confirm)==null?void 0:Oe.message)&&t.jsx(Nn,{title:(Pe=w.builtins.confirm)==null?void 0:Pe.title,message:t.jsx(Rt,{html:(Ne=w.builtins.confirm)==null?void 0:Ne.message}),open:!0,setOpen:()=>{s(bn())},onConfirm:()=>{var _;(_=w.builtins.confirm)!=null&&_.callback&&w.builtins.confirm.callback()}})]})},Mo=Object.freeze(Object.defineProperty({__proto__:null,default:In},Symbol.toStringTag,{value:"Module"}));export{He as R,Mo as S,Ln as a,An as b,qn as c,Yt as d,zt as e,De as f,$t as g,Un as h,Dn as i,$n as u};
