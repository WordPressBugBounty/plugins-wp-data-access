import{r as l,_ as E,cC as qe,l as o,cD as Qe,cE as J,cF as Re,j as a,P as Xe,cG as Ze,ba as Ke,a6 as Ie,S as T,cH as et,cI as tt,cJ as nt,cK as ge,cL as fe,cM as xe,cN as N,A as at,e as h,cO as st,cP as G,cQ as _e,cR as ot,cS as rt,C as it,cx as ve,cT as lt,a9 as ut}from"./main-1.0.17.js";import{u as R,B,S as q,a as ct,v as mt,a4 as he,K as be,s as dt}from"./main-1.0.17-54ffa424.js";import{u as gt,C as ft,a as xt,B as P,b as _t}from"./useScreenSize-1.0.17-44173319.js";import{s as vt,u as ht,i as je}from"./ActionsDml-1.0.17-9041b8e8.js";import{d as Se,j as bt,m as jt,F as L,b as pt,i as Rt,n as St}from"./usePrepareStore-1.0.17-a8be8b2f.js";import{u as Et}from"./useStoreTable-1.0.17-fdcf1717.js";import{C as yt}from"./CardActions-1.0.17-7e33ba01.js";import{I as Ct}from"./iconBase-1.0.17-8d991e6c.js";l.lazy(()=>E(()=>import("./TableContainer-1.0.17-008f8fba.js").then(n=>n.T),["./TableContainer-1.0.17-008f8fba.js","./main-1.0.17.js","./useScreenSize-1.0.17-44173319.js","./iconBase-1.0.17-8d991e6c.js","./index.esm-1.0.17-e75a3d2e.js","./createSvgIcon-1.0.17-f0c1dc0a.js","./Menu-1.0.17-09126381.js","./main-1.0.17-54ffa424.js","./main-1.0.17-f52cb0d7.css","./Select-1.0.17-745624d0.js","./FormControlLabel-1.0.17-cc31d0c1.js","./TargetEnum-1.0.17-1e1ba2c5.js","./Close-1.0.17-6c546366.js","./MenuItem-1.0.17-ed8ab45a.js","./Collapse-1.0.17-faa698ed.js","./usePrepareStore-1.0.17-a8be8b2f.js","./Radio-1.0.17-2bbb6717.js","./Checkbox-1.0.17-3dddd4e7.js","./AlertTitle-1.0.17-4b186927.js","./useSlot-1.0.17-ca7553c5.js","./DialogContent-1.0.17-9628df83.js","./TabPanel-1.0.17-3c2dbf14.js","./Tabs-1.0.17-a2a1c721.js","./TabPanel-1.0.17-9bff3a93.css","./InputAdornment-1.0.17-012556cc.js","./ListItemIcon-1.0.17-21c8997f.js","./DateTimePicker-1.0.17-88f02f82.js","./useMobilePicker-1.0.17-7c45344d.js","./date-time-utils-1.0.17-c30caadb.js","./dateViewRenderers-1.0.17-d51d277e.js","./TimePicker-1.0.17-43c48cfc.js","./DatePicker-1.0.17-e7f585a0.js","./Slider-1.0.17-27606716.js","./index.esm-1.0.17-3107c6b2.js","./ActionsDml-1.0.17-9041b8e8.js","./useStoreTable-1.0.17-fdcf1717.js","./SanitizeComponent-1.0.17-b68e53d1.js","./index.esm-1.0.17-78a91bbf.js","./index-1.0.17-9ae5630d.js","./settings-1.0.17-bb8125cf.js","./settings-1.0.17-871bbe9f.css","./ScopeEnum-1.0.17-7caf102d.js","./TableContainer-1.0.17-9815a209.css"],import.meta.url));l.lazy(()=>E(()=>Promise.resolve().then(()=>Q),void 0,import.meta.url));l.lazy(()=>E(()=>import("./TableContainer-1.0.17-008f8fba.js").then(n=>n.T),["./TableContainer-1.0.17-008f8fba.js","./main-1.0.17.js","./useScreenSize-1.0.17-44173319.js","./iconBase-1.0.17-8d991e6c.js","./index.esm-1.0.17-e75a3d2e.js","./createSvgIcon-1.0.17-f0c1dc0a.js","./Menu-1.0.17-09126381.js","./main-1.0.17-54ffa424.js","./main-1.0.17-f52cb0d7.css","./Select-1.0.17-745624d0.js","./FormControlLabel-1.0.17-cc31d0c1.js","./TargetEnum-1.0.17-1e1ba2c5.js","./Close-1.0.17-6c546366.js","./MenuItem-1.0.17-ed8ab45a.js","./Collapse-1.0.17-faa698ed.js","./usePrepareStore-1.0.17-a8be8b2f.js","./Radio-1.0.17-2bbb6717.js","./Checkbox-1.0.17-3dddd4e7.js","./AlertTitle-1.0.17-4b186927.js","./useSlot-1.0.17-ca7553c5.js","./DialogContent-1.0.17-9628df83.js","./TabPanel-1.0.17-3c2dbf14.js","./Tabs-1.0.17-a2a1c721.js","./TabPanel-1.0.17-9bff3a93.css","./InputAdornment-1.0.17-012556cc.js","./ListItemIcon-1.0.17-21c8997f.js","./DateTimePicker-1.0.17-88f02f82.js","./useMobilePicker-1.0.17-7c45344d.js","./date-time-utils-1.0.17-c30caadb.js","./dateViewRenderers-1.0.17-d51d277e.js","./TimePicker-1.0.17-43c48cfc.js","./DatePicker-1.0.17-e7f585a0.js","./Slider-1.0.17-27606716.js","./index.esm-1.0.17-3107c6b2.js","./ActionsDml-1.0.17-9041b8e8.js","./useStoreTable-1.0.17-fdcf1717.js","./SanitizeComponent-1.0.17-b68e53d1.js","./index.esm-1.0.17-78a91bbf.js","./index-1.0.17-9ae5630d.js","./settings-1.0.17-bb8125cf.js","./settings-1.0.17-871bbe9f.css","./ScopeEnum-1.0.17-7caf102d.js","./TableContainer-1.0.17-9815a209.css"],import.meta.url));l.lazy(()=>E(()=>Promise.resolve().then(()=>Q),void 0,import.meta.url));l.lazy(()=>E(()=>Promise.resolve().then(()=>Q),void 0,import.meta.url));const Mt=n=>{const m=R(_=>qe(_,n));return o.debug("storeColumns",m),m},Tt=n=>{const m=R(_=>Qe(_,n));return o.debug("moreState",m),m},Ft=l.lazy(()=>E(()=>import("./Row-1.0.17-f549d4c5.js"),["./Row-1.0.17-f549d4c5.js","./main-1.0.17.js","./main-1.0.17-54ffa424.js","./iconBase-1.0.17-8d991e6c.js","./main-1.0.17-f52cb0d7.css","./usePrepareStore-1.0.17-a8be8b2f.js","./useScreenSize-1.0.17-44173319.js","./ActionsDml-1.0.17-9041b8e8.js","./useStoreTable-1.0.17-fdcf1717.js","./CardActions-1.0.17-7e33ba01.js"],import.meta.url)),Dt=({appId:n,metaData:m,primaryKey:_,formMode:b,formUuid:F})=>{var y;o.debug(n,m,_,b,F);const j=Se(n),D=bt(n),g=R(f=>J(f,n));o.debug("data",g);const p=R(f=>Re(f,n));o.debug("initialData",p);let S="30px";return a.jsx("form",{id:F,className:"pp-form-content",onSubmit:f=>(f.preventDefault(),!1),children:a.jsx(B,{className:"pp-form-grid",sx:{display:"grid",gridTemplateColumns:{lg:`repeat(${j.cellsPerRow}, 1fr)`,md:"repeat("+Math.min(j.cellsPerRow,2)+", 1fr)",xs:"1fr"},gap:S,marginBottom:0,background:j.showGrid?((y=jt)==null?void 0:y.palette.mode)===Xe.LIGHT?"repeating-linear-gradient( -45deg, transparent, transparent 10px, #eee 10px, #eee 20px )":"repeating-linear-gradient( -45deg, transparent, transparent 10px, #111 10px, #111 20px )":"","& p.MuiFormHelperText-root":{...b===L.VIEW&&!0&&{display:"none"}}},children:a.jsx(l.Suspense,{fallback:a.jsx(q,{}),children:a.jsx(Ft,{appId:n,metaData:m,data:g,initialData:p,primaryKey:_,formMode:b,formSettings:j,language:D.language})})})})};var wt=Ze();const Y=Ke(wt);const kt=l.lazy(()=>E(()=>import("./Alert-1.0.17-27b19721.js"),["./Alert-1.0.17-27b19721.js","./main-1.0.17.js","./index.esm-1.0.17-7de921eb.js","./iconBase-1.0.17-8d991e6c.js","./AlertTitle-1.0.17-4b186927.js","./createSvgIcon-1.0.17-f0c1dc0a.js","./useSlot-1.0.17-ca7553c5.js","./Close-1.0.17-6c546366.js"],import.meta.url)),Pt=({appId:n,primaryKey:m,formMode:_,showTable:b,showForm:F,detailKey:j,children:D,relationAppId:g,relTab:p,joinTab:S,isEmbedded:y})=>{var ae,se,oe,re;o.debug(n,m,_,j,g,p,S,y);const f=ct(),U=Mt(n),u=pt(n),Ee=Rt(),ye=Et(n),[z,Ce]=l.useState(_),H=l.useMemo(()=>mt(),[]),[Me,W]=l.useState(!1),[X,Te]=l.useState(""),s=l.useMemo(()=>Ie(T.getState(),n),[n]);o.debug("metaData",s);const w=et((ae=s==null?void 0:s.app)==null?void 0:ae.container[0]),V=R(e=>J(e,n));o.debug("data",V);const Fe=R(e=>Re(e,n));o.debug("initialData",Fe);const $=R(e=>tt(e,n));o.debug("m2mUpdate",$),l.useEffect(()=>{$===!0&&O(!1,()=>{f(fe({appId:n,update:!1}))})},[$]),l.useEffect(()=>{m===null?we():Object.keys(m).length>0?De():W(!0)},[m]);const De=()=>{vt(n,m,s==null?void 0:s.media,e=>{if(o.debug(e),e!==null){const i={...e.context};delete i.debug;const c={...e.data[0]};f(ge({appId:n,data:c,context:i})),W(e!==null)}else h(u.invalidResponse,{variant:"error"})},e=>{o.error("error",e),Te(e??u.invalidResponse)},!1,p)},we=()=>{var e,i;if(s.columns&&Array.isArray(s.columns)){const c={},d=nt(T.getState(),n);o.debug("defaultValues",d);for(let t=0;t<s.columns.length;t++)c[s.columns[t].column_name]=null,d[s.columns[t].column_name]!==void 0&&(d[s.columns[t].column_name]==="@wpda_wp_user_id"?c[s.columns[t].column_name]=(i=(e=s==null?void 0:s.settings)==null?void 0:e.env)==null?void 0:i.id:d[s.columns[t].column_name]==="@now"?s.columns[t]==="date"?c[s.columns[t].column_name]=Y(Date.now()).format("YYYY-MM-DD"):c[s.columns[t].column_name]=Y(Date.now()).format("YYYY-MM-DD HH:mm:ss"):s.columns[t].column_default!==null&&s.columns[t].column_default!=="NULL"&&s.columns[t].column_default!==""?s.columns[t].column_default==="CURRENT_TIMESTAMP"?s.columns[t]==="date"?c[s.columns[t].column_name]=Y(Date.now()).format("YYYY-MM-DD"):c[s.columns[t].column_name]=Y(Date.now()).format("YYYY-MM-DD HH:mm:ss"):c[s.columns[t].column_name]=s.columns[t].column_default:c[s.columns[t].column_name]=d[s.columns[t].column_name]);o.debug(c),f(ge({appId:n,data:c,context:{media:{}}})),o.debug("init"),W(!0)}},Z=()=>{let e="";for(const i in s.columns)s.columns[i].extra==="auto_increment"&&(e=s.columns[i].column_name);return o.debug(e),e},ke=e=>{for(let i=0;i<s.columns.length;i++)if(s.columns[i].column_name===e)return s.columns[i]},K=e=>{const i=st(T.getState(),n);o.debug("rowValidation",i);let c=!1;for(const r in i)if(i[r].error===!0&&i[r].type===G.COLUMN){c=!0;break}if(c)return o.debug("validateForm returned errors"),!1;let d=!0;const t=Z();for(const r in e){const x=ke(r);let v=!0;x.column_name!==t&&x.is_nullable==="NO"&&(e[r]===""&&(_===L.INSERT||Ye.preserveSpacesOnUpdate===!1)||e[r]===null||e[r]===void 0)&&(f(_e({appId:n,columnName:r,columnError:!0,columnText:u.mandatoryField,columnType:G.FORM})),v=!1,d=!1);const A=ot(T.getState(),n,r);o.debug(A),v&&f(_e({appId:n,columnName:r,columnError:!1,columnText:"",columnType:G.FORM}))}return d},O=(e,i,c)=>{const d=J(T.getState(),n);if(o.debug(d),K(d)){if(m!==null){const t={};Object.keys(d).map(r=>{U.map(x=>{r===x.columnName&&x.updatable&&(t[r]=d[r])})}),o.debug(t),ht(n,m,t,r=>{var x;if(o.debug(r),r!=null&&r.code&&(r!=null&&r.message))switch(r.code){case"ok":h(u.updatedSuccessful,{variant:"success"}),((x=r.context)==null?void 0:x.updated)!==void 0&&Object.keys(r.context.updated).map(v=>{f(rt({appId:n,columnName:v,columnValue:r.context.updated[v]}))}),e&&(i!==void 0&&i(m),setTimeout(()=>{b(!0,g)},1e3));break;case"info":h(u.nothingToUpdate,{variant:"info"}),e&&(i!==void 0&&i(m),setTimeout(()=>{b(!0,g)},1e3));break;default:o.error(r),h(r.message??u.invalidResponse,{variant:"error"}),e&&b(!0,g)}else o.error(r),h(u.invalidResponse,{variant:"error"})},r=>{o.error("error",r),h(r??u.invalidResponse,{variant:"error"})},!1,S,p)}else je(n,d,t=>{if(o.debug(t),t!=null&&t.code&&(t!=null&&t.message)){let r;const x={};switch(t.code){case"ok":h(u.insertSuccessful,{variant:"success"}),r=Z();for(let v=0;v<s.primary_key.length;v++)r!==""?x[s.primary_key[v]]=t.context.insert_id:x[s.primary_key[v]]=d[s.primary_key[v]];if(o.debug(x),e){i!==void 0&&i(x),b(!0,g);return}F(x,St.UPDATE),c&&c();break;default:o.error(t),h(t.message??u.invalidResponse,{variant:"error"})}}else o.error(t),h(u.invalidResponse,{variant:"error"})},t=>{o.error("error",t),h(t??u.invalidResponse,{variant:"error"})},!1,S,p);g!==void 0&&f(fe({appId:g,update:!0}))}},Pe=e=>{if(e!==null&&K(V)){const i=ve(T.getState(),n),c=i.state.relation.relation_join_condition.split(",").map(t=>t.split("=")),d={...i.state.detailKey};c.map(t=>{d[t[0]]=V[t[1]]}),je(n,d,t=>{if(o.debug(t),t!=null&&t.code&&(t!=null&&t.message))switch(t.code){case"ok":o.debug("Added relation to join table",t);break;default:o.error(t),h(t.message??u.invalidResponse,{variant:"error"})}else o.error(t),h(u.invalidResponse,{variant:"error"})},t=>{o.error(t),h(t??u.invalidResponse,{variant:"error"})},!1,!0,!1)}},[Le,Oe]=l.useState(void 0),Ve=()=>{try{O(!1,()=>{},()=>{var i,c,d,t,r,x,v,A,ie,le,ue,ce,me,de;const e=JSON.parse((c=(i=s==null?void 0:s.app)==null?void 0:i.app[0])==null?void 0:c.app_settings);o.debug(e),((t=(d=e==null?void 0:e.settings)==null?void 0:d.app_registration)==null?void 0:t.showMessage)===!0&&((x=(r=e==null?void 0:e.settings)==null?void 0:r.app_registration)==null?void 0:x.message)!==void 0&&((A=(v=e==null?void 0:e.settings)==null?void 0:v.app_registration)==null?void 0:A.message)!==null&&((le=(ie=e==null?void 0:e.settings)==null?void 0:ie.app_registration)==null?void 0:le.message.trim())!==""&&Oe((ce=(ue=e==null?void 0:e.settings)==null?void 0:ue.app_registration)==null?void 0:ce.message),((de=(me=e==null?void 0:e.settings)==null?void 0:me.app_registration)==null?void 0:de.allowUpdates)!==!0&&Ce(L.VIEW)})}catch(e){o.error("Invalid JSON - app settings"),o.error(e),h(it.contactSupport,{variant:"error"})}},Ae=()=>{O(!1)},Ne=()=>{const e=ve(T.getState(),n);o.debug(e.state.relation),e.state.relation!==void 0&&e.state.relation.cardinality===lt.MANY_TO_MANY?O(!0,Pe):O(!0)},I=()=>{b(!0,g)},Ye=Se(n),Be=R(e=>xe(e,n)),Ue=R(e=>xe(e,g??"")),C=Tt(n),M=l.useRef(null),ze=gt(),[k,He]=l.useState((se=M==null?void 0:M.current)==null?void 0:se.offsetWidth),[We,$e]=l.useState({paddingTop:"50px",paddingBottom:"50px",paddingLeft:"50px",paddingRight:"50px"}),[Ge,ee]=l.useState("30px"),[Je,te]=l.useState("");if(l.useEffect(()=>{if(M.current!==null){He(M.current.offsetWidth);const e=k<600?.3:k<900?.6:1;$e({paddingTop:`calc(${e} * 50px)`,paddingBottom:`calc(${e} * 50px)`,paddingLeft:`calc(${e} * 50px)`,paddingRight:`calc(${e} * 50px)`}),k<600?(ee("10px"),te("10px")):k<900&&(ee("20px"),te("20px"))}},[ze.width,M.current]),X!=="")return a.jsx(l.Suspense,{children:a.jsx(kt,{severity:"error",message:X,close:!1})});const ne=()=>a.jsx(Dt,{appId:n,metaData:s,primaryKey:m,formMode:z,formUuid:H});return y?ne():a.jsx("div",{className:`${n}_wrapper pp-form`,ref:M,children:Me&&V!==null?a.jsxs(ft,{sx:We,elevation:Ee,children:[a.jsxs(xt,{sx:{padding:0,margin:"5px 0 0 0"},children:[ne(),D]}),a.jsxs(yt,{sx:{marginTop:{marginTop:Ge},paddingRight:{paddingRight:Je},padding:0,justifyContent:"space-between",alignItems:"center"},children:[a.jsxs(B,{sx:{display:"flex",gap:"8px"},children:[!1,(Be||Ue)&&a.jsx(a.Fragment,{children:k<600?a.jsx(Ct,{color:"primary",onClick:()=>{f(N({appId:n,more:!C})),g!==void 0&&f(N({appId:g,more:!C}))},children:C?a.jsx(he,{}):a.jsx(be,{})}):a.jsx(P,{variant:"outlined",startIcon:C?a.jsx(he,{}):a.jsx(be,{}),onClick:()=>{f(N({appId:n,more:!C})),g!==void 0&&f(N({appId:g,more:!C}))},children:C?u.less:u.more})}),a.jsx(B,{className:"pp-registration-form-message",children:Le})]}),a.jsx(B,{sx:{...k<600&&{marginLeft:"0 !important","& button":{marginLeft:"2px",padding:"6px"}}},children:_!==L.VIEW?a.jsx(a.Fragment,{children:((re=(oe=s==null?void 0:s.app)==null?void 0:oe.app[0])==null?void 0:re.app_type)==at.REGISTRATION&&ye.state.masterDetailConditions===void 0?a.jsx(a.Fragment,{children:(z===L.INSERT||z===L.UPDATE)&&a.jsx(P,{variant:"contained",onClick:Ve,type:"submit",form:H,sx:{marginLeft:"8px"},children:u.ok})}):a.jsxs(a.Fragment,{children:[a.jsx(P,{variant:"contained",onClick:Ae,type:"submit",form:H,children:u.apply}),(w==null?void 0:w.cardinality)!==0&&a.jsxs(a.Fragment,{children:[a.jsx(P,{variant:"outlined",onClick:Ne,sx:{marginLeft:"8px"},children:u.ok}),a.jsx(P,{variant:"outlined",onClick:I,sx:{marginLeft:"8px"},children:u.cancel})]})]})}):a.jsx(a.Fragment,{children:(w==null?void 0:w.cardinality)!==0&&a.jsx(P,{variant:"contained",onClick:I,children:u.back})})})]}),a.jsx(a.Fragment,{children:!1})]}):a.jsx("div",{style:{padding:"50px"},children:a.jsx(q,{title:u.loadingData})})})},Lt=l.lazy(()=>E(()=>import("./Settings-1.0.17-9fa9b38d.js"),["./Settings-1.0.17-9fa9b38d.js","./main-1.0.17.js","./main-1.0.17-54ffa424.js","./iconBase-1.0.17-8d991e6c.js","./main-1.0.17-f52cb0d7.css","./useScreenSize-1.0.17-44173319.js","./SortableDragHandle-1.0.17-a2162a27.js","./index.esm-1.0.17-78a91bbf.js","./useMetadataColumns-1.0.17-3a349218.js","./usePrepareStore-1.0.17-a8be8b2f.js","./useStoreTable-1.0.17-fdcf1717.js","./useFormStore-1.0.17-baf3b989.js","./Stepper-1.0.17-9e6367ba.js","./createSvgIcon-1.0.17-f0c1dc0a.js","./Collapse-1.0.17-faa698ed.js","./index.esm-1.0.17-11edad0c.js","./ActionsDml-1.0.17-9041b8e8.js","./Select-1.0.17-745624d0.js","./Menu-1.0.17-09126381.js","./MenuItem-1.0.17-ed8ab45a.js","./index-1.0.17-e83aeb27.js","./useTableUpdater-1.0.17-299f713b.js","./FormControlLabel-1.0.17-cc31d0c1.js","./Checkbox-1.0.17-3dddd4e7.js","./TargetEnum-1.0.17-1e1ba2c5.js","./Close-1.0.17-6c546366.js","./TabPanel-1.0.17-3c2dbf14.js","./DialogContent-1.0.17-9628df83.js","./Tabs-1.0.17-a2a1c721.js","./TabPanel-1.0.17-9bff3a93.css","./Link-1.0.17-88d48a3e.js","./AccordionSummary-1.0.17-276b7b2a.js","./useSlot-1.0.17-ca7553c5.js","./AccordionDetails-1.0.17-7b8437b0.js","./SettingsFormRelationships-1.0.17-c208d94f.js","./useApp-1.0.17-9f008cb2.js","./ActionsApp-1.0.17-78ec1ee3.js","./ActionsExplorer-1.0.17-9d96105d.js","./ToggleButtonGroup-1.0.17-d85b41b5.js","./PremiumFeature-1.0.17-12e324e9.js","./EnumTypeEnum-1.0.17-7ffcf33a.js","./Slider-1.0.17-27606716.js","./RadioGroup-1.0.17-46153993.js","./Radio-1.0.17-2bbb6717.js","./settings-1.0.17-bb8125cf.js","./settings-1.0.17-871bbe9f.css","./ScopeEnum-1.0.17-7caf102d.js","./CssUnitTextField-1.0.17-84b114af.js","./ThemeSettings-1.0.17-559387ce.js","./index-1.0.17-9ae5630d.js"],import.meta.url)),pe=({appId:n,primaryKey:m,formMode:_,showTable:b,showForm:F,metaData:j,detailKey:D,selectionForm:g})=>{o.debug(n,m,_,j,D,g);const p=_t(),S=l.useMemo(()=>{},[]);o.debug("relationAppId",S);const y=()=>null,f=()=>null,U=()=>null;return a.jsxs(a.Fragment,{children:[g===!0?a.jsx(a.Fragment,{children:y()}):a.jsx(Pt,{appId:n,primaryKey:m,formMode:_,showTable:b,showForm:F,detailKey:D,relationAppId:S,children:f()}),ut(j)&&a.jsx(dt,{theme:p,children:a.jsx(l.Suspense,{fallback:a.jsx(q,{title:"Loading form settings..."}),children:a.jsx(Lt,{appId:n})})}),U()]})},Q=Object.freeze(Object.defineProperty({__proto__:null,FormContainer:pe,default:pe},Symbol.toStringTag,{value:"Module"}));export{Q as F,Tt as a,Y as d,Mt as u};
