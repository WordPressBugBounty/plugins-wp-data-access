import{r as l}from"./redux-1.0.40-W_04YL6Z.js";import{b as G}from"./ActionsApp-1.0.40-AuvirVl-.js";import{l as s,A as r,E as b,F as j,G as w,b as A}from"./lib-1.0.40-CJM-IO_o.js";import{e as S}from"./notistack-1.0.40-HUa4vT_u.js";import{u as z,S as B,D as g}from"./StoreTypeEnum-1.0.40-D0wfLstw.js";import{a as K}from"./hooks-1.0.40-DoKijNI1.js";const I=(t,a,h,L,J,Q,m,o)=>{const c=K(),{prepareAppStore:k,prepareApp:x}=z(t,B.APP),[H,i]=l.useState(!1),[R,u]=l.useState(),[q,y]=l.useState(""),D=e=>{var n,M,P,T,_,E,N,v,C,O;if(s.debug(e),e.app&&e.app.app&&Array.isArray(e.app.app)&&e.app.container&&Array.isArray(e.app.container)&&e.app.apps&&Array.isArray(e.app.apps))if(e.app.app[0].app_type==r.APPCONTAINER)x(e,m),u(r.APPCONTAINER),i(!0);else if(e.app.app[0].app_type==r.CHART){const p={...e};p.src=g(a,(M=(n=e==null?void 0:e.app)==null?void 0:n.container[0])==null?void 0:M.cnt_id),m===!0&&(p.isExploring=!0),o!==void 0&&(p.appRootId=o),c(b({appId:t,metaData:p})),u(r.CHART),i(!0)}else if(e.app.app[0].app_type==r.MAP){const p={...e};p.src=g(a,(T=(P=e==null?void 0:e.app)==null?void 0:P.container[0])==null?void 0:T.cnt_id),m===!0&&(p.isExploring=!0),o!==void 0&&(p.appRootId=o);let f={};try{((E=(_=e==null?void 0:e.app)==null?void 0:_.container[0])==null?void 0:E.cnt_map)!==void 0&&((v=(N=e==null?void 0:e.app)==null?void 0:N.container[0])==null?void 0:v.cnt_map)!==null&&(f=JSON.parse((O=(C=e==null?void 0:e.app)==null?void 0:C.container[0])==null?void 0:O.cnt_map),delete f.state)}catch(F){s.error("Invalid JSON - map settings"),s.error(F),S("Invalid JSON, check console",{variant:"error"})}c(j({appId:t,mapState:f})),c(b({appId:t,metaData:p})),u(r.MAP),i(!0)}else k(a,e,h===!0,void 0,o,()=>{})&&(c(w({appId:t,property:{staticFilter:L,shortcodeArgs:J}})),u(e.app.app[0].app_type),i(!0));else S(A.contactSupport,{variant:"error"}),y(A.contactSupport)};return{loadAppMetaData:()=>{G(a,e=>{const n=e==null?void 0:e.data;s.debug("response data",n),D(n)},e=>{s.error("error",e),S(e??A.contactSupport,{variant:"error"}),y(e??A.contactSupport)})},processMetaData:D,metaDataLoaded:H,loadError:q,appType:R}};export{I as u};
