const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./QueryParams-1.0.41-DRxV5u8t.js","./cm-1.0.41-DxZ4itL_.js","./redux-1.0.41-DJjpZqD1.js","./vendor-1.0.41-CN03Eozo.js","./index-1.0.41-Wbyk3QBm.js","./index-1.0.41-Ca6zW1RM.js","./ConfirmDialog-1.0.41-NKESMhfW.js","./iconBase-1.0.41-BNQFQdHp.js","./Typography-1.0.41-BIN1Ddvh.js","./lib-1.0.41-DFdWuh_n.js","./loglevel-1.0.41-BZ7XahX3.js","./lodash-1.0.41-Cd8grAqB.js","./moment-1.0.41-C5S46NFB.js","./useEnhancedEffect-1.0.41-BVsyj6AW.js","./AdminTheme-1.0.41-4tiUoVeb.js","./index-1.0.41-CpXj521P.js","./notistack-1.0.41-Bq-EKqc7.js","./hooks-1.0.41-sDnKeMy7.js","./PremiumFeature-1.0.41-CNKLpmFu.js","./index-1.0.41-B2jO0d0P.js","./FormLabel-1.0.41-CgxisugM.js","./useFormControl-1.0.41-1E9QEnRo.js","./Tooltip-1.0.41-g4uuOuci.js","./ThemeProvider-1.0.41-D1lNQgXT.js","./useControlled-1.0.41-BEhJe3xs.js","./Popper-1.0.41-Dl4_0sfD.js","./Menu-1.0.41-DBfdBNVU.js","./CardContent-1.0.41-Cwtu331C.js","./CardHeader-1.0.41-DfJVb3rg.js","./Spinner-1.0.41-fWZy8imI.js","./TextField-1.0.41-CGPjmVeQ.js","./Select-1.0.41-aTzlc-HZ.js","./utils-1.0.41-iop7lDec.js","./createSvgIcon-1.0.41-0lRWzB2Q.js","./FormHelperText-1.0.41-BPSj83yP.js","./CardActions-1.0.41-CXPPUffK.js","./QuerySchedules-1.0.41-pN_giClC.js","./MainQueryBuilder-1.0.41-M8KmYGqb.js","./main-1.0.41.js","./ActionsExplorer-1.0.41-DSAyrNr3.js","./RestApi-1.0.41-CZ_yORv3.js","./DatabaseTypeEnum-1.0.41-DeJfpW1u.js","./dayjs.min-1.0.41-CD-l-E21.js","./lang-1.0.41-Bm0VdcRH.js","./QueryBuilder-1.0.41-hvN5SRs8.js","./index-1.0.41-DGYaemnA.js","./SanitizeComponent-1.0.41-B18z6eJi.js","./dompurify-1.0.41-DhD2mIk-.js","./FormControlLabel-1.0.41-OBCouq3I.js","./Checkbox-1.0.41-C_619ZQC.js","./SwitchBase-1.0.41-C_lqznV-.js","./Divider-1.0.41-CupjOoMR.js","./MenuItem-1.0.41-DCc8qvzQ.js","./InputAdornment-1.0.41-BaGp3m3T.js","./TabPanel-1.0.41-BJuUpIHA.js","./useThemeProps-1.0.41-BJkkrkB6.js","./getThemeProps-1.0.41-BXG_2HDV.js","./TabList-1.0.41-WNj_9XSz.js","./Tabs-1.0.41-C8-7orxg.js","./Switch-1.0.41-BrkxB2Jy.js","./main-1.0.41-LBsY5zsP.css","./TableRow-1.0.41-CTJevnEe.js","./TableHead-1.0.41-R3d_gFkF.js","./AiAssistant-1.0.41-BKDlxYNt.js","./index-1.0.41-fBbZNnTO.js","./AccordionSummary-1.0.41-CY9CEWZQ.js","./Collapse-1.0.41-QlMDtjRk.js","./AccordionDetails-1.0.41-DlUbOAS0.js","./ToggleButtonGroup-1.0.41-CS_43ZCw.js","./Autocomplete-1.0.41-82-5yXGC.js","./Close-1.0.41-Dkp5SdDZ.js","./Chip-1.0.41-C0GI7jZZ.js"])))=>i.map(i=>d[i]);
import{_ as re}from"./main-1.0.41.js";import{j as e}from"./cm-1.0.41-DxZ4itL_.js";import{r as n}from"./redux-1.0.41-DJjpZqD1.js";import{_ as Ie,$ as Pe,A as De,T as we,Y as Me,aj as Re,z as Ee,ak as Oe,k as Le,al as Ne,am as _e,an as Qe,M as Fe}from"./index-1.0.41-CpXj521P.js";import{G as We,I as K}from"./iconBase-1.0.41-BNQFQdHp.js";import{P as ze}from"./index-1.0.41-fBbZNnTO.js";import{a as ie}from"./hooks-1.0.41-sDnKeMy7.js";import{l as p,aS as ve,aY as Ce,n as oe,c6 as ae,c7 as je,c8 as Be,C as Ve}from"./lib-1.0.41-DFdWuh_n.js";import{A as M}from"./AdminTheme-1.0.41-4tiUoVeb.js";import{k as He}from"./index-1.0.41-B2jO0d0P.js";import{A as ee,u as ye,q as Ue,a as Se,b as Ge,c as Je,d as Xe,e as Ye}from"./QueryBuilder-1.0.41-hvN5SRs8.js";import{u as $e}from"./MainQueryBuilder-1.0.41-M8KmYGqb.js";import{C as Ze}from"./index-1.0.41-DIUNb9YZ.js";import{e as u}from"./notistack-1.0.41-Bq-EKqc7.js";import{N as ke}from"./react-number-format.es-1.0.41-KmyU8zGo.js";import{D as le,P as ce,a as pe,b as de,c as xe,d as me,B as W,C as Ae}from"./ConfirmDialog-1.0.41-NKESMhfW.js";import{B as m,S as qe}from"./Spinner-1.0.41-fWZy8imI.js";import{T as I,I as Ke}from"./TextField-1.0.41-CGPjmVeQ.js";import{F as y,a as te}from"./FormHelperText-1.0.41-BPSj83yP.js";import{T as es,a as be}from"./ToggleButtonGroup-1.0.41-CS_43ZCw.js";import{d as ss}from"./dayjs.min-1.0.41-CD-l-E21.js";import{P as ts}from"./PremiumFeature-1.0.41-CNKLpmFu.js";import{ac as rs}from"./useMobilePicker-1.0.41-Bl-98x2q.js";import{A as is}from"./AdapterDayjs-1.0.41-DDq-IPE4.js";import{D as ns}from"./DateTimePicker-1.0.41-FGXdJ7he.js";import{S as Te}from"./Select-1.0.41-aTzlc-HZ.js";import{M as b}from"./MenuItem-1.0.41-DCc8qvzQ.js";import{F as se}from"./FormLabel-1.0.41-CgxisugM.js";import{T as os,a as as,b as ls,c as ne}from"./TableRow-1.0.41-CTJevnEe.js";import{T as D}from"./Tooltip-1.0.41-g4uuOuci.js";import{F as w}from"./FormControlLabel-1.0.41-OBCouq3I.js";import{S as cs}from"./Switch-1.0.41-BrkxB2Jy.js";import{C as F}from"./Checkbox-1.0.41-C_619ZQC.js";import{a as ps}from"./RestApi-1.0.41-CZ_yORv3.js";import{F as ds}from"./FileSaver.min-1.0.41-CFZnymRv.js";import{M as xs}from"./Menu-1.0.41-DBfdBNVU.js";import"./vendor-1.0.41-CN03Eozo.js";import"./loglevel-1.0.41-BZ7XahX3.js";import"./lodash-1.0.41-Cd8grAqB.js";import"./moment-1.0.41-C5S46NFB.js";import"./Typography-1.0.41-BIN1Ddvh.js";import"./useEnhancedEffect-1.0.41-BVsyj6AW.js";import"./index-1.0.41-Wbyk3QBm.js";import"./index-1.0.41-Ca6zW1RM.js";import"./index-1.0.41-DGYaemnA.js";import"./SanitizeComponent-1.0.41-B18z6eJi.js";import"./dompurify-1.0.41-DhD2mIk-.js";import"./Divider-1.0.41-CupjOoMR.js";import"./InputAdornment-1.0.41-BaGp3m3T.js";import"./useFormControl-1.0.41-1E9QEnRo.js";import"./TabPanel-1.0.41-BJuUpIHA.js";import"./useThemeProps-1.0.41-BJkkrkB6.js";import"./getThemeProps-1.0.41-BXG_2HDV.js";import"./TabList-1.0.41-WNj_9XSz.js";import"./Tabs-1.0.41-C8-7orxg.js";import"./ThemeProvider-1.0.41-D1lNQgXT.js";import"./createSvgIcon-1.0.41-0lRWzB2Q.js";/* empty css                    */import"./ActionsExplorer-1.0.41-DSAyrNr3.js";import"./DatabaseTypeEnum-1.0.41-DeJfpW1u.js";import"./ctc-1.0.41-D6Hg2DQJ.js";import"./utils-1.0.41-iop7lDec.js";import"./lang-1.0.41-Bm0VdcRH.js";import"./index-1.0.41-zQwWCc96.js";import"./Popper-1.0.41-Dl4_0sfD.js";import"./useControlled-1.0.41-BEhJe3xs.js";import"./visuallyHidden-1.0.41-Dan1xhjv.js";import"./ListItem-1.0.41-CMjqURej.js";import"./Chip-1.0.41-C0GI7jZZ.js";import"./timeViewRenderers-1.0.41-3MJVY4qK.js";import"./dateViewRenderers-1.0.41-Dd4MHWu8.js";import"./SwitchBase-1.0.41-C_lqznV-.js";function ms(r){return We({attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"},child:[]}]})(r)}const us=({queries:r,queryKey:s,copyDialog:S,setCopyDialog:h,newName:l,setNewName:o})=>{var g,A,C,j;const f=ie(),{createQueryKey:T}=ye(),[c,k]=n.useState(r[s].access);return e.jsxs(le,{open:S,onClose:()=>h(!1),PaperComponent:ce,"aria-labelledby":"confirm-dialog",closeAfterTransition:!1,children:[e.jsx(pe,{sx:{color:(A=(g=M)==null?void 0:g.palette)==null?void 0:A.primary.main,marginTop:"10px",cursor:"move"},id:"draggable-dialog-title",children:"Copy query"}),e.jsx(de,{children:e.jsx(xe,{component:"div",sx:{color:(j=(C=M)==null?void 0:C.palette)==null?void 0:j.primary.main},children:e.jsxs(m,{sx:{paddingTop:"5px",display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsx(I,{label:"Copy",disabled:!0,value:r[s].queryName}),e.jsx(I,{label:"To",value:l,onChange:v=>{o(v.target.value)}}),e.jsxs(y,{fullWidth:!0,children:[e.jsxs(es,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr","& svg":{marginRight:"5px",height:"1.2em",width:"1.2em"}},value:c,children:[e.jsxs(be,{value:ee.USER,onClick:()=>{k(ee.USER)},children:[e.jsx(Ie,{})," Only Me"]}),e.jsxs(be,{value:ee.GLOBAL,onClick:()=>{k(ee.GLOBAL)},children:[e.jsx(Pe,{})," Everyone"]})]}),e.jsx(te,{children:"Define who can access this query."})]})]})})}),e.jsx(me,{sx:{padding:0},children:e.jsxs(m,{sx:{width:"100%",margin:"0 20px 20px 20px",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",gap:"10px"},children:[e.jsx(W,{autoFocus:!0,fullWidth:!0,variant:"contained",disabled:l.trim()==="",onClick:v=>{h(!1);const d=T(c,l);Ue(r[s].access,r[s].queryName,c,l,x=>{p.debug(x),(x==null?void 0:x.code)==="ok"&&(f(ve({queryKey:d,query:{access:c,queryName:l,query:r[s].query,schemaName:r[s].schemaName,isVisual:r[s].isVisual,params:r[s].params}})),f(Ce({tabIndex:d})),u("Query succesfully saved",{variant:"success"}))},x=>{p.error(x),u(x,{variant:"error"})}),v.stopPropagation()},children:"Copy"}),e.jsx(W,{fullWidth:!0,variant:"outlined",onClick:v=>{h(!1),v.stopPropagation()},children:"Cancel"})]})})]})},hs=({queries:r,queryKey:s,renameDialog:S,setRenameDialog:h,newName:l,setNewName:o})=>{var k,g,A,C;const f=ie(),{createQueryKey:T}=ye(),c=j=>{f(ve({queryKey:j,query:{access:r[s].access,queryName:l,query:r[s].query,schemaName:r[s].schemaName,isVisual:r[s].isVisual,isInserting:r[s].isInserting,params:r[s].params}})),f(ae({queryKey:s})),f(Ce({tabIndex:j}))};return e.jsxs(le,{open:S,onClose:()=>h(!1),PaperComponent:ce,"aria-labelledby":"confirm-dialog",closeAfterTransition:!1,children:[e.jsx(pe,{style:{color:(g=(k=M)==null?void 0:k.palette)==null?void 0:g.primary.main,marginTop:"10px",cursor:"move"},id:"draggable-dialog-title",children:"Rename query"}),e.jsx(de,{children:e.jsx(xe,{component:"div",sx:{color:(C=(A=M)==null?void 0:A.palette)==null?void 0:C.primary.main},children:e.jsxs(m,{sx:{paddingTop:"5px",display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsx(I,{label:"Old query name",disabled:!0,value:r[s].queryName}),e.jsx(I,{label:"New query name",value:l,onChange:j=>{o(j.target.value)}})]})})}),e.jsx(me,{sx:{padding:0},children:e.jsxs(m,{sx:{width:"100%",margin:"0 20px 20px 20px",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",gap:"10px"},children:[e.jsx(W,{autoFocus:!0,fullWidth:!0,variant:"contained",disabled:l.trim()==="",onClick:j=>{h(!1);const v=T(r[s].access,l);r[s].isInserting!==!0?Se(r[s].access,r[s].schemaName,l,oe(r[s].query),!1,r[s].queryName,!0,r[s].params,d=>{p.debug(d),(d==null?void 0:d.code)==="ok"&&(c(v),u("Query succesfully renamed",{variant:"success"}))},d=>{p.error(d),u(d,{variant:"error"})}):r[v]?u("Query name already exists",{variant:"error"}):c(v),j.stopPropagation()},children:"Rename"}),e.jsx(W,{fullWidth:!0,variant:"outlined",onClick:j=>{h(!1),j.stopPropagation()},children:"Cancel"})]})})]})},fs=({queries:r,queryKey:s,confirmDelete:S,setConfirmDelete:h})=>{const l=ie();return e.jsx(Ae,{title:"Delete query",message:e.jsxs("div",{children:["Are you sure you want to delete query ",r[s].queryName,"?",e.jsx("br",{}),e.jsx("strong",{children:"This action cannot be undone!"})]}),open:S,setOpen:h,onConfirm:()=>{l(ae({queryKey:s})),Ge(r[s].access,r[s].queryName,o=>{p.debug(o),u("Query successfully deleted",{variant:"success"})},o=>{p.error(o),u(o,{variant:"error"})})}})},gs=({queryKey:r,queryBuilderState:s,scheduling:S,setScheduling:h,limit:l})=>{var J,U,X,Y;const o=Je(),[f,T]=n.useState(ss()),[c,k]=n.useState("nonrepeating"),[g,A]=n.useState(!0),[C,j]=n.useState(!0),[v,d]=n.useState(100),[x,G]=n.useState(s.queries[r].params),[R,z]=n.useState(!1),[P,B]=n.useState(""),[E,V]=n.useState(!1),[O,L]=n.useState(!1),[N,H]=n.useState(!1);return n.useEffect(()=>{const i=localStorage.getItem("ppQueryBuilderNotify");if(i!==null){const a=JSON.parse(i);a.email&&(z(!0),B(a.email),V(a.csv),L(a.json),H(a.xml))}},[]),e.jsxs(le,{open:S,onClose:()=>h(!1),PaperComponent:ce,"aria-labelledby":"confirm-dialog",closeAfterTransition:!1,children:[e.jsx(pe,{sx:{color:(U=(J=M)==null?void 0:J.palette)==null?void 0:U.primary.main,marginTop:"10px",cursor:"move"},id:"draggable-dialog-title",children:"Schedule query"}),e.jsx(de,{children:e.jsxs(xe,{component:"div",sx:{color:(Y=(X=M)==null?void 0:X.palette)==null?void 0:Y.primary.main,marginTop:"5px",display:"grid",gap:"30px"},children:[e.jsx(rs,{dateAdapter:is,children:e.jsx(ns,{label:"Start date and time",value:f,onChange:i=>{T(i)},slotProps:{textField:{helperText:"First execution time."}},disabled:!0})}),e.jsxs(y,{fullWidth:!0,children:[e.jsx(Ke,{variant:"outlined",children:"Recurrence"}),e.jsxs(Te,{MenuProps:{id:"pp-select-menu"},label:"Recurrence",value:c,onChange:i=>{k(i.target.value)},disabled:!0,children:[e.jsx(b,{value:"nonrepeating",children:"Only Once (non-repeating)"},"nonrepeating"),...Object.keys(s.cron.intervalSorted).map(i=>e.jsx(b,{value:s.cron.intervalSorted[i].key,children:s.cron.schedules[s.cron.intervalSorted[i].key].display},s.cron.intervalSorted[i].key))]}),e.jsx(te,{children:"How often the event should subsequently recur."})]}),x&&Object.keys(x).length>0&&e.jsxs("fieldset",{className:"pp-fieldset",style:{marginTop:"-10px",padding:"0 10px"},children:[e.jsx("legend",{children:e.jsx(se,{sx:{padding:0,fontSize:"13px"},children:"Parameters"})}),e.jsx(os,{sx:{width:"auto",margin:"10px 0 20px 5px","& *":{border:"none"},"& td":{padding:"10px",fontWeight:"bold"}},children:e.jsx(as,{children:Object.keys(x).map(i=>e.jsxs(ls,{children:[e.jsx(ne,{sx:{paddingLeft:"16px !important",border:"none",color:"rgba(0, 0, 0, 0.38)"},children:i}),e.jsx(ne,{sx:{border:"none",width:"20px",textAlign:"center",color:"rgba(0, 0, 0, 0.38)"},children:"="}),e.jsx(ne,{sx:{border:"none"},children:e.jsx(D,{title:"",children:e.jsx(I,{type:"text",variant:"outlined",value:x[i],autoComplete:"off",onChange:a=>{const $={...x};$[i]=a.target.value,G($)},sx:{width:"60px","& input":{padding:0}},disabled:!0})})})]},i))})})]}),e.jsxs("fieldset",{className:"pp-fieldset",style:{marginTop:"-10px",padding:"0 10px"},children:[e.jsx("legend",{children:e.jsx(se,{sx:{padding:0,fontSize:"13px"},children:"Settings"})}),e.jsxs(m,{sx:{padding:"20px 20px 25px 20px"},children:[e.jsxs(y,{fullWidth:!0,children:[e.jsx(w,{control:e.jsx(cs,{checked:g,onChange:i=>{A(!g),i.stopPropagation()},disabled:!0}),label:"WordPress Table Protection"}),e.jsx(te,{sx:{marginTop:"5px"},children:"Protect WordPress tables to prevent accidental or harmful changes."})]}),e.jsxs(m,{sx:{marginTop:"10px",display:"flex",justifyContent:"start"},children:[e.jsx(y,{children:e.jsx(w,{sx:{marginRight:"8px"},control:e.jsx(F,{checked:C,onClick:i=>{j(!C),i.preventDefault(),i.stopPropagation()},color:"primary",disabled:!0,sx:{marginRight:"10px"}}),label:"Max rows: "})}),e.jsx(ke,{customInput:I,value:v,disabled:!0,variant:"outlined",onValueChange:({value:i})=>{d(Number(i))},onInvalid:i=>{i.preventDefault()},sx:{"& input.MuiInputBase-input":{borderRadius:"4px",height:"8px",backgroundColor:"#fff",width:"55px",minHeight:"unset"},"& fieldset":{borderRadius:"4px"}}})]})]})]}),e.jsxs("fieldset",{className:"pp-fieldset",style:{marginTop:"-10px",padding:"0 10px"},children:[e.jsx("legend",{children:e.jsx(se,{sx:{padding:0,fontSize:"13px"},children:"Notification"})}),e.jsxs(m,{sx:{padding:"20px 10px 20px 20px"},children:[e.jsxs(m,{sx:{display:"flex",justifyContent:"start"},children:[e.jsx(y,{children:e.jsx(w,{sx:{marginRight:"9px"},control:e.jsx(F,{checked:R,onClick:i=>{z(!R),i.preventDefault(),i.stopPropagation()},color:"primary",disabled:!0}),label:""})}),e.jsx(I,{value:P,onChange:i=>{B(i.target.value)},label:"Email",placeholder:"example@domain.com",fullWidth:!0,disabled:!0,sx:{"& input":{height:"8px",minHeight:"unset"}}})]}),e.jsxs(m,{sx:{marginTop:"10px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(se,{children:"Add attachment"}),e.jsx(y,{children:e.jsx(w,{sx:{marginRight:"9px"},control:e.jsx(F,{checked:E,onClick:i=>{V(!E),i.preventDefault(),i.stopPropagation()},color:"primary",disabled:!0}),label:"CSV"})}),e.jsx(y,{children:e.jsx(w,{sx:{marginRight:"9px"},control:e.jsx(F,{checked:O,onClick:i=>{L(!O),i.preventDefault(),i.stopPropagation()},color:"primary",disabled:!0}),label:"JSON"})}),e.jsx(y,{children:e.jsx(w,{sx:{marginRight:"9px"},control:e.jsx(F,{checked:N,onClick:i=>{H(!N),i.preventDefault(),i.stopPropagation()},color:"primary",disabled:!0}),label:"XML"})})]}),e.jsx(y,{children:e.jsx(te,{children:"Adds query results as attachments in the given formats."})})]})]}),e.jsx(ts,{})]})}),e.jsx(me,{sx:{padding:0},children:e.jsxs(m,{sx:{width:"100%",margin:"10px 25px 30px 25px",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",gap:"10px"},children:[e.jsx(W,{autoFocus:!0,fullWidth:!0,variant:"contained",onClick:i=>{R&&P.trim()===""?u("Email required for Notifications",{variant:"error"}):(localStorage.setItem("ppQueryBuilderNotify",JSON.stringify({email:P,csv:E,json:O,xml:N})),Xe(s.queries[r].queryName,s.queries[r].access,{protection:g,limit:l,params:x,notify:{...R&&{email:P,csv:E,json:O,xml:N}},query_id:s.queryId},(f==null?void 0:f.unix())||0,c,a=>{p.debug(a),(a==null?void 0:a.code)==="ok"&&(a!=null&&a.message)?(o(),u(a.message,{variant:"success"}),h(!1)):(p.error("Invalid response"),u("Invalid response",{variant:"error"}))},a=>{p.error(a),u(a,{variant:"error"})})),i.stopPropagation()},disabled:!0,children:"Schedule"}),e.jsx(W,{fullWidth:!0,variant:"outlined",onClick:i=>{h(!1),i.stopPropagation()},children:"Cancel"})]})})]})},js=n.lazy(()=>re(()=>import("./QueryParams-1.0.41-DRxV5u8t.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35]),import.meta.url)),bs=n.lazy(()=>re(()=>import("./QuerySchedules-1.0.41-pN_giClC.js"),__vite__mapDeps([36,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,37,38,17,39,40,41,29,23,42,43,44,45,46,47,34,32,48,49,50,24,33,22,25,26,51,52,30,31,53,54,55,56,57,58,59,60,27,28,61,62,35]),import.meta.url)),vs=n.lazy(()=>re(()=>import("./QueryBuilder-1.0.41-hvN5SRs8.js").then(r=>r.h),__vite__mapDeps([44,38,1,2,3,16,9,10,11,12,15,7,8,13,6,14,17,37,39,40,41,29,23,4,5,45,46,47,34,32,21,48,49,50,24,33,22,25,26,51,52,30,31,20,53,54,55,56,57,58,59,60]),import.meta.url)),Cs=n.lazy(()=>re(()=>import("./AiAssistant-1.0.41-BKDlxYNt.js"),__vite__mapDeps([63,38,1,2,3,16,9,10,11,12,6,7,8,13,14,15,40,64,29,22,23,24,25,65,66,67,68,30,31,26,32,21,33,20,34,53,4,5,37,17,39,41,69,70,71]),import.meta.url)),Wt=({queries:r,queryKey:s,databases:S,setQueryResults:h})=>{var fe;const l=ie(),o=$e(),f=n.useRef(null),[T,c]=n.useState(null),k=!!T,[g,A]=n.useState(!0),[C,j]=n.useState(100),[v,d]=n.useState(!1),[x,G]=n.useState(!1),[R,z]=n.useState(!1),[P,B]=n.useState(""),[E,V]=n.useState(!1),[O,L]=n.useState(!1),[N,H]=n.useState(!1),[J,U]=n.useState(!1),[X,Y]=n.useState(!1),[i,a]=n.useState(!1),[$,ue]=n.useState(!1),he=async()=>{if(X)L(!0);else try{await ps(Ve.appUrlAiEnabled,{}).then(t=>{var Z,_,Q,q,ge;p.debug(t),((Z=t==null?void 0:t.data)==null?void 0:Z.code)==="ok"&&((Q=(_=t==null?void 0:t.data)==null?void 0:_.data)==null?void 0:Q.enabled)===!0?(L(!0),Y(!0)):(H(!0),a(((ge=(q=t==null?void 0:t.data)==null?void 0:q.data)==null?void 0:ge.encryption)===!0))}).catch(t=>{p.error(t)})}catch(t){p.error(t)}};return n.useEffect(()=>{o.openAI&&o.openAI.prompt!==void 0&&o.openAI.queryKey===s&&he()},[o.openAI]),e.jsxs(e.Fragment,{children:[e.jsx(De,{position:"relative",sx:{margin:"0 0 5px 0",borderRadius:"4px"},children:e.jsxs(we,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:"20px"},children:[e.jsx(D,{title:"Choose the database to run your query against",placement:"top",children:e.jsx(y,{children:e.jsxs(Te,{value:r[s].schemaName,MenuProps:{id:"pp-select-database"},size:"small",sx:{width:"250px",backgroundColor:"#fff"},onChange:t=>{l(je({queryKey:s,query:{...r[s],schemaName:t.target.value}}))},children:[...S.databases.map(t=>e.jsx(b,{value:t.dbs,sx:{width:"250px"},children:t.dbs},t.dbs))]})})}),e.jsxs(m,{sx:{display:"flex",justifyContent:"start"},children:[e.jsx(D,{title:"Set a maximum number of rows to retrieve",children:e.jsxs(m,{sx:{display:"flex",justifyContent:"start"},children:[e.jsx(y,{children:e.jsx(w,{sx:{marginRight:"9px"},control:e.jsx(F,{checked:g,onClick:t=>{A(!g),t.preventDefault(),t.stopPropagation()},color:"secondary",sx:{"& svg":{fill:"#fff"}}}),label:"Max rows: "})}),e.jsx(ke,{customInput:I,value:C,disabled:!g,variant:"outlined",onValueChange:({value:t})=>{j(Number(t))},onInvalid:t=>{t.preventDefault()},sx:{"& input.MuiInputBase-input":{borderRadius:"4px",height:"8px",backgroundColor:"#fff",width:"55px",minHeight:"unset"},"& fieldset":{borderRadius:"4px"}}})]})}),e.jsx(D,{title:"Execute query",children:e.jsx(K,{sx:{color:"inherit",marginLeft:"8px"},onClick:()=>{d(!0),Ye(o.queries[s].schemaName,oe(o.queries[s].query),g?C.toString():"",o.protectWordPressTables,o.queries[s].params,t=>{p.debug(t),(t==null?void 0:t.code)==="ok"&&t.data?h(t.data):(p.error("Invalid response"),u("Invalid response",{variant:"error"})),d(!1)},t=>{p.error(t),u(t,{variant:"error"}),d(!1)})},children:v?e.jsx(m,{sx:{"& span.MuiCircularProgress-root":{width:"20px !important",height:"20px !important"},"& svg":{color:"#fff"}},children:e.jsx(qe,{})}):e.jsx(Me,{})})}),e.jsx(n.Suspense,{children:e.jsx(js,{queryKey:s,queryBuilderState:o})}),e.jsx(n.Suspense,{children:e.jsx(bs,{queryKey:s,queryBuilderState:o})})]})]}),e.jsxs(m,{sx:{display:"flex",flexDirection:"row"},children:[e.jsx(D,{title:"Save query",children:e.jsx(K,{sx:{color:"inherit"},onClick:()=>{Se(o.queries[s].access,o.queries[s].schemaName,o.queries[s].queryName,oe(o.queries[s].query),!1,"",o.queries[s].isInserting,o.queries[s].params,t=>{p.info(t),(t==null?void 0:t.code)==="ok"&&(l(je({queryKey:s,query:{...o.queries[s],isInserting:void 0},isUpdated:!1})),u("Query succesfully saved",{variant:"success"}))},t=>{p.error(t),u(t,{variant:"error"})})},children:e.jsx(He,{})})}),e.jsx(D,{title:"AI Assistant",children:e.jsx(K,{onClick:async()=>{he()},sx:{color:"inherit"},children:e.jsx(ze,{})})}),e.jsx(D,{title:"More actions",children:e.jsx(K,{sx:{color:"inherit",padding:0},onClick:t=>{c(t.currentTarget),t.stopPropagation()},children:e.jsx(Re,{})})}),e.jsxs(xs,{anchorEl:T,open:k,onClose:()=>c(null),sx:{zIndex:9999999999},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[e.jsxs(b,{onClick:()=>{c(null),G(!0)},disabled:r[s].isInserting===!0,children:[e.jsx(Ee,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Copy query"})]}),e.jsxs(b,{onClick:()=>{c(null),z(!0)},children:[e.jsx(Oe,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Rename query"})]}),e.jsxs(b,{onClick:()=>{c(null),V(!0)},sx:{color:(fe=M)==null?void 0:fe.palette.error.main},disabled:r[s].isInserting===!0,children:[e.jsx(Le,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Delete query"})]}),e.jsx(b,{divider:!0,sx:{margin:"8px 0",padding:0}}),e.jsxs(b,{onClick:()=>{c(null),ue(!0)},disabled:r[s].isInserting===!0,children:[e.jsx(Ne,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Schedule query"})]}),e.jsx(b,{divider:!0,sx:{margin:"8px 0",padding:0}}),e.jsxs(b,{onClick:()=>{f.current!==null&&f.current.click()},children:[e.jsx(_e,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Load from file"}),e.jsx("input",{ref:f,type:"file",onChange:t=>{if(t.target.files!==null){const Z=t.target.files[0];let _=new FileReader;_.onload=Q=>{const q=Q.target.result;l(Be({copyQuery:q}))},_.onerror=Q=>alert(Q.target.error.name),_.readAsText(Z)}},style:{height:0,width:0}})]}),e.jsxs(b,{onClick:()=>{ds(new Blob([r[s].query],{type:"text/sql;charset=utf-8"}),r[s].queryName+".sql")},children:[e.jsx(Qe,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Save to file"})]}),e.jsx(Ze,{text:r[s].query,onCopy:()=>{u("Query successfully copied to clipboard",{variant:"info"}),c(null)},children:e.jsxs(b,{children:[e.jsx(ms,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Copy to clipboard"})]})}),e.jsx(b,{divider:!0,sx:{margin:"8px 0",padding:0}}),e.jsxs(b,{onClick:()=>{l(ae({queryKey:s}))},children:[e.jsx(Fe,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Close query"})]})]})]})]})}),e.jsx(us,{queries:r,queryKey:s,copyDialog:x,setCopyDialog:G,newName:P,setNewName:B}),e.jsx(hs,{queries:r,queryKey:s,renameDialog:R,setRenameDialog:z,newName:P,setNewName:B}),e.jsx(fs,{queries:r,queryKey:s,confirmDelete:E,setConfirmDelete:V}),e.jsx(Ae,{title:"AI Assistant",message:e.jsx(m,{sx:{maxWidth:"430px"},children:"The AI Assistant is not yet enabled for your account. To start using it, you'll need to enter a valid API key. Would you like to configure the AI Assistant now?"}),open:N,setOpen:H,onConfirm:()=>{U(!0)}}),e.jsx(gs,{queryKey:s,queryBuilderState:o,scheduling:$,setScheduling:ue,limit:g?C.toString():""}),e.jsx(n.Suspense,{children:e.jsx(vs,{open:J,setOpen:U,encryption:i})}),e.jsx(n.Suspense,{children:e.jsx(Cs,{queryKey:s,open:O,setOpen:L})})]})};export{Wt as default};
