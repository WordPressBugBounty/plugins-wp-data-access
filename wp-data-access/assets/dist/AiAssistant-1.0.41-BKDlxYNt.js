const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./AiChat-1.0.41-iVggVz-B.js","./cm-1.0.41-DxZ4itL_.js","./redux-1.0.41-DJjpZqD1.js","./vendor-1.0.41-CN03Eozo.js","./index-1.0.41-CpXj521P.js","./iconBase-1.0.41-BNQFQdHp.js","./Typography-1.0.41-BIN1Ddvh.js","./lib-1.0.41-DFdWuh_n.js","./loglevel-1.0.41-BZ7XahX3.js","./lodash-1.0.41-Cd8grAqB.js","./moment-1.0.41-C5S46NFB.js","./useEnhancedEffect-1.0.41-BVsyj6AW.js","./notistack-1.0.41-Bq-EKqc7.js","./index-1.0.41-DIUNb9YZ.js","./ctc-1.0.41-D6Hg2DQJ.js","./hooks-1.0.41-sDnKeMy7.js","./Spinner-1.0.41-fWZy8imI.js","./Tooltip-1.0.41-g4uuOuci.js","./ThemeProvider-1.0.41-D1lNQgXT.js","./useControlled-1.0.41-BEhJe3xs.js","./Popper-1.0.41-Dl4_0sfD.js","./Link-1.0.41-yhMF_PSg.js","./AdminTheme-1.0.41-4tiUoVeb.js","./markdown-1.0.41-dNZTjvWI.js","./rehyperaw-1.0.41-YJYMuCoH.js"])))=>i.map(i=>d[i]);
import{_ as X}from"./main-1.0.41.js";import{j as e}from"./cm-1.0.41-DxZ4itL_.js";import{r as c}from"./redux-1.0.41-DJjpZqD1.js";import{B as Y,a as Z,D as ee,P as te}from"./ConfirmDialog-1.0.41-NKESMhfW.js";import{R as se,a as ie}from"./RestApi-1.0.41-CZ_yORv3.js";import{l as T,cR as re,C as Q,cb as oe}from"./lib-1.0.41-DFdWuh_n.js";import{l as ne,G as le,x as q,k as ae,aH as pe,aI as de,aJ as ce,aK as me,ai as xe,K as ue,M as he}from"./index-1.0.41-CpXj521P.js";import{A as L}from"./AdminTheme-1.0.41-4tiUoVeb.js";import{P as K}from"./index-1.0.41-fBbZNnTO.js";import{B as s}from"./Spinner-1.0.41-fWZy8imI.js";import{T as g}from"./Tooltip-1.0.41-g4uuOuci.js";import{I as y,P as ge}from"./iconBase-1.0.41-BNQFQdHp.js";import{A as _,a as F}from"./AccordionSummary-1.0.41-CY9CEWZQ.js";import{A as H}from"./AccordionDetails-1.0.41-DlUbOAS0.js";import{T as $,a as G}from"./ToggleButtonGroup-1.0.41-CS_43ZCw.js";import{T as U}from"./TextField-1.0.41-CGPjmVeQ.js";import{I as W}from"./InputAdornment-1.0.41-BaGp3m3T.js";import{P as fe,b as je,a as be}from"./index-1.0.41-Wbyk3QBm.js";import{u as N}from"./MainQueryBuilder-1.0.41-M8KmYGqb.js";import{a as V}from"./hooks-1.0.41-sDnKeMy7.js";import{P as Ae}from"./Menu-1.0.41-DBfdBNVU.js";import{F as we,a as Te}from"./FormHelperText-1.0.41-BPSj83yP.js";import{A as ye}from"./Autocomplete-1.0.41-82-5yXGC.js";import{e as Ie}from"./notistack-1.0.41-Bq-EKqc7.js";import"./vendor-1.0.41-CN03Eozo.js";import"./loglevel-1.0.41-BZ7XahX3.js";import"./lodash-1.0.41-Cd8grAqB.js";import"./moment-1.0.41-C5S46NFB.js";import"./Typography-1.0.41-BIN1Ddvh.js";import"./useEnhancedEffect-1.0.41-BVsyj6AW.js";import"./ThemeProvider-1.0.41-D1lNQgXT.js";import"./useControlled-1.0.41-BEhJe3xs.js";import"./Popper-1.0.41-Dl4_0sfD.js";import"./Collapse-1.0.41-QlMDtjRk.js";import"./Select-1.0.41-aTzlc-HZ.js";import"./utils-1.0.41-iop7lDec.js";import"./useFormControl-1.0.41-1E9QEnRo.js";import"./createSvgIcon-1.0.41-0lRWzB2Q.js";import"./FormLabel-1.0.41-CgxisugM.js";import"./index-1.0.41-Ca6zW1RM.js";import"./ActionsExplorer-1.0.41-DSAyrNr3.js";import"./DatabaseTypeEnum-1.0.41-DeJfpW1u.js";import"./Close-1.0.41-Dkp5SdDZ.js";import"./Chip-1.0.41-C0GI7jZZ.js";var A=(o=>(o.GPT35TURBO="gpt-3.5-turbo",o.GPT4TURBO="gpt-4-turbo",o))(A||{});const ve=()=>{const o=[{title:"Be Specific About the Goal",description:"Tell the AI exactly what you want to achieve.",vague:"Vague: Write a SQL query for users.",better:"Better: Write a SQL query to select the top 10 users with the highest total order amount from the `orders` table."},{title:"Include Table and Column Names",description:"The AI needs structure. Mention the exact table and column names if known.",vague:void 0,better:"Use button ADD TABLE DEFINITIONS to add the table definitions involved in your query. The structure of selected tables will be added to your request."},{title:"Mention Output Requirements",description:"What do you want to see in the result?",vague:void 0,better:"Write a SQL query that returns user names and their total number of orders. Only include users with more than 5 orders."},{title:"Add Filters, Sorting, Limits",description:"Make it clear how the data should be narrowed or ordered.",vague:void 0,better:"Show the latest 10 orders from the `orders` table, ordered by `created_at` descending."}],[d,i]=c.useState(!1);return e.jsxs(s,{children:[e.jsx(g,{title:"AI Tips",children:e.jsx(y,{size:"small",sx:{border:"1px solid rgba(0, 0, 0, 0.23)"},onClick:()=>{i(!0)},children:e.jsx(ne,{})})}),e.jsx(le,{open:d,onClose:()=>{i(!1)},children:e.jsxs(s,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"540px",boxShadow:24,maxHeight:"80vh",overflow:"auto","& ol":{marginLeft:0,paddingInlineStart:"15px"},"& ol li":{marginBottom:"30px"},"& ol li div":{whiteSpace:"wrap"}},children:[e.jsxs(_,{disableGutters:!0,children:[e.jsx(F,{expandIcon:e.jsx(q,{}),children:"Best ChatGPT model for SQL support"}),e.jsx(H,{children:e.jsxs("ol",{children:[e.jsx("li",{children:e.jsxs(s,{sx:{lineHeight:"20px"},children:[e.jsx("strong",{children:"gpt-3.5-turbo is fine for simple tasks or if you're optimizing for speed/cost"}),", but makes more syntax/logical mistakes in SQL."]})}),e.jsxs("li",{children:[e.jsxs(s,{sx:{lineHeight:"20px"},children:[e.jsx("strong",{children:"gpt-4-turbo is more accurate with SQL logic"}),", understands complex instructions better, and returns cleaner, more consistent results. gpt-4-turbo is more expensive."]}),e.jsx(s,{sx:{marginTop:"20px",textAlign:"right"},children:e.jsxs($,{size:"small",value:A.GPT4TURBO,disabled:!0,sx:{"& button":{whiteSpace:"nowrap",textTransform:"lowercase"}},children:[e.jsx(G,{value:A.GPT35TURBO,children:"gpt-3.5-turbo"}),e.jsx(G,{value:A.GPT4TURBO,children:"gpt-4-turbo"})]})})]})]})})]}),e.jsxs(_,{disableGutters:!0,children:[e.jsx(F,{expandIcon:e.jsx(q,{}),children:"Golden Rules for Writing Good SQL Prompts"}),e.jsx(H,{children:e.jsxs("ol",{children:[...o.map(n=>e.jsx("li",{children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:"10px"},children:[e.jsx(s,{children:e.jsx("strong",{children:n.title})}),e.jsx(s,{sx:{lineHeight:"20px"},children:n.description}),n.vague&&e.jsxs(s,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"5px"},children:[e.jsx(s,{children:"❌"}),n.vague]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"5px"},children:[e.jsx(s,{sx:{alignSelf:"start",lineHeight:"20px"},children:"✅"}),e.jsx(s,{sx:{alignSelf:"start",lineHeight:"20px"},children:n.better})]})]})}))]})})]})]})})]})},Se=({prompt:o,setPrompt:d,submit:i,loading:n,tables:t,setTables:l,chatMessages:m,model:x,setModel:u,explain:f,setExplain:I})=>{var v,w,S,j,k,C,M,D,R;return e.jsxs(s,{sx:{margin:"20px",border:"1px solid rgba(0, 0, 0, 0.23)",borderRadius:"4px"},children:[e.jsx(U,{value:o,onChange:h=>{d(h.target.value)},onKeyUp:h=>{h.key==="Enter"&&!h.shiftKey&&!n&&i()},placeholder:m.length>0?"":"Write a query to select [columns] from table [table] where [user description]",fullWidth:!0,multiline:!0,minRows:2,sx:{marginBottom:0,"& fieldset":{border:"none"},"&.MuiFormControl-root textarea":{fontSize:"14px"}}}),e.jsxs(s,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between",gap:"8px",alignItems:"center",padding:"8px"},children:[e.jsxs(s,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"8px"},children:[e.jsx(s,{children:e.jsx(ve,{})}),t.length>0&&e.jsx(g,{title:"Table definitions added to AI request",placement:"bottom",children:e.jsx(U,{value:t.join(","),disabled:!0,slotProps:{input:{startAdornment:e.jsx(W,{position:"end",sx:{fontSize:"1rem",padding:0,margin:0},children:e.jsx(K,{})}),endAdornment:e.jsx(W,{position:"end",sx:{fontSize:"1rem",padding:0,margin:"0 4px 0 0"},children:e.jsx(g,{title:"Clear table definitions",placement:"top",children:e.jsx(y,{size:"small",onClick:h=>{l([]),h.stopPropagation()},children:e.jsx(ae,{})})})})}},sx:{"& .MuiInputBase-root":{padding:"0 0 0 8px !important"},"& input":{padding:"8px 4px !important",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}})})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"8px"},children:[e.jsxs($,{size:"small",exclusive:!0,value:x,onChange:(h,P)=>{P!==null&&u(P)},sx:{"& button":{whiteSpace:"nowrap",textTransform:"lowercase"}},children:[e.jsx(g,{title:"Use gpt-3.5-turbo mode",children:e.jsx(G,{value:A.GPT35TURBO,children:"gpt-3.5-turbo"})}),e.jsx(g,{title:"Use gpt-4-turbo mode",children:e.jsx(G,{value:A.GPT4TURBO,children:"gpt-4-turbo"})})]}),e.jsx(g,{title:`Ask AI to add explanations (currently ${f?"enabled":"disabled"})`,children:e.jsx(y,{size:"small",sx:{border:"1px solid rgba(0, 0, 0, 0.23)"},onClick:()=>{I(!f)},children:f?e.jsx(pe,{}):e.jsx(de,{})})}),e.jsx(g,{title:"Send",children:e.jsx(y,{size:"small",onClick:i,disabled:!o.trim(),sx:{backgroundColor:(S=(w=(v=L)==null?void 0:v.palette)==null?void 0:w.primary)==null?void 0:S.dark,color:(C=(k=(j=L)==null?void 0:j.palette)==null?void 0:k.background)==null?void 0:C.default,border:"1px solid rgba(0, 0, 0, 0.23)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.54)"},"&.Mui-disabled":{border:"1px solid rgba(0, 0, 0, 0.07)",backgroundColor:"rgba(0, 0, 0, 0.23)",color:(R=(D=(M=L)==null?void 0:M.palette)==null?void 0:D.background)==null?void 0:R.default}},children:n?e.jsx(ce,{}):e.jsx(me,{})})})]})]})]})},Ce=()=>{const o=V(),d=N();return n=>{const t=d.queries[d.tabIndex];d.aiDefinitions[t==null?void 0:t.schemaName]===void 0&&se(Q.appUrlAiDefinitions,{dbs:n},l=>{T.debug(l),(l==null?void 0:l.code)==="ok"&&o(re({sqlSchemaName:n,aiDefinitions:l==null?void 0:l.data}))},l=>{T.error(l)})}},De=({tables:o,setTables:d})=>{const i=N(),n=Ce(),t=i.queries[i.tabIndex],l=i.aiDefinitions[t==null?void 0:t.schemaName],m=l?Object.keys(l).map(x=>x):[];return c.useEffect(()=>{i.aiDefinitions[t==null?void 0:t.schemaName]===void 0&&n(t==null?void 0:t.schemaName)},[i.tabIndex,t==null?void 0:t.schemaName,i.aiDefinitions[t==null?void 0:t.schemaName]]),e.jsx(fe,{variant:"popover",popupId:"popup-ai-help",children:x=>e.jsxs(s,{children:[e.jsxs(Y,{...je(x),variant:"outlined",color:"primary",children:[e.jsx(s,{children:"Add table definitions"}),e.jsx(xe,{})]}),e.jsx(Ae,{...be(x),anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(ge,{sx:{padding:"30px 20px 20px 20px"},children:e.jsxs(we,{fullWidth:!0,children:[e.jsx(ye,{multiple:!0,options:m,value:o,disableCloseOnSelect:!0,onChange:(u,f)=>{d(f),u.stopPropagation()},renderInput:u=>e.jsx(U,{...u,label:"Table List"}),sx:{width:"430px"}}),e.jsx(Te,{children:"The structure of the selected tables will be added your response."})]})})})]})})},Pe=({tables:o,setTables:d,fullScreen:i,setFullScreen:n,setOpen:t})=>e.jsxs(Z,{component:"div",sx:{margin:0,padding:"20px",display:"flex",justifyContent:"space-between",alignItems:"center","& svg":{height:"24px",width:"24px"}},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:"5px"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:"5px",cursor:"move"},id:"draggable-dialog-title",children:[e.jsx(K,{}),e.jsx(s,{children:"AI Assistant"})]}),e.jsx(g,{title:"Toggle full screen",children:e.jsx(y,{onClick:()=>{n(!i)},children:e.jsx(ue,{})})})]}),e.jsxs(s,{sx:{alignSelf:"end",display:"grid",gridTemplateColumns:"auto auto",alignItems:"center",gap:"5px"},children:[e.jsx(De,{tables:o,setTables:d}),e.jsx(g,{title:"Close AI Assistant",children:e.jsx(y,{onClick:()=>{t(!1)},children:e.jsx(he,{})})})]})]}),Be=c.lazy(()=>X(()=>import("./AiChat-1.0.41-iVggVz-B.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url)),wt=({queryKey:o,open:d,setOpen:i})=>{const n=V(),t=N(),l=[],[m,x]=c.useState(""),[u,f]=c.useState(l),[I,v]=c.useState(!1),[w,S]=c.useState([]),[j,k]=c.useState(!1),[C,M]=c.useState(A.GPT35TURBO),[D,R]=c.useState(!1);c.useEffect(()=>{var a,p;(a=t.openAI)!=null&&a.prompt&&((p=t.openAI)==null?void 0:p.queryKey)===o&&x(t.openAI.prompt)},[t.openAI]),c.useEffect(()=>{t.openAI&&t.openAI.prompt===m&&t.openAI.queryKey===o&&(P(),n(oe({prompt:void 0,queryKey:""})))},[m]);const h=new AbortController,P=async()=>{if(I)h.abort();else if(m.trim()!==""){v(!0);try{const a=t.queries[t.tabIndex],p=t.aiDefinitions[a.schemaName]===void 0?[]:w.map(r=>t.aiDefinitions[a.schemaName][r]).join(`;
`)+";",O=`${m}

${p?`Table definitions:
${p}`:""}`;T.debug(O),await ie(Q.appUrlAiAskSql,{prompt:O,model:C,explain:D},!1,h.signal).then(r=>{var b,B,E;T.debug(r),Array.isArray((b=r==null?void 0:r.data)==null?void 0:b.choices)?J(r.data):z((E=(B=r==null?void 0:r.data)==null?void 0:B.error)==null?void 0:E.message)}).catch(r=>{var b,B;T.error(r),z((B=(b=r==null?void 0:r.response)==null?void 0:b.data)==null?void 0:B.message)})}catch(a){T.error(a),Ie("Something went wrong. Please try again.",{variant:"error"})}finally{v(!1)}}},z=a=>{const p=[...u];p.push({message:m,type:"me"}),p.push({message:a,type:"ai",isError:!0}),f(p),x("")},J=a=>{const p=[...u];p.push({message:m,type:"me"}),a.choices.map(O=>{var r,b;p.push({message:((b=(r=O.message)==null?void 0:r.content)==null?void 0:b.trim())||"No response from ChatGPT.",type:"ai"})}),a!=null&&a.msg&&p.push({message:a.msg,type:"ai",isNote:!0}),f(p),x("")};return e.jsxs(ee,{open:d,onClose:()=>i(!1),PaperComponent:te,sx:{"& .MuiPaper-root":{display:"grid",gridTemplateRows:"auto 1fr auto",width:j?"100vw":"600px",height:j?"100vh":"600px",...j&&{maxWidth:"unset"}}},"aria-labelledby":"open-query-dialog",closeAfterTransition:!1,children:[e.jsx(Pe,{tables:w,setTables:S,fullScreen:j,setFullScreen:k,setOpen:i}),e.jsx(c.Suspense,{children:e.jsx(Be,{chatMessages:u,loading:I,fullScreen:j})}),e.jsx(Se,{prompt:m,setPrompt:x,submit:P,loading:I,tables:w,setTables:S,chatMessages:u,model:C,setModel:M,explain:D,setExplain:R})]})};export{wt as default};
