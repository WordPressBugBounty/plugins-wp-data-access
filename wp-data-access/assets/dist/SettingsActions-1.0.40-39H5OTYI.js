import{j as s}from"./cm-1.0.40-DO7MoydR.js";import{r as l}from"./redux-1.0.40-W_04YL6Z.js";import{b as pe}from"./RestApi-1.0.40-Uj1ofskP.js";import{l as o,b as c,aS as U,aQ as _,ao as $}from"./lib-1.0.40-CJM-IO_o.js";import{u as ce,T as u,d as ue,e as me,b as de,a as xe}from"./ActionsAdmin-1.0.40-CDUiJt-3.js";import{e as i}from"./notistack-1.0.40-HUa4vT_u.js";import{a as he}from"./hooks-1.0.40-DoKijNI1.js";import{B as x,C as k}from"./ConfirmDialog-1.0.40-DRjx8-xC.js";import{B as n,S as ge}from"./Spinner-1.0.40-Bmn0_C4u.js";import{k as je}from"./index-1.0.40-DlucSO_j.js";import{C as fe}from"./index-1.0.40-Beue_JiO.js";import{u as ve}from"./useExplorer-1.0.40-Bc0jqvLm.js";import{F as E,a as ye}from"./FormHelperText-1.0.40-D6buAdoc.js";import{I as z,T as R}from"./TextField-1.0.40-CejEr0KU.js";import{S as L}from"./Select-1.0.40-Db-Xnyoo.js";import{M as m}from"./MenuItem-1.0.40-UKMJrtYZ.js";import{F as J}from"./FormControlLabel-1.0.40-BH1qH5qy.js";import{S as X}from"./Switch-1.0.40-CJ3Ir4CS.js";import{T as we}from"./Tooltip-1.0.40-Czv1q8N-.js";import"./vendor-1.0.40-CN03Eozo.js";import"./loglevel-1.0.40-BZ7XahX3.js";import"./lodash-1.0.40-yZQKpWII.js";import"./moment-1.0.40-C5S46NFB.js";import"./iconBase-1.0.40-CH6TO7hF.js";import"./Typography-1.0.40-oRKYqE3b.js";import"./useEnhancedEffect-1.0.40-DvrM_gBo.js";import"./AdminTheme-1.0.40-B669Ow89.js";import"./index-1.0.40-DmMQghWt.js";import"./utils-1.0.40-iop7lDec.js";import"./useFormControl-1.0.40-BL8koKXQ.js";import"./FormLabel-1.0.40-DLOepjQ0.js";import"./Menu-1.0.40-BKp7UqHL.js";import"./ThemeProvider-1.0.40-D9QtC9zH.js";import"./useControlled-1.0.40-B7yPDtn1.js";import"./createSvgIcon-1.0.40-DryBVjDb.js";import"./SwitchBase-1.0.40-BQrnL2Sx.js";import"./Popper-1.0.40-Jt4gcDMJ.js";const ts=({dbs:r,tbl:a,typ:p,metaData:t})=>{var W,q,V,M,G,O,Q,H;o.debug(r,a,p,t);const h=he(),[g,K]=l.useState("sql"),[w,Y]=l.useState(!0),[v,Z]=l.useState(""),[N,D]=l.useState(r),[b,ee]=l.useState(""),[S,se]=l.useState(!0),[ne,I]=l.useState(!1),[re,P]=l.useState(!1),[ie,A]=l.useState(!1),[te,C]=l.useState(!1),oe=ve(),f=ce(),B=l.useMemo(()=>{const e=[];for(const d in f)e.push(d);return e},[f]);o.debug(B);const j=oe.selected,[y,F]=l.useState(f[r].pdsDbs===!0?((V=(q=(W=t==null?void 0:t.settings)==null?void 0:W.wp)==null?void 0:q.connect)==null?void 0:V.interval)??"":""),[T,ae]=l.useState(f[r].pdsDbs===!0?((O=(G=(M=t==null?void 0:t.settings)==null?void 0:M.wp)==null?void 0:G.connect)==null?void 0:O.unit)??"":""),le=e=>{pe.post(t.settings.wp.homea+"?action=wpda_pds_update_interval",e,{headers:{"Content-Type":"multipart/form-data"}}).then(d=>{o.error(e,d)}).catch(d=>{o.error("error",d)})};return s.jsxs(s.Fragment,{children:[s.jsxs(n,{sx:{margin:0,padding:0,"& .pp-action":{display:"grid",gridTemplateColumns:"150px 1fr",alignItems:"center",margin:0,padding:"30px",borderBottom:"1px solid #ddd"},"& .pp-action button":{width:"120px"}},children:[p===u.TABLE&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsxs("form",{action:t.settings.wp.home+"?action=wpda_export",method:"post",target:"_blank",children:[s.jsx("input",{type:"hidden",name:"type",value:"table"}),s.jsx("input",{type:"hidden",name:"wpdaschema_name",value:r}),s.jsx("input",{type:"hidden",name:"table_names",value:a}),s.jsx("input",{type:"hidden",name:"format_type",value:g}),s.jsx("input",{type:"hidden",name:"include_table_settings",value:g==="sql"&&w?"on":"off"}),s.jsx("input",{type:"hidden",name:"_wpnonce",value:t.settings.wp.aonce.split("-")[0]}),s.jsx(x,{variant:"contained",type:"submit",children:"Export"})]})}),s.jsxs(n,{sx:{display:"grid"},children:[s.jsxs(E,{children:[s.jsx(z,{variant:"outlined",children:"Export to"}),s.jsxs(L,{MenuProps:{id:"pp-select-menu"},label:"Export to",value:g,onChange:e=>{K(e.target.value)},children:[s.jsx(m,{value:"sql",children:"SQL"},"sql"),s.jsx(m,{value:"csv",children:"CSV"},"csv"),s.jsx(m,{value:"json",children:"JSON"},"json"),s.jsx(m,{value:"excel",children:"Excel"},"excel"),s.jsx(m,{value:"xml",children:"XML"},"xml")]})]}),s.jsx(J,{sx:{visibility:g==="sql"?"visible":"hidden",height:g==="sql"?"auto":0,marginTop:g==="sql"?"10px":0,marginLeft:0},control:s.jsx(X,{checked:w,onClick:e=>{Y(!w),e.stopPropagation()}}),label:"With table settings",labelPlacement:"end"})]})]}),j[r]!=="system"&&(j[r]!=="wp"||!t.settings.wp.tables.includes(a))&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsx(x,{variant:"contained",onClick:()=>{a!==v&&v.trim()!==""?I(!0):i("Nothing to rename",{variant:"error"})},children:"Rename"})}),s.jsx(n,{children:s.jsx(R,{label:p===u.TABLE?"New table name":"New view name",value:v,onChange:e=>{Z(e.target.value)},fullWidth:!0})})]}),p===u.TABLE&&s.jsxs(n,{className:"pp-action",children:[s.jsxs(n,{children:[s.jsx(x,{variant:"contained",onClick:()=>{b.trim()!==""?(C(!0),ue(r,N,a,b,S,e=>{if(o.debug(e),e!=null&&e.code&&(e==null?void 0:e.message)!==void 0)switch(e.code){case"ok":h(_({dbs:r})),i(e.message,{variant:"success"});break;case"info":i(e.message,{variant:"info"});break;default:o.error(e),i(e.message??c.contactSupport,{variant:"error"})}else o.error(e),i(c.contactSupport,{variant:"error"});C(!1)},e=>{o.error("error",e),i(e??c.contactSupport,{variant:"error"}),C(!1)})):i("Nothing to rename",{variant:"error"})},children:"Copy"}),s.jsx(J,{control:s.jsx(X,{checked:S,onClick:e=>{se(!S),e.stopPropagation()}}),label:"Copy data",labelPlacement:"end",sx:{height:"56px"}}),s.jsx(n,{sx:{display:te?"block":"none","& > div":{marginRight:"30px"},"& span.MuiCircularProgress-root, svg":{height:"20px !important",width:"20px !important"}},children:s.jsx(ge,{title:"Copying..."})})]}),s.jsxs(n,{sx:{display:"grid",gridGap:"10px"},children:[s.jsxs(E,{fullWidth:!0,children:[s.jsx(z,{variant:"outlined",children:"To database"}),s.jsxs(L,{MenuProps:{id:"pp-select-menu"},label:"To database",value:N,onChange:e=>{D(e.target.value)},children:[...B.map(e=>s.jsx(m,{value:e,children:e},e))]})]}),s.jsx(R,{label:"To table name",value:b,onChange:e=>{ee(e.target.value)},fullWidth:!0})]})]}),p===u.TABLE&&j[r]!=="system"&&(j[r]!=="wp"||!t.settings.wp.tables.includes(a))&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsx(x,{variant:"contained",onClick:()=>{P(!0)},children:"Truncate"})}),s.jsxs(n,{sx:{display:"grid",gridGap:"5px"},children:[s.jsx("span",{children:"Deletes all data permanently."}),s.jsx("strong",{children:"This action cannot be undone!"})]})]}),j[r]!=="system"&&(j[r]!=="wp"||!t.settings.wp.tables.includes(a))&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsx(x,{variant:"contained",onClick:()=>{A(!0)},children:"Drop"})}),s.jsxs(n,{sx:{display:"grid",gridGap:"5px"},children:[p==u.VIEW?s.jsx("span",{children:"Deletes view permanently."}):s.jsx("span",{children:"Deletes table and all data permanently."}),s.jsx("strong",{children:"This action cannot be undone!"})]})]}),p===u.TABLE&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsxs("form",{method:"POST",action:t.settings.wp.home+"?page=wpda_designer",children:[s.jsx("input",{type:"hidden",name:"action",value:"edit"}),s.jsx("input",{type:"hidden",name:"action2",value:"init"}),s.jsx("input",{type:"hidden",name:"wpda_schema_name",value:r}),s.jsx("input",{type:"hidden",name:"wpda_schema_name_re",value:r}),s.jsx("input",{type:"hidden",name:"wpda_table_name",value:a}),s.jsx("input",{type:"hidden",name:"wpda_table_name_re",value:a}),s.jsx("input",{type:"hidden",name:"_wpnonce",value:t.settings.wp.alter}),s.jsx("input",{type:"hidden",name:"page_number",value:"1"}),s.jsx("input",{type:"hidden",name:"caller",value:"dataexplorer"}),s.jsx(x,{variant:"contained",type:"submit",children:"ALTER"})]})}),s.jsx(n,{sx:{display:"grid",gridGap:"5px"},children:"Loads table into the Data Designer."})]}),f[r].pdsDbs===!0&&((H=(Q=t==null?void 0:t.settings)==null?void 0:Q.wp)==null?void 0:H.connect)!==!1&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsx(x,{variant:"contained",onClick:()=>{if(y!==""&&y>0&&T!==""){const e=new FormData;e.append("wpnonce",t.settings.wp.refresh),e.append("schema_name",r),e.append("table_name",a),e.append("interval",y.toString()),e.append("unit",T),le(e)}else i("Please enter valid scheduled update values",{variant:"error"})},children:"Refresh"})}),s.jsxs(n,{sx:{display:"grid",gridGap:"5px"},children:[s.jsx(n,{children:"Next scheduled update"}),s.jsxs(n,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",justifyContent:"start",alignItems:"center",gap:"5px"},children:[s.jsx(R,{type:"number",slotProps:{htmlInput:{min:0}},value:y,autoComplete:"off",onChange:e=>{const d=e.target.value.replaceAll("-","");F(d===""?"":Number(d))}}),s.jsxs(L,{MenuProps:{id:"pp-select-menu"},value:T,onChange:e=>{ae(e.target.value)},children:[s.jsx(m,{value:""}),s.jsx(m,{value:"hour",children:"hour"}),s.jsx(m,{value:"day",children:"day"})]})]}),s.jsx(E,{children:s.jsx(ye,{children:"Enter and press REFRESH to apply"})})]})]}),t.create!==""&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsx(fe,{text:t.create,onCopy:()=>{i("SQL successfully copied to your clipboard",{variant:"info"})},children:s.jsx(we,{title:"Copy SQL to clipboard",children:s.jsx(x,{variant:"contained",endIcon:s.jsx(je,{}),sx:{display:"flex",alignItems:"flex-start","& svg":{width:"50%"}},children:"SQL"})})})}),s.jsx(n,{sx:{display:"grid",gridGap:"5px"},children:s.jsx(n,{sx:{whiteSpace:"pre-wrap",fontSize:"70%"},children:t.create})})]})]}),s.jsx(k,{title:`Rename ${p===u.VIEW?"view":"table"}?`,message:"This can affect existing apps using this table!",open:ne,setOpen:I,onConfirm:()=>{me(r,a,v,e=>{if(o.debug(e),e!=null&&e.code&&(e==null?void 0:e.message)!==void 0)switch(e.code){case"ok":p===u.VIEW?h(U({dbs:r})):h(_({dbs:r})),h($()),i(e.message,{variant:"success"});break;case"info":i(e.message,{variant:"info"});break;default:o.error(e),i(e.message??c.contactSupport,{variant:"error"})}else o.error(e),i(c.contactSupport,{variant:"error"})},e=>{o.error("error",e),i(e??c.contactSupport,{variant:"error"})})}}),s.jsx(k,{title:"Truncate table?",message:"This action cannot be undone!",open:re,setOpen:P,onConfirm:()=>{de(r,a,e=>{if(o.debug(e),e!=null&&e.code&&(e==null?void 0:e.message)!==void 0)switch(e.code){case"ok":i(e.message,{variant:"success"});break;case"info":i(e.message,{variant:"info"});break;default:o.error(e),i(e.message??c.contactSupport,{variant:"error"})}else o.error(e),i(c.contactSupport,{variant:"error"})},e=>{o.error("error",e),i(e??c.contactSupport,{variant:"error"})})}}),s.jsx(k,{title:`Drop ${p===u.VIEW?"view":"table"}?`,message:"This action cannot be undone!",open:ie,setOpen:A,onConfirm:()=>{xe(r,a,p,e=>{if(o.debug(e),e!=null&&e.code&&(e==null?void 0:e.message)!==void 0)switch(e.code){case"ok":p===u.VIEW?h(U({dbs:r})):h(_({dbs:r})),h($()),i(e.message,{variant:"success"});break;case"info":i(e.message,{variant:"info"});break;default:o.error(e),i(e.message??c.contactSupport,{variant:"error"})}else o.error(e),i(c.contactSupport,{variant:"error"})},e=>{o.error("error",e),i(e??c.contactSupport,{variant:"error"})})}})]})};export{ts as default};
