const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Alert-1.0.37-DRzJfdQS.js","./cm-1.0.37-CEr77VZi.js","./redux-1.0.37-C4JSQ-MG.js","./vendor-1.0.37-CN03Eozo.js","./index-1.0.37-LxgxH_yq.js","./iconBase-1.0.37-DRohixw7.js","./Typography-1.0.37-DjtXWQnP.js","./lib-1.0.37-Czwr-8r3.js","./loglevel-1.0.37-BZ7XahX3.js","./lodash-1.0.37-Dx3wKrSf.js","./moment-1.0.37-C5S46NFB.js","./useEnhancedEffect-1.0.37-UwysO4qr.js","./AlertTitle-1.0.37-BCo6eK8b.js","./createSvgIcon-1.0.37-DXsAQOmB.js","./Close-1.0.37-Yr1E1-6A.js","./Settings-1.0.37-DjVOk-rW.js","./main-1.0.37.js","./notistack-1.0.37-CEqipxDI.js","./hooks-1.0.37-DW0_oiBB.js","./TabPanel-1.0.37-CPE-1h3v.js","./index-1.0.37-B60ShF2d.js","./Spinner-1.0.37-CwhfSVqI.js","./ConfirmDialog-1.0.37-BDQ_OfRf.js","./AdminTheme-1.0.37-7PLndQ8H.js","./Menu-1.0.37-Ca8DeoO3.js","./ThemeProvider-1.0.37-Cyf1xy26.js","./MenuItem-1.0.37-JkRcsicb.js","./useThemeProps-1.0.37-CD9ZXLtG.js","./getThemeProps-1.0.37-BGc0S4YC.js","./Tooltip-1.0.37-D_uDknxi.js","./Tooltip-1.0.37--D4jr2go.css","./ActionsSettings-1.0.37-DQdLIvID.js","./RestApi-1.0.37-CcjslynE.js","./TargetEnum-1.0.37-CIW1jlU5.js","./DynamicModeEnum-1.0.37-BXuL5kgA.js","./settings-1.0.37-Bx2jvYL6.css"])))=>i.map(i=>d[i]);
import{_ as be}from"./main-1.0.37.js";import{j as d}from"./cm-1.0.37-CEr77VZi.js";import{r as i,R as S}from"./redux-1.0.37-C4JSQ-MG.js";import{r as Le,e as $}from"./notistack-1.0.37-CEqipxDI.js";import{g as je}from"./vendor-1.0.37-CN03Eozo.js";import{a6 as Re,l as E,aa as ze,d as Fe,ab as Be,_ as De,a5 as Ue,r as He,Z as Ge,C as Je,a9 as Ze,ac as D,ad as $e}from"./lib-1.0.37-Czwr-8r3.js";import{u as Ke,a as Ce}from"./hooks-1.0.37-DW0_oiBB.js";import{a as qe}from"./AdminTheme-1.0.37-7PLndQ8H.js";import{a as Ve}from"./RestApi-1.0.37-CcjslynE.js";import"./dompurify-1.0.37-DhD2mIk-.js";import"./moment-1.0.37-C5S46NFB.js";import{u as We,A as Ye}from"./AppTheme-1.0.37-DOXnENpA.js";import{u as Xe,a as Qe,L as et}from"./useRemoveAppFromStore-1.0.37-HphIv4xo.js";import{A as tt,T as Me,f as nt,M as rt}from"./index-1.0.37-B60ShF2d.js";import{B as ee,S as ot}from"./Spinner-1.0.37-CwhfSVqI.js";import{T as de}from"./Tooltip-1.0.37-BLWvlO4a.js";import{I as fe}from"./iconBase-1.0.37-DRohixw7.js";import{F as it}from"./FallbackSpinner-1.0.37-DAc7pvnM.js";import{u as at}from"./useTheme-1.0.37-D4xQQypV.js";import{a as st}from"./index-1.0.37-CgPwljr5.js";import{S as lt}from"./Select-1.0.37-B5ZKqjeL.js";import{M as ut}from"./MenuItem-1.0.37-JkRcsicb.js";import{T as ct,a as me}from"./ToggleButtonGroup-1.0.37-BCHx2oZO.js";import{T as ge}from"./ThemeProvider-1.0.37-Cyf1xy26.js";import"./loglevel-1.0.37-BZ7XahX3.js";import"./lodash-1.0.37-Dx3wKrSf.js";import"./Typography-1.0.37-DjtXWQnP.js";import"./index-1.0.37-D4zhytA1.js";import"./getThemeProps-1.0.37-BGc0S4YC.js";import"./useEnhancedEffect-1.0.37-UwysO4qr.js";import"./lang-1.0.37-CfHlhLgz.js";import"./useControlled-1.0.37-DyimEgDk.js";import"./Popper-1.0.37-CSsNCozr.js";import"./Menu-1.0.37-Ca8DeoO3.js";import"./utils-1.0.37-iop7lDec.js";import"./useFormControl-1.0.37-BcUwa2qz.js";import"./createSvgIcon-1.0.37-DXsAQOmB.js";var Q,pe;function dt(){return pe||(pe=1,Q=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var n,o,a;if(Array.isArray(t)){if(n=t.length,n!=r.length)return!1;for(o=n;o--!==0;)if(!e(t[o],r[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(a=Object.keys(t),n=a.length,n!==Object.keys(r).length)return!1;for(o=n;o--!==0;)if(!Object.prototype.hasOwnProperty.call(r,a[o]))return!1;for(o=n;o--!==0;){var l=a[o];if(!e(t[l],r[l]))return!1}return!0}return t!==t&&r!==r}),Q}var ft=dt();const mt=je(ft);function N(){return N=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},N.apply(null,arguments)}function U(e,t){if(e==null)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.indexOf(n)!==-1)continue;r[n]=e[n]}return r}function gt(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function pt(e){var t=gt(e,"string");return typeof t=="symbol"?t:t+""}const z={NOT_LOADED:"NOT_LOADED",LOADING:"LOADING",LOADED:"LOADED",FAILED:"FAILED",AUTH_FAILURE:"AUTH_FAILURE"},ht="https://maps.googleapis.com/maps/api/js";class K{static async load(t,r){var n;const o=t.libraries?t.libraries.split(","):[],a=this.serializeParams(t);this.listeners.push(r),(n=window.google)!=null&&(n=n.maps)!=null&&n.importLibrary?(this.serializedApiParams||(this.loadingStatus=z.LOADED),this.notifyLoadingStatusListeners()):(this.serializedApiParams=a,this.initImportLibrary(t)),this.serializedApiParams&&this.serializedApiParams!==a&&console.warn("[google-maps-api-loader] The maps API has already been loaded with different parameters and will not be loaded again. Refresh the page for new values to have effect.");const l=["maps",...o];await Promise.all(l.map(s=>google.maps.importLibrary(s)))}static serializeParams(t){return[t.v,t.key,t.language,t.region,t.authReferrerPolicy,t.solutionChannel].join("/")}static initImportLibrary(t){if(window.google||(window.google={}),window.google.maps||(window.google.maps={}),window.google.maps.importLibrary){console.error("[google-maps-api-loader-internal]: initImportLibrary must only be called once");return}let r=null;const n=()=>r||(r=new Promise((o,a)=>{var l;const s=document.createElement("script"),c=new URLSearchParams;for(const[m,f]of Object.entries(t)){const L=m.replace(/[A-Z]/g,C=>"_"+C[0].toLowerCase());c.set(L,String(f))}c.set("loading","async"),c.set("callback","__googleMapsCallback__"),s.async=!0,s.src=ht+"?"+c.toString(),s.nonce=((l=document.querySelector("script[nonce]"))==null?void 0:l.nonce)||"",s.onerror=()=>{this.loadingStatus=z.FAILED,this.notifyLoadingStatusListeners(),a(new Error("The Google Maps JavaScript API could not load."))},window.__googleMapsCallback__=()=>{this.loadingStatus=z.LOADED,this.notifyLoadingStatusListeners(),o()},window.gm_authFailure=()=>{this.loadingStatus=z.AUTH_FAILURE,this.notifyLoadingStatusListeners()},this.loadingStatus=z.LOADING,this.notifyLoadingStatusListeners(),document.head.append(s)}),r);google.maps.importLibrary=o=>n().then(()=>google.maps.importLibrary(o))}static notifyLoadingStatusListeners(){for(const t of this.listeners)t(this.loadingStatus)}}K.loadingStatus=z.NOT_LOADED;K.serializedApiParams=void 0;K.listeners=[];const vt=["onLoad","onError","apiKey","version","libraries"],yt=["children"],bt="GMP_visgl_rgmlibrary_v1_default",q=S.createContext(null);function Lt(){const[e,t]=i.useState({});return{mapInstances:e,addMapInstance:(a,l="default")=>{t(s=>N({},s,{[l]:a}))},removeMapInstance:(a="default")=>{t(l=>U(l,[a].map(pt)))},clearMapInstances:()=>{t({})}}}function Ct(e){const{onLoad:t,onError:r,apiKey:n,version:o,libraries:a=[]}=e,l=U(e,vt),[s,c]=i.useState(K.loadingStatus),[m,f]=i.useReducer((u,b)=>u[b.name]?u:N({},u,{[b.name]:b.value}),{}),L=i.useMemo(()=>a==null?void 0:a.join(","),[a]),C=i.useMemo(()=>JSON.stringify(N({apiKey:n,version:o},l)),[n,o,l]),y=i.useCallback(async u=>{var b;if(m[u])return m[u];if(!((b=google)!=null&&(b=b.maps)!=null&&b.importLibrary))throw new Error("[api-provider-internal] importLibrary was called before google.maps.importLibrary was defined.");const M=await window.google.maps.importLibrary(u);return f({name:u,value:M}),M},[m]);return i.useEffect(()=>{(async()=>{try{const u=N({key:n},l);o&&(u.v=o),(L==null?void 0:L.length)>0&&(u.libraries=L),(u.channel===void 0||u.channel<0||u.channel>999)&&delete u.channel,u.solutionChannel===void 0?u.solutionChannel=bt:u.solutionChannel===""&&delete u.solutionChannel,await K.load(u,b=>c(b));for(const b of["core","maps",...a])await y(b);t&&t()}catch(u){r?r(u):console.error("<ApiProvider> failed to load the Google Maps JavaScript API",u)}})()},[n,L,C]),{status:s,loadedLibraries:m,importLibrary:y}}const Mt=e=>{const{children:t}=e,r=U(e,yt),{mapInstances:n,addMapInstance:o,removeMapInstance:a,clearMapInstances:l}=Lt(),{status:s,loadedLibraries:c,importLibrary:m}=Ct(r),f=i.useMemo(()=>({mapInstances:n,addMapInstance:o,removeMapInstance:a,clearMapInstances:l,status:s,loadedLibraries:c,importLibrary:m}),[n,o,a,l,s,c,m]);return S.createElement(q.Provider,{value:f},t)};function kt(e,t){for(const r of It){const n=t[r],o=ke[r];i.useEffect(()=>{if(!e||!n)return;const a=google.maps.event.addListener(e,o,l=>{n(xt(o,e,l))});return()=>a.remove()},[e,o,n])}}function xt(e,t,r){const n={type:e,map:t,detail:{},stoppable:!1,stop:()=>{}};if(Et.includes(e)){const a=n,l=t.getCenter(),s=t.getZoom(),c=t.getHeading()||0,m=t.getTilt()||0,f=t.getBounds();return(!l||!f||!Number.isFinite(s))&&console.warn("[createEvent] at least one of the values from the map returned undefined. This is not expected to happen. Please report an issue at https://github.com/visgl/react-google-maps/issues/new"),a.detail={center:(l==null?void 0:l.toJSON())||{lat:0,lng:0},zoom:s||0,heading:c,tilt:m,bounds:(f==null?void 0:f.toJSON())||{north:90,east:180,south:-90,west:-180}},a}else if(St.includes(e)){var o;if(!r)throw new Error("[createEvent] mouse events must provide a srcEvent");const a=n;return a.domEvent=r.domEvent,a.stoppable=!0,a.stop=()=>r.stop(),a.detail={latLng:((o=r.latLng)==null?void 0:o.toJSON())||null,placeId:r.placeId},a}return n}const ke={onBoundsChanged:"bounds_changed",onCenterChanged:"center_changed",onClick:"click",onContextmenu:"contextmenu",onDblclick:"dblclick",onDrag:"drag",onDragend:"dragend",onDragstart:"dragstart",onHeadingChanged:"heading_changed",onIdle:"idle",onIsFractionalZoomEnabledChanged:"isfractionalzoomenabled_changed",onMapCapabilitiesChanged:"mapcapabilities_changed",onMapTypeIdChanged:"maptypeid_changed",onMousemove:"mousemove",onMouseout:"mouseout",onMouseover:"mouseover",onProjectionChanged:"projection_changed",onRenderingTypeChanged:"renderingtype_changed",onTilesLoaded:"tilesloaded",onTiltChanged:"tilt_changed",onZoomChanged:"zoom_changed",onCameraChanged:"bounds_changed"},Et=["bounds_changed","center_changed","heading_changed","tilt_changed","zoom_changed"],St=["click","contextmenu","dblclick","mousemove","mouseout","mouseover"],It=Object.keys(ke);function _t(e,t){const r=i.useRef(void 0);(!r.current||!mt(t,r.current))&&(r.current=t),i.useEffect(e,r.current)}const Ot=new Set(["backgroundColor","clickableIcons","controlSize","disableDefaultUI","disableDoubleClickZoom","draggable","draggableCursor","draggingCursor","fullscreenControl","fullscreenControlOptions","gestureHandling","headingInteractionEnabled","isFractionalZoomEnabled","keyboardShortcuts","mapTypeControl","mapTypeControlOptions","mapTypeId","maxZoom","minZoom","noClear","panControl","panControlOptions","restriction","rotateControl","rotateControlOptions","scaleControl","scaleControlOptions","scrollwheel","streetView","streetViewControl","streetViewControlOptions","styles","tiltInteractionEnabled","zoomControl","zoomControlOptions"]);function At(e,t){const r={},n=Object.keys(t);for(const o of n)Ot.has(o)&&(r[o]=t[o]);_t(()=>{e&&e.setOptions(r)},[r])}function xe(){var e;return((e=i.useContext(q))==null?void 0:e.status)||z.NOT_LOADED}function wt(e,t){const{viewport:r,viewState:n}=t,o=!!r;return i.useLayoutEffect(()=>{if(!e||!n)return;const{latitude:a,longitude:l,bearing:s,pitch:c,zoom:m}=n;e.moveCamera({center:{lat:a,lng:l},heading:s,tilt:c,zoom:m+1})},[e,n]),o}function Nt(e){return!e||typeof e!="object"||!("lat"in e&&"lng"in e)?!1:Number.isFinite(e.lat)&&Number.isFinite(e.lng)}function Ee(e){return Nt(e)?e:e.toJSON()}function Pt(e,t,r){const n=r.center?Ee(r.center):null;let o=null,a=null;n&&Number.isFinite(n.lat)&&Number.isFinite(n.lng)&&(o=n.lat,a=n.lng);const l=Number.isFinite(r.zoom)?r.zoom:null,s=Number.isFinite(r.heading)?r.heading:null,c=Number.isFinite(r.tilt)?r.tilt:null;i.useLayoutEffect(()=>{if(!e)return;const m={};let f=!1;o!==null&&a!==null&&(t.current.center.lat!==o||t.current.center.lng!==a)&&(m.center={lat:o,lng:a},f=!0),l!==null&&t.current.zoom!==l&&(m.zoom=l,f=!0),s!==null&&t.current.heading!==s&&(m.heading=s,f=!0),c!==null&&t.current.tilt!==c&&(m.tilt=c,f=!0),f&&e.moveCamera(m)})}const Tt=()=>{const e={position:"absolute",top:0,left:0,bottom:0,right:0,zIndex:999,display:"flex",flexFlow:"column nowrap",textAlign:"center",justifyContent:"center",fontSize:".8rem",color:"rgba(0,0,0,0.6)",background:"#dddddd",padding:"1rem 1.5rem"};return S.createElement("div",{style:e},S.createElement("h2",null,"Error: AuthFailure"),S.createElement("p",null,"A problem with your API key prevents the map from rendering correctly. Please make sure the value of the ",S.createElement("code",null,"APIProvider.apiKey")," prop is correct. Check the error-message in the console for further details."))};function jt(){const[e,t]=i.useState(null),r=i.useCallback(n=>t(n),[t]);return[e,r]}function Se(){return xe()===z.LOADED}function Rt(){const[,e]=i.useReducer(t=>t+1,0);return e}function zt(e,t){const r=e.getCenter(),n=e.getZoom(),o=e.getHeading()||0,a=e.getTilt()||0,l=e.getBounds();(!r||!l||!Number.isFinite(n))&&console.warn("[useTrackedCameraState] at least one of the values from the map returned undefined. This is not expected to happen. Please report an issue at https://github.com/visgl/react-google-maps/issues/new"),Object.assign(t.current,{center:(r==null?void 0:r.toJSON())||{lat:0,lng:0},zoom:n||0,heading:o,tilt:a})}function Ft(e){const t=Rt(),r=i.useRef({center:{lat:0,lng:0},heading:0,tilt:0,zoom:0});return i.useEffect(()=>{if(!e)return;const n=google.maps.event.addListener(e,"bounds_changed",()=>{zt(e,r),t()});return()=>n.remove()},[e,t]),r}const Bt=["id","defaultBounds","defaultCenter","defaultZoom","defaultHeading","defaultTilt","reuseMaps","renderingType","colorScheme"],Dt=["padding"];class X{static has(t){return this.entries[t]&&this.entries[t].length>0}static pop(t){return this.entries[t]&&this.entries[t].pop()||null}static push(t,r){this.entries[t]||(this.entries[t]=[]),this.entries[t].push(r)}}X.entries={};function Ut(e,t){const r=Se(),[n,o]=i.useState(null),[a,l]=jt(),s=Ft(n),{id:c,defaultBounds:m,defaultCenter:f,defaultZoom:L,defaultHeading:C,defaultTilt:y,reuseMaps:u,renderingType:b,colorScheme:M}=e,k=U(e,Bt),O=e.zoom!==void 0||e.defaultZoom!==void 0,P=e.center!==void 0||e.defaultCenter!==void 0;!m&&(!O||!P)&&console.warn("<Map> component is missing configuration. You have to provide zoom and center (via the `zoom`/`defaultZoom` and `center`/`defaultCenter` props) or specify the region to show using `defaultBounds`. See https://visgl.github.io/react-google-maps/docs/api-reference/components/map#required"),!k.center&&f&&(k.center=f),!k.zoom&&Number.isFinite(L)&&(k.zoom=L),!k.heading&&Number.isFinite(C)&&(k.heading=C),!k.tilt&&Number.isFinite(y)&&(k.tilt=y);for(const _ of Object.keys(k))k[_]===void 0&&delete k[_];const A=i.useRef(void 0);return i.useEffect(()=>{if(!a||!r)return;const{addMapInstance:_,removeMapInstance:p}=t,{mapId:w}=e,T=`${w||"default"}:${b||"default"}:${M||"LIGHT"}`;let j,I;if(u&&X.has(T)?(I=X.pop(T),j=I.getDiv(),a.appendChild(j),I.setOptions(k),setTimeout(()=>I.setCenter(I.getCenter()),0)):(j=document.createElement("div"),j.style.height="100%",a.appendChild(j),I=new google.maps.Map(j,N({},k,b?{renderingType:b}:{},M?{colorScheme:M}:{}))),o(I),_(I,c),m){const{padding:H}=m,B=U(m,Dt);I.fitBounds(B,H)}else(!O||!P)&&I.fitBounds({east:180,west:-180,south:-90,north:90});if(A.current){const{mapId:H,cameraState:B}=A.current;H!==w&&I.setOptions(B)}return()=>{A.current={mapId:w,cameraState:s.current},j.remove(),u?X.push(T,I):google.maps.event.clearInstanceListeners(I),o(null),p(c)}},[a,r,c,e.mapId,e.renderingType,e.colorScheme]),[n,l,s]}const Ie=S.createContext(null),_e=e=>{const{children:t,id:r,className:n,style:o}=e,a=i.useContext(q),l=xe();if(!a)throw new Error("<Map> can only be used inside an <ApiProvider> component.");const[s,c,m]=Ut(e,a);Pt(s,m,e),kt(s,e),At(s,e);const f=wt(s,e),L=!!e.controlled;i.useEffect(()=>{if(s)return f&&s.setOptions({disableDefaultUI:!0}),(f||L)&&s.setOptions({gestureHandling:"none",keyboardShortcuts:!1}),()=>{s.setOptions({gestureHandling:e.gestureHandling,keyboardShortcuts:e.keyboardShortcuts})}},[s,f,L,e.gestureHandling,e.keyboardShortcuts]);const C=e.center?Ee(e.center):null;let y=null,u=null;C&&Number.isFinite(C.lat)&&Number.isFinite(C.lng)&&(y=C.lat,u=C.lng);const b=i.useMemo(()=>{var O,P,A,_,p;return{center:{lat:(O=y)!=null?O:0,lng:(P=u)!=null?P:0},zoom:(A=e.zoom)!=null?A:0,heading:(_=e.heading)!=null?_:0,tilt:(p=e.tilt)!=null?p:0}},[y,u,e.zoom,e.heading,e.tilt]);i.useLayoutEffect(()=>{if(!s||!L)return;s.moveCamera(b);const O=s.addListener("bounds_changed",()=>{s.moveCamera(b)});return()=>O.remove()},[s,L,b]);const M=i.useMemo(()=>N({width:"100%",height:"100%",position:"relative",zIndex:f?-1:0},o),[o,f]),k=i.useMemo(()=>({map:s}),[s]);return l===z.AUTH_FAILURE?S.createElement("div",{style:N({position:"relative"},n?{}:M),className:n},S.createElement(Tt,null)):S.createElement("div",N({ref:c,"data-testid":"map",style:n?void 0:M,className:n},r?{id:r}:{}),s?S.createElement(Ie.Provider,{value:k},t):null)};_e.deckGLViewProps=!0;const he=new Set;function te(...e){const t=JSON.stringify(e);he.has(t)||(he.add(t),console.error(...e))}const Oe=(e=null)=>{const t=i.useContext(q),{map:r}=i.useContext(Ie)||{};if(t===null)return te("useMap(): failed to retrieve APIProviderContext. Make sure that the <APIProvider> component exists and that the component you are calling `useMap()` from is a sibling of the <APIProvider>."),null;const{mapInstances:n}=t;return e!==null?n[e]||null:r||n.default||null};function Ht(e){const t=Se(),r=i.useContext(q);return i.useEffect(()=>{!t||!r||r.importLibrary(e)},[t,r,e]),(r==null?void 0:r.loadedLibraries[e])||null}function W(e,t,r){i.useEffect(()=>{if(!e||!t||!r)return;const n=google.maps.event.addListener(e,t,r);return()=>n.remove()},[e,t,r])}function Y(e,t,r){i.useEffect(()=>{e&&(e[t]=r)},[e,t,r])}function ve(e,t,r){i.useEffect(()=>{if(!(!e||!t||!r))return e.addEventListener(t,r),()=>e.removeEventListener(t,r)},[e,t,r])}function Gt(e){return e.nodeType===Node.ELEMENT_NODE}const Ae=S.createContext(null),Jt={BOTTOM:["50%","100%"]},Zt=({children:e,styles:t,className:r,anchorPoint:n})=>{const[o,a]=n??Jt.BOTTOM;let l=`-${o}`,s=`-${a}`;o.trimStart().startsWith("-")&&(l=o.substring(1)),a.trimStart().startsWith("-")&&(s=a.substring(1));const c=`translate(50%, 100%) translate(${l}, ${s})`;return S.createElement("div",{style:{transform:c}},S.createElement("div",{className:r,style:t},e))};function $t(e){const[t,r]=i.useState(null),[n,o]=i.useState(null),a=Oe(),l=Ht("marker"),{children:s,onClick:c,className:m,onMouseEnter:f,onMouseLeave:L,onDrag:C,onDragStart:y,onDragEnd:u,collisionBehavior:b,clickable:M,draggable:k,position:O,title:P,zIndex:A}=e,_=i.Children.count(s);return i.useEffect(()=>{if(!a||!l)return;const p=new l.AdvancedMarkerElement;p.map=a,r(p);let w=null;return _>0&&(w=document.createElement("div"),w.isCustomMarker=!0,p.content=w,o(w)),()=>{var T;p.map=null,(T=w)==null||T.remove(),r(null),o(null)}},[a,l,_]),i.useEffect(()=>{!t||!t.content||_>0||(t.content.className=m||"")},[t,m,_]),Y(t,"position",O),Y(t,"title",P??""),Y(t,"zIndex",A),Y(t,"collisionBehavior",b),i.useEffect(()=>{t&&(k!==void 0?t.gmpDraggable=k:C||y||u?t.gmpDraggable=!0:t.gmpDraggable=!1)},[t,k,C,u,y]),i.useEffect(()=>{if(!t)return;const p=M!==void 0||!!c||!!f||!!L;t.gmpClickable=p,p&&t!=null&&t.content&&Gt(t.content)&&(t.content.style.pointerEvents="none",t.content.firstElementChild&&(t.content.firstElementChild.style.pointerEvents="all"))},[t,M,c,f,L]),W(t,"click",c),W(t,"drag",C),W(t,"dragstart",y),W(t,"dragend",u),ve(t==null?void 0:t.element,"mouseenter",f),ve(t==null?void 0:t.element,"mouseleave",L),[t,n]}const Kt=i.forwardRef((e,t)=>{const{children:r,style:n,className:o,anchorPoint:a}=e,[l,s]=$t(e),c=i.useMemo(()=>l?{marker:l}:null,[l]);return i.useImperativeHandle(t,()=>l,[l]),s?S.createElement(Ae.Provider,{value:c},Le.createPortal(S.createElement(Zt,{anchorPoint:a,styles:n,className:o},r),s)):null});function qt(){const[e,t]=i.useState(null);return[i.useCallback(n=>{t(n)},[]),e]}const Vt=["onClick","onDrag","onDragStart","onDragEnd","onMouseOver","onMouseOut"];function Wt(e){const[t,r]=i.useState(null),n=Oe(),{onClick:o,onDrag:a,onDragStart:l,onDragEnd:s,onMouseOver:c,onMouseOut:m}=e,f=U(e,Vt),{position:L,draggable:C}=f;return i.useEffect(()=>{if(!n){n===void 0&&console.error("<Marker> has to be inside a Map component.");return}const y=new google.maps.Marker(f);return y.setMap(n),r(y),()=>{y.setMap(null),r(null)}},[n]),i.useEffect(()=>{if(!t)return;const y=t,u=google.maps.event;return o&&u.addListener(y,"click",o),a&&u.addListener(y,"drag",a),l&&u.addListener(y,"dragstart",l),s&&u.addListener(y,"dragend",s),c&&u.addListener(y,"mouseover",c),m&&u.addListener(y,"mouseout",m),t.setDraggable(!!C),()=>{u.clearInstanceListeners(y)}},[t,C,o,a,l,s,c,m]),i.useEffect(()=>{t&&f&&t.setOptions(f)},[t,f]),i.useEffect(()=>{C||!L||!t||t.setPosition(L)},[C,L,t]),t}i.forwardRef((e,t)=>{const r=Wt(e);return i.useImperativeHandle(t,()=>r,[r]),S.createElement(S.Fragment,null)});const Yt=e=>{var t;const r=(t=i.useContext(Ae))==null?void 0:t.marker,n=i.useMemo(()=>document.createElement("div"),[]);return i.useEffect(()=>{var o;if(!r){r===void 0&&console.error("The <Pin> component can only be used inside <AdvancedMarker>.");return}e.glyph&&e.children&&te("The <Pin> component only uses children to render the glyph if both the glyph property and children are present."),i.Children.count(e.children)>1&&te("Passing multiple children to the <Pin> component might lead to unexpected results.");const a=N({},e),l=new google.maps.marker.PinElement(a);e.children&&(l.glyph=n);const s=(o=r.content)==null||(o=o.firstChild)==null?void 0:o.firstChild;for(;s!=null&&s.firstChild;)s.removeChild(s.firstChild);s&&s.appendChild(l.element)},[r,n,e]),Le.createPortal(e.children,n)},we=({mapData:e,poi:t,markerOptions:r,isRoot:n})=>{const[o,a]=qt(),[l,s]=i.useState(!1),[c,m]=i.useState(!1),[f,L]=i.useState(void 0);i.useEffect(()=>{},[e.userInteraction.markerInteraction.enabled,e.userInteraction.markerInteraction.style.background,c,l]);const[C,y]=i.useState(void 0);i.useEffect(()=>{},[e.userInteraction.markerInteraction.enabled,e.userInteraction.markerInteraction.style.borderColor,c,l]);const[u,b]=i.useState(void 0);i.useEffect(()=>{},[e.userInteraction.markerInteraction.enabled,e.userInteraction.markerInteraction.style.glyphColor,c,l]);const[M,k]=i.useState(0);return i.useEffect(()=>{},[e.userInteraction.markerInteraction.enabled,e.userInteraction.markerInteraction.scale,c,l]),isNaN(t.location.lat)||isNaN(t.location.lng)?null:d.jsxs(d.Fragment,{children:[d.jsx(Kt,{ref:o,title:t.title,position:{lat:Number(t.location.lat),lng:Number(t.location.lng)},onMouseEnter:()=>{e.userInteraction.markerInteraction.enabled&&m(!0)},onMouseLeave:()=>{e.userInteraction.markerInteraction.enabled&&m(!1)},onClick:()=>{s(!l)},className:"pp-marker"+(n===!0?" pp-root-marker":""),zIndex:c||l?1:void 0,children:d.jsx(Yt,{background:f,borderColor:C,glyph:r.glyph,glyphColor:u,scale:(r.scale??1)+(c||l?M:0)})},t.key),!1]})},Xt={background:void 0,borderColor:void 0,glyph:void 0,glyphColor:void 0,scale:void 0},Ne=e=>Re({},Xt,e),Qt=({mapData:e,rows:t})=>{var n;const r=o=>Ne({});return((n=e==null?void 0:e.state)==null?void 0:n.locations)===void 0?null:d.jsx(d.Fragment,{children:e.state.locations.map((o,a)=>o?d.jsx(we,{mapData:e,poi:o,markerOptions:r()},o.key):null)})},en=e=>{const t=Ke(r=>r.maps[e]);return E.debug("mapData",t),t},tn=({appId:e,title:t,showToolBar:r,isExploring:n,isBuilderEnabled:o,appLanguage:a,elevation:l})=>{const s=Ce(),c=Xe();return d.jsx(d.Fragment,{children:r&&d.jsx(tt,{className:"pp-header",elevation:l,position:"relative",sx:{margin:"0 0 5px 0",borderRadius:"4px"},children:d.jsxs(Me,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[d.jsx(ee,{sx:{display:"block",whiteSpace:"nowrap",fontSize:"18px",lineHeight:"18px",fontWeight:"bold",textOverflow:"ellipsis",overflow:"hidden",marginRight:"10px"},children:t}),d.jsxs(ee,{sx:{display:"flex",gap:"10px",justifyContent:"center",alignItems:"center"},children:[o&&d.jsx(de,{title:"Map Builder",className:"pp-builder-button",children:d.jsx(fe,{sx:{color:"inherit",padding:0},onClick:()=>{s(ze({appId:e}))},children:d.jsx(nt,{})})}),n&&d.jsx(de,{title:a.close,children:d.jsx(fe,{sx:{color:"inherit",padding:0},onClick:()=>{s(Fe({isActive:!1,appDbId:0})),s(Be({appId:e})),c(e),s(De())},children:d.jsx(rt,{})})})]})]})})})},nn=({mapRadius:e,setMapRadius:t,radiusUnit:r,setRadiusUnit:n,searchRadius:o})=>d.jsxs(Me,{className:"pp-map-toolbar",sx:{justifyContent:"end",alignItems:"center",gap:"12px","&.pp-map-toolbar":{paddingRight:"12px"}},children:[d.jsxs(lt,{MenuProps:{id:"pp-map-radius"},value:e,sx:{height:"40px",background:"none padding-box rgb(255, 255, 255)","& svg":{width:"40px"}},onChange:a=>{t(Number(a.target.value))},startAdornment:d.jsx(st,{}),children:[...o.map(a=>d.jsx(ut,{value:a,children:a},a))]}),d.jsxs(ct,{value:r,exclusive:!0,onChange:(a,l)=>{l!==null&&n(l)},sx:{height:"40px",background:"none padding-box rgb(255, 255, 255)"},children:[d.jsx(me,{value:"km",children:"KM"}),d.jsx(me,{value:"miles",children:"Miles"})]})]}),ye=i.lazy(()=>be(()=>import("./Alert-1.0.37-DRzJfdQS.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url)),rn=i.lazy(()=>be(()=>import("./Settings-1.0.37-DjVOk-rW.js").then(e=>e.S),__vite__mapDeps([15,16,1,2,3,17,7,8,9,10,18,19,5,6,11,20,21,22,23,24,25,26,27,28,29,30,31,32,33,4,34,35]),import.meta.url)),Hn=({appId:e,appDbId:t})=>{var ne,re,oe,ie,ae,se,le,ue;E.debug(e,t);const r=Ce(),n=en(e),o=We(e),a=Qe(e),l=qe(),s=et,c=at(),m=Ye(c,He.table,Ue.form),[f,L]=i.useState([]),[C,y]=i.useState(!1),[u,b]=i.useState(n.initialLocation.static),[M,k]=i.useState({lat:void 0,lng:void 0});i.useEffect(()=>{n.initialLocation.static||(navigator.geolocation?navigator.geolocation.getCurrentPosition(g=>{g.coords===void 0?(E.error("ERROR - Could not determine user location"),$("Could not determine user location",{variant:"error"})):k({lat:g.coords.latitude,lng:g.coords.longitude}),b(!0)},g=>{E.error("ERROR - ",g),$(g.message,{variant:"error"}),b(!0)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):(E.error("Geolocation is not supported by this browser."),$("Geolocation is not supported by this browser",{variant:"error"}),b(!0)))},[]);const[O,P]=i.useState(n.userInteraction.defaultRadius),[A,_]=i.useState(n.userInteraction.distanceUnit),p=i.useMemo(()=>{var h,v,x,R,F,G,J,Z;let g={};try{g=JSON.parse((v=(h=o==null?void 0:o.app)==null?void 0:h.app[0])==null?void 0:v.app_settings)}catch(V){g={apiKey:"",columnLatitude:"",columnLongitude:""},E.error("Invalid JSON - app settings"),E.error(V),$("Invalid JSON, check console",{variant:"error"})}return{apiKey:(R=(x=g==null?void 0:g.settings)==null?void 0:x.app_map)==null?void 0:R.api_key,columnLatitude:(G=(F=g==null?void 0:g.settings)==null?void 0:F.app_map)==null?void 0:G.column_latitude,columnLongitude:(Z=(J=g==null?void 0:g.settings)==null?void 0:J.app_map)==null?void 0:Z.column_longitude}},[e,(re=(ne=o==null?void 0:o.app)==null?void 0:ne.app[0])==null?void 0:re.app_settings]),w=i.useMemo(()=>{var h;let g={};try{const v=JSON.parse((h=o==null?void 0:o.app)==null?void 0:h.container[0].cnt_cls);Array.isArray(v)&&v.map(x=>{x.columnName&&x.isSelected!==void 0&&(g[x.columnName]=x.isSelected)})}catch(v){E.error("Invalid JSON - map columns"),E.error(v),$("Invalid JSON, check console",{variant:"error"})}return g},[]),T=i.useMemo(()=>Ge(o),[e]);i.useEffect(()=>{u&&j()},[u,O,A]);const j=async()=>{var g,h;await Ve(Je.appUrlAppSelect,{client_side:!0,app_id:(g=o==null?void 0:o.src)==null?void 0:g.app_id,cnt_id:(h=o==null?void 0:o.src)==null?void 0:h.cnt_id,col:w,media:[],search_data_types:(()=>{const v={};return Object.keys(w).map(x=>{const R=o==null?void 0:o.columns.filter(F=>F.column_name===x);if(Array.isArray(R)&&R.length===1)return v[x]=R[0].data_type}),v})(),geo_radius:n.userInteraction.enabled?(()=>{const v=B();return{col:{lat:p.columnLatitude,lng:p.columnLongitude},loc:{lat:v==null?void 0:v.lat,lng:v==null?void 0:v.lng},radius:O,unit:A}})():{}}).then(v=>{var R,F,G,J,Z,V,ce;E.debug(v),Array.isArray((R=v==null?void 0:v.data)==null?void 0:R.data)&&L(v.data.data);let x={};if(((G=(F=o==null?void 0:o.app)==null?void 0:F.app[0])==null?void 0:G.app_theme)!==void 0&&((Z=(J=o==null?void 0:o.app)==null?void 0:J.app[0])==null?void 0:Z.app_theme)!==null&&((ce=(V=o==null?void 0:o.app)==null?void 0:V.app[0])==null?void 0:ce.app_theme)!=="")try{x=JSON.parse(o.app.app[0].app_theme)}catch(Te){E.error("Invalid JSON - theme settings"),E.error(Te)}x===!1&&(x={}),E.debug(x),r(Ze({appId:e,themeState:x}))}).catch(v=>{E.error(v)})},I=g=>{if(g.toLocaleUpperCase().startsWith("POINT("))return g.substring(6,g.length-1).split(" ")[0]},H=g=>{if(g.toLocaleUpperCase().startsWith("POINT("))return g.substring(6,g.length-1).split(" ")[1]};if(i.useEffect(()=>{const g=f.filter(h=>h[p.columnLatitude]!==null&&h[p.columnLongitude]!==null&&(p.columnLatitude===p.columnLongitude||!isNaN(h[p.columnLatitude])&&!isNaN(h[p.columnLongitude]))).map(h=>{if(E.debug(h),p.columnLatitude===p.columnLongitude){const v=I(h[p.columnLatitude]),x=H(h[p.columnLongitude]);if(v&&x)return{key:String(h[p.columnLatitude]),location:{lat:Number(v),lng:Number(x)},title:D(n.mapMarkers.marker.title,h),header:D(n.mapMarkers.marker.header,h),content:D(n.mapMarkers.marker.content,h)}}else return{key:String(h[p.columnLatitude])+String(h[p.columnLongitude]),location:{lat:Number(h[p.columnLatitude]),lng:Number(h[p.columnLongitude])},title:D(n.mapMarkers.marker.title,h),header:D(n.mapMarkers.marker.header,h),content:D(n.mapMarkers.marker.content,h)}});r($e({appId:e,property:{locations:g}}))},[n.mapMarkers.marker,f]),p.columnLatitude==""||p.columnLongitude=="")return d.jsx(i.Suspense,{children:d.jsx(ye,{severity:"error",message:"Latitude and/or longitude column not defined - use App Manager to fix issue",close:!1})});if(p.apiKey==="")return d.jsx(i.Suspense,{children:d.jsx(ye,{severity:"error",message:"Missing Google Maps API Key - use App Manager to fix issue",close:!1})});const B=()=>{if(n.initialLocation.static&&!isNaN(n.initialLocation.staticMarker.location.lat)&&!isNaN(n.initialLocation.staticMarker.location.lng))return{lat:Number(n.initialLocation.staticMarker.location.lat),lng:Number(n.initialLocation.staticMarker.location.lng)};if(M.lat&&M.lng)return{lat:M.lat,lng:M.lng}},Pe=()=>Ne({});return u?d.jsxs(ee,{className:"pp-container-map",sx:{...((oe=n==null?void 0:n.setup)==null?void 0:oe.width)&&((ie=n==null?void 0:n.setup)==null?void 0:ie.widthUnit)&&((ae=n==null?void 0:n.setup)==null?void 0:ae.height)&&((se=n==null?void 0:n.setup)==null?void 0:se.heightUnit)&&{"&.pp-container-map":{width:n.setup.width+n.setup.widthUnit,height:n.setup.height+n.setup.heightUnit}}},children:[d.jsx(ge,{theme:m,children:d.jsx(Mt,{apiKey:p.apiKey,onLoad:()=>{E.debug("Google Maps API has loaded..."),y(!0)},onError:g=>{E.error(g),E.error("Make sure your Google Maps API key is correctly entered in the App Manager and correctly defined in your Google Cloud Platform Console.")},children:C&&d.jsxs(d.Fragment,{children:[d.jsx(tn,{appId:e,title:((ue=(le=o==null?void 0:o.app)==null?void 0:le.app[0])==null?void 0:ue.app_title)??"Map Builder",showToolBar:!0,isExploring:(o==null?void 0:o.isExploring)===!0,isBuilderEnabled:T,appLanguage:s,elevation:4}),n.userInteraction.enabled&&d.jsx(nn,{mapRadius:O,setMapRadius:P,radiusUnit:A,setRadiusUnit:_,searchRadius:n.userInteraction.searchRadius}),d.jsxs(_e,{mapId:e,mapTypeId:n.setup.startMode,fullscreenControl:a==null?void 0:a.allowFullScreen,defaultCenter:B(),defaultZoom:n.setup.initialZoom,gestureHandling:n.setup.gestureHandling,disableDefaultUI:!n.setup.googleMapsButtons,style:{width:"100%",height:"100%"},children:[n.initialLocation.showStaticMarker&&(n.initialLocation.static||M.lat!==void 0&&M.lng!==void 0)&&d.jsx(we,{mapData:n,poi:n.initialLocation.static?n.initialLocation.staticMarker:{key:"user-location",location:{lat:M.lat??0,lng:M.lng??0},title:n.initialLocation.staticMarker.title,header:n.initialLocation.staticMarker.header,content:n.initialLocation.staticMarker.content},markerOptions:Pe(),isRoot:!0}),d.jsx(Qt,{mapData:n,rows:f})]})]})})}),T&&d.jsx(i.Suspense,{fallback:d.jsx(ot,{}),children:d.jsx(ge,{theme:l,children:d.jsx(rn,{appId:e})})})]}):d.jsx(it,{})};export{Hn as default};
