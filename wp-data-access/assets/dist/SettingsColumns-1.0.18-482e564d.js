import{j as e,d8 as Z,l as h,r as M,a2 as I,S as ee,d9 as ie,cE as R,C as q,cD as x,da as se,y as te,ac as ae,db as ne,dc as re,dd as oe,de as le,k as f,df as de,dg as ce,dh as me,di as pe,dj as ue}from"./main-1.0.18.js";import{u as B,S as xe,a as ge,I as z,b as he,c as je,d as H,D as fe,e as be,f as ye,g as Se,h as ve,T as ke,M as Te,P as we}from"./useMetadataColumns-1.0.18-3cad9c2e.js";import{u as Ae}from"./useTableSortableColumns-1.0.18-89de4e60.js";import{a as A,u as J}from"./RestApi-1.0.18-cb72bd79.js";import{j as Ee}from"./index.esm-1.0.18-32f5cee0.js";import{v as U,w as Pe,k as Ne,_ as Me,$ as De,a0 as Le,t as Ce,a1 as Fe,a2 as Re,a3 as Oe,a4 as Be,a5 as Ue,a6 as _e}from"./index.esm-1.0.18-12f13c4a.js";import{T as P,C as Ge}from"./ConfirmDialog-1.0.18-eb1f3988.js";import{u as E}from"./useTableUpdater-1.0.18-089ef7f9.js";import{B as c}from"./Spinner-1.0.18-de8df990.js";import{F as w}from"./FormLabel-1.0.18-47dbe87d.js";import{S as Y}from"./Slider-1.0.18-32b00bb2.js";import{F as S,a as v}from"./FormHelperText-1.0.18-8b4ce85f.js";import{P as Q}from"./PremiumFeature-1.0.18-2f6283b7.js";import{u as We}from"./useStoreTable-1.0.18-8a593f98.js";import{A as $}from"./AdminTheme-1.0.18-73e13a4f.js";import{c as Ve,d as ze,b as He}from"./index.esm-1.0.18-1950fc28.js";import{A as _,a as G}from"./AccordionSummary-1.0.18-f9e114cf.js";import{A as W}from"./AccordionDetails-1.0.18-2900e110.js";import{F as k}from"./FormControlLabel-1.0.18-2840e084.js";import{S as T}from"./Switch-1.0.18-cbb6329b.js";import{R as qe}from"./RadioGroup-1.0.18-4960e4a8.js";import{R as O}from"./Radio-1.0.18-210e4079.js";import{T as D}from"./TextField-1.0.18-cf148b4e.js";import{L as Qe}from"./Link-1.0.18-41cc6055.js";import{A as b,a as y}from"./AggregationLabelsEnum-1.0.18-30d037e3.js";import{A as Xe}from"./Autocomplete-1.0.18-a264f80a.js";import{C as Je}from"./Checkbox-1.0.18-3ed60478.js";import{I as N}from"./iconBase-1.0.18-3c21f5e2.js";import{D as Ye}from"./useTheme-1.0.18-c1f3f722.js";import"./useFormStore-1.0.18-a2e1b6cf.js";import"./CardContent-1.0.18-3d5e5525.js";import"./Typography-1.0.18-dc3c0740.js";import"./ActionsDml-1.0.18-7e1a74e9.js";import"./MenuItem-1.0.18-0088f2a2.js";import"./Menu-1.0.18-e8cb0649.js";import"./ThemeProvider-1.0.18-247b72cc.js";import"./Popover-1.0.18-54868205.js";import"./Modal-1.0.18-870f459d.js";import"./Grow-1.0.18-4ebc2ce8.js";import"./index-1.0.18-bd94b546.js";import"./Stepper-1.0.18-05ecefbc.js";import"./createSvgIcon-1.0.18-dcf0276e.js";import"./StepContent-1.0.18-147bdc81.js";import"./Collapse-1.0.18-8e581380.js";import"./DialogContent-1.0.18-5570cba4.js";import"./useFormControl-1.0.18-87a8487d.js";import"./index-1.0.18-ff546563.js";import"./useControlled-1.0.18-12a74006.js";import"./useSlot-1.0.18-71f9e7ae.js";import"./createStyled-1.0.18-b238c9ff.js";import"./SwitchBase-1.0.18-e2aa3211.js";import"./Close-1.0.18-d90e9fa7.js";import"./Popper-1.0.18-20544c9b.js";import"./colorManipulator-1.0.18-95bf61ec.js";const $e=({appId:t,columnIndex:o,tableColumn:i})=>{const l=A(),s=E(t);return e.jsxs(c,{sx:{margin:"0 1rem 2rem 1rem"},children:[e.jsx(w,{children:"Width"}),e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"1fr auto",gridGap:"30px",alignItems:"center"},children:[e.jsx(Y,{min:60,max:420,step:1,value:i.width,marks:[{value:60,label:"60"},{value:120,label:"120"},{value:180,label:"180"},{value:240,label:"240"},{value:300,label:"320"},{value:360,label:"360"},{value:420,label:"420"}],valueLabelDisplay:"auto",onChange:(a,p)=>{l(Z({appId:t,index:o,width:p})),s(!0),a.stopPropagation()}}),e.jsx("span",{children:"px"})]}),e.jsx(S,{children:e.jsxs(v,{children:["Column width is relative when responsiveness = ",e.jsx("strong",{children:"auto column hiding"}),"."]})})]})},Ke=({appId:t,columnIndex:o,tableColumn:i})=>{var n,j,L,C,F;h.debug(t,o,i),A();const l=We(t),s=M.useMemo(()=>I(ee.getState(),t),[]);B(t,s);const[a,p]=M.useState(!1),d=J(m=>ie(m,t));M.useState(!1),E(t);const u=!0;return e.jsxs(_,{disableGutters:!0,children:[e.jsxs(G,{expandIcon:e.jsx(U,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(Ve,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Column actions"})]}),e.jsxs(W,{sx:{display:"grid",paddingTop:"1rem"},children:[e.jsxs(c,{sx:{margin:"0 10px",display:"grid",gridTemplateColumns:"auto"},children:[i.computedField?e.jsx(k,{control:e.jsx(T,{checked:!1,disabled:!0}),label:"Enable inline search",labelPlacement:"end"}):e.jsx(k,{control:e.jsx(T,{checked:i.inlineSearch&&!u,disabled:u,onChange:(m,V)=>{m.stopPropagation()}}),label:"Enable column filter",labelPlacement:"end"}),i.inlineSearch&&!u&&e.jsxs(c,{children:[e.jsxs(qe,{sx:{flexDirection:"column",alignContent:"flex-start",marginLeft:"20px",marginTop:"10px",marginBottom:"10px"},children:[e.jsxs(w,{className:"align-label-radio",children:[e.jsx(O,{checked:i.inlineSearchEnum===R.SEARCHBOX,disabled:!0,onChange:m=>{m.stopPropagation()}}),"Searchbox"]}),e.jsxs(w,{className:"align-label-radio",children:[e.jsx(O,{checked:i.inlineSearchEnum===R.DROPDOWN,disabled:!0,onChange:m=>{m.stopPropagation()}}),"Drop-down list"]}),e.jsxs(w,{className:"align-label-radio",children:[e.jsx(O,{checked:i.inlineSearchEnum===R.MULTISELECT,disabled:!0,onChange:m=>{m.stopPropagation()}}),"Multi-select drop-down list"]}),e.jsxs(w,{className:"align-label-radio",children:[e.jsx(O,{checked:i.inlineSearchEnum===R.SEARCHPANE,disabled:!0,onChange:m=>{m.stopPropagation()}}),"Search pane"]})]}),i.lookup!==void 0&&((n=i.lookup)==null?void 0:n.loadOnStartup)!==!0&&e.jsx(S,{sx:{marginBottom:"20px",marginLeft:"5px"},children:e.jsxs(v,{sx:{color:(j=$)==null?void 0:j.palette.error.main,"& svg":{marginRight:"5px",verticalAlign:"middle"}},children:[e.jsx(Pe,{size:"18px"}),e.jsx("span",{children:"Drop-down lists are only supported for lookups loaded into memory on startup."})]})}),e.jsx(D,{fullWidth:!0,type:"number",label:"Order",value:i.columnFilterOrder,helperText:"Position of column filter in search panel.",disabled:!0,onChange:m=>{m.stopPropagation()},sx:{marginLeft:"15px",marginBottom:"20px"}})]}),((L=s==null?void 0:s.privs)==null?void 0:L.update)&&s.primary_key.length>0&&e.jsx(e.Fragment,{children:!i.computedField&&!i.columnName.startsWith(q.relationTablePrefix)&&!(((C=l==null?void 0:l.state)==null?void 0:C.masterDetailConditions)!==void 0&&((F=l==null?void 0:l.state)==null?void 0:F.masterDetailConditions[i.columnName])!==void 0)?e.jsx(k,{control:e.jsx(T,{checked:d&&i.visible&&i.inlineEditing,disabled:!0,onChange:(m,V)=>{m.stopPropagation()}}),label:"Enable inline editing",labelPlacement:"end"}):e.jsx(k,{control:e.jsx(T,{checked:!1,disabled:!0}),label:"Enable inline editing",labelPlacement:"end"})})]}),!1,e.jsxs(v,{component:"div",sx:{marginTop:"30px"},children:[e.jsx(c,{children:e.jsxs(Qe,{sx:{textDecoration:"none",cursor:"pointer",display:"inline-flex","& svg":{fontSize:"1rem",marginRight:"2px"}},onClick:()=>p(!a),children:[e.jsx(Ne,{}),"What are column actions?"]})}),a&&e.jsxs(c,{sx:{marginTop:"20px",display:"grid",gap:"20px"},children:[e.jsx(c,{children:"Column actions are inline actions added to a table column to enhance usability and user-friendliness."}),e.jsx(c,{children:e.jsx("strong",{children:"Column filtering"})}),e.jsx(c,{children:"When column filtering is enabled, a search field is added to the table for performing column-specific searches. A search box allows wildcard searches, while drop-down lists perform exact searches. Exact searches can improve performance, especially when the searched columns are well-indexed."}),e.jsx(c,{children:"To enable the column filter feature, go to the TABLE section under Column Filters. You can also change the position of the column filters."}),e.jsx(c,{children:"The global filter performs a wildcard search. This feature can be disabled in the TABLE section under Global filter."}),e.jsx(c,{children:e.jsx("strong",{children:"Inline editing"})}),e.jsx(c,{children:"Inline editing allows users to change table columns directly, without needing to open a data entry form. This feature is not available for primary key fields. Drop-down lists are automatically generated for enum and set data types."})]})]}),e.jsx(Q,{})]})]})},Ze=({appId:t,columnIndex:o,tableColumn:i})=>{var d,u;const l=A(),s=E(t),a=B(t),p=(n,j)=>{h.debug(n,j)};return e.jsxs(_,{disableGutters:!0,children:[e.jsxs(G,{expandIcon:e.jsx(U,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(ze,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Column settings"})]}),e.jsxs(W,{sx:{display:"grid",gridGap:"2rem",paddingTop:"1rem"},children:[(i.computedField||a[i.columnName]!==void 0&&(x(a[i.columnName].data_type)==="float"||x(a[i.columnName].data_type)==="number"||x(a[i.columnName].data_type)==="time"||x(a[i.columnName].data_type,!0)==="date"||x(a[i.columnName].data_type,!0)==="datetime"||x(a[i.columnName].data_type,!0)==="timestamp"||x(a[i.columnName].data_type,!0)==="time"))&&e.jsx(c,{children:e.jsxs(S,{children:[e.jsx(k,{control:e.jsx(T,{checked:!1,disabled:!0,onClick:n=>{n.stopPropagation()}}),label:"Localize",labelPlacement:"end"}),e.jsx(v,{children:i.computedField||a[i.columnName]!==void 0&&(x(a[i.columnName].data_type)==="float"||x(a[i.columnName].data_type)==="number")?"Localizes decimal and thousands seperators.":"Localizes date and time fields."})]})}),(a[i.columnName]!==void 0&&x(a[i.columnName].data_type,!0)==="float"||i.computedField!==void 0)&&e.jsxs(S,{children:[e.jsx(w,{children:"Decimals"}),e.jsx(Y,{min:0,max:6,value:i.decimals,marks:[{value:0,label:"0"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"},{value:5,label:"5"},{value:6,label:"∞"}],valueLabelDisplay:"auto",disabled:!0,onChange:(n,j)=>{h.debug(j),n.stopPropagation()}}),e.jsx(v,{children:"Number of decimals displayed."})]}),a[i.columnName]!==void 0&&i.localize&&(x(a[i.columnName].data_type,!0)==="datetime"||x(a[i.columnName].data_type,!0)==="timestamp")&&e.jsx(c,{children:x(a[i.columnName].data_type)==="date"&&e.jsx(S,{children:e.jsx(k,{control:e.jsx(T,{checked:!1,disabled:!0,onClick:n=>{n.stopPropagation()}}),label:"Add trailing zeros to days and month",labelPlacement:"end"})})}),e.jsxs(S,{children:[e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"10px",alignItems:"center"},children:[e.jsx(D,{type:"text",variant:"outlined",label:"Prefix",value:i.prefix,disabled:!0,InputLabelProps:{shrink:!0},onChange:n=>{n.stopPropagation()}}),e.jsx(D,{type:"text",variant:"outlined",label:"Suffix",value:i.suffix,disabled:!0,InputLabelProps:{shrink:!0},onChange:n=>{n.stopPropagation()}})]}),e.jsx(v,{children:"Adds a prefix and/or suffix to the column content (also added to inline text and number fields)."})]}),e.jsxs(S,{children:[e.jsx(D,{type:"text",variant:"outlined",label:"CSS classes",fullWidth:!0,value:i.classNames,disabled:!0,InputLabelProps:{shrink:!0},onChange:n=>{n.stopPropagation()}}),e.jsx(v,{children:"CSS classes (seperated by spaces) for custom styling."})]}),e.jsxs(S,{children:[e.jsx(k,{control:e.jsx(T,{checked:i.allowMarkup,onChange:(n,j)=>{l(se({appId:t,index:o,allowMarkup:j})),s(!0),n.stopPropagation()}}),label:"Allow inline HTML",labelPlacement:"end"}),e.jsxs(v,{children:["Allows markup in column content. ",e.jsx("span",{style:{...i.allowMarkup&&{color:((u=(d=$)==null?void 0:d.palette)==null?void 0:u.error.main)??"red"}},children:"Enabling this feature may pose a risk of cross-site scripting (XSS) attacks."})]})]}),e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"auto"},children:[e.jsx(k,{control:e.jsx(T,{checked:!1,disabled:!0,onClick:n=>{te.appFeature===!0&&p(o,!i.visibleTablet),n.stopPropagation()}}),label:"Show column on tablet",labelPlacement:"end"}),e.jsx(k,{control:e.jsx(T,{checked:!1,disabled:!0,onClick:n=>{n.stopPropagation()}}),label:"Show column on mobile",labelPlacement:"end"})]}),e.jsx(Q,{single:!1,margin:"0"})]})]})},Ie=[{key:b.SUM,label:y.SUM},{key:b.MIN,label:y.MIN},{key:b.MAX,label:y.MAX},{key:b.AVG,label:y.AVG},{key:b.COUNT,label:y.COUNT},{key:b.UNIQUE,label:y.UNIQUE},{key:b.STD,label:y.STD},{key:b.VARIANCE,label:y.VARIANCE},{key:b.MEDIAN,label:y.MEDIAN}],X=[...Ie],ei=({appId:t,columnIndex:o,tableColumn:i})=>{h.debug(t,o,i),A(),E(t);const l=B(t),s=M.useMemo(()=>{var a;return(i==null?void 0:i.aggregation)===void 0?[]:(a=i==null?void 0:i.aggregation)==null?void 0:a.map(p=>X.filter(d=>d.key===p)[0])},[i==null?void 0:i.aggregation]);return!ae(t)||i.computedField===void 0&&x(l[i.columnName].data_type)!=="number"?null:e.jsxs(_,{disableGutters:!0,children:[e.jsxs(G,{expandIcon:e.jsx(U,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(He,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Aggregations"})]}),e.jsxs(W,{sx:{marginTop:"10px"},children:[e.jsxs(S,{fullWidth:!0,children:[e.jsx(Xe,{multiple:!0,options:X,disabled:!0,disableCloseOnSelect:!0,getOptionLabel:a=>a.label,value:s,onChange:(a,p)=>{a.stopPropagation()},renderOption:(a,p,{selected:d})=>e.jsxs("li",{...a,children:[e.jsx(Je,{icon:e.jsx(Me,{}),checkedIcon:e.jsx(De,{}),style:{marginRight:8},checked:d}),p.label]}),renderInput:a=>e.jsx(D,{...a,label:"Select from list"})}),e.jsx(v,{children:"Allows multiple selections. Displayed in order of entry."})]}),e.jsx(Q,{})]})]})},ii=({appId:t,columnIndex:o,tableColumn:i})=>{h.debug(t,o,i);const l=A(),s=E(t),p=B(t)[i.columnName],d=(u,n)=>{l(ne({appId:t,columnName:i.columnName})),l(re({appId:t,columnName:i.columnName})),l(oe({appId:t,index:u,lookup:n})),s(!0)};return e.jsxs(e.Fragment,{children:[e.jsx($e,{appId:t,columnIndex:o,tableColumn:i}),e.jsx(Ze,{appId:t,columnIndex:o,tableColumn:i}),e.jsx(Ke,{appId:t,columnIndex:o,tableColumn:i}),e.jsx(xe,{appId:t,columnIndex:o,tableColumn:i,columnMetaData:p,setLookup:d}),e.jsx(ei,{appId:t,columnIndex:o,tableColumn:i}),e.jsx(ge,{columnMetaData:p})]})},si=({appId:t,columnIndex:o,tableType:i})=>{h.debug(t,o,i);const l=A(),s=J(r=>le(r,t,o));h.debug("tableColumn",s);const a=E(t),[p,d]=M.useState(!1),[u,n]=M.useState(void 0),j=r=>{r!==void 0&&(l(de({appId:t,index:r})),a(!0))},L=(r,g)=>{h.debug(r,g),l(ce({appId:t,index:r,visible:g})),a(!0)},C=(r,g)=>{h.debug(r,g),l(me({appId:t,index:r,queryable:g})),a(!0)},F=(r,g)=>{h.debug(r,g),l(pe({appId:t,index:r,orderable:g})),a(!0)},m=(r,g)=>{l(ue({appId:t,index:r,alignment:g})),a(!0)},V=(r,g,K)=>(h.debug(r,g,K),e.jsxs(e.Fragment,{children:[e.jsx(c,{sx:{"& svg":{pointerEvents:"none",opacity:"0.5"}},children:e.jsx(he,{id:r,enabled:!1},r)}),e.jsxs(c,{sx:{display:"inline-grid",gridTemplateColumns:s.computedField!==void 0?"auto auto":"auto",justifyContent:"start",alignItems:"center",gap:"10px","& svg":{opacity:"0.5"}},children:[s.computedField!==void 0&&e.jsx(Ee,{}),e.jsx(w,{children:g})]})]}));return e.jsxs(e.Fragment,{children:[e.jsxs(_,{disableGutters:!0,slotProps:{transition:{unmountOnExit:!0}},children:[e.jsxs(G,{className:"pp-column-settings",expandIcon:e.jsx(U,{}),sx:{justifyContent:"space-between",position:"relative"},children:[i!==""&&e.jsx(c,{sx:{position:"absolute",top:"5px",right:"5px",fontSize:"50%"},children:i}),e.jsx(c,{sx:{display:"grid",gridTemplateColumns:"auto 1fr",alignItems:"center","& svg":{display:"flex"}},children:V(s.columnName,s.columnLabel,o)}),e.jsxs("div",{style:{display:"inline-grid",gridTemplateColumns:"40px 40px 40px 40px"},children:[e.jsx(P,{title:"Visibility",position:"bottom",children:e.jsx(N,{onClick:r=>{L(o,!s.visible),r.stopPropagation()},children:e.jsx(z,{checked:s.visible,children:e.jsx(Le,{})})})}),s.computedField?e.jsx(P,{title:"Edit",position:"bottom",children:e.jsx("span",{children:e.jsx(N,{disabled:!0,onClick:r=>{r.stopPropagation()},children:e.jsx(Fe,{})})})}):e.jsx(P,{title:"Searchable",position:"bottom",children:e.jsx(N,{onClick:r=>{C(o,!s.queryable),r.stopPropagation()},children:e.jsx(z,{checked:s.queryable,alignRight:!1,children:e.jsx(Ce,{})})})}),s.computedField?e.jsx(P,{title:"Delete",position:"bottom",children:e.jsx(N,{onClick:r=>{n(o),d(!0),r.stopPropagation()},children:e.jsx(Oe,{})})}):e.jsx(P,{title:"Sortable",position:"bottom",disabled:s.visible===!1,children:e.jsx(N,{disabled:s.visible===!1,onClick:r=>{F(o,!s.orderable),r.stopPropagation()},children:e.jsx(z,{checked:s.orderable,forceOff:s.visible===!1,children:e.jsx(Re,{})})})}),e.jsx(P,{title:"Alignment",position:"bottom",disabled:s.visible===!1,children:e.jsxs(N,{disabled:s.visible===!1,onClick:r=>{s.alignment===f.LEFT?m(o,f.CENTER):s.alignment===f.CENTER?m(o,f.RIGHT):s.alignment===f.RIGHT&&m(o,f.LEFT),a(!0),r.stopPropagation()},children:[s.alignment===f.LEFT&&e.jsx(Be,{}),s.alignment===f.CENTER&&e.jsx(Ue,{}),s.alignment===f.RIGHT&&e.jsx(_e,{})]})})]})]}),e.jsx(W,{children:e.jsx(ii,{appId:t,columnIndex:o,tableColumn:s})})]},o),e.jsx(Ge,{title:"Delete computed field?",message:"Are you sure you want to delete this computed field? This action cannot be undone!",open:p,setOpen:d,onConfirm:()=>j(u)})]})},ts=({appId:t,metaData:o})=>{h.debug(t,o),A();const i=je(H(we),H(Te),H(ke));E(t);const l=d=>{const{active:u,over:n}=d;h.debug(u,n),u==null||u.id,n==null||n.id},s=Ae(t),a=()=>(s==null?void 0:s.filter(d=>d.startsWith(q.relationTablePrefix)).length)>0,p=d=>a()?d.startsWith(q.relationTablePrefix)?"Relation Table Column":"Join Table Column":"";return s===void 0||s.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx(fe,{autoScroll:!0,sensors:i,collisionDetection:be,onDragEnd:l,children:e.jsx(ye,{items:s,children:s.map((d,u)=>e.jsx(Se,{id:d,children:e.jsx(si,{appId:t,columnIndex:u,tableType:p(d)})},d))})}),e.jsx(ve,{appId:t,target:Ye.TABLE})]})};export{ts as default};
