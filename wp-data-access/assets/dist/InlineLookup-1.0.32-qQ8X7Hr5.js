import{j as C}from"./cm-1.0.32-roxymF9V.js";import{r as n}from"./redux-1.0.32-BsgiH_bG.js";import{l as m,b as V,bP as U}from"./lib-1.0.32-CBsDffd2.js";import{l as O}from"./ActionsDml-1.0.32-CqneDSgR.js";import{u as X,a as Y}from"./RestApi-1.0.32-Bp_RRidr.js";import{c as Z}from"./useTheme-1.0.32-Boox29T5.js";import{g as $}from"./TableQuery-1.0.32-DLn0yGji.js";import{i as D}from"./index-1.0.32-DEU9wnLT.js";import{F as M}from"./FormHelperText-1.0.32-BG3xt4JA.js";import{A as R}from"./Autocomplete-1.0.32-CC-cYb5n.js";import{T as I}from"./TextField-1.0.32-EUJpMVir.js";import"./vendor-1.0.32-BmpNFhoq.js";import"./loglevel-1.0.32-BZ7XahX3.js";import"./lodash-1.0.32-B7VmFneh.js";import"./moment-1.0.32-C5S46NFB.js";import"./index-1.0.32-D6IhVoXv.js";import"./Typography-1.0.32-D9d-UzA0.js";import"./cjs-1.0.32-AqZgyPIn.js";import"./iconBase-1.0.32-inVKjZEJ.js";import"./notistack-1.0.32-N2grKTUm.js";import"./main-1.0.32.js";import"./useStoreTable-1.0.32-DHfF4DKP.js";import"./ConfirmDialog-1.0.32-A4KvBqFE.js";import"./AdminTheme-1.0.32-WcjuTcVF.js";import"./DialogContent-1.0.32-B0aW5NMk.js";import"./SanitizeComponent-1.0.32-pSotkHem.js";import"./dompurify-1.0.32-CCJo14B2.js";import"./index-1.0.32-wSDMfVDG.js";import"./tanstack-1.0.32-hjLg6WMC.js";import"./index.esm-1.0.32-DHLqzAfk.js";import"./createSvgIcon-1.0.32-DGmABpxr.js";import"./Collapse-1.0.32-3dNdwtSs.js";import"./Tooltip-1.0.32-BFRxm1kH.js";import"./Popper-1.0.32-Dr5x4zRa.js";import"./useControlled-1.0.32-fDn_qfrW.js";import"./Spinner-1.0.32-D1QL5ry3.js";import"./FormControlLabel-1.0.32-B7mCGY7x.js";import"./useFormControl-1.0.32-Tf9RtQ-m.js";import"./Checkbox-1.0.32-CFJQbOdr.js";import"./SwitchBase-1.0.32-8MhCpXB3.js";import"./Menu-1.0.32-CRF2Elfu.js";import"./InputAdornment-1.0.32-B4eTRvU4.js";import"./TimePicker-1.0.32-JvxXQNTX.js";import"./useMobilePicker-1.0.32-aq7eJnRp.js";import"./index-1.0.32-6Cfvmv3-.js";import"./visuallyHidden-1.0.32-Dan1xhjv.js";import"./ListItem-1.0.32-BDCZ88q2.js";import"./timeViewRenderers-1.0.32-oFPNP3d_.js";import"./MenuItem-1.0.32-Bc1CXi88.js";import"./DateTimePicker-1.0.32-BCOHYqEk.js";import"./Tabs-1.0.32-B237JaNe.js";import"./dateViewRenderers-1.0.32-BBL1OGiN.js";import"./Divider-1.0.32-kK3jX0R7.js";import"./DatePicker-1.0.32-D40Vxj8d.js";import"./Stack-1.0.32-BKAIHkUk.js";import"./Slider-1.0.32-C4ittimZ.js";import"./ListItemIcon-1.0.32-CPQjWjIH.js";import"./Radio-1.0.32-Dg2N7INw.js";import"./AlertTitle-1.0.32-CcGnHgem.js";import"./Close-1.0.32-BV_W41ov.js";import"./Switch-1.0.32-BfMlbG-m.js";import"./index.esm-1.0.32-BcBy0Voo.js";import"./TableContainer-1.0.32-CcQeMHoT.js";import"./FallbackSpinner-1.0.32-kTXSQeKF.js";import"./ActionsSettings-1.0.32-u1MS6Fmu.js";import"./TargetEnum-1.0.32-DPFnTxiX.js";import"./ScopeEnum-1.0.32-B4DDvIDj.js";import"./index-1.0.32-D1JAhTpk.js";import"./TabPanel-1.0.32-DFUvt78C.js";import"./useTableUpdater-1.0.32-BssjPM3j.js";import"./settings-1.0.32-OrNy0l2i.js";import"./useScreenSize-1.0.32-ZGgk_gJq.js";import"./ThemeContainer-1.0.32-DQB7LmiJ.js";import"./AggregationLabelsEnum-1.0.32-BC8SFHGp.js";import"./useTableColumnOrder-1.0.32-Q496z8_E.js";import"./FormLabel-1.0.32-agP5qBoD.js";const w=(p,e)=>{const u=X(c=>c.lookups[p]!==void 0?c.lookups[p][e]:void 0);return m.debug("lookup",u),u},he=({value:p,columnState:e,columnMetaData:u,setValue:c,saveChanges:P,appId:a,currentRow:f,storeRow:N,row:T})=>{var L,j;m.debug(p,e,u,a,f,N,T);const F=Y(),h=Z(a),[q,W]=n.useState(!1),[x,_]=n.useState(p);n.useEffect(()=>{m.debug("useEffect",e.columnName,x,p,f[e.columnName]),N!==void 0&&N[e.columnName]!==void 0&&x!==p&&(P(),_(p))},[p]);const k=w(a,e.columnName),[g,b]=n.useState([]);m.debug("lov",g);const[d,H]=n.useState(Array.isArray((L=e.lookup)==null?void 0:L.dynamicConditions)?(j=e.lookup)==null?void 0:j.dynamicConditions.map(o=>({columnName:o.lookupColumnName,columnValue:f[o.tableColumnName]??""})):[]);m.debug("conditions",d),n.useEffect(()=>{if(k!==void 0)if(Object.keys(k).length>0){const o=[];for(const l in k)o.push({key:l,value:k[l]});b(o)}else d.length===0&&z();else b([])},[k]);const z=()=>{if(!q&&g.length===0){W(!0);const o=e.lookup;if(o!==void 0){const l=h.isRelationSelectionTable===!0?V.relationTablePrefix+e.columnName:e.columnName;O(a,"table",l,o.key,o.value,{},{},i=>{m.debug(i.data);const t={};for(let r=0;r<i.data.length;r++)if(!o.value.includes(","))t[i.data[r].key]=i.data[r].value;else{const s=o.value.split(",");t[i.data[r].key]=s.map(v=>i.data[r][v])}m.debug(t),F(U({appId:a,columnName:e.columnName,lookup:t}))},i=>{m.error(i)})}}else m.error("Error loading lookup - please check server response")};n.useEffect(()=>{var o,l;if(Object.keys(d).length>0&&d.length>0){const i=Array.isArray((o=e.lookup)==null?void 0:o.dynamicConditions)?(l=e.lookup)==null?void 0:l.dynamicConditions.map(r=>({columnName:r.lookupColumnName,columnValue:f[r.tableColumnName]??""})):[];m.debug("reload lookup?",d,i);const t={};if(i.length>0&&i.map(r=>{t[r.columnName]=r.columnValue}),D(d,i))m.debug("reloading dynamic lookup",e.columnName,i,t),A(t);else{const r={};i.length>0&&i.map(s=>{r[s.columnName]=s.columnValue}),H(i),i.filter(s=>s.columnValue===""||s.columnValue===null).length===0?A(r):b([])}}},[f]);const A=(o={})=>{const l=e.lookup;if(l!==void 0){const i=h.isRelationSelectionTable===!0?V.relationTablePrefix+e.columnName:e.columnName;O(a,"table",i,l.key,l.value,o,{},t=>{var r,s,v;if(m.debug(t.data),!((r=e.lookup)!=null&&r.value.includes(",")))b(t.data);else{const J=(s=e.lookup)==null?void 0:s.value.split(","),E=[];for(let y=0;y<t.data.length;y++){const K=J.map(Q=>t.data[y][Q]).join(((v=e.lookup)==null?void 0:v.delimiter)??"");E.push({key:t.data[y].key,value:K})}b(E)}},t=>{m.error(t)})}},B=o=>{var l;return Array.isArray(o.value)?o.value.join(((l=e.lookup)==null?void 0:l.delimiter)??""):o.value},G=n.useMemo(()=>g.filter(o=>o.key===p)[0]??null,[g,p]);return C.jsx("div",{onClick:o=>{o.stopPropagation()},children:C.jsx(M,{fullWidth:!0,onClick:o=>{o.stopPropagation()},children:C.jsx(R,{className:"pp-inline-editing",multiple:!1,fullWidth:!0,autoHighlight:!0,disableClearable:u.is_nullable==="NO",options:g,getOptionLabel:o=>B(o),value:G,onChange:(o,l)=>{c(l!==null?l.key:null),o.stopPropagation()},renderInput:o=>C.jsx(I,{label:u.formLabel,required:u.is_nullable==="NO",...o,sx:$(e)})})})})};export{he as default};
