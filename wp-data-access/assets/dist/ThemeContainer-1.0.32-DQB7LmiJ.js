const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./TableContainer-1.0.32-CcQeMHoT.js","./cm-1.0.32-roxymF9V.js","./redux-1.0.32-BsgiH_bG.js","./vendor-1.0.32-BmpNFhoq.js","./AdminTheme-1.0.32-WcjuTcVF.js","./Typography-1.0.32-D9d-UzA0.js","./lib-1.0.32-CBsDffd2.js","./loglevel-1.0.32-BZ7XahX3.js","./lodash-1.0.32-B7VmFneh.js","./moment-1.0.32-C5S46NFB.js","./main-1.0.32.js","./notistack-1.0.32-N2grKTUm.js","./tanstack-1.0.32-hjLg6WMC.js","./FallbackSpinner-1.0.32-kTXSQeKF.js","./Spinner-1.0.32-D1QL5ry3.js","./RestApi-1.0.32-Bp_RRidr.js","./ActionsSettings-1.0.32-u1MS6Fmu.js","./TargetEnum-1.0.32-DPFnTxiX.js","./ConfirmDialog-1.0.32-A4KvBqFE.js","./iconBase-1.0.32-inVKjZEJ.js","./cjs-1.0.32-AqZgyPIn.js","./DialogContent-1.0.32-B0aW5NMk.js","./ConfirmDialog-1.0.32--D4jr2go.css","./ScopeEnum-1.0.32-B4DDvIDj.js","./index-1.0.32-D1JAhTpk.js","./TabPanel-1.0.32-DFUvt78C.js","./useTableUpdater-1.0.32-BssjPM3j.js","./settings-1.0.32-OrNy0l2i.js","./Menu-1.0.32-CRF2Elfu.js","./MenuItem-1.0.32-Bc1CXi88.js","./settings-1.0.32-Bx2jvYL6.css","./useTheme-1.0.32-Boox29T5.js","./index-1.0.32-D6IhVoXv.js","./Row-1.0.32-C66q9X21.js","./useStoreTable-1.0.32-DHfF4DKP.js","./ActionsDml-1.0.32-CqneDSgR.js","./useScreenSize-1.0.32-ZGgk_gJq.js","./dompurify-1.0.32-CCJo14B2.js","./Tooltip-1.0.32-BFRxm1kH.js","./Popper-1.0.32-Dr5x4zRa.js","./useControlled-1.0.32-fDn_qfrW.js","./Alert-1.0.32-BfuX6f_g.js","./AlertTitle-1.0.32-CcGnHgem.js","./createSvgIcon-1.0.32-DGmABpxr.js","./Close-1.0.32-BV_W41ov.js","./Settings-1.0.32-B0tgt1o5.js","./useFormStore-1.0.32-CuqY-zLZ.js","./TableChartDock-1.0.32-CyGZ61eN.js","./Chart-1.0.32-D0aR_QQf.js"])))=>i.map(i=>d[i]);
import{j as t}from"./cm-1.0.32-roxymF9V.js";import{_ as ee}from"./main-1.0.32.js";import{r as i}from"./redux-1.0.32-BsgiH_bG.js";import{l as o,P as $t,K as L,L as mt,v as Gt,M as Jt,N as de,S as I,O as Te,Q as Ke,T as Ie,U as me,V as Qt,W as Ee,X as et,Y as Xt,Z as fe,_ as Ce,$ as ge,a0 as ft,a1 as qt,A as Fe,b as Zt,a2 as Se,a3 as gt,a4 as Kt,d as It,a5 as en,a6 as tn,a7 as nn,a8 as sn,a9 as on}from"./lib-1.0.32-CBsDffd2.js";import{u as te,a as xt}from"./RestApi-1.0.32-Bp_RRidr.js";import{B as M,S as Me}from"./Spinner-1.0.32-D1QL5ry3.js";import{a as rn,T as ht}from"./AdminTheme-1.0.32-WcjuTcVF.js";import{u as we}from"./useStoreTable-1.0.32-DHfF4DKP.js";import{s as ln,u as tt,i as nt}from"./ActionsDml-1.0.32-CqneDSgR.js";import{e as w}from"./notistack-1.0.32-N2grKTUm.js";import{u as Oe,A as an,a as ke,r as cn,b as pt,c as he,d as _t,R as un,C as dn,e as mn,D as J,B as fn,f as gn,g as xn,h as hn}from"./useTheme-1.0.32-Boox29T5.js";import"./moment-1.0.32-C5S46NFB.js";import{G as pn,A as jt,T as bt,H as st,I as ot,B as ie,e as vt,M as Tt,F as _n}from"./cjs-1.0.32-AqZgyPIn.js";import{u as jn}from"./useScreenSize-1.0.32-ZGgk_gJq.js";import"./dompurify-1.0.32-CCJo14B2.js";import{g as bn}from"./vendor-1.0.32-BmpNFhoq.js";import{P as rt,I as ue}from"./iconBase-1.0.32-inVKjZEJ.js";import{F as ye}from"./FallbackSpinner-1.0.32-kTXSQeKF.js";import{T as it}from"./Tooltip-1.0.32-BFRxm1kH.js";const Re=e=>{const r=te(f=>{var a,p;return(p=(a=f.forms[e])==null?void 0:a.state)==null?void 0:p.data});return o.debug("data",r,e),r};var pe=(e=>(e[e.SELECT=0]="SELECT",e[e.INSERT=1]="INSERT",e[e.UPDATE=2]="UPDATE",e[e.DELETE=3]="DELETE",e[e.EXPORT=4]="EXPORT",e[e.IMPORT=5]="IMPORT",e[e.VIEW=6]="VIEW",e))(pe||{});i.lazy(()=>ee(()=>import("./TableContainer-1.0.32-CcQeMHoT.js").then(e=>e.T),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]),import.meta.url));i.lazy(()=>ee(()=>import("./TableContainer-1.0.32-CcQeMHoT.js").then(e=>e.T),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]),import.meta.url));const Et=e=>4,vn=e=>{const r=te(f=>{var a;return((a=f.forms[e])==null?void 0:a.columns)??[]});return o.debug("storeColumns",r),r},lt=e=>{const r=te(f=>f.forms[e]!==void 0?f.forms[e].columns.filter(a=>a.more).length>0:!1);return o.debug("hasMoreColumns",r),r},Tn=e=>{const r=te(f=>{var a,p;return((p=(a=f.forms[e])==null?void 0:a.state)==null?void 0:p.more)??!1});return o.debug("moreState",r),r},En=e=>{const r=te(f=>{var a,p;return(p=(a=f.forms[e])==null?void 0:a.state)==null?void 0:p.initialData});return o.debug("initialData",r),r},yn=i.lazy(()=>ee(()=>import("./Row-1.0.32-C66q9X21.js"),__vite__mapDeps([33,10,1,2,3,11,6,7,8,9,15,31,32,5,20,19,14,4,34,35,36,37,13,38,39,40]),import.meta.url)),Fn=({appId:e,metaData:r,primaryKey:f,formMode:a,formUuid:p})=>{var P;o.debug(e,r,f,a,p);const C=ke(),O=Oe(e),j=Re(e),y=En(e);return t.jsx("form",{id:p,className:"pp-form-content",onSubmit:c=>(c.preventDefault(),!1),children:t.jsx(M,{className:"pp-form-grid",sx:{display:"grid",gridTemplateColumns:{lg:`repeat(${C.cellsPerRow}, 1fr)`,md:"repeat("+Math.min(C.cellsPerRow,2)+", 1fr)",xs:"1fr"},gap:"30px",marginBottom:0,background:C.showGrid?((P=an)==null?void 0:P.palette.mode)===$t.LIGHT?"repeating-linear-gradient( -45deg, transparent, transparent 10px, #eee 10px, #eee 20px )":"repeating-linear-gradient( -45deg, transparent, transparent 10px, #111 10px, #111 20px )":"","& p.MuiFormHelperText-root":{...a===L.VIEW&&!0&&{display:"none"}}},children:t.jsx(i.Suspense,{fallback:t.jsx(Me,{}),children:t.jsx(yn,{appId:e,metaData:r,data:j,initialData:y,primaryKey:f,formMode:a,formSettings:C,language:O.language})})})})},Sn=e=>({}),Rn=e=>{const r=te(f=>{var a,p;return((p=(a=f.forms[e])==null?void 0:a.state)==null?void 0:p.m2mUpdate)??!1});return o.debug("m2mUpdate",r),r},Cn=({code:e,safeMode:r,isExpression:f,args:a})=>{const p=mt(e,r,f,a);return window.jQuery&&p instanceof window.jQuery&&p.html(),null};var Mn=cn();const xe=bn(Mn),at=i.lazy(()=>ee(()=>import("./Alert-1.0.32-BfuX6f_g.js"),__vite__mapDeps([41,1,2,3,24,19,5,6,7,8,9,42,43,44]),import.meta.url)),ct=({appId:e,primaryKey:r,formMode:f,showTable:a,showForm:p,detailKey:C,children:O,relationAppId:j,relTab:y,joinTab:m,isEmbedded:P,masterAppId:c,isModal:V})=>{var Ae,He,We,Ye,ze,$e;o.debug(e,r,f,C,j,y,m,P,c,V);const T=xt(),ne=i.useRef(null),Q=vn(e),b=pt(e),Y=Et(),B=we(e),A=Sn(),X=Oe(e),[z,$]=i.useState(f),H=i.useMemo(()=>Gt(),[]),[se,G]=i.useState(!1),[q,_e]=i.useState(""),s=he(e),Z=Re(e),u=Jt((Ae=s==null?void 0:s.app)==null?void 0:Ae.container[0]),R=Rn(e),k=he(c??""),le=Re(c??""),ae=_t(e),[je,be]=i.useState(null);i.useEffect(()=>{o.debug(R,e),R===!0&&(o.debug("setM2MUpdate: false"),ce(!1,()=>{},()=>{},()=>{T(Ke({appId:e,update:!1}))}))},[R]),i.useEffect(()=>{r===null?Ft():Object.keys(r).length>0?yt():G(!0)},[r]);const yt=()=>{ln(e,r,s==null?void 0:s.media,n=>{if(o.debug(n),(n==null?void 0:n.code)==="ok"){if(Array.isArray(n.data)&&n.data.length>0){const d={...n.data[0]},_={...n.context};delete _.debug,T(Te({appId:e,data:d,context:_})),n.data.length>1?be("Query returned more than one row. Check configuration."):be(null)}else{const d={...n.context};delete d.debug,T(Te({appId:e,data:{},context:d})),be("Invalid primary key. Check configuration.")}G(!0)}else w(b.invalidResponse,{variant:"error"})},n=>{o.error("error",n),_e(n??b.invalidResponse)},!1,y)},Ft=()=>{var n,d;if(s.columns&&Array.isArray(s.columns)){const _={},E=de.getSelectors().selectFormColumns(I.getState().forms,e),l=Object.fromEntries(E.map(h=>[h.columnName,h.defaultValue]));o.debug("defaultValues",l);for(let h=0;h<s.columns.length;h++)_[s.columns[h].column_name]=null,l[s.columns[h].column_name]!==void 0&&(l[s.columns[h].column_name]==="@wpda_wp_user_id"?_[s.columns[h].column_name]=(d=(n=s==null?void 0:s.settings)==null?void 0:n.env)==null?void 0:d.id:l[s.columns[h].column_name]==="@now"?s.columns[h]==="date"?_[s.columns[h].column_name]=xe(Date.now()).format("YYYY-MM-DD"):_[s.columns[h].column_name]=xe(Date.now()).format("YYYY-MM-DD HH:mm:ss"):s.columns[h].column_default!==null&&s.columns[h].column_default!=="NULL"&&s.columns[h].column_default!==""?s.columns[h].column_default==="CURRENT_TIMESTAMP"?s.columns[h]==="date"?_[s.columns[h].column_name]=xe(Date.now()).format("YYYY-MM-DD"):_[s.columns[h].column_name]=xe(Date.now()).format("YYYY-MM-DD HH:mm:ss"):_[s.columns[h].column_name]=s.columns[h].column_default:_[s.columns[h].column_name]=l[s.columns[h].column_name]);o.debug(_),T(Te({appId:e,data:_,context:{media:{}}})),o.debug("init"),G(!0)}},Ne=()=>{let n="";for(const d in s.columns)s.columns[d].extra==="auto_increment"&&(n=s.columns[d].column_name);return o.debug(n),n},Le=n=>{var h;const d=(h=de.getSelectors().selectFormState(I.getState().forms,e))==null?void 0:h.validation;o.debug("rowValidation",d);let _=!1;for(const g in d)if(d[g].error===!0&&d[g].type===me.COLUMN){_=!0;break}if(_)return o.debug("validateForm returned errors"),!1;let E=!0;const l=Ne();for(const g in n){const x=Qt(s,g);let F=!0;x.column_name!==l&&x.is_nullable==="NO"&&(n[g]===null||n[g]==="")&&(f===L.UPDATE||f===L.INSERT&&(x.column_default===null||x.column_default==="NULL"||x.column_default==="")||Nt.preserveSpacesOnUpdate===!1&&n[g]==="")&&(T(Ee({appId:e,columnName:g,columnError:!0,columnText:b.mandatoryField,columnType:me.FORM})),F=!1,E=!1);const S=de.getSelectors().selectFormColumns(I.getState().forms,e);let U;for(let v=0;v<S.length;v++)S[v].columnName===g&&(U=S[v]);if(o.debug(U),F&&x.data_type==="time"){const v=n[g];if(v.length===6){let D=v.substring(2,3),N=v.substring(4,5);(Number(D)>5||Number(N)>5)&&(T(Ee({appId:e,columnName:g,columnError:!0,columnText:b.mandatoryField,columnType:me.FORM})),F=!1,E=!1)}}F&&T(Ee({appId:e,columnName:g,columnError:!1,columnText:"",columnType:me.FORM}))}return E},ce=(n,d,_,E)=>{var h;const l=(h=de.getSelectors().selectFormState(I.getState().forms,e))==null?void 0:h.data;if(o.debug(l),Le(l)){if(r!==null){const g={};Object.keys(l).map(x=>{Q.map(F=>{x===F.columnName&&F.updatable&&(g[x]=l[x])})}),o.debug(g),tt(e,r,g,x=>{var F;if(o.debug(x),x!=null&&x.code&&(x!=null&&x.message))switch(x.code){case"ok":w(b.updatedSuccessful,{variant:"success"}),((F=x.context)==null?void 0:F.updated)!==void 0&&Object.keys(x.context.updated).map(S=>{T(et({appId:e,columnName:S,columnValue:x.context.updated[S]}))}),n&&(d!==void 0&&d(r),setTimeout(()=>{a(!0,j)},1e3)),E&&E();break;case"info":w(b.nothingToUpdate,{variant:"info"}),n&&(d!==void 0&&d(r),setTimeout(()=>{a(!0,j)},1e3)),E&&E();break;default:o.error(x),w(x.message??b.invalidResponse,{variant:"error"}),n&&a(!0,j)}else o.error(x),w(b.invalidResponse,{variant:"error"})},x=>{o.error("error",x),w(x??b.invalidResponse,{variant:"error"})},!1,m,y)}else nt(e,l,g=>{if(o.debug(g),g!=null&&g.code&&(g!=null&&g.message)){let x;const F={};switch(g.code){case"ok":w(b.insertSuccessful,{variant:"success"}),x=Ne();for(let S=0;S<s.primary_key.length;S++){const U=Xt(s,s.primary_key[S]);let v;U!==void 0&&(v=s==null?void 0:s.columns[U]),x!==""&&x===(v==null?void 0:v.column_name)?F[s.primary_key[S]]=g.context.insert_id:F[s.primary_key[S]]=l[s.primary_key[S]]}if((u==null?void 0:u.cardinality)===fe.ONE_TO_ONE){const S={};k!=null&&k.primary_key&&Array.isArray(k==null?void 0:k.primary_key)&&(k==null||k.primary_key.map(v=>S[v]=le[v]));const U={};if(u.join_condition!==void 0){const v=u.join_condition.split(",");for(let D=0;D<v.length;D++){const N=v[D].split("=");N.length===2&&(U[N[0]]=F[N[1]])}}tt(e,S,U,()=>{Object.keys(le).map(v=>{if(u.join_condition!==void 0){const D=u.join_condition.split(",");for(let N=0;N<D.length;N++){const re=D[N].split("=");re.length===2&&re[0]===v&&T(et({appId:c,columnName:v,columnValue:Z[re[1]]}))}}})},()=>{})}if(n){d!==void 0&&d(F),a(!0,j);return}p(F,pe.UPDATE),_&&_(),E&&E();break;default:o.error(g),w(g.message??b.invalidResponse,{variant:"error"})}}else o.error(g),w(b.invalidResponse,{variant:"error"})},g=>{o.error("error",g),w(g??b.invalidResponse,{variant:"error"})},!1,m,y);o.debug(j),j!==void 0&&(o.debug("setM2MUpdate: true"),T(Ke({appId:j,update:!0})))}else o.error("Validate failed: ",l)},St=()=>je===null?null:t.jsx(i.Suspense,{children:t.jsx(M,{sx:{marginTop:"30px"},children:t.jsx(at,{severity:"error",message:je,close:!1})})}),Rt=n=>{if(n!==null&&Le(Z)){const d=Se.getSelectors().selectTableById(I.getState().tables,e),_=d.state.relation.relation_join_condition.split(",").map(l=>l.split("=")),E={...d.state.detailKey};_.map(l=>{E[l[0]]=n[l[1]]}),nt(e,E,l=>{if(o.debug(l),l!=null&&l.code&&(l!=null&&l.message))switch(l.code){case"ok":o.debug("Added relation to join table",l);break;default:o.error(l),w(l.message??b.invalidResponse,{variant:"error"})}else o.error(l),w(b.invalidResponse,{variant:"error"})},l=>{o.error(l),w(l??b.invalidResponse,{variant:"error"})},!1,!0,!1)}},[Ct,Mt]=i.useState(void 0),wt=()=>{try{ce(!1,()=>{},()=>{var d,_,E,l,h,g,x,F,S,U,v,D,N,re,Ge,Je,Qe,Xe,qe,Ze;const n=JSON.parse((_=(d=s==null?void 0:s.app)==null?void 0:d.app[0])==null?void 0:_.app_settings);if(o.debug(n),((l=(E=n==null?void 0:n.settings)==null?void 0:E.app_registration)==null?void 0:l.showMessage)===!0&&((g=(h=n==null?void 0:n.settings)==null?void 0:h.app_registration)==null?void 0:g.message)!==void 0&&((F=(x=n==null?void 0:n.settings)==null?void 0:x.app_registration)==null?void 0:F.message)!==null&&((U=(S=n==null?void 0:n.settings)==null?void 0:S.app_registration)==null?void 0:U.message.trim())!==""&&Mt((D=(v=n==null?void 0:n.settings)==null?void 0:v.app_registration)==null?void 0:D.message),((re=(N=n==null?void 0:n.settings)==null?void 0:N.app_registration)==null?void 0:re.allowUpdates)!==!0&&($(L.VIEW),((Je=(Ge=n==null?void 0:n.settings)==null?void 0:Ge.app_registration)==null?void 0:Je.showUrl)===!0&&((Xe=(Qe=n==null?void 0:n.settings)==null?void 0:Qe.app_registration)==null?void 0:Xe.url)!=="")){const zt=((Ze=(qe=n==null?void 0:n.settings)==null?void 0:qe.app_registration)==null?void 0:Ze.urlTime)??3;setTimeout(()=>{window.location.href=n.settings.app_registration.url},zt)}})}catch(n){o.error("Invalid JSON - app settings"),o.error(n),w(Zt.contactSupport,{variant:"error"})}},Ot=()=>{ce(!1)},kt=()=>{var d,_,E;const n=Se.getSelectors().selectTableById(I.getState().tables,e);o.debug((d=n==null?void 0:n.state)==null?void 0:d.relation),((E=(_=n==null?void 0:n.state)==null?void 0:_.relation)==null?void 0:E.cardinality)===fe.MANY_TO_MANY?ce(!0,Rt):ce(!0)},ve=()=>{a(!0,j)},Nt=ke(),Lt=lt(e),Pt=lt(j??""),K=Tn(e),W=i.useRef(null),Vt=jn(),[oe,Bt]=i.useState((He=W==null?void 0:W.current)==null?void 0:He.offsetWidth),[Ut,Dt]=i.useState({paddingTop:"50px",paddingBottom:"50px",paddingLeft:"50px",paddingRight:"50px"}),[At,Pe]=i.useState("30px"),[Ht,Ve]=i.useState("");if(i.useEffect(()=>{if(W.current!==null){Bt(W.current.offsetWidth);let n=oe<600?.3:oe<900?.6:1;(V??!1)===!0&&(n=1),Dt({paddingTop:`calc(${n} * 50px)`,paddingBottom:`calc(${n} * 50px)`,paddingLeft:`calc(${n} * 50px)`,paddingRight:`calc(${n} * 50px)`}),oe<600?(Pe("10px"),Ve("10px")):oe<900&&(Pe("20px"),Ve("20px"))}},[Vt.width,W.current]),q!=="")return t.jsx(i.Suspense,{children:t.jsx(at,{severity:"error",message:q,close:!1})});const Be=()=>t.jsx(Fn,{appId:e,metaData:s,primaryKey:r,formMode:z,formUuid:H}),Wt=()=>t.jsxs(t.Fragment,{children:[t.jsx(ue,{color:"inherit",onClick:()=>{const n={appId:e};o.info(u),u!=null&&(n.hideThemeSettings=!0),j!==void 0&&(n.isRelationForm=!0),T(gt(n))},children:t.jsx(vt,{})}),t.jsx(ue,{color:"inherit",onClick:()=>{ve()},children:t.jsx(Tt,{})})]}),Yt=i.useMemo(()=>{var n,d,_,E,l;return(n=s==null?void 0:s.src)!=null&&n.app_id&&((_=(d=s==null?void 0:s.app)==null?void 0:d.app[0])==null?void 0:_.app_title)!==""?s.app.app[0].app_title:(E=s==null?void 0:s.src)!=null&&E.dbs&&((l=s==null?void 0:s.src)!=null&&l.tbl)?s.src.dbs+" - "+s.src.tbl:"WP Data Access"},[]),Ue=(((Ye=(We=B==null?void 0:B.table)==null?void 0:We.modal)==null?void 0:Ye.maxHeight)??95)+((($e=(ze=B==null?void 0:B.table)==null?void 0:ze.modal)==null?void 0:$e.maxHeightUnit)??"vh"),De=()=>{var n,d;return t.jsxs(rt,{elevation:Y,ref:ne,children:[(V??!1)===!0&&t.jsx(jt,{sx:{position:"unset",borderBottomRightRadius:0,borderBottomLeftRadius:0,boxShadow:"none"},children:t.jsxs(bt,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(M,{sx:{display:"flex",alignItems:"center",cursor:"move",gap:"2px","& svg":{width:"2em",height:"2em"}},id:Ie(s,"title"),children:t.jsx(M,{sx:{display:"block",whiteSpace:"nowrap",fontSize:"18px",lineHeight:"18px",fontWeight:"bold",textOverflow:"ellipsis",overflow:"hidden",marginRight:"10px"},children:Yt})}),t.jsx(M,{children:(V??!1)===!0&&Ce(s)&&t.jsx(t.Fragment,{children:Wt()})})]})}),t.jsxs(M,{style:Ut,sx:{...(V??!1)===!0&&ae!==void 0&&{maxHeight:`calc(${Ue} - 240px)`,overflow:"auto",backgroundColor:"transparent",border:"none",borderRadius:0}},children:[t.jsxs(M,{sx:{margin:0,padding:"5px 0",...(V??!1)===!0&&ae===void 0&&{maxHeight:`calc(${Ue} - 240px)`,overflow:"auto"}},children:[Be(),O,St()]}),t.jsxs(M,{sx:{marginTop:{marginTop:At},paddingRight:{paddingRight:Ht},padding:0,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(M,{sx:{display:"flex",gap:"8px"},children:[!1,(Lt||Pt)&&t.jsx(t.Fragment,{children:oe<600?t.jsx(ue,{color:"primary",onClick:()=>{T(ge({appId:e,more:!K})),j!==void 0&&T(ge({appId:j,more:!K}))},children:K?t.jsx(st,{}):t.jsx(ot,{})}):t.jsx(ie,{variant:"outlined",startIcon:K?t.jsx(st,{}):t.jsx(ot,{}),onClick:()=>{T(ge({appId:e,more:!K})),j!==void 0&&T(ge({appId:j,more:!K}))},children:K?b.less:b.more})}),(A==null?void 0:A.customActionsBottom)!==void 0&&ft(s)&&t.jsx(t.Fragment,{children:t.jsx(Cn,{code:A.customActionsBottom.code??"",safeMode:X.safeMode,isExpression:!1,args:{log:o,row:Z,mode:qt[f]}})}),t.jsx(M,{className:"pp-registration-form-message",children:Ct})]}),t.jsx(M,{sx:{...oe<600&&{marginLeft:"0 !important","& button":{marginLeft:"2px",padding:"6px"}}},children:f!==L.VIEW?t.jsx(t.Fragment,{children:((d=(n=s==null?void 0:s.app)==null?void 0:n.app[0])==null?void 0:d.app_type)==Fe.REGISTRATION&&B.state.masterDetailConditions===void 0?t.jsx(t.Fragment,{children:(z===L.INSERT||z===L.UPDATE)&&t.jsx(ie,{variant:"contained",onClick:wt,type:"submit",form:H,sx:{marginLeft:"8px"},children:b.ok})}):t.jsxs(t.Fragment,{children:[t.jsx(ie,{variant:"contained",onClick:Ot,type:"submit",form:H,disabled:je!==null,children:b.apply}),(u==null?void 0:u.cardinality)!==fe.ONE_TO_ONE&&t.jsxs(t.Fragment,{children:[t.jsx(ie,{variant:"outlined",onClick:kt,sx:{marginLeft:"8px"},children:b.ok}),t.jsx(ie,{variant:"outlined",onClick:ve,sx:{marginLeft:"8px"},children:b.cancel})]})]})}):t.jsx(t.Fragment,{children:(u==null?void 0:u.cardinality)!==fe.ONE_TO_ONE&&t.jsx(ie,{variant:"contained",onClick:ve,children:b.back})})})]}),t.jsx(t.Fragment,{children:!1})]})]})};return P?Be():(i.useEffect(()=>{var n;W.current!==null&&((n=window.document.getElementById(`pp-app-${e}`))==null||n.scrollIntoView())},[W.current]),t.jsx("div",{className:`${e}_wrapper pp-form`,ref:W,style:{scrollMarginTop:"70px"},children:se&&Z!==null?t.jsx(t.Fragment,{children:(V??!1)===!0?t.jsx(t.Fragment,{children:t.jsx(pn,{handle:"#"+Ie(s,"title"),nodeRef:ne,offsetParent:document.body,children:De()})}):t.jsx(t.Fragment,{children:De()})}):t.jsx(rt,{style:{padding:"50px"},elevation:Y,children:t.jsx(Me,{title:b.loadingData})})}))},wn=i.lazy(()=>ee(()=>import("./Settings-1.0.32-B0tgt1o5.js"),__vite__mapDeps([45,10,1,2,3,11,6,7,8,9,15,4,5,16,17,23,18,19,20,21,22,24,25,46,14,27,28,29,30,31,32]),import.meta.url)),ut=({appId:e,primaryKey:r,formMode:f,showTable:a,showForm:p,metaData:C,detailKey:O,selectionForm:j,masterAppId:y})=>{o.debug(e,r,f,C,O,j,y);const m=rn(),c=we(e).table;o.debug("relationship",null);const T=i.useMemo(()=>{},[]);o.debug("relationAppId",T);const ne=()=>null,Q=()=>null,b=()=>null,Y=()=>{var A,X,z,$,H,se,G,q;return t.jsx(_n,{open:!0,className:"pp-form-modal",sx:{zIndex:9999990},children:t.jsx(M,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",minWidth:(((A=c==null?void 0:c.modal)==null?void 0:A.minWidth)??60)+(((X=c==null?void 0:c.modal)==null?void 0:X.minWidthUnit)??"vw"),maxWidth:(((z=c==null?void 0:c.modal)==null?void 0:z.maxWidth)??90)+((($=c==null?void 0:c.modal)==null?void 0:$.maxWidthUnit)??"vw"),minHeight:(((H=c==null?void 0:c.modal)==null?void 0:H.minHeight)??0)+(((se=c==null?void 0:c.modal)==null?void 0:se.minHeightUnit)??"vh"),maxHeight:(((G=c==null?void 0:c.modal)==null?void 0:G.maxHeight)??95)+(((q=c==null?void 0:c.modal)==null?void 0:q.maxHeightUnit)??"vh"),backgroundColor:"transparent"},children:t.jsx(ct,{appId:e,primaryKey:r,formMode:f,showTable:a,showForm:p,detailKey:O,relationAppId:T,masterAppId:y,isModal:!0,children:Q()})})})},B=()=>t.jsx(ct,{appId:e,primaryKey:r,formMode:f,showTable:a,showForm:p,detailKey:O,relationAppId:T,masterAppId:y,children:Q()});return t.jsxs(t.Fragment,{children:[j===!0?t.jsx(t.Fragment,{children:ne()}):t.jsx(t.Fragment,{children:c.formModal===!0?t.jsx(t.Fragment,{children:Y()}):t.jsx(t.Fragment,{children:B()})}),t.jsx(t.Fragment,{children:Ce(C)&&t.jsx(ht,{theme:m,children:t.jsx(i.Suspense,{fallback:t.jsx(Me,{}),children:t.jsx(wn,{appId:e})})})}),b()]})},On=e=>{const r=te(f=>{var a,p;return((p=(a=f.tables[e])==null?void 0:a.state)==null?void 0:p.fullScreen)??!1});return o.debug("fullScreen",r),r},kn=i.lazy(()=>ee(()=>import("./TableContainer-1.0.32-CcQeMHoT.js").then(e=>e.T),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]),import.meta.url));i.lazy(()=>ee(()=>import("./TableChartDock-1.0.32-CyGZ61eN.js"),__vite__mapDeps([47,1,2,3,48,10,11,6,7,8,9,31,15,32,5,20,19,14,38,4,39,40]),import.meta.url));const dt=({appId:e})=>{var s,Z;o.debug(e);const r=xt(),f=un(),a=dn(),p=Et(),C=_t(e);mn(e),we(e).table;const j=pt(e),y="pp-remove-body-vertical-scrollbar",m=he(e),P=i.useMemo(()=>{var u,R,k,le,ae;return(u=m==null?void 0:m.src)!=null&&u.app_id&&((k=(R=m==null?void 0:m.app)==null?void 0:R.app[0])==null?void 0:k.app_title)!==""?m.app.app[0].app_title:(le=m==null?void 0:m.src)!=null&&le.dbs&&((ae=m==null?void 0:m.src)!=null&&ae.tbl)?m.src.dbs+" - "+m.src.tbl:"WP Data Access"},[]),c=On(e);i.useEffect(()=>(o.debug(c),()=>{var u;(u=window.document.getElementById(y))==null||u.remove(),window.document.body.classList.remove("pp-fullscreen")}),[c]);const V=i.useMemo(()=>Se.getSelectors().selectTableExploring(I.getState().tables,e),[e]);o.debug("tableExploring",V);const[T,ne]=i.useState(((Z=(s=m==null?void 0:m.app)==null?void 0:s.app[0])==null?void 0:Z.app_type)==Fe.REGISTRATION?J.FORM:J.TABLE),[Q,b]=i.useState(!1),Y=u=>{r(nn({appId:e,mode:u})),ne(u)};i.useEffect(()=>{window.ppShowForm=function(u){o.debug(u),X(u),Y(J.FORM)}},[e]);const B=(u,R)=>{o.debug(u,R),sn(e)&&(a(e),R!==void 0&&(f(R),a(R))),u&&b(!Q),Y(J.TABLE)},[A,X]=i.useState(null),[z,$]=i.useState(L.VIEW),H=(u,R)=>{switch(o.debug(u,R),R){case pe.INSERT:$(L.INSERT);break;case pe.UPDATE:$(L.UPDATE);break;default:$(L.VIEW)}X(u),Y(J.FORM)};let se={};Oe(e);const G=()=>null,q=()=>t.jsx(i.Suspense,{fallback:t.jsx(ye,{title:j.loadingForm}),children:t.jsx(ut,{appId:e,primaryKey:A,formMode:L.INSERT,showTable:()=>{},showForm:H,metaData:m})}),_e=()=>{var u,R;return((R=(u=m==null?void 0:m.app)==null?void 0:u.app[0])==null?void 0:R.app_type)==Fe.REGISTRATION?q():t.jsxs(t.Fragment,{children:[t.jsxs(i.Suspense,{fallback:t.jsx(ye,{title:j.loadingTable}),children:[!1,t.jsx(kn,{appId:e,display:T===J.TABLE,refresh:Q,showForm:H,metaData:m}),!1]}),T===J.FORM&&t.jsx(i.Suspense,{fallback:t.jsx(ye,{title:j.loadingForm}),children:t.jsx(ut,{appId:e,primaryKey:A,formMode:z,showTable:B,showForm:H,metaData:m})})]})};return t.jsxs(M,{className:"pp-component",sx:c?se:{},children:[t.jsx(jt,{className:"pp-header",elevation:p,position:"relative",sx:{margin:"0 0 5px 0"},children:t.jsxs(bt,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(M,{sx:{display:"block",whiteSpace:"nowrap",fontSize:"18px",lineHeight:"18px",fontWeight:"bold",textOverflow:"ellipsis",overflow:"hidden",marginRight:"10px"},children:P}),t.jsxs(M,{sx:{display:"flex",gap:"10px",justifyContent:"center",alignItems:"center"},children:[Ce(m)&&t.jsx(it,{title:t.jsx(fn,{details:C,mode:T}),className:"pp-builder-button",children:t.jsx(ue,{sx:{color:"inherit",padding:0},onClick:()=>{T===J.FORM?r(gt({appId:e})):r(Kt({appId:e}))},children:t.jsx(vt,{})})}),G(),V&&t.jsx(it,{title:j.close,children:t.jsx(ue,{sx:{color:"inherit",padding:0},onClick:()=>{var u;(u=window.document.getElementById(y))==null||u.remove(),window.document.body.classList.remove("pp-fullscreen"),m.src.app_id?r(It({isActive:!1,appDbId:0})):r(en({})),a(e),f(e),r(tn({}))},children:t.jsx(Tt,{})})})]})]})}),_e()]})},Nn=e=>({}),Ln=({appId:e})=>{o.debug(e);const r=gn(e),f=ke(),a=hn(),p=he(e);let C;p.appRootId===void 0&&(C=xn(a,r,f));const O=Nn(),j=`pp-global-code-${e}`;return i.useEffect(()=>{o.debug("open app")},[]),i.useEffect(()=>()=>{var y;o.debug("close app"),mt(((y=O.onAppClose)==null?void 0:y.code)??"",on(p),!1)},[]),i.useEffect(()=>{var y,m,P;if(O!==void 0&&ft(p)){(y=window.document.getElementById(j))==null||y.remove();const c=window.document.createElement("script");c.id=j,c.innerHTML=((m=O.global)==null?void 0:m.code)??"",(P=window.document.getElementById(`pp-app-${e}`))==null||P.appendChild(c)}},[O]),C!==void 0?t.jsx(ht,{theme:C,children:t.jsx(dt,{appId:e})}):t.jsx(dt,{appId:e})},es=Object.freeze(Object.defineProperty({__proto__:null,default:Ln},Symbol.toStringTag,{value:"Module"}));export{pe as R,es as T,Tn as a,On as b,Et as c,Nn as d,Sn as e,Re as f,xe as g,vn as u};
