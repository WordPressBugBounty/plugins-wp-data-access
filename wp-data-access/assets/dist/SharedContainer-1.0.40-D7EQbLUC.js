const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./TableContainer-1.0.40-DiO5TNZP.js","./cm-1.0.40-DO7MoydR.js","./redux-1.0.40-W_04YL6Z.js","./vendor-1.0.40-CN03Eozo.js","./AdminTheme-1.0.40-B669Ow89.js","./lib-1.0.40-CJM-IO_o.js","./loglevel-1.0.40-BZ7XahX3.js","./lodash-1.0.40-yZQKpWII.js","./moment-1.0.40-C5S46NFB.js","./Typography-1.0.40-oRKYqE3b.js","./main-1.0.40.js","./notistack-1.0.40-HUa4vT_u.js","./tanstack-1.0.40-Cw2_8Blq.js","./FallbackSpinner-1.0.40-Bwyy_LaW.js","./Spinner-1.0.40-Bmn0_C4u.js","./hooks-1.0.40-DoKijNI1.js","./ActionsSettings-1.0.40-eUdZc7P-.js","./RestApi-1.0.40-Uj1ofskP.js","./TargetEnum-1.0.40-CIW1jlU5.js","./Tooltip-1.0.40-C5SL6QF3.js","./iconBase-1.0.40-CH6TO7hF.js","./useEnhancedEffect-1.0.40-DvrM_gBo.js","./Tooltip-1.0.40--D4jr2go.css","./ScopeEnum-1.0.40-B4DDvIDj.js","./index-1.0.40-D3XFZfpM.js","./index-1.0.40-DmMQghWt.js","./BuilderMenu-1.0.40-wmot84K1.js","./ConfirmDialog-1.0.40-DRjx8-xC.js","./Menu-1.0.40-BKp7UqHL.js","./ThemeProvider-1.0.40-D9QtC9zH.js","./MenuItem-1.0.40-UKMJrtYZ.js","./useTableUpdater-1.0.40-0UQrI-Q9.js","./DynamicModeEnum-1.0.40-BXuL5kgA.js","./useFormDetails-1.0.40-DhJ-oNOJ.js","./useRemoveAppFromStore-1.0.40-DxUqDH6k.js","./lang-1.0.40-D4Y70Q_T.js","./TabPanel-1.0.40-svpV7m9Q.js","./useThemeProps-1.0.40-CnqSFvnT.js","./getThemeProps-1.0.40-CtGZuG5N.js","./settings-1.0.40-Bx2jvYL6.css","./Row-1.0.40-CLkjV_n_.js","./useTableSettings-1.0.40-BK0DaQ_w.js","./useChartSettings-1.0.40-CCxE4Zu8.js","./useStoreTable-1.0.40-C_-ljzWa.js","./ActionsDml-1.0.40-BspTHnPS.js","./useMetadata-1.0.40-DdsiIGYX.js","./useStoreFormSettings-1.0.40-CICs2Pm_.js","./AppTheme-1.0.40-whCBYKjb.js","./index-1.0.40-xxiPHCiq.js","./useScreenSize-1.0.40-DAXf1AlH.js","./dompurify-1.0.40-DhD2mIk-.js","./AlertDialog-1.0.40-CsMgd1A8.js","./SanitizeComponent-1.0.40-qpEC7QW6.js","./Tooltip-1.0.40-Czv1q8N-.js","./useControlled-1.0.40-B7yPDtn1.js","./Popper-1.0.40-Jt4gcDMJ.js","./Alert-1.0.40-Bz3Zj62D.js","./AlertTitle-1.0.40-BbdAhoXf.js","./createSvgIcon-1.0.40-DryBVjDb.js","./Close-1.0.40-DOQmTCBQ.js","./Settings-1.0.40-XeSp3qIG.js","./TableMapDock-1.0.40-BOzQVog5.js","./MapPrepare-1.0.40-B4Ld8RF8.js","./TableChartDock-1.0.40-hRA6a9Jo.js","./Chart-1.0.40-Bz4vBsVt.js"])))=>i.map(i=>d[i]);
import{_ as te,R as It}from"./main-1.0.40.js";import{j as t}from"./cm-1.0.40-DO7MoydR.js";import{r as l,R as en}from"./redux-1.0.40-W_04YL6Z.js";import{l as i,bb as kt,b9 as Ot,ba as tn,bc as U,P as nn,v as on,bd as sn,be as Ne,S as se,bf as ze,G as rn,bg as pt,bh as bt,bi as Ve,bj as ln,bk as Ye,a6 as Qe,bl as Le,bm as an,A as Ge,bn as Ae,a3 as Pt,b as un,bo as qe,bp as _t,g as cn,a4 as dn,d as mn,ao as fn,a7 as gn,bq as xn,br as hn,bs as pn,bt as bn}from"./lib-1.0.40-CJM-IO_o.js";import{u as Z,a as je}from"./hooks-1.0.40-DoKijNI1.js";import{B as P,S as Xe}from"./Spinner-1.0.40-Bmn0_C4u.js";import{a as _n}from"./AdminTheme-1.0.40-B669Ow89.js";import{u as Ze}from"./useStoreTable-1.0.40-C_-ljzWa.js";import{s as jn,u as jt,i as St}from"./ActionsDml-1.0.40-BspTHnPS.js";import{e as A}from"./notistack-1.0.40-HUa4vT_u.js";import{u as Je}from"./useMetadata-1.0.40-DdsiIGYX.js";import"./moment-1.0.40-C5S46NFB.js";import{u as Nt,a as Sn}from"./useChartSettings-1.0.40-CCxE4Zu8.js";import{a7 as wn,p as Tn,A as Vt,T as Lt,a8 as wt,m as Tt,f as At,M as Bt,Q as yn}from"./index-1.0.40-DmMQghWt.js";import{u as Ke}from"./useStoreFormSettings-1.0.40-CICs2Pm_.js";import{u as Ut,C as En,B as Rn}from"./useFormDetails-1.0.40-DhJ-oNOJ.js";import{a as Ie,u as Cn}from"./useRemoveAppFromStore-1.0.40-DxUqDH6k.js";import{a as vn,A as Fn,u as Mn}from"./AppTheme-1.0.40-whCBYKjb.js";import{u as Dt}from"./useScreenSize-1.0.40-DAXf1AlH.js";import{e as kn,B as re,C as On}from"./ConfirmDialog-1.0.40-DRjx8-xC.js";import"./dompurify-1.0.40-DhD2mIk-.js";import{I as ie,P as yt}from"./iconBase-1.0.40-CH6TO7hF.js";import{g as Pn}from"./vendor-1.0.40-CN03Eozo.js";import{r as Nn}from"./lang-1.0.40-D4Y70Q_T.js";import{T as Ht}from"./ThemeProvider-1.0.40-D9QtC9zH.js";import{D as ee}from"./DynamicModeEnum-1.0.40-BXuL5kgA.js";import{F as $e}from"./FallbackSpinner-1.0.40-Bwyy_LaW.js";import{A as Vn}from"./AlertDialog-1.0.40-CsMgd1A8.js";import{S as Et}from"./SanitizeComponent-1.0.40-qpEC7QW6.js";import{T as Rt}from"./Tooltip-1.0.40-Czv1q8N-.js";const Ue=e=>{const s=Z(r=>{var u,x;return(x=(u=r.forms[e])==null?void 0:u.state)==null?void 0:x.data});return i.debug("data",s,e),s};var De=(e=>(e[e.SELECT=0]="SELECT",e[e.INSERT=1]="INSERT",e[e.UPDATE=2]="UPDATE",e[e.DELETE=3]="DELETE",e[e.EXPORT=4]="EXPORT",e[e.IMPORT=5]="IMPORT",e[e.VIEW=6]="VIEW",e))(De||{});l.lazy(()=>te(()=>import("./TableContainer-1.0.40-DiO5TNZP.js").then(e=>e.T),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39]),import.meta.url));l.lazy(()=>te(()=>import("./TableContainer-1.0.40-DiO5TNZP.js").then(e=>e.T),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39]),import.meta.url));const Wt=e=>4,Ln=e=>{const s=Z(r=>{var u;return((u=r.forms[e])==null?void 0:u.columns)??[]});return i.debug("storeColumns",s),s},Ct=e=>{const s=Z(r=>r.forms[e]!==void 0?r.forms[e].columns.filter(u=>u.more).length>0:!1);return i.debug("hasMoreColumns",s),s},An=e=>{const s=Z(r=>{var u,x;return((x=(u=r.forms[e])==null?void 0:u.state)==null?void 0:x.more)??!1});return i.debug("moreState",s),s},Bn=e=>{const s=Z(r=>{var u,x;return(x=(u=r.forms[e])==null?void 0:u.state)==null?void 0:x.initialData});return i.debug("initialData",s),s},zt=e=>({}),Yt=e=>(Ue(e),r=>{}),Un=e=>(je(),(r,u)=>{}),Dn=(e,s)=>(je(),(u,x)=>{}),Hn=l.lazy(()=>te(()=>import("./Row-1.0.40-CLkjV_n_.js"),__vite__mapDeps([40,10,1,2,3,11,5,6,7,8,15,41,42,34,35,14,9,4,43,44,17,45,25,20,21,46,33,32,47,48,38,49,27,50,29,13,51,52,53,54,55]),import.meta.url)),Wn=({appId:e,metaData:s,primaryKey:r,formMode:u,formUuid:x})=>{var y;i.debug(e,s,r,u,x);const T=Ke(),V=Ie(e),S=Ue(e),w=Bn(e),M=zt(),J=Yt(e),D=Un(),N=Dn();l.useEffect(()=>{var L;kt(s)&&((L=M==null?void 0:M.onRowInit)==null?void 0:L.enabled)==!0&&Ot(M.onRowInit.code??"",tn(s),!1,{mode:u,getColumnValue:J,setColumnValue:D,setColumnStyle:N})},[]);const[g,h]=l.useState("30px");return l.useEffect(()=>{},[T.spacing]),t.jsx("form",{id:x,className:"pp-form-content",onSubmit:L=>(L.preventDefault(),!1),children:t.jsx(P,{className:"pp-form-grid",sx:{display:"grid",gridTemplateColumns:{lg:`repeat(${T.cellsPerRow}, 1fr)`,md:"repeat("+Math.min(T.cellsPerRow,2)+", 1fr)",xs:"1fr"},gap:g,marginBottom:0,background:T.showGrid?((y=vn)==null?void 0:y.palette.mode)===nn.LIGHT?"repeating-linear-gradient( -45deg, transparent, transparent 10px, #eee 10px, #eee 20px )":"repeating-linear-gradient( -45deg, transparent, transparent 10px, #111 10px, #111 20px )":"","& p.MuiFormHelperText-root":{...u===U.VIEW&&!0&&{display:"none"}}},children:t.jsx(l.Suspense,{fallback:t.jsx(Xe,{}),children:t.jsx(Hn,{appId:e,metaData:s,data:S,initialData:w,primaryKey:r,formMode:u,formSettings:T,language:V.language})})})})},zn=e=>{const s=Z(r=>{var u,x;return((x=(u=r.forms[e])==null?void 0:u.state)==null?void 0:x.m2mUpdate)??!1});return i.debug("m2mUpdate",s),s},Yn=en.memo(({code:e,safeMode:s,isExpression:r,args:u})=>{const x=Ot(e,s,r,u);return window.jQuery&&x instanceof window.jQuery&&x.html(),null}),$n=e=>{const s=Z(r=>r.forms[e]);return i.debug("formStore",s),s},Gn=({appId:e,setPrimaryKey:s,tableInstance:r,tableRowIndex:u})=>{i.debug(u);const x=$n(e),[T,V]=l.useState(u),[S,w]=l.useState(0);return l.useEffect(()=>{if(r)if(S===-1){const M=r.getState().pagination.pageSize-1;r!=null&&r.getRowModel().rows[M]&&(V(M),s(M),w(0))}else S===1&&r!=null&&r.getRowModel().rows[0]&&(V(0),s(0),w(0))},[r==null?void 0:r.getState().pagination.pageIndex,r==null?void 0:r.getRowModel().rows]),!x.form.addNavigationButtons||r===void 0||T===void 0?null:t.jsxs(P,{children:[t.jsx(ie,{color:"primary",disabled:T===0&&!r.getCanPreviousPage()||S!==0,onClick:()=>{T>0?(V(T-1),s(T-1)):(w(-1),r.previousPage())},children:t.jsx(wn,{})}),t.jsx(ie,{color:"primary",disabled:T+1===r.getRowCount()%r.getState().pagination.pageSize&&!r.getCanNextPage()||S!==0,onClick:()=>{(T+1)%r.getState().pagination.pageSize>0?(V(T+1),s(T+1)):(w(1),r.nextPage())},children:t.jsx(Tn,{})})]})};var qn=Nn();const Be=Pn(qn),vt=l.lazy(()=>te(()=>import("./Alert-1.0.40-Bz3Zj62D.js"),__vite__mapDeps([56,1,2,3,24,20,9,5,6,7,8,21,57,58,59]),import.meta.url)),Ft=({appId:e,primaryKey:s,formMode:r,showTable:u,showForm:x,detailKey:T,children:V,relationAppId:S,relTab:w,joinTab:M,isEmbedded:J,masterAppId:D,isModal:N,tableInstance:g,tableRowIndex:h})=>{var rt,it,lt,at,ut,ct;i.debug(e,s,r,T,S,w,M,J,D,N);const y=je(),L=l.useRef(null),le=Ln(e),j=Nt(e),ae=Wt(),H=Ze(e),K=Ie(e),G=zt();Yt(e);const[W,ue]=l.useState(r),Q=l.useMemo(()=>on(),[]),[ce,q]=l.useState(!1),[ne,Se]=l.useState(""),o=Je(e),de=Ue(e),R=sn((rt=o==null?void 0:o.app)==null?void 0:rt.container[0]),xe=zn(e),z=Je(D??""),we=Ue(D??""),Te=Ut(e),[oe,he]=l.useState(null);l.useEffect(()=>{i.debug(xe,e),xe===!0&&(i.debug("setM2MUpdate: false"),I(!1,()=>{},()=>{},()=>{y(pt({appId:e,update:!1}))}))},[xe]);const He=n=>{var d;const a=(d=g==null?void 0:g.getRowModel().rows[n])==null?void 0:d.original;if(i.debug("setPrimaryKey",a,n),a){const b={...s};Object.keys(s).map(c=>{b[c]=a[c]}),i.debug("newPrimaryKey",b),ye(b)}};l.useEffect(()=>{s===null?We():Object.keys(s).length>0?ye(s):q(!0)},[s]);const ye=n=>{jn(e,n,o==null?void 0:o.media,a=>{if(i.debug(a),(a==null?void 0:a.code)==="ok"){if(Array.isArray(a.data)&&a.data.length>0){const d={...a.data[0]},b={...a.context};delete b.debug,y(ze({appId:e,data:d,context:b})),a.data.length>1?he("Query returned more than one row. Check configuration."):he(null)}else{const d={...a.context};delete d.debug,y(ze({appId:e,data:{},context:d})),he("Invalid primary key. Check configuration.")}q(!0)}else A(j.invalidResponse,{variant:"error"})},a=>{i.error("error",a),Se(a??j.invalidResponse)},!1,w)},We=()=>{var n,a;if(o.columns&&Array.isArray(o.columns)){const d={},b=Ne.getSelectors().selectFormColumns(se.getState().forms,e),c=Object.fromEntries(b.map(p=>[p.columnName,p.defaultValue]));i.debug("defaultValues",c);for(let p=0;p<o.columns.length;p++)d[o.columns[p].column_name]=null,c[o.columns[p].column_name]!==void 0&&(c[o.columns[p].column_name]==="@wpda_wp_user_id"?d[o.columns[p].column_name]=(a=(n=o==null?void 0:o.settings)==null?void 0:n.env)==null?void 0:a.id:c[o.columns[p].column_name]==="@now"?o.columns[p]==="date"?d[o.columns[p].column_name]=Be(Date.now()).format("YYYY-MM-DD"):d[o.columns[p].column_name]=Be(Date.now()).format("YYYY-MM-DD HH:mm:ss"):o.columns[p].column_default!==null&&o.columns[p].column_default!=="NULL"&&o.columns[p].column_default!==""?o.columns[p].column_default==="CURRENT_TIMESTAMP"?o.columns[p]==="date"?d[o.columns[p].column_name]=Be(Date.now()).format("YYYY-MM-DD"):d[o.columns[p].column_name]=Be(Date.now()).format("YYYY-MM-DD HH:mm:ss"):d[o.columns[p].column_name]=o.columns[p].column_default:d[o.columns[p].column_name]=c[o.columns[p].column_name]);i.debug(d),y(ze({appId:e,data:d,context:{media:{}}})),i.debug("init"),q(!0)}},Ee=()=>{let n="";for(const a in o.columns)o.columns[a].extra==="auto_increment"&&(n=o.columns[a].column_name);return i.debug(n),n},pe=n=>{var p;const a=(p=Ne.getSelectors().selectFormState(se.getState().forms,e))==null?void 0:p.validation;i.debug("rowValidation",a);let d=!1;for(const m in a)if(a[m].error===!0&&a[m].type===Ve.COLUMN){d=!0;break}if(d)return i.debug("validateForm returned errors"),!1;let b=!0;const c=Ee();for(const m in n){const f=ln(o,m);let v=!0;f.column_name!==c&&f.is_nullable==="NO"&&(n[m]===null||n[m]==="")&&(r===U.UPDATE||r===U.INSERT&&(f.column_default===null||f.column_default==="NULL"||f.column_default==="")||_e.preserveSpacesOnUpdate===!1&&n[m]==="")&&(y(Ye({appId:e,columnName:m,columnError:!0,columnText:j.mandatoryField,columnType:Ve.FORM})),v=!1,b=!1);const F=Ne.getSelectors().selectFormColumns(se.getState().forms,e);let Y;for(let E=0;E<F.length;E++)F[E].columnName===m&&(Y=F[E]);if(i.debug(Y),v&&f.data_type==="time"){const E=n[m];if(E.length===6){let $=E.substring(2,3),B=E.substring(4,5);(Number($)>5||Number(B)>5)&&(y(Ye({appId:e,columnName:m,columnError:!0,columnText:j.mandatoryField,columnType:Ve.FORM})),v=!1,b=!1)}}v&&y(Ye({appId:e,columnName:m,columnError:!1,columnText:"",columnType:Ve.FORM}))}return b},Re=()=>{},be=n=>{},I=(n,a,d,b)=>{var p;const c=(p=Ne.getSelectors().selectFormState(se.getState().forms,e))==null?void 0:p.data;if(i.debug(c),Re()!==!1)if(pe(c)){if(s!==null){const m={};Object.keys(c).map(f=>{le.map(v=>{f===v.columnName&&v.updatable&&(m[f]=c[f])})}),i.debug(m),jt(e,s,m,f=>{var v;if(i.debug(f),f!=null&&f.code&&(f!=null&&f.message)){switch(f.code){case"ok":A(j.updatedSuccessful,{variant:"success"}),((v=f.context)==null?void 0:v.updated)!==void 0&&Object.keys(f.context.updated).map(F=>{y(_t({appId:e,columnName:F,columnValue:f.context.updated[F]}))}),n&&(a!==void 0&&a(s),setTimeout(()=>{u(!0,S)},1e3)),b&&b();break;case"info":A(j.nothingToUpdate,{variant:"info"}),n&&(a!==void 0&&a(s),setTimeout(()=>{u(!0,S)},1e3)),b&&b();break;default:i.error(f),A(f.message??j.invalidResponse,{variant:"error"}),n&&u(!0,S)}be(f==null?void 0:f.code)}else i.error(f),A(j.invalidResponse,{variant:"error"})},f=>{i.error("error",f),A(f??j.invalidResponse,{variant:"error"})},!1,M,w)}else y(rn({appId:e,property:{isRowCountUpdated:!0}})),St(e,c,m=>{if(i.debug(m),m!=null&&m.code&&(m!=null&&m.message)){let f;const v={};switch(m.code){case"ok":A(j.insertSuccessful,{variant:"success"}),f=Ee();for(let F=0;F<o.primary_key.length;F++){const Y=cn(o,o.primary_key[F]);let E;Y!==void 0&&(E=o==null?void 0:o.columns[Y]),f!==""&&f===(E==null?void 0:E.column_name)?v[o.primary_key[F]]=m.context.insert_id:v[o.primary_key[F]]=c[o.primary_key[F]]}if((R==null?void 0:R.cardinality)===Ae.ONE_TO_ONE){const F={};z!=null&&z.primary_key&&Array.isArray(z==null?void 0:z.primary_key)&&(z==null||z.primary_key.map(E=>F[E]=we[E]));const Y={};if(R.join_condition!==void 0){const E=R.join_condition.split(",");for(let $=0;$<E.length;$++){const B=E[$].split("=");B.length===2&&(Y[B[0]]=v[B[1]])}}jt(e,F,Y,()=>{Object.keys(we).map(E=>{if(R.join_condition!==void 0){const $=R.join_condition.split(",");for(let B=0;B<$.length;B++){const ge=$[B].split("=");ge.length===2&&ge[0]===E&&D&&y(_t({appId:D,columnName:E,columnValue:de[ge[1]]}))}}})},()=>{})}if(n){a!==void 0&&a(v),u(!0,S);return}x(v,De.UPDATE),d&&d(),b&&b();break;default:i.error(m),A(m.message??j.invalidResponse,{variant:"error"})}be(m==null?void 0:m.code)}else i.error(m),A(j.invalidResponse,{variant:"error"})},m=>{i.error("error",m),A(m??j.invalidResponse,{variant:"error"})},!1,M,w);i.debug(S),S!==void 0&&(i.debug("setM2MUpdate: true"),y(pt({appId:S,update:!0})))}else i.error("Validation failed: ",c)},Ce=()=>oe===null?null:t.jsx(l.Suspense,{children:t.jsx(P,{sx:{marginTop:"30px"},children:t.jsx(vt,{severity:"error",message:oe,close:!1})})}),ve=n=>{if(n!==null&&pe(de)){const a=qe.getSelectors().selectTableById(se.getState().tables,e),d=a.state.relation.relation_join_condition.split(",").map(c=>c.split("=")),b={...a.state.detailKey};d.map(c=>{b[c[0]]=n[c[1]]}),St(e,b,c=>{if(i.debug(c),c!=null&&c.code&&(c!=null&&c.message))switch(c.code){case"ok":i.debug("Added relation to join table",c);break;default:i.error(c),A(c.message??j.invalidResponse,{variant:"error"})}else i.error(c),A(j.invalidResponse,{variant:"error"})},c=>{i.error(c),A(c??j.invalidResponse,{variant:"error"})},!1,!0,!1)}},[Fe,Me]=l.useState(void 0),ke=()=>{try{I(!1,()=>{},()=>{var a,d,b,c,p,m,f,v,F,Y,E,$,B,ge,dt,mt,ft,gt,xt,ht;const n=JSON.parse((d=(a=o==null?void 0:o.app)==null?void 0:a.app[0])==null?void 0:d.app_settings);if(i.debug(n),((c=(b=n==null?void 0:n.settings)==null?void 0:b.app_registration)==null?void 0:c.showMessage)===!0&&((m=(p=n==null?void 0:n.settings)==null?void 0:p.app_registration)==null?void 0:m.message)!==void 0&&((v=(f=n==null?void 0:n.settings)==null?void 0:f.app_registration)==null?void 0:v.message)!==null&&((Y=(F=n==null?void 0:n.settings)==null?void 0:F.app_registration)==null?void 0:Y.message.trim())!==""&&Me(($=(E=n==null?void 0:n.settings)==null?void 0:E.app_registration)==null?void 0:$.message),((ge=(B=n==null?void 0:n.settings)==null?void 0:B.app_registration)==null?void 0:ge.allowUpdates)!==!0&&(ue(U.VIEW),((mt=(dt=n==null?void 0:n.settings)==null?void 0:dt.app_registration)==null?void 0:mt.showUrl)===!0&&((gt=(ft=n==null?void 0:n.settings)==null?void 0:ft.app_registration)==null?void 0:gt.url)!=="")){const Kt=((ht=(xt=n==null?void 0:n.settings)==null?void 0:xt.app_registration)==null?void 0:ht.urlTime)??3;setTimeout(()=>{window.location.href=n.settings.app_registration.url},Kt)}})}catch(n){i.error("Invalid JSON - app settings"),i.error(n),A(un.contactSupport,{variant:"error"})}},Oe=()=>{I(!1)},Pe=()=>{var a,d,b;const n=qe.getSelectors().selectTableById(se.getState().tables,e);i.debug((a=n==null?void 0:n.state)==null?void 0:a.relation),((b=(d=n==null?void 0:n.state)==null?void 0:d.relation)==null?void 0:b.cardinality)===Ae.MANY_TO_MANY?I(!0,ve):I(!0)},me=()=>{u(!0,S)},_e=Ke(),_=Ct(e),k=Ct(S??""),O=An(e),C=l.useRef(null),X=Dt(),[fe,$t]=l.useState((it=C==null?void 0:C.current)==null?void 0:it.offsetWidth),[Gt,qt]=l.useState({paddingTop:"50px",paddingBottom:"50px",paddingLeft:"50px",paddingRight:"50px"}),[Jt,et]=l.useState("30px"),[Qt,tt]=l.useState("");if(l.useEffect(()=>{if(C.current!==null){$t(C.current.offsetWidth);let n=fe<600?.3:fe<900?.6:1;(N??!1)===!0&&(n=1),qt({paddingTop:`calc(${n} * 50px)`,paddingBottom:`calc(${n} * 50px)`,paddingLeft:`calc(${n} * 50px)`,paddingRight:`calc(${n} * 50px)`}),fe<600?(et("10px"),tt("10px")):fe<900&&(et("20px"),tt("20px"))}},[X.width,C.current,_e.spacing]),ne!=="")return t.jsx(l.Suspense,{children:t.jsx(vt,{severity:"error",message:ne,close:!1})});const nt=()=>t.jsx(Wn,{appId:e,metaData:o,primaryKey:s,formMode:W,formUuid:Q}),Xt=()=>t.jsxs(t.Fragment,{children:[t.jsx(ie,{color:"inherit",onClick:()=>{const n={appId:e};i.info(R),R!=null&&(n.hideThemeSettings=!0),S!==void 0&&(n.isRelationForm=!0),y(Pt(n))},children:t.jsx(At,{})}),t.jsx(ie,{color:"inherit",onClick:()=>{me()},children:t.jsx(Bt,{})})]}),Zt=l.useMemo(()=>{var n,a,d,b,c;return(n=o==null?void 0:o.src)!=null&&n.app_id&&((d=(a=o==null?void 0:o.app)==null?void 0:a.app[0])==null?void 0:d.app_title)!==""?o.app.app[0].app_title:(b=o==null?void 0:o.src)!=null&&b.dbs&&((c=o==null?void 0:o.src)!=null&&c.tbl)?o.src.dbs+" - "+o.src.tbl:"WP Data Access"},[]),ot=(((at=(lt=H==null?void 0:H.table)==null?void 0:lt.modal)==null?void 0:at.maxHeight)??95)+(((ct=(ut=H==null?void 0:H.table)==null?void 0:ut.modal)==null?void 0:ct.maxHeightUnit)??"vh"),st=()=>{var n,a,d;return t.jsxs(yt,{elevation:ae,ref:L,children:[(N??!1)===!0&&t.jsx(Vt,{sx:{position:"unset",borderBottomRightRadius:0,borderBottomLeftRadius:0,boxShadow:"none"},children:t.jsxs(Lt,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(P,{sx:{display:"flex",alignItems:"center",cursor:"move",gap:"2px","& svg":{width:"2em",height:"2em"}},id:bt(o,"title"),children:t.jsx(P,{sx:{display:"block",whiteSpace:"nowrap",fontSize:"18px",lineHeight:"18px",fontWeight:"bold",textOverflow:"ellipsis",overflow:"hidden",marginRight:"10px"},children:Zt})}),t.jsx(P,{children:(N??!1)===!0&&Qe(o)&&t.jsx(t.Fragment,{children:Xt()})})]})}),t.jsxs(P,{style:Gt,sx:{...(N??!1)===!0&&Te!==void 0&&{maxHeight:`calc(${ot} - 240px)`,overflow:"auto",backgroundColor:"transparent",border:"none",borderRadius:0}},children:[t.jsxs(P,{sx:{margin:0,padding:"5px 0",...(N??!1)===!0&&Te===void 0&&{maxHeight:`calc(${ot} - 240px)`,overflow:"auto"}},children:[nt(),V,Ce()]}),t.jsxs(P,{sx:{marginTop:{marginTop:Jt},paddingRight:{paddingRight:Qt},padding:0,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(P,{sx:{display:"flex",gap:"8px"},children:[t.jsx(Gn,{appId:e,tableInstance:g,tableRowIndex:h,setPrimaryKey:He}),!1,(_||k)&&t.jsx(t.Fragment,{children:fe<600?t.jsx(ie,{color:"primary",onClick:()=>{y(Le({appId:e,more:!O})),S!==void 0&&y(Le({appId:S,more:!O}))},children:O?t.jsx(wt,{}):t.jsx(Tt,{})}):t.jsx(re,{variant:"outlined",startIcon:O?t.jsx(wt,{}):t.jsx(Tt,{}),onClick:()=>{y(Le({appId:e,more:!O})),S!==void 0&&y(Le({appId:S,more:!O}))},children:O?j.less:j.more})}),((n=G==null?void 0:G.customActionsBottom)==null?void 0:n.enabled)===!0&&kt(o)&&t.jsx(t.Fragment,{children:t.jsx(Yn,{code:G.customActionsBottom.code??"",safeMode:K.safeMode,isExpression:!1,args:{row:de,mode:an[r]}})}),t.jsx(P,{className:"pp-registration-form-message",children:Fe})]}),t.jsx(P,{sx:{...fe<600&&{marginLeft:"0 !important","& button":{marginLeft:"2px",padding:"6px"}}},children:r!==U.VIEW?t.jsx(t.Fragment,{children:((d=(a=o==null?void 0:o.app)==null?void 0:a.app[0])==null?void 0:d.app_type)==Ge.REGISTRATION&&H.state.masterDetailConditions===void 0?t.jsx(t.Fragment,{children:(W===U.INSERT||W===U.UPDATE)&&t.jsx(re,{variant:"contained",onClick:ke,type:"submit",form:Q,sx:{marginLeft:"8px"},children:j.ok})}):t.jsxs(t.Fragment,{children:[t.jsx(re,{variant:"contained",onClick:Oe,type:"submit",form:Q,disabled:oe!==null,children:j.apply}),(R==null?void 0:R.cardinality)!==Ae.ONE_TO_ONE&&t.jsxs(t.Fragment,{children:[t.jsx(re,{variant:"outlined",onClick:Pe,sx:{marginLeft:"8px"},children:j.ok}),t.jsx(re,{variant:"outlined",onClick:me,sx:{marginLeft:"8px"},children:j.cancel})]})]})}):t.jsx(t.Fragment,{children:(R==null?void 0:R.cardinality)!==Ae.ONE_TO_ONE&&t.jsx(re,{variant:"contained",onClick:me,children:j.back})})})]}),t.jsx(t.Fragment,{children:!1})]})]})};return J?nt():(l.useEffect(()=>{var n;C.current!==null&&((n=window.document.getElementById(`pp-app-${e}`))==null||n.scrollIntoView())},[C.current]),t.jsx("div",{className:`${e}_wrapper pp-form`,ref:C,style:{scrollMarginTop:"70px"},children:ce&&de!==null?t.jsx(t.Fragment,{children:(N??!1)===!0?t.jsx(t.Fragment,{children:t.jsx(kn,{handle:"#"+bt(o,"title"),nodeRef:L,offsetParent:document.body,children:st()})}):t.jsx(t.Fragment,{children:st()})}):t.jsx(yt,{style:{padding:"50px"},elevation:ae,children:t.jsx(Xe,{title:j.loadingData})})}))},Jn=l.lazy(()=>te(()=>import("./Settings-1.0.40-XeSp3qIG.js"),__vite__mapDeps([60,10,1,2,3,11,5,6,7,8,15,4,9,16,17,18,23,19,20,21,22,24,25,26,14,27,28,29,30,45,32,36,37,38,43,44,42,34,35,46,33,47,48,49,50,13,51,52,53,54,55,39]),import.meta.url)),Mt=({appId:e,primaryKey:s,formMode:r,showTable:u,showForm:x,metaData:T,detailKey:V,selectionForm:S,masterAppId:w,tableInstance:M,tableRowIndex:J})=>{i.debug(e,s,r,T,V,S,w);const D=_n(),g=Ze(e).table;i.debug("relationship",null);const y=l.useMemo(()=>{},[]);i.debug("relationAppId",y);const L=()=>null,le=()=>null,j=()=>null,ae=()=>{var K,G,W,ue,Q,ce,q,ne;return t.jsx(yn,{open:!0,className:"pp-form-modal",sx:{zIndex:9999990},children:t.jsx(P,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",minWidth:(((K=g==null?void 0:g.modal)==null?void 0:K.minWidth)??60)+(((G=g==null?void 0:g.modal)==null?void 0:G.minWidthUnit)??"vw"),maxWidth:(((W=g==null?void 0:g.modal)==null?void 0:W.maxWidth)??90)+(((ue=g==null?void 0:g.modal)==null?void 0:ue.maxWidthUnit)??"vw"),minHeight:(((Q=g==null?void 0:g.modal)==null?void 0:Q.minHeight)??0)+(((ce=g==null?void 0:g.modal)==null?void 0:ce.minHeightUnit)??"vh"),maxHeight:(((q=g==null?void 0:g.modal)==null?void 0:q.maxHeight)??95)+(((ne=g==null?void 0:g.modal)==null?void 0:ne.maxHeightUnit)??"vh"),backgroundColor:"transparent"},children:t.jsx(Ft,{appId:e,primaryKey:s,formMode:r,showTable:u,showForm:x,detailKey:V,relationAppId:y,masterAppId:w,isModal:!0,tableInstance:M,tableRowIndex:J,children:le()})})})},H=()=>t.jsx(Ft,{appId:e,primaryKey:s,formMode:r,showTable:u,showForm:x,detailKey:V,relationAppId:y,masterAppId:w,tableInstance:M,tableRowIndex:J,children:le()});return t.jsxs(t.Fragment,{children:[S===!0?t.jsx(t.Fragment,{children:L()}):t.jsx(t.Fragment,{children:g.formModal===!0?t.jsx(t.Fragment,{children:ae()}):t.jsx(t.Fragment,{children:H()})}),t.jsx(t.Fragment,{children:Qe(T)&&t.jsx(Ht,{theme:D,children:t.jsx(l.Suspense,{fallback:t.jsx(Xe,{}),children:t.jsx(Jn,{appId:e})})})}),j()]})},Qn=e=>{const s=Z(r=>{var u,x;return((x=(u=r.tables[e])==null?void 0:u.state)==null?void 0:x.fullScreen)??!1});return i.debug("fullScreen",s),s},Xn=()=>{const e=Z(s=>s.ui);return i.debug("uiSetting",e),e},Zn=e=>(je(),{builtinLog:e,builtinShowAlert:(x,T)=>{},builtinShowConfirm:(x,T,V)=>{},builtinShowSnackbar:(x,T)=>{}}),Kn=({label:e})=>t.jsx(re,{variant:"contained",color:"primary",children:e}),In=l.lazy(()=>te(()=>import("./TableContainer-1.0.40-DiO5TNZP.js").then(e=>e.T),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39]),import.meta.url));l.lazy(()=>te(()=>import("./TableMapDock-1.0.40-BOzQVog5.js"),__vite__mapDeps([61,1,2,3,62,10,11,5,6,7,8,45,15,13,14,9,20,21]),import.meta.url));l.lazy(()=>te(()=>import("./TableChartDock-1.0.40-hRA6a9Jo.js"),__vite__mapDeps([63,1,2,3,64,10,11,5,6,7,8,42,34,35,15,14,9,25,20,21,53,29,54,55,45]),import.meta.url));const eo=({appId:e})=>{var pe,Re,be,I,Ce,ve,Fe,Me,ke,Oe,Pe,me,_e;i.debug(e);const s=je(),r=Cn(),u=En(),x=Wt(),T=Ut(e);Sn(e);const S=Ze(e).table,w=Xn();Dt();const M=Ke(),J=Mn(),D=Fn(J,S,M),N=Nt(e),g="pp-remove-body-vertical-scrollbar",h=Je(e),y=l.useMemo(()=>{var _,k,O,C,X;return(_=h==null?void 0:h.src)!=null&&_.app_id&&((O=(k=h==null?void 0:h.app)==null?void 0:k.app[0])==null?void 0:O.app_title)!==""?h.app.app[0].app_title:(C=h==null?void 0:h.src)!=null&&C.dbs&&((X=h==null?void 0:h.src)!=null&&X.tbl)?h.src.dbs+" - "+h.src.tbl:"WP Data Access"},[]),L=`_reactRoots_${e.replaceAll("-","_")}`;l.useEffect(()=>()=>{window[L]&&delete window[L]},[]);const{builtinLog:le,builtinShowAlert:j,builtinShowConfirm:ae,builtinShowSnackbar:H}=Zn(i);window.wpda={log:le,alert:j,confirm:ae,snackbar:H,button:(_,k)=>{window.document.querySelectorAll(`#${_}`).forEach(O=>{const C=window[L]||new Map;window[L]=C;let X=C.get(O);X||(X=It.createRoot(O),C.set(O,X)),X.render(t.jsx(Ht,{theme:l.useMemo(()=>D,[]),children:t.jsx(Kn,{label:k})}))})}};const K=Qn(e);l.useEffect(()=>(i.debug(K),()=>{var _;(_=window.document.getElementById(g))==null||_.remove(),window.document.body.classList.remove("pp-fullscreen")}),[K]);const G=l.useMemo(()=>qe.getSelectors().selectTableExploring(se.getState().tables,e),[e]);i.debug("tableExploring",G);const[W,ue]=l.useState(((Re=(pe=h==null?void 0:h.app)==null?void 0:pe.app[0])==null?void 0:Re.app_type)==Ge.REGISTRATION?ee.FORM:ee.TABLE),[Q,ce]=l.useState(!1),q=_=>{s(pn({appId:e,mode:_})),ue(_)};l.useEffect(()=>{window.ppShowForm=function(_){i.debug(_),o(_),q(ee.FORM)}},[e]);const ne=(_,k)=>{i.debug(_,k),bn(e)&&(u(e),k!==void 0&&(r(k),u(k))),_&&ce(!Q),q(ee.TABLE)},[Se,o]=l.useState(null),[de,R]=l.useState(U.VIEW),[xe,z]=l.useState(void 0),[we,Te]=l.useState(void 0),oe=(_,k,O,C)=>{switch(i.debug(_,k,C),k){case De.INSERT:R(U.INSERT);break;case De.UPDATE:R(U.UPDATE);break;default:R(U.VIEW)}o(_),z(O),Te(C),q(ee.FORM)};let he={};Ie(e);const[He]=l.useState(((Ce=window.PP_APP_CONFIG[(I=(be=h==null?void 0:h.app)==null?void 0:be.app[0])==null?void 0:I.app_id])==null?void 0:Ce.hideTitleBar)===!0),ye=()=>null,We=()=>t.jsx(l.Suspense,{fallback:t.jsx($e,{title:N.loadingForm}),children:t.jsx(Mt,{appId:e,primaryKey:Se,formMode:U.INSERT,showTable:()=>{},showForm:oe,metaData:h})}),Ee=()=>{var _,k;return((k=(_=h==null?void 0:h.app)==null?void 0:_.app[0])==null?void 0:k.app_type)==Ge.REGISTRATION?We():t.jsxs(t.Fragment,{children:[t.jsxs(l.Suspense,{fallback:t.jsx($e,{title:N.loadingTable}),children:[!1,t.jsx(In,{appId:e,display:W===ee.TABLE,refresh:Q,showForm:oe,metaData:h}),!1]}),W===ee.FORM&&t.jsx(l.Suspense,{fallback:t.jsx($e,{title:N.loadingForm}),children:t.jsx(Mt,{appId:e,primaryKey:Se,formMode:de,showTable:ne,showForm:oe,metaData:h,tableInstance:xe,tableRowIndex:we})})]})};return t.jsxs(P,{className:"pp-component",sx:K?he:{},children:[He!==!0&&t.jsx(Vt,{className:"pp-header",elevation:x,position:"relative",sx:{margin:"0 0 5px 0"},children:t.jsxs(Lt,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(P,{sx:{display:"block",whiteSpace:"nowrap",fontSize:"18px",lineHeight:"18px",fontWeight:"bold",textOverflow:"ellipsis",overflow:"hidden",marginRight:"10px"},children:y}),t.jsxs(P,{sx:{display:"flex",gap:"10px",justifyContent:"center",alignItems:"center"},children:[Qe(h)&&t.jsx(Rt,{title:t.jsx(Rn,{details:T,mode:W}),className:"pp-builder-button",children:t.jsx(ie,{sx:{color:"inherit",padding:0},onClick:()=>{W===ee.FORM?s(Pt({appId:e})):s(dn({appId:e}))},children:t.jsx(At,{})})}),ye(),G&&t.jsx(Rt,{title:N.close,children:t.jsx(ie,{sx:{color:"inherit",padding:0},onClick:()=>{var _;(_=window.document.getElementById(g))==null||_.remove(),window.document.body.classList.remove("pp-fullscreen"),h.src.app_id?s(mn({isActive:!1,appDbId:0})):s(fn()),u(e),r(e),s(gn())},children:t.jsx(Bt,{})})})]})]})}),Ee(),((ve=w.builtins.alert)==null?void 0:ve.title)&&((Fe=w.builtins.alert)==null?void 0:Fe.message)&&t.jsx(Vn,{title:(Me=w.builtins.alert)==null?void 0:Me.title,message:t.jsx(Et,{html:(ke=w.builtins.alert)==null?void 0:ke.message}),open:!0,setOpen:()=>{s(xn())}}),((Oe=w.builtins.confirm)==null?void 0:Oe.title)&&((Pe=w.builtins.confirm)==null?void 0:Pe.message)&&t.jsx(On,{title:(me=w.builtins.confirm)==null?void 0:me.title,message:t.jsx(Et,{html:(_e=w.builtins.confirm)==null?void 0:_e.message}),open:!0,setOpen:()=>{s(hn())},onConfirm:()=>{var _;(_=w.builtins.confirm)!=null&&_.callback&&w.builtins.confirm.callback()}})]})},Oo=Object.freeze(Object.defineProperty({__proto__:null,default:eo},Symbol.toStringTag,{value:"Module"}));export{De as R,Oo as S,Ln as a,An as b,Qn as c,Wt as d,zt as e,Ue as f,Yt as g,Un as h,Dn as i,Be as j,$n as u};
