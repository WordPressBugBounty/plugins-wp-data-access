import{j as e,cY as $,l as h,r as M,a6 as I,S as ee,cZ as ie,cd as L,C as z,cj as x,c_ as se,i as te,bu as ae,c$ as ne,d0 as re,d1 as oe,d2 as le,K as f,d3 as de,d4 as ce,d5 as me,d6 as pe,d7 as ue}from"./main-1.0.17.js";import{S as xe,u as ge,a as W,D as he,c as je,b as fe,d as be,T as ye,M as Se,P as ke}from"./SortableDragHandle-1.0.17-a2162a27.js";import{u as Te}from"./useTableSortableColumns-1.0.17-11425f5b.js";import{u as F,S as ve,a as we,I as V,b as Ae}from"./useMetadataColumns-1.0.17-3a349218.js";import{a as A,B as c,u as Q,c as R,d as Ee,e as Pe,a5 as Ne,a6 as Me,a7 as De,C as Le,a8 as Ce,a9 as Fe,aa as Re,ab as Oe,ac as Be,ad as Ue}from"./main-1.0.17-54ffa424.js";import{p as _e}from"./index.esm-1.0.17-78a91bbf.js";import{S as k,T as P,C as Ge}from"./TabPanel-1.0.17-3c2dbf14.js";import{u as E}from"./useTableUpdater-1.0.17-299f713b.js";import{b as w,F as S,a as T}from"./Select-1.0.17-745624d0.js";import{S as X}from"./Slider-1.0.17-27606716.js";import{P as H}from"./PremiumFeature-1.0.17-12e324e9.js";import{A as Y}from"./useScreenSize-1.0.17-44173319.js";import{b as We,c as Ve,a as ze}from"./index.esm-1.0.17-11edad0c.js";import{A as O,a as B}from"./AccordionSummary-1.0.17-276b7b2a.js";import{A as U}from"./AccordionDetails-1.0.17-7b8437b0.js";import{F as v}from"./FormControlLabel-1.0.17-cc31d0c1.js";import{R as He}from"./RadioGroup-1.0.17-46153993.js";import{R as C}from"./Radio-1.0.17-2bbb6717.js";import{T as D,A as qe}from"./TargetEnum-1.0.17-1e1ba2c5.js";import{L as Qe}from"./Link-1.0.17-88d48a3e.js";import{A as b,a as y}from"./TableContainer-1.0.17-008f8fba.js";import{C as Xe}from"./Checkbox-1.0.17-3dddd4e7.js";import{I as N}from"./iconBase-1.0.17-8d991e6c.js";import{D as Ye}from"./usePrepareStore-1.0.17-a8be8b2f.js";import"./useStoreTable-1.0.17-fdcf1717.js";import"./useFormStore-1.0.17-baf3b989.js";import"./Stepper-1.0.17-9e6367ba.js";import"./createSvgIcon-1.0.17-f0c1dc0a.js";import"./Collapse-1.0.17-faa698ed.js";import"./ActionsDml-1.0.17-9041b8e8.js";import"./MenuItem-1.0.17-ed8ab45a.js";import"./Menu-1.0.17-09126381.js";import"./index-1.0.17-e83aeb27.js";import"./DialogContent-1.0.17-9628df83.js";import"./Tabs-1.0.17-a2a1c721.js";import"./useSlot-1.0.17-ca7553c5.js";import"./Close-1.0.17-6c546366.js";import"./index.esm-1.0.17-e75a3d2e.js";import"./AlertTitle-1.0.17-4b186927.js";import"./InputAdornment-1.0.17-012556cc.js";import"./ListItemIcon-1.0.17-21c8997f.js";import"./DateTimePicker-1.0.17-88f02f82.js";import"./useMobilePicker-1.0.17-7c45344d.js";import"./date-time-utils-1.0.17-c30caadb.js";import"./dateViewRenderers-1.0.17-d51d277e.js";import"./TimePicker-1.0.17-43c48cfc.js";import"./DatePicker-1.0.17-e7f585a0.js";import"./index.esm-1.0.17-3107c6b2.js";import"./SanitizeComponent-1.0.17-b68e53d1.js";import"./index-1.0.17-9ae5630d.js";import"./settings-1.0.17-bb8125cf.js";import"./ScopeEnum-1.0.17-7caf102d.js";const Je=({appId:s,columnIndex:o,tableColumn:i})=>{const d=A(),a=E(s);return e.jsxs(c,{sx:{margin:"0 1rem 2rem 1rem"},children:[e.jsx(w,{children:"Width"}),e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"1fr auto",gridGap:"30px",alignItems:"center"},children:[e.jsx(X,{min:60,max:420,step:1,value:i.width,marks:[{value:60,label:"60"},{value:120,label:"120"},{value:180,label:"180"},{value:240,label:"240"},{value:300,label:"320"},{value:360,label:"360"},{value:420,label:"420"}],valueLabelDisplay:"auto",onChange:(t,m)=>{d($({appId:s,index:o,width:m})),a(!0),t.stopPropagation()}}),e.jsx("span",{children:"px"})]}),e.jsx(S,{children:e.jsxs(T,{children:["Column width is relative when responsiveness = ",e.jsx("strong",{children:"auto column hiding"}),"."]})})]})},Ke=({appId:s,columnIndex:o,tableColumn:i})=>{var u,n,j;h.debug(s,o,i),A();const d=M.useMemo(()=>I(ee.getState(),s),[]);F(s,d);const[a,t]=M.useState(!1),m=Q(p=>ie(p,s));M.useState(!1),E(s);const l=!0;return e.jsxs(O,{disableGutters:!0,children:[e.jsxs(B,{expandIcon:e.jsx(R,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(We,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Column actions"})]}),e.jsxs(U,{sx:{display:"grid",paddingTop:"1rem"},children:[e.jsxs(c,{sx:{margin:"0 10px",display:"grid",gridTemplateColumns:"auto"},children:[i.computedField?e.jsx(v,{control:e.jsx(k,{checked:!1,disabled:!0}),label:"Enable inline search",labelPlacement:"end"}):e.jsx(v,{control:e.jsx(k,{checked:i.inlineSearch&&!l,disabled:l,onChange:(p,_)=>{p.stopPropagation()}}),label:"Enable column filter",labelPlacement:"end"}),i.inlineSearch&&!l&&e.jsxs(c,{children:[e.jsxs(He,{sx:{flexDirection:"column",alignContent:"flex-start",marginLeft:"20px",marginTop:"10px",marginBottom:"10px"},children:[e.jsxs(w,{className:"align-label-radio",children:[e.jsx(C,{checked:i.inlineSearchEnum===L.SEARCHBOX,disabled:!0,onChange:p=>{p.stopPropagation()}}),"Searchbox"]}),e.jsxs(w,{className:"align-label-radio",children:[e.jsx(C,{checked:i.inlineSearchEnum===L.DROPDOWN,disabled:!0,onChange:p=>{p.stopPropagation()}}),"Drop-down list"]}),e.jsxs(w,{className:"align-label-radio",children:[e.jsx(C,{checked:i.inlineSearchEnum===L.MULTISELECT,disabled:!0,onChange:p=>{p.stopPropagation()}}),"Multi-select drop-down list"]}),e.jsxs(w,{className:"align-label-radio",children:[e.jsx(C,{checked:i.inlineSearchEnum===L.SEARCHPANE,disabled:!0,onChange:p=>{p.stopPropagation()}}),"Search pane"]})]}),i.lookup!==void 0&&((u=i.lookup)==null?void 0:u.loadOnStartup)!==!0&&e.jsx(S,{sx:{marginBottom:"20px",marginLeft:"5px"},children:e.jsxs(T,{sx:{color:(n=Y)==null?void 0:n.palette.error.main,"& svg":{marginRight:"5px",verticalAlign:"middle"}},children:[e.jsx(Ee,{size:"18px"}),e.jsx("span",{children:"Drop-down lists are only supported for lookups loaded into memory on startup."})]})}),e.jsx(D,{fullWidth:!0,type:"number",label:"Order",value:i.columnFilterOrder,helperText:"Position of column filter in search panel.",disabled:!0,onChange:p=>{p.stopPropagation()},sx:{marginLeft:"15px",marginBottom:"20px"}})]}),((j=d==null?void 0:d.privs)==null?void 0:j.update)&&d.primary_key.length>0&&e.jsx(e.Fragment,{children:!i.computedField&&!i.columnName.startsWith(z.relationTablePrefix)?e.jsx(v,{control:e.jsx(k,{checked:m&&i.visible&&i.inlineEditing,disabled:!0,onChange:(p,_)=>{p.stopPropagation()}}),label:"Enable inline editing",labelPlacement:"end"}):e.jsx(v,{control:e.jsx(k,{checked:!1,disabled:!0}),label:"Enable inline editing",labelPlacement:"end"})})]}),!1,e.jsxs(T,{component:"div",sx:{marginTop:"30px"},children:[e.jsx(c,{children:e.jsxs(Qe,{sx:{textDecoration:"none",cursor:"pointer",display:"inline-flex","& svg":{fontSize:"1rem",marginRight:"2px"}},onClick:()=>t(!a),children:[e.jsx(Pe,{}),"What are column actions?"]})}),a&&e.jsxs(c,{sx:{marginTop:"20px",display:"grid",gap:"20px"},children:[e.jsx(c,{children:"Column actions are inline actions added to a table column to enhance usability and user-friendliness."}),e.jsx(c,{children:e.jsx("strong",{children:"Column filtering"})}),e.jsx(c,{children:"When column filtering is enabled, a search field is added to the table for performing column-specific searches. A search box allows wildcard searches, while drop-down lists perform exact searches. Exact searches can improve performance, especially when the searched columns are well-indexed."}),e.jsx(c,{children:"To enable the column filter feature, go to the TABLE section under Column Filters. You can also change the position of the column filters."}),e.jsx(c,{children:"The global filter performs a wildcard search. This feature can be disabled in the TABLE section under Global filter."}),e.jsx(c,{children:e.jsx("strong",{children:"Inline editing"})}),e.jsx(c,{children:"Inline editing allows users to change table columns directly, without needing to open a data entry form. This feature is not available for primary key fields. Drop-down lists are automatically generated for enum and set data types."})]})]}),e.jsx(H,{})]})]})},Ze=({appId:s,columnIndex:o,tableColumn:i})=>{var l,u;const d=A(),a=E(s),t=F(s),m=(n,j)=>{h.debug(n,j)};return e.jsxs(O,{disableGutters:!0,children:[e.jsxs(B,{expandIcon:e.jsx(R,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(Ve,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Column settings"})]}),e.jsxs(U,{sx:{display:"grid",gridGap:"2rem",paddingTop:"1rem"},children:[(i.computedField||t[i.columnName]!==void 0&&(x(t[i.columnName].data_type)==="float"||x(t[i.columnName].data_type)==="number"||x(t[i.columnName].data_type)==="time"||x(t[i.columnName].data_type,!0)==="date"||x(t[i.columnName].data_type,!0)==="datetime"||x(t[i.columnName].data_type,!0)==="timestamp"||x(t[i.columnName].data_type,!0)==="time"))&&e.jsx(c,{children:e.jsxs(S,{children:[e.jsx(v,{control:e.jsx(k,{checked:!1,disabled:!0,onClick:n=>{n.stopPropagation()}}),label:"Localize",labelPlacement:"end"}),e.jsx(T,{children:i.computedField||t[i.columnName]!==void 0&&(x(t[i.columnName].data_type)==="float"||x(t[i.columnName].data_type)==="number")?"Localizes decimal and thousands seperators.":"Localizes date and time fields."})]})}),(t[i.columnName]!==void 0&&x(t[i.columnName].data_type,!0)==="float"||i.computedField!==void 0)&&e.jsxs(S,{children:[e.jsx(w,{children:"Decimals"}),e.jsx(X,{min:0,max:6,value:i.decimals,marks:[{value:0,label:"0"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"},{value:5,label:"5"},{value:6,label:"∞"}],valueLabelDisplay:"auto",disabled:!0,onChange:(n,j)=>{h.debug(j),n.stopPropagation()}}),e.jsx(T,{children:"Number of decimals displayed."})]}),t[i.columnName]!==void 0&&i.localize&&(x(t[i.columnName].data_type,!0)==="datetime"||x(t[i.columnName].data_type,!0)==="timestamp")&&e.jsx(c,{children:x(t[i.columnName].data_type)==="date"&&e.jsx(S,{children:e.jsx(v,{control:e.jsx(k,{checked:!1,disabled:!0,onClick:n=>{n.stopPropagation()}}),label:"Add trailing zeros to days and month",labelPlacement:"end"})})}),e.jsxs(S,{children:[e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"10px",alignItems:"center"},children:[e.jsx(D,{type:"text",variant:"outlined",label:"Prefix",value:i.prefix,disabled:!0,InputLabelProps:{shrink:!0},onChange:n=>{n.stopPropagation()}}),e.jsx(D,{type:"text",variant:"outlined",label:"Suffix",value:i.suffix,disabled:!0,InputLabelProps:{shrink:!0},onChange:n=>{n.stopPropagation()}})]}),e.jsx(T,{children:"Adds a prefix and/or suffix to the column content (also added to inline text and number fields)."})]}),e.jsxs(S,{children:[e.jsx(D,{type:"text",variant:"outlined",label:"CSS classes",fullWidth:!0,value:i.classNames,disabled:!0,InputLabelProps:{shrink:!0},onChange:n=>{n.stopPropagation()}}),e.jsx(T,{children:"CSS classes (seperated by spaces) for custom styling."})]}),e.jsxs(S,{children:[e.jsx(v,{control:e.jsx(k,{checked:i.allowMarkup,onChange:(n,j)=>{d(se({appId:s,index:o,allowMarkup:j})),a(!0),n.stopPropagation()}}),label:"Allow inline HTML",labelPlacement:"end"}),e.jsxs(T,{children:["Allows markup in column content. ",e.jsx("span",{style:{...i.allowMarkup&&{color:((u=(l=Y)==null?void 0:l.palette)==null?void 0:u.error.main)??"red"}},children:"Enabling this feature may pose a risk of cross-site scripting (XSS) attacks."})]})]}),e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"auto"},children:[e.jsx(v,{control:e.jsx(k,{checked:!1,disabled:!0,onClick:n=>{te.appFeature===!0&&m(o,!i.visibleTablet),n.stopPropagation()}}),label:"Show column on tablet",labelPlacement:"end"}),e.jsx(v,{control:e.jsx(k,{checked:!1,disabled:!0,onClick:n=>{n.stopPropagation()}}),label:"Show column on mobile",labelPlacement:"end"})]}),e.jsx(H,{single:!1,margin:"0"})]})]})},$e=[{key:b.SUM,label:y.SUM},{key:b.MIN,label:y.MIN},{key:b.MAX,label:y.MAX},{key:b.AVG,label:y.AVG},{key:b.COUNT,label:y.COUNT},{key:b.UNIQUE,label:y.UNIQUE},{key:b.STD,label:y.STD},{key:b.VARIANCE,label:y.VARIANCE},{key:b.MEDIAN,label:y.MEDIAN}],q=[...$e],Ie=({appId:s,columnIndex:o,tableColumn:i})=>{h.debug(s,o,i),A(),E(s);const d=F(s),a=M.useMemo(()=>{var t;return(i==null?void 0:i.aggregation)===void 0?[]:(t=i==null?void 0:i.aggregation)==null?void 0:t.map(m=>q.filter(l=>l.key===m)[0])},[i==null?void 0:i.aggregation]);return!ae(s)||i.computedField===void 0&&x(d[i.columnName].data_type)!=="number"?null:e.jsxs(O,{disableGutters:!0,children:[e.jsxs(B,{expandIcon:e.jsx(R,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(ze,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Aggregations"})]}),e.jsxs(U,{sx:{marginTop:"10px"},children:[e.jsxs(S,{fullWidth:!0,children:[e.jsx(qe,{multiple:!0,options:q,disabled:!0,disableCloseOnSelect:!0,getOptionLabel:t=>t.label,value:a,onChange:(t,m)=>{t.stopPropagation()},renderOption:(t,m,{selected:l})=>e.jsxs("li",{...t,children:[e.jsx(Xe,{icon:e.jsx(Ne,{}),checkedIcon:e.jsx(Me,{}),style:{marginRight:8},checked:l}),m.label]}),renderInput:t=>e.jsx(D,{...t,label:"Select from list"})}),e.jsx(T,{children:"Allows multiple selections. Displayed in order of entry."})]}),e.jsx(H,{})]})]})},ei=({appId:s,columnIndex:o,tableColumn:i})=>{h.debug(s,o,i);const d=A(),a=E(s),m=F(s)[i.columnName],l=(u,n)=>{d(ne({appId:s,columnName:i.columnName})),d(re({appId:s,columnName:i.columnName})),d(oe({appId:s,index:u,lookup:n})),a(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(Je,{appId:s,columnIndex:o,tableColumn:i}),e.jsx(Ze,{appId:s,columnIndex:o,tableColumn:i}),e.jsx(Ke,{appId:s,columnIndex:o,tableColumn:i}),e.jsx(ve,{appId:s,columnIndex:o,tableColumn:i,columnMetaData:m,setLookup:l}),e.jsx(Ie,{appId:s,columnIndex:o,tableColumn:i}),e.jsx(we,{columnMetaData:m})]})},ii=({appId:s,columnIndex:o,tableType:i})=>{h.debug(s,o,i);const d=A(),a=Q(r=>le(r,s,o));h.debug("tableColumn",a);const t=E(s),[m,l]=M.useState(!1),[u,n]=M.useState(void 0),j=r=>{r!==void 0&&(d(de({appId:s,index:r})),t(!0))},p=(r,g)=>{h.debug(r,g),d(ce({appId:s,index:r,visible:g})),t(!0)},_=(r,g)=>{h.debug(r,g),d(me({appId:s,index:r,queryable:g})),t(!0)},J=(r,g)=>{h.debug(r,g),d(pe({appId:s,index:r,orderable:g})),t(!0)},G=(r,g)=>{d(ue({appId:s,index:r,alignment:g})),t(!0)},K=(r,g,Z)=>(h.debug(r,g,Z),e.jsxs(e.Fragment,{children:[e.jsx(c,{sx:{"& svg":{pointerEvents:"none",opacity:"0.5"}},children:e.jsx(xe,{id:r,enabled:!1},r)}),e.jsxs(c,{sx:{display:"inline-grid",gridTemplateColumns:a.computedField!==void 0?"auto auto":"auto",justifyContent:"start",alignItems:"center",gap:"10px","& svg":{opacity:"0.5"}},children:[a.computedField!==void 0&&e.jsx(_e,{}),e.jsx(w,{children:g})]})]}));return e.jsxs(e.Fragment,{children:[e.jsxs(O,{disableGutters:!0,slotProps:{transition:{unmountOnExit:!0}},children:[e.jsxs(B,{className:"pp-column-settings",expandIcon:e.jsx(R,{}),sx:{justifyContent:"space-between",position:"relative"},children:[i!==""&&e.jsx(c,{sx:{position:"absolute",top:"5px",right:"5px",fontSize:"50%"},children:i}),e.jsx(c,{sx:{display:"grid",gridTemplateColumns:"auto 1fr",alignItems:"center","& svg":{display:"flex"}},children:K(a.columnName,a.columnLabel,o)}),e.jsxs("div",{style:{display:"inline-grid",gridTemplateColumns:"40px 40px 40px 40px"},children:[e.jsx(P,{title:"Visibility",position:"bottom",children:e.jsx(N,{onClick:r=>{p(o,!a.visible),r.stopPropagation()},children:e.jsx(V,{checked:a.visible,children:e.jsx(De,{})})})}),a.computedField?e.jsx(P,{title:"Edit",position:"bottom",children:e.jsx("span",{children:e.jsx(N,{disabled:!0,onClick:r=>{r.stopPropagation()},children:e.jsx(Ce,{})})})}):e.jsx(P,{title:"Searchable",position:"bottom",children:e.jsx(N,{onClick:r=>{_(o,!a.queryable),r.stopPropagation()},children:e.jsx(V,{checked:a.queryable,alignRight:!1,children:e.jsx(Le,{})})})}),a.computedField?e.jsx(P,{title:"Delete",position:"bottom",children:e.jsx(N,{onClick:r=>{n(o),l(!0),r.stopPropagation()},children:e.jsx(Re,{})})}):e.jsx(P,{title:"Sortable",position:"bottom",children:e.jsx(N,{onClick:r=>{J(o,!a.orderable),r.stopPropagation()},children:e.jsx(V,{checked:a.orderable,children:e.jsx(Fe,{})})})}),e.jsx(P,{title:"Alignment",position:"bottom",children:e.jsxs(N,{onClick:r=>{a.alignment===f.LEFT?G(o,f.CENTER):a.alignment===f.CENTER?G(o,f.RIGHT):a.alignment===f.RIGHT&&G(o,f.LEFT),t(!0),r.stopPropagation()},children:[a.alignment===f.LEFT&&e.jsx(Oe,{}),a.alignment===f.CENTER&&e.jsx(Be,{}),a.alignment===f.RIGHT&&e.jsx(Ue,{})]})})]})]}),e.jsx(U,{children:e.jsx(ei,{appId:s,columnIndex:o,tableColumn:a})})]},o),e.jsx(Ge,{title:"Delete computed field?",message:"Are you sure you want to delete this computed field? This action cannot be undone!",open:m,setOpen:l,onConfirm:()=>j(u)})]})},es=({appId:s,metaData:o})=>{h.debug(s,o),A();const i=ge(W(ke),W(Se),W(ye));E(s);const d=l=>{const{active:u,over:n}=l;h.debug(u,n),u==null||u.id,n==null||n.id},a=Te(s),t=()=>(a==null?void 0:a.filter(l=>l.startsWith(z.relationTablePrefix)).length)>0,m=l=>t()?l.startsWith(z.relationTablePrefix)?"Relation Table Column":"Join Table Column":"";return a===void 0||a.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx(he,{autoScroll:!0,sensors:i,collisionDetection:je,onDragEnd:d,children:e.jsx(fe,{items:a,children:a.map((l,u)=>e.jsx(be,{id:l,children:e.jsx(ii,{appId:s,columnIndex:u,tableType:m(l)})},l))})}),e.jsx(Ae,{appId:s,target:Ye.TABLE})]})};export{es as default};
