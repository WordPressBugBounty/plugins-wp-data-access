const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SettingsChart-1.0.36-DFVImdLT.js","./cm-1.0.36-c_d2YVSf.js","./redux-1.0.36-Dw38apwx.js","./vendor-1.0.36-CN03Eozo.js","./index-1.0.36-Cdz_jNzK.js","./iconBase-1.0.36-Cg_-P7_6.js","./Typography-1.0.36-CpRCY5e-.js","./lib-1.0.36-RK2jtnD_.js","./loglevel-1.0.36-BZ7XahX3.js","./lodash-1.0.36-DFhYoGis.js","./moment-1.0.36-C5S46NFB.js","./useEnhancedEffect-1.0.36-CTzd5Szc.js","./notistack-1.0.36-BWLrSPn1.js","./DefaultChartColors-1.0.36-D1Jle8Cd.js","./hooks-1.0.36-DVpFeylj.js","./index-1.0.36-B0PsaY_K.js","./FormHelperText-1.0.36-CywRqLJL.js","./useFormControl-1.0.36-DwbRv5ZH.js","./ToggleButtonGroup-1.0.36-BXp32NTm.js","./FormLabel-1.0.36-wYb03Y2-.js","./RadioGroup-1.0.36-Cdm5IN11.js","./Radio-1.0.36-hNRQPG6Z.js","./SwitchBase-1.0.36-DQfS6hYA.js","./useControlled-1.0.36-DU9XYnsb.js","./createSvgIcon-1.0.36-CIHUMY7B.js","./Slider-1.0.36-P1QSgbLL.js","./ThemeProvider-1.0.36-BePdakPr.js","./visuallyHidden-1.0.36-Dan1xhjv.js","./isHostComponent-1.0.36-DVu5iVWx.js","./Spinner-1.0.36-BfGTD4Gb.js","./Divider-1.0.36-B5JUONQZ.js","./dividerClasses-1.0.36-cwzIcK9n.js","./TextField-1.0.36-7fMfIiaO.js","./debounce-1.0.36-Be36O1Ab.js","./Menu-1.0.36-BJc4ujw0.js","./InputAdornment-1.0.36-DJw47I9A.js","./AccordionSummary-1.0.36-Bkgwks40.js","./Collapse-1.0.36-DzOtbj0p.js","./AccordionDetails-1.0.36-DkVLnrNK.js","./PremiumFeature-1.0.36-bCWDv36W.js","./index-1.0.36-Dv-fkoQB.js","./AdminTheme-1.0.36-Bhvs-n11.js","./FormControlLabel-1.0.36-DUOG-t_O.js","./Switch-1.0.36-BYfunOZA.js","./ChartTypes-1.0.36-I-VdyVbC.js","./Autocomplete-1.0.36-iUEM6sWc.js","./Close-1.0.36-Bg2BHC5L.js","./Popper-1.0.36-B2EKBEPA.js","./ThemeSettings-1.0.36-CkjS7Prd.js","./useTheme-1.0.36-BoaurWjH.js","./index-1.0.36-BDOx_E1a.js","./index-1.0.36-xGqEIHxf.js","./getThemeProps-1.0.36-R5fuQQuM.js","./Stack-1.0.36-K2HrciJA.js","./useThemeProps-1.0.36-BvrgfXwP.js","./Link-1.0.36-k1HTh5ol.js","./CssUnitTextField-1.0.36-lmkwemA7.js","./ConfirmDialog-1.0.36-_-4q7QfI.js","./LanguagesSupport-1.0.36-CNwr1suX.js","./ResizableDrawer-1.0.36-DprvuOUU.js","./useScreenSize-1.0.36-Cyh3FPEf.js"])))=>i.map(i=>d[i]);
import{j as e}from"./cm-1.0.36-c_d2YVSf.js";import{r}from"./redux-1.0.36-Dw38apwx.js";import{u as se,C as re}from"./Chart-1.0.36-DVqQ3GnJ.js";import{_ as U}from"./main-1.0.36.js";import{Z as H,S as M,_ as oe,P as ae,a as K,s as ne,l as n,$ as ie,a0 as le,a1 as ce,b as $,a2 as he,p as me,W as ue,a3 as pe,a4 as de,a5 as fe,a6 as ge,C as xe}from"./lib-1.0.36-RK2jtnD_.js";import{T as F,C as q,a as X}from"./Tooltip-1.0.36-COg3Mxx7.js";import{u as be,g as Ce,c as Se,B as Te,a as je,T as _e,b as Z}from"./TabPanel-1.0.36-CEnbl1IG.js";import{A as ye,T as ve,M as ke}from"./index-1.0.36-Cdz_jNzK.js";import{B as V,C as Ee}from"./ConfirmDialog-1.0.36-_-4q7QfI.js";import{A as I,a as Ae}from"./AdminTheme-1.0.36-Bhvs-n11.js";import{a as ee}from"./hooks-1.0.36-DVpFeylj.js";import{b as we}from"./useChartSettings-1.0.36-DKli_4MO.js";import{D as Be}from"./LanguagesSupport-1.0.36-CNwr1suX.js";import{a as Pe}from"./ActionsSettings-1.0.36-BoYKkBaN.js";import{e as R}from"./notistack-1.0.36-BWLrSPn1.js";import{B as Ne,S as W}from"./Spinner-1.0.36-BfGTD4Gb.js";import{T as Oe}from"./Typography-1.0.36-CpRCY5e-.js";import{I as J}from"./iconBase-1.0.36-Cg_-P7_6.js";import{T as Re,a as Q}from"./Tabs-1.0.36-DsFVtNgs.js";import{R as ze}from"./RestApi-1.0.36-XUqEDvWp.js";import{u as Le}from"./useTheme-1.0.36-BoaurWjH.js";import{u as Me,A as Fe}from"./AppTheme-1.0.36-BB9LBkIC.js";import{F as Ve}from"./FallbackSpinner-1.0.36-D7KlMhQ_.js";import{T as D}from"./ThemeProvider-1.0.36-BePdakPr.js";const We=r.forwardRef(function(c,d){const{children:x,...E}=c,t=be();if(t===null)throw new TypeError("No TabContext provided");const b=r.Children.map(x,h=>r.isValidElement(h)?r.cloneElement(h,{"aria-controls":Se(t,h.props.value),id:Ce(t,h.props.value)}):null);return e.jsx(Re,{...E,ref:d,value:t.value,children:b})}),Je=r.lazy(()=>U(()=>import("./SettingsChart-1.0.36-DFVImdLT.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47]),import.meta.url)),Ue=r.lazy(()=>U(()=>import("./ThemeSettings-1.0.36-CkjS7Prd.js"),__vite__mapDeps([48,1,2,3,14,7,8,9,10,49,39,40,5,6,11,41,19,17,4,12,50,51,52,29,16,43,22,23,53,54,25,26,27,28,42,55,20,21,24,56,32,33,34,57,58,36,37,38]),import.meta.url)),Ge=r.lazy(()=>U(()=>import("./ResizableDrawer-1.0.36-DprvuOUU.js"),__vite__mapDeps([59,1,2,3,60,7,8,9,10,14,6,26,11,5,4,12,33]),import.meta.url)),Ye=({appId:o})=>{var _,y;const c=ee(),[d,x]=r.useState(H.getSelectors().selectChart(M.getState().charts,o)),[E,t]=r.useState(oe.getSelectors().selectThemeById(M.getState().themes,o)),b=we(o),h=se(o),[A,m]=r.useState(!1),[z,C]=r.useState(!1),[i,w]=r.useState("1"),B=(s,p)=>{w(p)},u=()=>{c(le({})),m(!1)},f=()=>{A?C(!0):(T(),u())},P=s=>{n.debug(s),c(ie({appId:o,property:s})),m(!0)},S=s=>{c(ne({anchor:s}))},T=()=>{c(ce({appId:o,chartState:d}))},j=()=>{Pe(o,s=>{if(n.debug(s),s!=null&&s.code&&(s==null?void 0:s.message)!==void 0)switch(s.code){case"ok":x(H.getSelectors().selectChart(M.getState().charts,o)),R(s.message,{variant:"success"});break;case"info":R(s.message,{variant:"info"});break;default:n.error(s),R(s.message??$.contactSupport,{variant:"error"})}},s=>{n.error("error",s),R(s??$.contactSupport,{variant:"error"})}),m(!1)},N=()=>{A?(j(),setTimeout(()=>{u()},1e3)):u()},O=((_=I)==null?void 0:_.palette.mode)===ae.LIGHT?(y=I)==null?void 0:y.palette.primary.main:"";return e.jsx(e.Fragment,{children:h&&e.jsxs(e.Fragment,{children:[e.jsx(r.Suspense,{fallback:e.jsx(W,{}),children:e.jsxs(Ge,{closeDrawer:f,children:[e.jsx(ye,{position:"static",elevation:4,sx:{borderRadius:0},children:e.jsxs(ve,{className:"pp-setting-toolbar",sx:{borderRadius:0},children:[e.jsx(Oe,{variant:"h5",noWrap:!0,component:"div",className:"unselectable",sx:{flexGrow:1,paddingLeft:"6px"},children:"Chart Builder"}),e.jsx(F,{title:"Dock to left",position:"bottom",children:e.jsx(J,{onClick:()=>{S(K.LEFT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(Te,{})})}),e.jsx(F,{title:"Dock to right",position:"bottom",children:e.jsx(J,{onClick:()=>{S(K.RIGHT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(je,{})})}),e.jsx(F,{title:"Close",position:"bottom",children:e.jsx(J,{onClick:f,size:"large",color:"inherit",sx:{fontSize:"1.4em"},children:e.jsx(ke,{})})})]})}),e.jsx(q,{className:"pp-settings-container",children:e.jsx(X,{sx:{padding:0,margin:0},children:e.jsxs(_e,{value:i,children:[e.jsxs(We,{variant:"fullWidth",textColor:"primary",onChange:B,sx:{width:"100%",height:"80px",padding:0,margin:0,backgroundColor:"rgb(242, 242, 242)"},children:[e.jsx(Q,{label:"Chart",value:"1",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}}),e.jsx(Q,{label:"Theme",value:"2",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}})]}),e.jsxs(Ne,{sx:{margin:0,padding:0,overflowX:"hidden",overflowY:"auto",height:"calc(100vh - 250px)","& > div.MuiTabPanel-root":{padding:0}},children:[e.jsx(Z,{value:"1",children:e.jsx(r.Suspense,{fallback:e.jsx(W,{}),children:e.jsx(Je,{appId:o,chartSettings:b,updateSettings:P})})}),e.jsx(Z,{value:"2",children:e.jsx(r.Suspense,{fallback:e.jsx(W,{}),children:e.jsx(Ue,{appId:o,source:Be.TABLE,setIsUpdated:m})})})]})]})})}),e.jsx(q,{className:"pp-setting-footer",sx:{borderRadius:0,backgroundColor:O},children:e.jsxs(X,{className:"pp-setting-footer-buttons",sx:{borderRadius:0},children:[e.jsx(V,{variant:"outlined",className:"footer_action_button_apply",onClick:j,children:"Apply"}),e.jsx(V,{variant:"outlined",className:"footer_action_button",onClick:N,children:"OK"}),e.jsx(V,{variant:"outlined",className:"footer_action_button",onClick:f,children:"Cancel"})]})})]})}),e.jsx(Ee,{title:"Close Chart Builder?",message:"All uncommitted changes will be lost!",open:z,setOpen:C,onConfirm:()=>{T(),u()},onKeep:()=>{u()}})]})})},He=({appId:o,appDbId:c})=>{n.debug(o,c);const d=ee(),[x,E]=r.useState(!1),t=Me(o),b=Le(),h=Fe(b,me.table,he.form),A=r.useMemo(()=>Ae(),[]),m=i=>{switch(i.substring(0,i.indexOf("(")).toLowerCase()){case"decimal":case"double":case"double precision":case"float":case"real":case"bit":case"tinyint":case"smallint":case"int":case"integer":case"mediumint":case"bigint":return"number";case"time":return"time";case"date":return"date";case"datetime":case"timestamp":return"datetime"}return"text"},z=()=>{ze(xe.appUrlChartData,{app_id:c},i=>{var w,B,u,f,P,S,T,j,N,O,_,y;if(n.debug(i),(i==null?void 0:i.data)!==void 0){if(Array.isArray(i.data)){const s=i.data,p=[];i.explain.map(a=>{a.Type?p.push(m(a.Type)):a.type?p.push(m(a.type)):a.TYPE&&p.push(m(a.TYPE))}),n.debug(p);const g=[],G=[];Object.keys(s[0]).map(a=>G.push(a)),g.push(G);for(let a=0;a<s.length;a++){const L=[];Object.keys(s[a]).map((Y,te)=>p[te]==="text"?L.push(s[a][Y]):L.push(Number(s[a][Y]))),g.push(L)}n.debug(g);let l={};if(((B=(w=t==null?void 0:t.app)==null?void 0:w.container[0])==null?void 0:B.cnt_chart)!==void 0&&((f=(u=t==null?void 0:t.app)==null?void 0:u.container[0])==null?void 0:f.cnt_chart)!==null&&((S=(P=t==null?void 0:t.app)==null?void 0:P.container[0])==null?void 0:S.cnt_chart)!=="")try{l=JSON.parse(t.app.container[0].cnt_chart)}catch(a){n.error("Invalid JSON - chart settings"),n.error(a)}l===!1&&(l={}),n.debug(l);const v=pe({},de,l);v.data=g,v.majorAxisColumn=g[0][0],v.minorAxisColumns=g[0].slice(1),Array.isArray(l==null?void 0:l.chartTypes)&&l.chartTypes.length>0&&(v.chartType=l.chartTypes[0]),d(fe({appId:o,chartState:v}));let k={};if(((j=(T=t==null?void 0:t.app)==null?void 0:T.app[0])==null?void 0:j.app_theme)!==void 0&&((O=(N=t==null?void 0:t.app)==null?void 0:N.app[0])==null?void 0:O.app_theme)!==null&&((y=(_=t==null?void 0:t.app)==null?void 0:_.app[0])==null?void 0:y.app_theme)!=="")try{k=JSON.parse(t.app.app[0].app_theme)}catch(a){n.error("Invalid JSON - theme settings"),n.error(a)}k===!1&&(k={}),n.debug(k),d(ge({appId:o,themeState:k})),E(!0)}}else n.error("Error loading chart data")},()=>{n.error("Error loading chart data")})};r.useEffect(()=>{z()},[]);const C=r.useMemo(()=>ue(t),[t]);return x?e.jsxs(e.Fragment,{children:[e.jsx(D,{theme:h,children:e.jsx(re,{appId:o,isBuilderEnabled:C,isToolbarEnabled:!0,isExploring:t==null?void 0:t.isExploring})}),C&&e.jsx(D,{theme:A,children:e.jsx(Ye,{appId:o})})]}):e.jsx(Ve,{})},gt=Object.freeze(Object.defineProperty({__proto__:null,default:He},Symbol.toStringTag,{value:"Module"}));export{gt as C,We as T};
