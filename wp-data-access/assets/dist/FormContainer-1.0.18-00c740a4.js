import{r as c,_ as E,ca as Ze,l as s,cb as Ke,cc as Q,cd as Se,j as o,P as Ie,ce as et,cf as tt,a2 as nt,S as T,cg as ot,ch as at,ci as st,cj as ge,ck as xe,cl as _e,cm as Y,a as rt,e as h,cn as it,co as J,cp as ve,cq as lt,cr as ct,C as ut,c5 as he,cs as mt,a5 as dt}from"./main-1.0.18.js";import{B as U,S as q}from"./Spinner-1.0.18-de8df990.js";import{a as ft}from"./AdminTheme-1.0.18-73e13a4f.js";import{u as j,a as gt}from"./RestApi-1.0.18-cb72bd79.js";import{s as xt,u as _t,i as pe}from"./ActionsDml-1.0.18-7e1a74e9.js";import{F as O,u as vt,a as ht,R as pt}from"./ThemeContainer-1.0.18-fbd92e13.js";import{e as Ce,c as Ee,h as bt,b as jt}from"./useTheme-1.0.18-c1f3f722.js";import{Q as be,G as je}from"./index.esm-1.0.18-12f13c4a.js";import{u as Rt}from"./useScreenSize-1.0.18-62aeb4c4.js";import{u as St}from"./useStoreTable-1.0.18-8a593f98.js";import"./purify.es-1.0.18-68816782.js";import{d as N}from"./dayjs.min-1.0.18-7ea54188.js";import{v as Ct}from"./FallbackSpinner-1.0.18-e10446f4.js";import{C as Et,a as yt,B as V}from"./CardContent-1.0.18-3d5e5525.js";import{C as Mt}from"./CardActions-1.0.18-9693078a.js";import{I as Ft}from"./iconBase-1.0.18-3c21f5e2.js";import{T as Tt}from"./ThemeProvider-1.0.18-247b72cc.js";c.lazy(()=>E(()=>import("./TableContainer-1.0.18-20cdfb1b.js").then(n=>n.T),["./TableContainer-1.0.18-20cdfb1b.js","./main-1.0.18.js","./AdminTheme-1.0.18-73e13a4f.js","./Typography-1.0.18-dc3c0740.js","./FallbackSpinner-1.0.18-e10446f4.js","./Spinner-1.0.18-de8df990.js","./RestApi-1.0.18-cb72bd79.js","./ActionsSettings-1.0.18-41fd8841.js","./TargetEnum-1.0.18-b82380d5.js","./ConfirmDialog-1.0.18-eb1f3988.js","./DialogContent-1.0.18-5570cba4.js","./index.esm-1.0.18-12f13c4a.js","./iconBase-1.0.18-3c21f5e2.js","./Modal-1.0.18-870f459d.js","./CardContent-1.0.18-3d5e5525.js","./ConfirmDialog-1.0.18-9bff3a93.css","./TabPanel-1.0.18-2d718e76.js","./useScreenSize-1.0.18-62aeb4c4.js","./ThemeProvider-1.0.18-247b72cc.js","./Tabs-1.0.18-d7d53c1e.js","./createSvgIcon-1.0.18-dcf0276e.js","./ScopeEnum-1.0.18-7caf102d.js","./useTheme-1.0.18-c1f3f722.js","./colorManipulator-1.0.18-95bf61ec.js","./settings-1.0.18-871bbe9f.css"],import.meta.url));c.lazy(()=>E(()=>Promise.resolve().then(()=>X),void 0,import.meta.url));c.lazy(()=>E(()=>import("./TableContainer-1.0.18-20cdfb1b.js").then(n=>n.T),["./TableContainer-1.0.18-20cdfb1b.js","./main-1.0.18.js","./AdminTheme-1.0.18-73e13a4f.js","./Typography-1.0.18-dc3c0740.js","./FallbackSpinner-1.0.18-e10446f4.js","./Spinner-1.0.18-de8df990.js","./RestApi-1.0.18-cb72bd79.js","./ActionsSettings-1.0.18-41fd8841.js","./TargetEnum-1.0.18-b82380d5.js","./ConfirmDialog-1.0.18-eb1f3988.js","./DialogContent-1.0.18-5570cba4.js","./index.esm-1.0.18-12f13c4a.js","./iconBase-1.0.18-3c21f5e2.js","./Modal-1.0.18-870f459d.js","./CardContent-1.0.18-3d5e5525.js","./ConfirmDialog-1.0.18-9bff3a93.css","./TabPanel-1.0.18-2d718e76.js","./useScreenSize-1.0.18-62aeb4c4.js","./ThemeProvider-1.0.18-247b72cc.js","./Tabs-1.0.18-d7d53c1e.js","./createSvgIcon-1.0.18-dcf0276e.js","./ScopeEnum-1.0.18-7caf102d.js","./useTheme-1.0.18-c1f3f722.js","./colorManipulator-1.0.18-95bf61ec.js","./settings-1.0.18-871bbe9f.css"],import.meta.url));c.lazy(()=>E(()=>Promise.resolve().then(()=>X),void 0,import.meta.url));c.lazy(()=>E(()=>Promise.resolve().then(()=>X),void 0,import.meta.url));const wt=n=>{const l=j(f=>Ze(f,n));return s.debug("storeColumns",l),l},Dt=n=>{const l=j(f=>Ke(f,n));return s.debug("moreState",l),l},kt=c.lazy(()=>E(()=>import("./Row-1.0.18-10a3a770.js"),["./Row-1.0.18-10a3a770.js","./main-1.0.18.js","./RestApi-1.0.18-cb72bd79.js","./Typography-1.0.18-dc3c0740.js","./ThemeContainer-1.0.18-fbd92e13.js","./useTheme-1.0.18-c1f3f722.js","./colorManipulator-1.0.18-95bf61ec.js","./iconBase-1.0.18-3c21f5e2.js","./index.esm-1.0.18-12f13c4a.js","./FallbackSpinner-1.0.18-e10446f4.js","./Spinner-1.0.18-de8df990.js","./Tooltip-1.0.18-5f32f0fd.js","./ThemeProvider-1.0.18-247b72cc.js","./Popper-1.0.18-20544c9b.js","./useControlled-1.0.18-12a74006.js","./Grow-1.0.18-4ebc2ce8.js","./AdminTheme-1.0.18-73e13a4f.js","./ActionsDml-1.0.18-7e1a74e9.js","./useScreenSize-1.0.18-62aeb4c4.js","./useStoreTable-1.0.18-8a593f98.js","./purify.es-1.0.18-68816782.js","./dayjs.min-1.0.18-7ea54188.js","./CardContent-1.0.18-3d5e5525.js","./CardActions-1.0.18-9693078a.js"],import.meta.url)),Vt=({appId:n,metaData:l,primaryKey:f,formMode:p,formUuid:b})=>{var y;s.debug(n,l,f,p,b);const R=Ce(n),w=Ee(n),g=j(x=>Q(x,n));s.debug("data",g);const S=j(x=>Se(x,n));s.debug("initialData",S);let C="30px";return o.jsx("form",{id:b,className:"pp-form-content",onSubmit:x=>(x.preventDefault(),!1),children:o.jsx(U,{className:"pp-form-grid",sx:{display:"grid",gridTemplateColumns:{lg:`repeat(${R.cellsPerRow}, 1fr)`,md:"repeat("+Math.min(R.cellsPerRow,2)+", 1fr)",xs:"1fr"},gap:C,marginBottom:0,background:R.showGrid?((y=bt)==null?void 0:y.palette.mode)===Ie.LIGHT?"repeating-linear-gradient( -45deg, transparent, transparent 10px, #eee 10px, #eee 20px )":"repeating-linear-gradient( -45deg, transparent, transparent 10px, #111 10px, #111 20px )":"","& p.MuiFormHelperText-root":{...p===O.VIEW&&!0&&{display:"none"}}},children:o.jsx(c.Suspense,{fallback:o.jsx(q,{}),children:o.jsx(kt,{appId:n,metaData:l,data:g,initialData:S,primaryKey:f,formMode:p,formSettings:R,language:w.language})})})})},Ot=n=>{const l=j(f=>et(f,n));return s.debug("formCode",l),l},Pt=({code:n,safeMode:l,isExpression:f,args:p})=>{const b=tt(n,l,f,p);return window.jQuery&&b instanceof window.jQuery&&b.html(),null};const Lt=c.lazy(()=>E(()=>import("./Alert-1.0.18-8e754392.js"),["./Alert-1.0.18-8e754392.js","./main-1.0.18.js","./index.esm-1.0.18-bb69b89a.js","./iconBase-1.0.18-3c21f5e2.js","./Typography-1.0.18-dc3c0740.js","./AlertTitle-1.0.18-0fd475c6.js","./index-1.0.18-ff546563.js","./useSlot-1.0.18-71f9e7ae.js","./createSvgIcon-1.0.18-dcf0276e.js","./Close-1.0.18-d90e9fa7.js"],import.meta.url)),At=({appId:n,primaryKey:l,formMode:f,showTable:p,showForm:b,detailKey:R,children:w,relationAppId:g,relTab:S,joinTab:C,isEmbedded:y})=>{var ae,se,re,ie;s.debug(n,l,f,R,g,S,C,y);const x=gt(),z=wt(n),u=jt(n),ye=vt(),Me=St(n),L=Ot(n),Fe=Ee(n),[H,Te]=c.useState(f),W=c.useMemo(()=>Ct(),[]),[we,$]=c.useState(!1),[Z,De]=c.useState(""),a=c.useMemo(()=>nt(T.getState(),n),[n]);s.debug("metaData",a);const D=ot((ae=a==null?void 0:a.app)==null?void 0:ae.container[0]),A=j(e=>Q(e,n));s.debug("data",A);const ke=j(e=>Se(e,n));s.debug("initialData",ke);const G=j(e=>at(e,n));s.debug("m2mUpdate",G),c.useEffect(()=>{G===!0&&P(!1,()=>{x(xe({appId:n,update:!1}))})},[G]),c.useEffect(()=>{l===null?Oe():Object.keys(l).length>0?Ve():$(!0)},[l]);const Ve=()=>{xt(n,l,a==null?void 0:a.media,e=>{if(s.debug(e),e!==null){const i={...e.context};delete i.debug;const m={...e.data[0]};x(ge({appId:n,data:m,context:i})),$(e!==null)}else h(u.invalidResponse,{variant:"error"})},e=>{s.error("error",e),De(e??u.invalidResponse)},!1,S)},Oe=()=>{var e,i;if(a.columns&&Array.isArray(a.columns)){const m={},d=st(T.getState(),n);s.debug("defaultValues",d);for(let t=0;t<a.columns.length;t++)m[a.columns[t].column_name]=null,d[a.columns[t].column_name]!==void 0&&(d[a.columns[t].column_name]==="@wpda_wp_user_id"?m[a.columns[t].column_name]=(i=(e=a==null?void 0:a.settings)==null?void 0:e.env)==null?void 0:i.id:d[a.columns[t].column_name]==="@now"?a.columns[t]==="date"?m[a.columns[t].column_name]=N(Date.now()).format("YYYY-MM-DD"):m[a.columns[t].column_name]=N(Date.now()).format("YYYY-MM-DD HH:mm:ss"):a.columns[t].column_default!==null&&a.columns[t].column_default!=="NULL"&&a.columns[t].column_default!==""?a.columns[t].column_default==="CURRENT_TIMESTAMP"?a.columns[t]==="date"?m[a.columns[t].column_name]=N(Date.now()).format("YYYY-MM-DD"):m[a.columns[t].column_name]=N(Date.now()).format("YYYY-MM-DD HH:mm:ss"):m[a.columns[t].column_name]=a.columns[t].column_default:m[a.columns[t].column_name]=d[a.columns[t].column_name]);s.debug(m),x(ge({appId:n,data:m,context:{media:{}}})),s.debug("init"),$(!0)}},K=()=>{let e="";for(const i in a.columns)a.columns[i].extra==="auto_increment"&&(e=a.columns[i].column_name);return s.debug(e),e},Pe=e=>{for(let i=0;i<a.columns.length;i++)if(a.columns[i].column_name===e)return a.columns[i]},I=e=>{const i=it(T.getState(),n);s.debug("rowValidation",i);let m=!1;for(const r in i)if(i[r].error===!0&&i[r].type===J.COLUMN){m=!0;break}if(m)return s.debug("validateForm returned errors"),!1;let d=!0;const t=K();for(const r in e){const _=Pe(r);let v=!0;_.column_name!==t&&_.is_nullable==="NO"&&e[r]===""&&(f===O.INSERT||ze.preserveSpacesOnUpdate===!1)&&(x(ve({appId:n,columnName:r,columnError:!0,columnText:u.mandatoryField,columnType:J.FORM})),v=!1,d=!1);const B=lt(T.getState(),n,r);s.debug(B),v&&x(ve({appId:n,columnName:r,columnError:!1,columnText:"",columnType:J.FORM}))}return d},P=(e,i,m)=>{const d=Q(T.getState(),n);if(s.debug(d),I(d)){if(l!==null){const t={};Object.keys(d).map(r=>{z.map(_=>{r===_.columnName&&_.updatable&&(t[r]=d[r])})}),s.debug(t),_t(n,l,t,r=>{var _;if(s.debug(r),r!=null&&r.code&&(r!=null&&r.message))switch(r.code){case"ok":h(u.updatedSuccessful,{variant:"success"}),((_=r.context)==null?void 0:_.updated)!==void 0&&Object.keys(r.context.updated).map(v=>{x(ct({appId:n,columnName:v,columnValue:r.context.updated[v]}))}),e&&(i!==void 0&&i(l),setTimeout(()=>{p(!0,g)},1e3));break;case"info":h(u.nothingToUpdate,{variant:"info"}),e&&(i!==void 0&&i(l),setTimeout(()=>{p(!0,g)},1e3));break;default:s.error(r),h(r.message??u.invalidResponse,{variant:"error"}),e&&p(!0,g)}else s.error(r),h(u.invalidResponse,{variant:"error"})},r=>{s.error("error",r),h(r??u.invalidResponse,{variant:"error"})},!1,C,S)}else pe(n,d,t=>{if(s.debug(t),t!=null&&t.code&&(t!=null&&t.message)){let r;const _={};switch(t.code){case"ok":h(u.insertSuccessful,{variant:"success"}),r=K();for(let v=0;v<a.primary_key.length;v++)r!==""?_[a.primary_key[v]]=t.context.insert_id:_[a.primary_key[v]]=d[a.primary_key[v]];if(e){i!==void 0&&i(_),p(!0,g);return}b(_,pt.UPDATE),m&&m();break;default:s.error(t),h(t.message??u.invalidResponse,{variant:"error"})}}else s.error(t),h(u.invalidResponse,{variant:"error"})},t=>{s.error("error",t),h(t??u.invalidResponse,{variant:"error"})},!1,C,S);g!==void 0&&x(xe({appId:g,update:!0}))}},Le=e=>{if(e!==null&&I(A)){const i=he(T.getState(),n),m=i.state.relation.relation_join_condition.split(",").map(t=>t.split("=")),d={...i.state.detailKey};m.map(t=>{d[t[0]]=e[t[1]]}),pe(n,d,t=>{if(s.debug(t),t!=null&&t.code&&(t!=null&&t.message))switch(t.code){case"ok":s.debug("Added relation to join table",t);break;default:s.error(t),h(t.message??u.invalidResponse,{variant:"error"})}else s.error(t),h(u.invalidResponse,{variant:"error"})},t=>{s.error(t),h(t??u.invalidResponse,{variant:"error"})},!1,!0,!1)}},[Ae,Be]=c.useState(void 0),Ye=()=>{try{P(!1,()=>{},()=>{var i,m,d,t,r,_,v,B,le,ce,ue,me,de,fe;const e=JSON.parse((m=(i=a==null?void 0:a.app)==null?void 0:i.app[0])==null?void 0:m.app_settings);s.debug(e),((t=(d=e==null?void 0:e.settings)==null?void 0:d.app_registration)==null?void 0:t.showMessage)===!0&&((_=(r=e==null?void 0:e.settings)==null?void 0:r.app_registration)==null?void 0:_.message)!==void 0&&((B=(v=e==null?void 0:e.settings)==null?void 0:v.app_registration)==null?void 0:B.message)!==null&&((ce=(le=e==null?void 0:e.settings)==null?void 0:le.app_registration)==null?void 0:ce.message.trim())!==""&&Be((me=(ue=e==null?void 0:e.settings)==null?void 0:ue.app_registration)==null?void 0:me.message),((fe=(de=e==null?void 0:e.settings)==null?void 0:de.app_registration)==null?void 0:fe.allowUpdates)!==!0&&Te(O.VIEW)})}catch(e){s.error("Invalid JSON - app settings"),s.error(e),h(ut.contactSupport,{variant:"error"})}},Ne=()=>{P(!1)},Ue=()=>{const e=he(T.getState(),n);s.debug(e.state.relation),e.state.relation!==void 0&&e.state.relation.cardinality===mt.MANY_TO_MANY?P(!0,Le):P(!0)},ee=()=>{p(!0,g)},ze=Ce(n),He=j(e=>_e(e,n)),We=j(e=>_e(e,g??"")),M=Dt(n),F=c.useRef(null),$e=Rt(),[k,Ge]=c.useState((se=F==null?void 0:F.current)==null?void 0:se.offsetWidth),[Je,Qe]=c.useState({paddingTop:"50px",paddingBottom:"50px",paddingLeft:"50px",paddingRight:"50px"}),[qe,te]=c.useState("30px"),[Xe,ne]=c.useState("");if(c.useEffect(()=>{if(F.current!==null){Ge(F.current.offsetWidth);const e=k<600?.3:k<900?.6:1;Qe({paddingTop:`calc(${e} * 50px)`,paddingBottom:`calc(${e} * 50px)`,paddingLeft:`calc(${e} * 50px)`,paddingRight:`calc(${e} * 50px)`}),k<600?(te("10px"),ne("10px")):k<900&&(te("20px"),ne("20px"))}},[$e.width,F.current]),Z!=="")return o.jsx(c.Suspense,{children:o.jsx(Lt,{severity:"error",message:Z,close:!1})});const oe=()=>o.jsx(Vt,{appId:n,metaData:a,primaryKey:l,formMode:H,formUuid:W});return y?oe():o.jsx("div",{className:`${n}_wrapper pp-form`,ref:F,children:we&&A!==null?o.jsxs(Et,{sx:Je,elevation:ye,children:[o.jsxs(yt,{sx:{padding:0,margin:"5px 0 0 0"},children:[oe(),w]}),o.jsxs(Mt,{sx:{marginTop:{marginTop:qe},paddingRight:{paddingRight:Xe},padding:0,justifyContent:"space-between",alignItems:"center"},children:[o.jsxs(U,{sx:{display:"flex",gap:"8px"},children:[!1,(He||We)&&o.jsx(o.Fragment,{children:k<600?o.jsx(Ft,{color:"primary",onClick:()=>{x(Y({appId:n,more:!M})),g!==void 0&&x(Y({appId:g,more:!M}))},children:M?o.jsx(be,{}):o.jsx(je,{})}):o.jsx(V,{variant:"outlined",startIcon:M?o.jsx(be,{}):o.jsx(je,{}),onClick:()=>{x(Y({appId:n,more:!M})),g!==void 0&&x(Y({appId:g,more:!M}))},children:M?u.less:u.more})}),(L==null?void 0:L.customActionsBottom)!==void 0&&o.jsx(o.Fragment,{children:o.jsx(Pt,{code:L.customActionsBottom.code??"",safeMode:Fe.safeMode,isExpression:!1,args:{log:s,row:A,mode:ht[f]}})}),o.jsx(U,{className:"pp-registration-form-message",children:Ae})]}),o.jsx(U,{sx:{...k<600&&{marginLeft:"0 !important","& button":{marginLeft:"2px",padding:"6px"}}},children:f!==O.VIEW?o.jsx(o.Fragment,{children:((ie=(re=a==null?void 0:a.app)==null?void 0:re.app[0])==null?void 0:ie.app_type)==rt.REGISTRATION&&Me.state.masterDetailConditions===void 0?o.jsx(o.Fragment,{children:(H===O.INSERT||H===O.UPDATE)&&o.jsx(V,{variant:"contained",onClick:Ye,type:"submit",form:W,sx:{marginLeft:"8px"},children:u.ok})}):o.jsxs(o.Fragment,{children:[o.jsx(V,{variant:"contained",onClick:Ne,type:"submit",form:W,children:u.apply}),(D==null?void 0:D.cardinality)!==0&&o.jsxs(o.Fragment,{children:[o.jsx(V,{variant:"outlined",onClick:Ue,sx:{marginLeft:"8px"},children:u.ok}),o.jsx(V,{variant:"outlined",onClick:ee,sx:{marginLeft:"8px"},children:u.cancel})]})]})}):o.jsx(o.Fragment,{children:(D==null?void 0:D.cardinality)!==0&&o.jsx(V,{variant:"contained",onClick:ee,children:u.back})})})]}),o.jsx(o.Fragment,{children:!1})]}):o.jsx("div",{style:{padding:"50px"},children:o.jsx(q,{title:u.loadingData})})})},Bt=c.lazy(()=>E(()=>import("./Settings-1.0.18-0d59fea0.js"),["./Settings-1.0.18-0d59fea0.js","./main-1.0.18.js","./RestApi-1.0.18-cb72bd79.js","./Typography-1.0.18-dc3c0740.js","./AdminTheme-1.0.18-73e13a4f.js","./TabPanel-1.0.18-2d718e76.js","./useScreenSize-1.0.18-62aeb4c4.js","./ThemeProvider-1.0.18-247b72cc.js","./index.esm-1.0.18-12f13c4a.js","./iconBase-1.0.18-3c21f5e2.js","./Modal-1.0.18-870f459d.js","./Tabs-1.0.18-d7d53c1e.js","./createSvgIcon-1.0.18-dcf0276e.js","./ActionsSettings-1.0.18-41fd8841.js","./TargetEnum-1.0.18-b82380d5.js","./ScopeEnum-1.0.18-7caf102d.js","./ConfirmDialog-1.0.18-eb1f3988.js","./DialogContent-1.0.18-5570cba4.js","./CardContent-1.0.18-3d5e5525.js","./ConfirmDialog-1.0.18-9bff3a93.css","./useFormStore-1.0.18-a2e1b6cf.js","./Spinner-1.0.18-de8df990.js","./useTheme-1.0.18-c1f3f722.js","./colorManipulator-1.0.18-95bf61ec.js","./settings-1.0.18-871bbe9f.css"],import.meta.url)),Re=({appId:n,primaryKey:l,formMode:f,showTable:p,showForm:b,metaData:R,detailKey:w,selectionForm:g})=>{s.debug(n,l,f,R,w,g);const S=ft(),C=c.useMemo(()=>{},[]);s.debug("relationAppId",C);const y=()=>null,x=()=>null,z=()=>null;return o.jsxs(o.Fragment,{children:[g===!0?o.jsx(o.Fragment,{children:y()}):o.jsx(At,{appId:n,primaryKey:l,formMode:f,showTable:p,showForm:b,detailKey:w,relationAppId:C,children:x()}),dt(R)&&o.jsx(Tt,{theme:S,children:o.jsx(c.Suspense,{fallback:o.jsx(q,{}),children:o.jsx(Bt,{appId:n})})}),z()]})},X=Object.freeze(Object.defineProperty({__proto__:null,FormContainer:Re,default:Re},Symbol.toStringTag,{value:"Module"}));export{X as F,Dt as a,Ot as b,wt as u};
