import{j as e}from"./cm-1.0.40-DO7MoydR.js";import{u as _,L as K,S as Z,a as $,I as U,b as I,c as ee,d as V,D as te,e as se,f as ie,g as ne,h as ae,T as re,M as oe,P as le}from"./useMetadataColumns-1.0.40-Dh2-FNxa.js";import{r as F}from"./redux-1.0.40-W_04YL6Z.js";import{u as de,a as N}from"./hooks-1.0.40-DoKijNI1.js";import{l as g,cu as E,b as z,Q as p,C as ce,bt as me,cv as pe,cw as ue,j as k,cx as xe}from"./lib-1.0.40-CJM-IO_o.js";import{s as ge}from"./index-1.0.40-DlucSO_j.js";import{I as O,l as he,am as fe,an as je,ao as be,n as ye,ap as Se,aq as Te,ar as ke,as as ve,at as Ae,au as Ee}from"./index-1.0.40-DmMQghWt.js";import{T as L}from"./Tooltip-1.0.40-C5SL6QF3.js";import{u as M}from"./useTableUpdater-1.0.40-0UQrI-Q9.js";import{B as c}from"./Spinner-1.0.40-Bmn0_C4u.js";import{F as H}from"./FormLabel-1.0.40-DLOepjQ0.js";import{S as Q}from"./Slider-1.0.40-w2yGdRCB.js";import{F as j,a as b}from"./FormHelperText-1.0.40-D6buAdoc.js";import{u as X}from"./useMetadata-1.0.40-DdsiIGYX.js";import{P as W}from"./PremiumFeature-1.0.40-C4a0KOip.js";import"./moment-1.0.40-C5S46NFB.js";import{u as Pe}from"./useStoreTable-1.0.40-C_-ljzWa.js";import{d as Ne,e as Me,c as Le}from"./index-1.0.40-BIp4XK-5.js";import{A as R,a as B}from"./AccordionSummary-1.0.40-BaFEiNF8.js";import{A as G}from"./AccordionDetails-1.0.40-AFOWsBZA.js";import{F as y}from"./FormControlLabel-1.0.40-BH1qH5qy.js";import{S}from"./Switch-1.0.40-CJ3Ir4CS.js";import{L as De}from"./Link-1.0.40-rVkAFnTh.js";import{A as Fe}from"./AdminTheme-1.0.40-B669Ow89.js";import{T as w}from"./TextField-1.0.40-CejEr0KU.js";import{A as v,a as A}from"./AggregationLabelsEnum-1.0.40-B-3lhjpJ.js";import{A as Ce}from"./Autocomplete-1.0.40-CcfYAr1c.js";import{C as we}from"./Checkbox-1.0.40-DtDfmlS5.js";import{C as _e}from"./ConfirmDialog-1.0.40-DRjx8-xC.js";import{I as D}from"./iconBase-1.0.40-CH6TO7hF.js";import{u as Oe}from"./useTableColumnOrder-1.0.40-SiEYxTEI.js";import{D as Re}from"./DynamicModeEnum-1.0.40-BXuL5kgA.js";import"./vendor-1.0.40-CN03Eozo.js";import"./notistack-1.0.40-HUa4vT_u.js";import"./SharedContainer-1.0.40-D7EQbLUC.js";import"./main-1.0.40.js";import"./loglevel-1.0.40-BZ7XahX3.js";import"./lodash-1.0.40-yZQKpWII.js";import"./ActionsDml-1.0.40-BspTHnPS.js";import"./RestApi-1.0.40-Uj1ofskP.js";import"./useChartSettings-1.0.40-CCxE4Zu8.js";import"./useRemoveAppFromStore-1.0.40-DxUqDH6k.js";import"./lang-1.0.40-D4Y70Q_T.js";import"./useStoreFormSettings-1.0.40-CICs2Pm_.js";import"./useFormDetails-1.0.40-DhJ-oNOJ.js";import"./AppTheme-1.0.40-whCBYKjb.js";import"./index-1.0.40-xxiPHCiq.js";import"./Typography-1.0.40-oRKYqE3b.js";import"./getThemeProps-1.0.40-CtGZuG5N.js";import"./useEnhancedEffect-1.0.40-DvrM_gBo.js";import"./useScreenSize-1.0.40-DAXf1AlH.js";import"./dompurify-1.0.40-DhD2mIk-.js";import"./ThemeProvider-1.0.40-D9QtC9zH.js";import"./FallbackSpinner-1.0.40-Bwyy_LaW.js";import"./AlertDialog-1.0.40-CsMgd1A8.js";import"./SanitizeComponent-1.0.40-qpEC7QW6.js";import"./Tooltip-1.0.40-Czv1q8N-.js";import"./useControlled-1.0.40-B7yPDtn1.js";import"./Popper-1.0.40-Jt4gcDMJ.js";import"./Select-1.0.40-Db-Xnyoo.js";import"./Menu-1.0.40-BKp7UqHL.js";import"./utils-1.0.40-iop7lDec.js";import"./useFormControl-1.0.40-BL8koKXQ.js";import"./createSvgIcon-1.0.40-DryBVjDb.js";import"./MenuItem-1.0.40-UKMJrtYZ.js";import"./DefaultWhere-1.0.40-DTRDKm6T.js";import"./Stepper-1.0.40-r8Zcqqgv.js";import"./StepContent-1.0.40-BWs8Fwoy.js";import"./Collapse-1.0.40-C90ayxyF.js";import"./visuallyHidden-1.0.40-Dan1xhjv.js";import"./SwitchBase-1.0.40-BQrnL2Sx.js";import"./Close-1.0.40-DOQmTCBQ.js";const Be=(s,a)=>{const t=de(o=>o.tables[s].columns[a]);return g.debug("tableColumn",t),t},Ge=({appId:s,columnIndex:a,tableColumn:t})=>{const o=N(),i=M(s);return e.jsxs(c,{sx:{margin:"0 1rem 2rem 1rem"},children:[e.jsx(H,{children:"Width"}),e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"1fr auto",gridGap:"30px",alignItems:"center"},children:[e.jsx(Q,{min:60,max:420,step:1,value:t.width,marks:[{value:60,label:"60"},{value:120,label:"120"},{value:180,label:"180"},{value:240,label:"240"},{value:300,label:"320"},{value:360,label:"360"},{value:420,label:"420"}],valueLabelDisplay:"auto",onChange:(n,m)=>{o(E({appId:s,index:a,property:{width:m}})),i(!0),n.stopPropagation()}}),e.jsx("span",{children:"px"})]}),e.jsx(j,{children:e.jsxs(b,{children:["Column width is relative when responsiveness = ",e.jsx("strong",{children:"auto column hiding"}),"."]})})]})},Ue=({appId:s,columnIndex:a,tableColumn:t})=>{var T,P,l;g.debug(s,a,t),N();const o=Pe(s),i=X(s);_(s,i);const[n,m]=F.useState(!1),[d,u]=F.useState(!1);return M(s),e.jsxs(R,{disableGutters:!0,children:[e.jsxs(B,{expandIcon:e.jsx(O,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(Ne,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Column actions"})]}),e.jsxs(G,{sx:{display:"grid",paddingTop:"1rem"},children:[e.jsxs(c,{sx:{margin:"0 10px",display:"grid",gridTemplateColumns:"auto"},children:[t.computedField?e.jsx(y,{control:e.jsx(S,{checked:!1,disabled:!0}),label:"Enable inline search",labelPlacement:"end"}):e.jsx(y,{control:e.jsx(S,{checked:t.inlineSearch&&!1,disabled:!0,onChange:(f,C)=>{f.stopPropagation()}}),label:"Enable column filter",labelPlacement:"end"}),t.inlineSearch&&!1,((T=i==null?void 0:i.privs)==null?void 0:T.update)&&i.primary_key.length>0&&e.jsx(e.Fragment,{children:!t.computedField&&!t.columnName.startsWith(z.relationTablePrefix)&&!(((P=o==null?void 0:o.state)==null?void 0:P.masterDetailConditions)!==void 0&&((l=o==null?void 0:o.state)==null?void 0:l.masterDetailConditions[t.columnName])!==void 0)?e.jsx(y,{control:e.jsx(S,{checked:t.visible&&t.inlineEditing,disabled:!0,onChange:(f,C)=>{f.stopPropagation()}}),label:"Enable inline editing",labelPlacement:"end"}):e.jsx(y,{control:e.jsx(S,{checked:!1,disabled:!0}),label:"Enable inline editing",labelPlacement:"end"})})]}),!1,e.jsxs(b,{component:"div",sx:{marginTop:"30px"},children:[e.jsx(c,{children:e.jsxs(De,{sx:{textDecoration:"none",cursor:"pointer",display:"inline-flex","& svg":{fontSize:"1rem",marginRight:"2px"}},onClick:()=>m(!n),children:[e.jsx(he,{}),"What are column actions?"]})}),n&&e.jsxs(c,{sx:{marginTop:"20px",display:"grid",gap:"20px",marginBottom:"20px"},children:[e.jsx(c,{children:"Column actions are inline actions added to a table column to enhance usability and user-friendliness."}),e.jsx(c,{children:e.jsx("strong",{children:"Column filtering"})}),e.jsx(c,{children:"When column filtering is enabled, a search field is added to the table for performing column-specific searches. A search box allows wildcard searches, while drop-down lists perform exact searches. Exact searches can improve performance, especially when the searched columns are well-indexed."}),e.jsx(c,{children:"To enable the column filter feature, go to the TABLE section under Column Filters. You can also change the position of the column filters."}),e.jsx(c,{children:"The global filter performs a wildcard search. This feature can be disabled in the TABLE section under Global filter."}),e.jsx(c,{children:e.jsx("strong",{children:"Inline editing"})}),e.jsx(c,{children:"Inline editing allows users to change table columns directly, without needing to open a data entry form. This feature is not available for primary key fields. Drop-down lists are automatically generated for enum and set data types."})]})]}),e.jsx(K,{}),e.jsx(W,{})]})]})},Ve=({appId:s,columnIndex:a,tableColumn:t})=>{var d,u,h,T,P;const o=N(),i=M(s),n=_(s),m=(l,f)=>{g.debug(l,f)};return e.jsxs(R,{disableGutters:!0,children:[e.jsxs(B,{expandIcon:e.jsx(O,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(Me,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Column settings"})]}),e.jsxs(G,{sx:{display:"grid",gridGap:"2rem",paddingTop:"1rem"},children:[(t.computedField||n[t.columnName]!==void 0&&t.lookup===void 0&&(p(n[t.columnName].data_type)==="float"||p(n[t.columnName].data_type)==="number"||p(n[t.columnName].data_type)==="time"||p(n[t.columnName].data_type,!0)==="date"||p(n[t.columnName].data_type,!0)==="datetime"||p(n[t.columnName].data_type,!0)==="timestamp"||p(n[t.columnName].data_type,!0)==="time"))&&e.jsx(c,{children:e.jsxs(j,{children:[e.jsx(y,{control:e.jsx(S,{checked:!1,disabled:!0,onClick:l=>{l.stopPropagation()}}),label:"Localize",labelPlacement:"end"}),e.jsx(b,{children:p((d=n[t.columnName])==null?void 0:d.data_type)==="float"||p((u=n[t.columnName])==null?void 0:u.data_type)==="number"?"Localizes decimal and thousands seperators.":"Localizes date and time fields."})]})}),n[t.columnName]!==void 0&&p((h=n[t.columnName])==null?void 0:h.data_type,!0)==="time"&&e.jsx(c,{children:e.jsx(c,{sx:{marginBottom:"10px"},children:e.jsxs(j,{children:[e.jsx(y,{control:e.jsx(S,{checked:t.duration,onClick:l=>{o(E({appId:s,index:a,property:{duration:!t.duration}})),i(!0),l.stopPropagation()}}),label:"Duration format",labelPlacement:"end"}),e.jsx(b,{children:"Enables storage of durations up to 99 hours in the MySQL time format (hh:mm:ss)."})]})})}),(n[t.columnName]!==void 0&&t.lookup===void 0&&p(n[t.columnName].data_type,!0)==="float"||t.computedField!==void 0)&&e.jsxs(j,{children:[e.jsx(H,{children:"Decimals"}),e.jsx(Q,{min:0,max:6,value:t.decimals,marks:[{value:0,label:"0"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"},{value:5,label:"5"},{value:6,label:"∞"}],valueLabelDisplay:"auto",disabled:!0,onChange:(l,f)=>{g.debug(f),l.stopPropagation()}}),e.jsx(b,{children:"Number of decimals displayed."})]}),n[t.columnName]!==void 0&&t.localize===!0&&(p(n[t.columnName].data_type,!0)==="date"||p(n[t.columnName].data_type,!0)==="datetime"||p(n[t.columnName].data_type,!0)==="timestamp")&&e.jsx(c,{children:e.jsx(j,{children:e.jsx(y,{control:e.jsx(S,{checked:!1,disabled:!0,onClick:l=>{l.stopPropagation()}}),label:"Add trailing zeros to days and month",labelPlacement:"end"})})}),e.jsxs(j,{children:[e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"10px",alignItems:"center"},children:[e.jsx(w,{type:"text",variant:"outlined",label:"Prefix",value:t.prefix,disabled:!0,slotProps:{inputLabel:{shrink:!0}},onChange:l=>{l.stopPropagation()}}),e.jsx(w,{type:"text",variant:"outlined",label:"Suffix",value:t.suffix,disabled:!0,slotProps:{inputLabel:{shrink:!0}},onChange:l=>{l.stopPropagation()}})]}),e.jsx(b,{children:"Adds a prefix and/or suffix to the column content (also added to inline text and number fields)."})]}),e.jsxs(j,{children:[e.jsx(w,{type:"text",variant:"outlined",label:"CSS classes",fullWidth:!0,value:t.classNames,disabled:!0,slotProps:{inputLabel:{shrink:!0}},onChange:l=>{l.stopPropagation()}}),e.jsx(b,{children:"CSS classes (seperated by spaces) for custom styling."})]}),e.jsxs(j,{children:[e.jsx(y,{control:e.jsx(S,{checked:t.allowMarkup,onChange:(l,f)=>{o(E({appId:s,index:a,property:{allowMarkup:f}})),i(!0),l.stopPropagation()}}),label:"Allow inline HTML",labelPlacement:"end"}),e.jsxs(b,{children:["Allows markup in column content. ",e.jsx("span",{style:{...t.allowMarkup&&{color:((P=(T=Fe)==null?void 0:T.palette)==null?void 0:P.error.main)??"red"}},children:"Enabling this feature may pose a risk of cross-site scripting (XSS) attacks."})]})]}),e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"auto"},children:[e.jsx(y,{control:e.jsx(S,{checked:!1,disabled:!0,onClick:l=>{ce.appFeature===!0&&m(a,!t.visibleTablet),l.stopPropagation()}}),label:"Show column on tablet",labelPlacement:"end"}),e.jsx(y,{control:e.jsx(S,{checked:!1,disabled:!0,onClick:l=>{l.stopPropagation()}}),label:"Show column on mobile",labelPlacement:"end"})]}),e.jsx(W,{single:!1,margin:"0"})]})]})},ze=[{key:A.SUM,label:v.SUM},{key:A.MIN,label:v.MIN},{key:A.MAX,label:v.MAX},{key:A.AVG,label:v.AVG},{key:A.COUNT,label:v.COUNT},{key:A.UNIQUE,label:v.UNIQUE},{key:A.STD,label:v.STD},{key:A.VARIANCE,label:v.VARIANCE},{key:A.MEDIAN,label:v.MEDIAN}],q=[...ze],He=({appId:s,columnIndex:a,tableColumn:t})=>{g.debug(s,a,t),N(),M(s);const o=_(s),i=F.useMemo(()=>{var n;return(t==null?void 0:t.aggregation)===void 0?[]:(n=t==null?void 0:t.aggregation)==null?void 0:n.map(m=>q.filter(d=>d.key===m)[0])},[t==null?void 0:t.aggregation]);return!me(s)||t.computedField===void 0&&p(o[t.columnName].data_type)!=="number"?null:e.jsxs(R,{disableGutters:!0,children:[e.jsxs(B,{expandIcon:e.jsx(O,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(Le,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Aggregations"})]}),e.jsxs(G,{sx:{marginTop:"10px"},children:[e.jsxs(j,{fullWidth:!0,children:[e.jsx(Ce,{multiple:!0,options:q,disabled:!0,disableCloseOnSelect:!0,getOptionLabel:n=>n.label,value:i,onChange:(n,m)=>{n.stopPropagation()},renderOption:(n,m,{selected:d})=>F.createElement("li",{...n,key:m.label},e.jsx(we,{icon:e.jsx(je,{}),checkedIcon:e.jsx(fe,{}),style:{marginRight:8},checked:d}),m.label),renderInput:n=>e.jsx(w,{...n,label:"Select from list"})}),e.jsx(b,{children:"Allows multiple selections. Displayed in order of entry."})]}),e.jsx(j,{sx:{marginTop:"20px",marginLeft:"-10px"},children:e.jsxs(b,{component:"div",children:["Aggregations are calculated:",e.jsxs("ul",{style:{marginBottom:0,listStyleType:"disc",paddingLeft:"40px"},children:[e.jsx("li",{children:"per table with client-side processing enabled"}),e.jsx("li",{children:"per page with server-side processing enabled"})]})]})}),e.jsx(W,{})]})]})},We=({appId:s,columnIndex:a,tableColumn:t})=>{g.debug(s,a,t);const o=N(),i=M(s),n=X(s),d=_(s)[t.columnName],u=(h,T)=>{o(pe({appId:s,columnName:t.columnName})),o(ue({appId:s,columnName:t.columnName})),o(E({appId:s,index:h,property:{lookup:T}})),i(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(Ge,{appId:s,columnIndex:a,tableColumn:t}),e.jsx(Ve,{appId:s,columnIndex:a,tableColumn:t}),e.jsx(Ue,{appId:s,columnIndex:a,tableColumn:t}),e.jsx(Z,{appId:s,columnIndex:a,tableColumn:t,columnMetaData:d,setLookup:u}),e.jsx(He,{appId:s,columnIndex:a,tableColumn:t}),e.jsx($,{columnMetaData:d,metaData:n})]})},qe=({appId:s,columnIndex:a,tableType:t})=>{g.debug(s,a,t);const o=N(),i=Be(s,a),n=M(s),[m,d]=F.useState(!1),[u,h]=F.useState(void 0),T=r=>{r!==void 0&&(o(xe({appId:s,index:r})),n(!0))},P=(r,x)=>{g.debug(r,x),o(E({appId:s,index:r,property:{visible:x}})),n(!0)},l=(r,x)=>{g.debug(r,x),o(E({appId:s,index:r,property:{queryable:x}})),n(!0)},f=(r,x)=>{g.debug(r,x),o(E({appId:s,index:r,property:{orderable:x}})),n(!0)},C=(r,x)=>{o(E({appId:s,index:r,property:{alignment:x}})),n(!0)},J=(r,x,Y)=>(g.debug(r,x,Y),e.jsxs(e.Fragment,{children:[e.jsx(c,{sx:{"& svg":{pointerEvents:"none",opacity:"0.5"}},children:e.jsx(I,{id:r,enabled:!1},r)}),e.jsxs(c,{sx:{display:"inline-grid",gridTemplateColumns:i.computedField!==void 0?"auto auto":"auto",justifyContent:"start",alignItems:"center",gap:"10px","& svg":{opacity:"0.5"}},children:[i.computedField!==void 0&&e.jsx(ge,{}),e.jsx(H,{children:x})]})]}));return e.jsxs(e.Fragment,{children:[e.jsxs(R,{disableGutters:!0,slotProps:{transition:{unmountOnExit:!0}},children:[e.jsxs(B,{className:"pp-column-settings",component:"div",expandIcon:e.jsx(O,{}),sx:{justifyContent:"space-between",position:"relative"},children:[t!==""&&e.jsx(c,{sx:{position:"absolute",top:"5px",right:"5px",fontSize:"50%"},children:t}),e.jsx(c,{sx:{display:"grid",gridTemplateColumns:"auto 1fr",alignItems:"center","& svg":{display:"flex"}},children:J(i.columnName,i.columnLabel,a)}),e.jsxs("div",{style:{display:"inline-grid",gridTemplateColumns:"40px 40px 40px 40px"},children:[e.jsx(L,{title:"Visibility",position:"bottom",children:e.jsx(D,{onClick:r=>{P(a,!i.visible),r.stopPropagation()},children:e.jsx(U,{checked:i.visible,children:e.jsx(be,{})})})}),i.computedField?e.jsx(L,{title:"Edit",position:"bottom",children:e.jsx("span",{children:e.jsx(D,{disabled:!0,onClick:r=>{r.stopPropagation()},children:e.jsx(Se,{})})})}):e.jsx(L,{title:"Searchable",position:"bottom",children:e.jsx(D,{onClick:r=>{l(a,!i.queryable),r.stopPropagation()},children:e.jsx(U,{checked:i.queryable,alignRight:!1,children:e.jsx(ye,{})})})}),i.computedField?e.jsx(L,{title:"Delete",position:"bottom",children:e.jsx(D,{onClick:r=>{h(a),d(!0),r.stopPropagation()},children:e.jsx(ke,{})})}):e.jsx(L,{title:"Sortable",position:"bottom",disabled:i.visible===!1,children:e.jsx(D,{disabled:i.visible===!1,onClick:r=>{f(a,!i.orderable),r.stopPropagation()},children:e.jsx(U,{checked:i.orderable,forceOff:i.visible===!1,children:e.jsx(Te,{})})})}),e.jsx(L,{title:"Alignment",position:"bottom",disabled:i.visible===!1,children:e.jsxs(D,{disabled:i.visible===!1,onClick:r=>{i.alignment===k.LEFT?C(a,k.CENTER):i.alignment===k.CENTER?C(a,k.RIGHT):i.alignment===k.RIGHT&&C(a,k.LEFT),n(!0),r.stopPropagation()},children:[i.alignment===k.LEFT&&e.jsx(ve,{}),i.alignment===k.CENTER&&e.jsx(Ae,{}),i.alignment===k.RIGHT&&e.jsx(Ee,{})]})})]})]}),e.jsx(G,{children:e.jsx(We,{appId:s,columnIndex:a,tableColumn:i})})]},a),e.jsx(_e,{title:"Delete computed field?",message:"Are you sure you want to delete this computed field? This action cannot be undone!",open:m,setOpen:d,onConfirm:()=>T(u)})]})},cs=({appId:s,metaData:a})=>{g.debug(s,a),N();const t=ee(V(le),V(oe),V(re));M(s);const o=d=>{const{active:u,over:h}=d;g.debug(u,h),u==null||u.id,h==null||h.id},i=Oe(s),n=()=>(i==null?void 0:i.filter(d=>d.startsWith(z.relationTablePrefix)).length)>0,m=d=>n()?d.startsWith(z.relationTablePrefix)?"Relation Table Column":"Join Table Column":"";return i===void 0||i.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx(te,{autoScroll:!0,sensors:t,collisionDetection:se,onDragEnd:o,children:e.jsx(ie,{items:i,children:i.map((d,u)=>e.jsx(ne,{id:d,children:e.jsx(qe,{appId:s,columnIndex:u,tableType:m(d)})},d))})}),e.jsx(ae,{appId:s,target:Re.TABLE})]})};export{cs as default};
