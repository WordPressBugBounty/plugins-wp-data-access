import{r as c,_ as E,bT as Ze,l as s,bU as Ke,bV as X,bW as Me,j as n,P as Ie,bX as et,bY as tt,Q as nt,S as D,bZ as ot,b_ as at,b$ as st,c0 as ge,c1 as xe,c2 as _e,c3 as z,a as rt,e as b,c4 as it,c5 as q,c6 as ve,c7 as lt,c8 as ut,aK as ct,C as mt,bO as he,c9 as dt,V as ft}from"./main-1.0.23.js";import{B as W,S as Z}from"./Spinner-1.0.23-90ab83ff.js";import{a as gt}from"./AdminTheme-1.0.23-7044caf5.js";import{u as R,a as xt}from"./RestApi-1.0.23-cc179eb9.js";import{s as _t,u as vt,i as be}from"./ActionsDml-1.0.23-e3901c9d.js";import{F as V,u as ht,a as bt,R as pt}from"./ThemeContainer-1.0.23-10b65460.js";import{e as Se,c as ye,h as jt,b as Rt}from"./useTheme-1.0.23-55aea9bb.js";import{V as pe,K as je}from"./index.esm-1.0.23-ba0465a2.js";import{u as Mt}from"./useScreenSize-1.0.23-b1e8b94a.js";import{u as St}from"./useStoreTable-1.0.23-508477d7.js";import"./purify.es-1.0.23-68816782.js";import{d as H}from"./dayjs.min-1.0.23-c3dddbc3.js";import{v as yt}from"./FallbackSpinner-1.0.23-96931408.js";import{C as Et,a as Tt,B as k}from"./CardContent-1.0.23-cd3f2c87.js";import{C as Ft}from"./CardActions-1.0.23-6c452d3f.js";import{I as Ct}from"./iconBase-1.0.23-43ac6f06.js";import{T as wt}from"./ThemeProvider-1.0.23-f3e5cbc1.js";c.lazy(()=>E(()=>import("./TableContainer-1.0.23-55f87dc7.js").then(t=>t.T),["./TableContainer-1.0.23-55f87dc7.js","./main-1.0.23.js","./AdminTheme-1.0.23-7044caf5.js","./Typography-1.0.23-19a0fd3e.js","./FallbackSpinner-1.0.23-96931408.js","./Spinner-1.0.23-90ab83ff.js","./RestApi-1.0.23-cc179eb9.js","./ActionsSettings-1.0.23-a601e9bf.js","./TargetEnum-1.0.23-b82380d5.js","./ConfirmDialog-1.0.23-f318040f.js","./DialogContent-1.0.23-79893b13.js","./index.esm-1.0.23-ba0465a2.js","./iconBase-1.0.23-43ac6f06.js","./Modal-1.0.23-3fe42627.js","./CardContent-1.0.23-cd3f2c87.js","./ConfirmDialog-1.0.23-9bff3a93.css","./ScopeEnum-1.0.23-7caf102d.js","./TabPanel-1.0.23-ecd53346.js","./Tabs-1.0.23-d047285a.js","./ThemeProvider-1.0.23-f3e5cbc1.js","./createSvgIcon-1.0.23-f9410a01.js","./useTheme-1.0.23-55aea9bb.js","./colorManipulator-1.0.23-e382be1d.js","./settings-1.0.23-871bbe9f.css"],import.meta.url));c.lazy(()=>E(()=>Promise.resolve().then(()=>K),void 0,import.meta.url));c.lazy(()=>E(()=>import("./TableContainer-1.0.23-55f87dc7.js").then(t=>t.T),["./TableContainer-1.0.23-55f87dc7.js","./main-1.0.23.js","./AdminTheme-1.0.23-7044caf5.js","./Typography-1.0.23-19a0fd3e.js","./FallbackSpinner-1.0.23-96931408.js","./Spinner-1.0.23-90ab83ff.js","./RestApi-1.0.23-cc179eb9.js","./ActionsSettings-1.0.23-a601e9bf.js","./TargetEnum-1.0.23-b82380d5.js","./ConfirmDialog-1.0.23-f318040f.js","./DialogContent-1.0.23-79893b13.js","./index.esm-1.0.23-ba0465a2.js","./iconBase-1.0.23-43ac6f06.js","./Modal-1.0.23-3fe42627.js","./CardContent-1.0.23-cd3f2c87.js","./ConfirmDialog-1.0.23-9bff3a93.css","./ScopeEnum-1.0.23-7caf102d.js","./TabPanel-1.0.23-ecd53346.js","./Tabs-1.0.23-d047285a.js","./ThemeProvider-1.0.23-f3e5cbc1.js","./createSvgIcon-1.0.23-f9410a01.js","./useTheme-1.0.23-55aea9bb.js","./colorManipulator-1.0.23-e382be1d.js","./settings-1.0.23-871bbe9f.css"],import.meta.url));c.lazy(()=>E(()=>Promise.resolve().then(()=>K),void 0,import.meta.url));c.lazy(()=>E(()=>Promise.resolve().then(()=>K),void 0,import.meta.url));const Dt=t=>{const u=R(g=>Ze(g,t));return s.debug("storeColumns",u),u},Vt=t=>{const u=R(g=>Ke(g,t));return s.debug("moreState",u),u},Lt=c.lazy(()=>E(()=>import("./Row-1.0.23-639efdec.js"),["./Row-1.0.23-639efdec.js","./main-1.0.23.js","./RestApi-1.0.23-cc179eb9.js","./ThemeContainer-1.0.23-10b65460.js","./useTheme-1.0.23-55aea9bb.js","./colorManipulator-1.0.23-e382be1d.js","./Typography-1.0.23-19a0fd3e.js","./iconBase-1.0.23-43ac6f06.js","./index.esm-1.0.23-ba0465a2.js","./FallbackSpinner-1.0.23-96931408.js","./Spinner-1.0.23-90ab83ff.js","./Tooltip-1.0.23-1b58a848.js","./ThemeProvider-1.0.23-f3e5cbc1.js","./Popper-1.0.23-4a0d0616.js","./useControlled-1.0.23-1e71c28b.js","./Grow-1.0.23-40b2ff68.js","./AdminTheme-1.0.23-7044caf5.js","./ActionsDml-1.0.23-e3901c9d.js","./useScreenSize-1.0.23-b1e8b94a.js","./useStoreTable-1.0.23-508477d7.js","./purify.es-1.0.23-68816782.js","./dayjs.min-1.0.23-c3dddbc3.js","./CardContent-1.0.23-cd3f2c87.js","./CardActions-1.0.23-6c452d3f.js"],import.meta.url)),Ot=({appId:t,metaData:u,primaryKey:g,formMode:p,formUuid:j})=>{var y;s.debug(t,u,g,p,j);const M=Se(t),L=ye(t),x=R(_=>X(_,t));s.debug("data",x);const S=R(_=>Me(_,t));s.debug("initialData",S);let T="30px";return n.jsx("form",{id:j,className:"pp-form-content",onSubmit:_=>(_.preventDefault(),!1),children:n.jsx(W,{className:"pp-form-grid",sx:{display:"grid",gridTemplateColumns:{lg:`repeat(${M.cellsPerRow}, 1fr)`,md:"repeat("+Math.min(M.cellsPerRow,2)+", 1fr)",xs:"1fr"},gap:T,marginBottom:0,background:M.showGrid?((y=jt)==null?void 0:y.palette.mode)===Ie.LIGHT?"repeating-linear-gradient( -45deg, transparent, transparent 10px, #eee 10px, #eee 20px )":"repeating-linear-gradient( -45deg, transparent, transparent 10px, #111 10px, #111 20px )":"","& p.MuiFormHelperText-root":{...p===V.VIEW&&!0&&{display:"none"}}},children:n.jsx(c.Suspense,{fallback:n.jsx(Z,{}),children:n.jsx(Lt,{appId:t,metaData:u,data:x,initialData:S,primaryKey:g,formMode:p,formSettings:M,language:L.language})})})})},Pt=t=>{const u=R(g=>et(g,t));return s.debug("formCode",u),u},kt=({code:t,safeMode:u,isExpression:g,args:p})=>{const j=tt(t,u,g,p);return window.jQuery&&j instanceof window.jQuery&&j.html(),null};const At=c.lazy(()=>E(()=>import("./Alert-1.0.23-c5d2670c.js"),["./Alert-1.0.23-c5d2670c.js","./main-1.0.23.js","./index.esm-1.0.23-5dc3dbfa.js","./iconBase-1.0.23-43ac6f06.js","./Typography-1.0.23-19a0fd3e.js","./AlertTitle-1.0.23-db3e7867.js","./index-1.0.23-9af490ae.js","./useSlot-1.0.23-b9d48820.js","./createSvgIcon-1.0.23-f9410a01.js","./Close-1.0.23-ea28bfa6.js"],import.meta.url)),Bt=({appId:t,primaryKey:u,formMode:g,showTable:p,showForm:j,detailKey:M,children:L,relationAppId:x,relTab:S,joinTab:T,isEmbedded:y})=>{var re,ie,le,ue;s.debug(t,u,g,M,x,S,T,y);const _=xt(),$=Dt(t),m=Rt(t),Ee=ht(),Te=St(t),Y=Pt(t),Fe=ye(t),[G,Ce]=c.useState(g),J=c.useMemo(()=>yt(),[]),[we,Q]=c.useState(!1),[I,De]=c.useState(""),a=c.useMemo(()=>nt(D.getState(),t),[t]);s.debug("metaData",a);const O=ot((re=a==null?void 0:a.app)==null?void 0:re.container[0]),N=R(e=>X(e,t));s.debug("data",N);const Ve=R(e=>Me(e,t));s.debug("initialData",Ve);const U=R(e=>at(e,t));s.debug("m2mUpdate",U),c.useEffect(()=>{s.debug(U,t),U===!0&&(s.debug("setM2MUpdate: false"),A(!1,()=>{},()=>{},()=>{_(xe({appId:t,update:!1}))}))},[U]),c.useEffect(()=>{u===null?Oe():Object.keys(u).length>0?Le():Q(!0)},[u]);const Le=()=>{_t(t,u,a==null?void 0:a.media,e=>{if(s.debug(e),e!==null){const l={...e.context};delete l.debug;const d={...e.data[0]};_(ge({appId:t,data:d,context:l})),Q(e!==null)}else b(m.invalidResponse,{variant:"error"})},e=>{s.error("error",e),De(e??m.invalidResponse)},!1,S)},Oe=()=>{var e,l;if(a.columns&&Array.isArray(a.columns)){const d={},f=st(D.getState(),t);s.debug("defaultValues",f);for(let o=0;o<a.columns.length;o++)d[a.columns[o].column_name]=null,f[a.columns[o].column_name]!==void 0&&(f[a.columns[o].column_name]==="@wpda_wp_user_id"?d[a.columns[o].column_name]=(l=(e=a==null?void 0:a.settings)==null?void 0:e.env)==null?void 0:l.id:f[a.columns[o].column_name]==="@now"?a.columns[o]==="date"?d[a.columns[o].column_name]=H(Date.now()).format("YYYY-MM-DD"):d[a.columns[o].column_name]=H(Date.now()).format("YYYY-MM-DD HH:mm:ss"):a.columns[o].column_default!==null&&a.columns[o].column_default!=="NULL"&&a.columns[o].column_default!==""?a.columns[o].column_default==="CURRENT_TIMESTAMP"?a.columns[o]==="date"?d[a.columns[o].column_name]=H(Date.now()).format("YYYY-MM-DD"):d[a.columns[o].column_name]=H(Date.now()).format("YYYY-MM-DD HH:mm:ss"):d[a.columns[o].column_name]=a.columns[o].column_default:d[a.columns[o].column_name]=f[a.columns[o].column_name]);s.debug(d),_(ge({appId:t,data:d,context:{media:{}}})),s.debug("init"),Q(!0)}},ee=()=>{let e="";for(const l in a.columns)a.columns[l].extra==="auto_increment"&&(e=a.columns[l].column_name);return s.debug(e),e},Pe=e=>{for(let l=0;l<a.columns.length;l++)if(a.columns[l].column_name===e)return a.columns[l]},te=e=>{const l=it(D.getState(),t);s.debug("rowValidation",l);let d=!1;for(const i in l)if(l[i].error===!0&&l[i].type===q.COLUMN){d=!0;break}if(d)return s.debug("validateForm returned errors"),!1;let f=!0;const o=ee();for(const i in e){const r=Pe(i);let v=!0;r.column_name!==o&&r.is_nullable==="NO"&&(e[i]===null||e[i]==="")&&(g===V.UPDATE||g===V.INSERT&&(r.column_default===null||r.column_default==="NULL"||r.column_default==="")||ze.preserveSpacesOnUpdate===!1&&e[i]==="")&&(_(ve({appId:t,columnName:i,columnError:!0,columnText:m.mandatoryField,columnType:q.FORM})),v=!1,f=!1);const h=lt(D.getState(),t,i);s.debug(h),v&&_(ve({appId:t,columnName:i,columnError:!1,columnText:"",columnType:q.FORM}))}return f},A=(e,l,d,f)=>{const o=X(D.getState(),t);if(s.debug(o),te(o)){if(u!==null){const i={};Object.keys(o).map(r=>{$.map(v=>{r===v.columnName&&v.updatable&&(i[r]=o[r])})}),s.debug(i),vt(t,u,i,r=>{var v;if(s.debug(r),r!=null&&r.code&&(r!=null&&r.message))switch(r.code){case"ok":b(m.updatedSuccessful,{variant:"success"}),((v=r.context)==null?void 0:v.updated)!==void 0&&Object.keys(r.context.updated).map(h=>{_(ut({appId:t,columnName:h,columnValue:r.context.updated[h]}))}),e&&(l!==void 0&&l(u),setTimeout(()=>{p(!0,x)},1e3)),f&&f();break;case"info":b(m.nothingToUpdate,{variant:"info"}),e&&(l!==void 0&&l(u),setTimeout(()=>{p(!0,x)},1e3)),f&&f();break;default:s.error(r),b(r.message??m.invalidResponse,{variant:"error"}),e&&p(!0,x)}else s.error(r),b(m.invalidResponse,{variant:"error"})},r=>{s.error("error",r),b(r??m.invalidResponse,{variant:"error"})},!1,T,S)}else be(t,o,i=>{if(s.debug(i),i!=null&&i.code&&(i!=null&&i.message)){let r;const v={};switch(i.code){case"ok":b(m.insertSuccessful,{variant:"success"}),r=ee();for(let h=0;h<a.primary_key.length;h++){const B=ct(a,a.primary_key[h]);let w;B!==void 0&&(w=a==null?void 0:a.columns[B]),r!==""&&r===(w==null?void 0:w.column_name)?v[a.primary_key[h]]=i.context.insert_id:v[a.primary_key[h]]=o[a.primary_key[h]]}if(e){l!==void 0&&l(v),p(!0,x);return}j(v,pt.UPDATE),d&&d(),f&&f();break;default:s.error(i),b(i.message??m.invalidResponse,{variant:"error"})}}else s.error(i),b(m.invalidResponse,{variant:"error"})},i=>{s.error("error",i),b(i??m.invalidResponse,{variant:"error"})},!1,T,S);s.debug(x),x!==void 0&&(s.debug("setM2MUpdate: true"),_(xe({appId:x,update:!0})))}else s.error("Validate failed: ",o)},ke=e=>{if(e!==null&&te(N)){const l=he(D.getState(),t),d=l.state.relation.relation_join_condition.split(",").map(o=>o.split("=")),f={...l.state.detailKey};d.map(o=>{f[o[0]]=e[o[1]]}),be(t,f,o=>{if(s.debug(o),o!=null&&o.code&&(o!=null&&o.message))switch(o.code){case"ok":s.debug("Added relation to join table",o);break;default:s.error(o),b(o.message??m.invalidResponse,{variant:"error"})}else s.error(o),b(m.invalidResponse,{variant:"error"})},o=>{s.error(o),b(o??m.invalidResponse,{variant:"error"})},!1,!0,!1)}},[Ae,Be]=c.useState(void 0),Ye=()=>{try{A(!1,()=>{},()=>{var l,d,f,o,i,r,v,h,B,w,ce,me,de,fe;const e=JSON.parse((d=(l=a==null?void 0:a.app)==null?void 0:l.app[0])==null?void 0:d.app_settings);s.debug(e),((o=(f=e==null?void 0:e.settings)==null?void 0:f.app_registration)==null?void 0:o.showMessage)===!0&&((r=(i=e==null?void 0:e.settings)==null?void 0:i.app_registration)==null?void 0:r.message)!==void 0&&((h=(v=e==null?void 0:e.settings)==null?void 0:v.app_registration)==null?void 0:h.message)!==null&&((w=(B=e==null?void 0:e.settings)==null?void 0:B.app_registration)==null?void 0:w.message.trim())!==""&&Be((me=(ce=e==null?void 0:e.settings)==null?void 0:ce.app_registration)==null?void 0:me.message),((fe=(de=e==null?void 0:e.settings)==null?void 0:de.app_registration)==null?void 0:fe.allowUpdates)!==!0&&Ce(V.VIEW)})}catch(e){s.error("Invalid JSON - app settings"),s.error(e),b(mt.contactSupport,{variant:"error"})}},Ne=()=>{A(!1)},Ue=()=>{const e=he(D.getState(),t);s.debug(e.state.relation),e.state.relation!==void 0&&e.state.relation.cardinality===dt.MANY_TO_MANY?A(!0,ke):A(!0)},ne=()=>{p(!0,x)},ze=Se(t),He=R(e=>_e(e,t)),We=R(e=>_e(e,x??"")),F=Vt(t),C=c.useRef(null),$e=Mt(),[P,Ge]=c.useState((ie=C==null?void 0:C.current)==null?void 0:ie.offsetWidth),[Je,Qe]=c.useState({paddingTop:"50px",paddingBottom:"50px",paddingLeft:"50px",paddingRight:"50px"}),[qe,oe]=c.useState("30px"),[Xe,ae]=c.useState("");if(c.useEffect(()=>{if(C.current!==null){Ge(C.current.offsetWidth);const e=P<600?.3:P<900?.6:1;Qe({paddingTop:`calc(${e} * 50px)`,paddingBottom:`calc(${e} * 50px)`,paddingLeft:`calc(${e} * 50px)`,paddingRight:`calc(${e} * 50px)`}),P<600?(oe("10px"),ae("10px")):P<900&&(oe("20px"),ae("20px"))}},[$e.width,C.current]),I!=="")return n.jsx(c.Suspense,{children:n.jsx(At,{severity:"error",message:I,close:!1})});const se=()=>n.jsx(Ot,{appId:t,metaData:a,primaryKey:u,formMode:G,formUuid:J});return y?se():n.jsx("div",{className:`${t}_wrapper pp-form`,ref:C,children:we&&N!==null?n.jsxs(Et,{sx:Je,elevation:Ee,children:[n.jsxs(Tt,{sx:{padding:0,margin:"5px 0 0 0"},children:[se(),L]}),n.jsxs(Ft,{sx:{marginTop:{marginTop:qe},paddingRight:{paddingRight:Xe},padding:0,justifyContent:"space-between",alignItems:"center"},children:[n.jsxs(W,{sx:{display:"flex",gap:"8px"},children:[!1,(He||We)&&n.jsx(n.Fragment,{children:P<600?n.jsx(Ct,{color:"primary",onClick:()=>{_(z({appId:t,more:!F})),x!==void 0&&_(z({appId:x,more:!F}))},children:F?n.jsx(pe,{}):n.jsx(je,{})}):n.jsx(k,{variant:"outlined",startIcon:F?n.jsx(pe,{}):n.jsx(je,{}),onClick:()=>{_(z({appId:t,more:!F})),x!==void 0&&_(z({appId:x,more:!F}))},children:F?m.less:m.more})}),(Y==null?void 0:Y.customActionsBottom)!==void 0&&n.jsx(n.Fragment,{children:n.jsx(kt,{code:Y.customActionsBottom.code??"",safeMode:Fe.safeMode,isExpression:!1,args:{log:s,row:N,mode:bt[g]}})}),n.jsx(W,{className:"pp-registration-form-message",children:Ae})]}),n.jsx(W,{sx:{...P<600&&{marginLeft:"0 !important","& button":{marginLeft:"2px",padding:"6px"}}},children:g!==V.VIEW?n.jsx(n.Fragment,{children:((ue=(le=a==null?void 0:a.app)==null?void 0:le.app[0])==null?void 0:ue.app_type)==rt.REGISTRATION&&Te.state.masterDetailConditions===void 0?n.jsx(n.Fragment,{children:(G===V.INSERT||G===V.UPDATE)&&n.jsx(k,{variant:"contained",onClick:Ye,type:"submit",form:J,sx:{marginLeft:"8px"},children:m.ok})}):n.jsxs(n.Fragment,{children:[n.jsx(k,{variant:"contained",onClick:Ne,type:"submit",form:J,children:m.apply}),(O==null?void 0:O.cardinality)!==0&&n.jsxs(n.Fragment,{children:[n.jsx(k,{variant:"outlined",onClick:Ue,sx:{marginLeft:"8px"},children:m.ok}),n.jsx(k,{variant:"outlined",onClick:ne,sx:{marginLeft:"8px"},children:m.cancel})]})]})}):n.jsx(n.Fragment,{children:(O==null?void 0:O.cardinality)!==0&&n.jsx(k,{variant:"contained",onClick:ne,children:m.back})})})]}),n.jsx(n.Fragment,{children:!1})]}):n.jsx("div",{style:{padding:"50px"},children:n.jsx(Z,{title:m.loadingData})})})},Yt=c.lazy(()=>E(()=>import("./Settings-1.0.23-7a2f1df9.js"),["./Settings-1.0.23-7a2f1df9.js","./main-1.0.23.js","./RestApi-1.0.23-cc179eb9.js","./AdminTheme-1.0.23-7044caf5.js","./Typography-1.0.23-19a0fd3e.js","./ActionsSettings-1.0.23-a601e9bf.js","./TargetEnum-1.0.23-b82380d5.js","./ScopeEnum-1.0.23-7caf102d.js","./ConfirmDialog-1.0.23-f318040f.js","./DialogContent-1.0.23-79893b13.js","./index.esm-1.0.23-ba0465a2.js","./iconBase-1.0.23-43ac6f06.js","./Modal-1.0.23-3fe42627.js","./CardContent-1.0.23-cd3f2c87.js","./ConfirmDialog-1.0.23-9bff3a93.css","./TabPanel-1.0.23-ecd53346.js","./Tabs-1.0.23-d047285a.js","./ThemeProvider-1.0.23-f3e5cbc1.js","./createSvgIcon-1.0.23-f9410a01.js","./useFormStore-1.0.23-90f12904.js","./Spinner-1.0.23-90ab83ff.js","./useTheme-1.0.23-55aea9bb.js","./colorManipulator-1.0.23-e382be1d.js","./settings-1.0.23-871bbe9f.css"],import.meta.url)),Re=({appId:t,primaryKey:u,formMode:g,showTable:p,showForm:j,metaData:M,detailKey:L,selectionForm:x})=>{s.debug(t,u,g,M,L,x);const S=gt();let T=null;s.debug("relationship",T);const y=c.useMemo(()=>{},[]);s.debug("relationAppId",y);const _=()=>null,$=()=>null,m=()=>null;return n.jsxs(n.Fragment,{children:[x===!0?n.jsx(n.Fragment,{children:_()}):n.jsx(Bt,{appId:t,primaryKey:u,formMode:g,showTable:p,showForm:j,detailKey:L,relationAppId:y,children:$()}),n.jsx(n.Fragment,{children:ft(M)&&n.jsx(wt,{theme:S,children:n.jsx(c.Suspense,{fallback:n.jsx(Z,{}),children:n.jsx(Yt,{appId:t})})})}),m()]})},K=Object.freeze(Object.defineProperty({__proto__:null,FormContainer:Re,default:Re},Symbol.toStringTag,{value:"Module"}));export{K as F,Vt as a,Pt as b,Dt as u};
