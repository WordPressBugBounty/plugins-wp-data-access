import{r as f,j as e,s as Ze,l as n,a as As,b as ys,A,g as Ke,c as Ts,e as x,C as I,d as Ss,f as Cs,h as vs,i as Qe,k as Ms,m as ws,n as Rs,o as Is,p as Ds,q as Ns,t as Se,u as ks,v as Es,R as ee,w as ue,x as Ls,y as Ps,P as _s,z as Fe,B as Xe,D as zs,E as je,F as Os,G as Be,H as Ue,I as Ge,J as We,S as Fs,K as Bs,L as qe,M as Gs,N as Ws,O as He,Q as $e,T as Ce,U as qs,V as Hs,W as $s,X as Ys,Y as Js,Z as Vs,$ as ve,a0 as Zs}from"./main-1.0.17.js";import{B as J,A as ne,C as De,a as Ne,b as Ks}from"./useScreenSize-1.0.17-44173319.js";import{u as F,B as c,a as B,M as Qs,b as Xs,c as se,d as Us,e as he,T as W,f as et,A as es,g as ss,h as ts,i as st,j as tt,k as rt,l as at,m as nt,n as it,o as ot,S as pt,p as lt,q as ct,r as rs,v as dt,s as ut,t as xt,w as ht,x as gt,y as mt,z as ft,C as jt,D as bt}from"./main-1.0.17-54ffa424.js";import{C as pe,S as Q,R as At,T as Me,B as yt,a as Tt,b as St,c as Ct,d as we}from"./TabPanel-1.0.17-3c2dbf14.js";import{C as as,a as ns,b as is,u as Te}from"./useApp-1.0.17-9f008cb2.js";import{A as O,a as k}from"./AccordionSummary-1.0.17-276b7b2a.js";import{T as V,a as Re,A as be,C as Ae}from"./TargetEnum-1.0.17-1e1ba2c5.js";import{F as vt}from"./index.esm-1.0.17-78a91bbf.js";import{F as E,I as os,S as ps,a as H,b as ke}from"./Select-1.0.17-745624d0.js";import{l as Ye,g as Mt,M as ie}from"./MenuItem-1.0.17-ed8ab45a.js";import{L as wt}from"./ListItemIcon-1.0.17-21c8997f.js";import{s as Rt,_ as xe,u as It,a as Dt,T as oe,c as Nt,b as kt,I as q,P as ls}from"./iconBase-1.0.17-8d991e6c.js";import{L as Et,M as Lt}from"./Menu-1.0.17-09126381.js";import{s as Pt}from"./settings-1.0.17-bb8125cf.js";import{A as le}from"./AccordionDetails-1.0.17-7b8437b0.js";import{l as _t,u as ye,D as $}from"./usePrepareStore-1.0.17-a8be8b2f.js";import{P as zt}from"./PremiumFeature-1.0.17-12e324e9.js";import{L as X}from"./Link-1.0.17-88d48a3e.js";import{F as Z}from"./FormControlLabel-1.0.17-cc31d0c1.js";import{a as Ot,b as Ft,c as Bt,d as Gt,e as Wt,f as qt,g as Ht,h as $t,i as Yt}from"./ActionsApp-1.0.17-78ec1ee3.js";import{R as Jt}from"./RadioGroup-1.0.17-46153993.js";import{R as Je}from"./Radio-1.0.17-2bbb6717.js";import{l as Vt,C as Zt}from"./index-1.0.17-c81b5b35.js";import{T as Ie}from"./Tabs-1.0.17-a2a1c721.js";import{F as Kt}from"./FileSaver.min-1.0.17-233e49d5.js";import{C as Qt}from"./Checkbox-1.0.17-3dddd4e7.js";import{c as Xt}from"./index-1.0.17-e83aeb27.js";import{S as Ut,a as er,b as sr}from"./Stepper-1.0.17-9e6367ba.js";import{C as tr}from"./CardHeader-1.0.17-aafd2d21.js";import{A as rr}from"./AppMetaData-1.0.17-ed06ba68.js";import{I as ar}from"./InputAdornment-1.0.17-012556cc.js";import"./createSvgIcon-1.0.17-f0c1dc0a.js";import"./DialogContent-1.0.17-9628df83.js";import"./ActionsExplorer-1.0.17-9d96105d.js";import"./useSlot-1.0.17-ca7553c5.js";import"./Collapse-1.0.17-faa698ed.js";import"./Close-1.0.17-6c546366.js";import"./Alert-1.0.17-27b19721.js";import"./index.esm-1.0.17-7de921eb.js";import"./AlertTitle-1.0.17-4b186927.js";const nr=["children","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"],ir=s=>{const{classes:r,inset:t,primary:i,secondary:u,dense:p}=s;return kt({root:["root",t&&"inset",p&&"dense",i&&u&&"multiline"],primary:["primary"],secondary:["secondary"]},Mt,r)},or=Rt("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(s,r)=>{const{ownerState:t}=s;return[{[`& .${Ye.primary}`]:r.primary},{[`& .${Ye.secondary}`]:r.secondary},r.root,t.inset&&r.inset,t.primary&&t.secondary&&r.multiline,t.dense&&r.dense]}})(({ownerState:s})=>xe({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},s.primary&&s.secondary&&{marginTop:6,marginBottom:6},s.inset&&{paddingLeft:56})),pr=f.forwardRef(function(r,t){const i=It({props:r,name:"MuiListItemText"}),{children:u,className:p,disableTypography:l=!1,inset:m=!1,primary:T,primaryTypographyProps:h,secondary:o,secondaryTypographyProps:g}=i,S=Dt(i,nr),{dense:w}=f.useContext(Et);let v=T??u,j=o;const C=xe({},i,{disableTypography:l,inset:m,primary:!!v,secondary:!!j,dense:w}),L=ir(C);return v!=null&&v.type!==oe&&!l&&(v=e.jsx(oe,xe({variant:w?"body2":"body1",className:L.primary,component:h!=null&&h.variant?void 0:"span",display:"block"},h,{children:v}))),j!=null&&j.type!==oe&&!l&&(j=e.jsx(oe,xe({variant:"body2",className:L.secondary,color:"text.secondary",display:"block"},g,{children:j}))),e.jsxs(or,xe({className:Nt(L.root,p),ownerState:C,ref:t},S,{children:[v,j]}))}),lr=pr,cr=()=>{const s=F(r=>Ze(r));return n.debug("appApps",s),s},dr=({app:s,setIsUpdated:r})=>(n.debug(s),e.jsxs(c,{children:[e.jsx(O,{disableGutters:!0,children:e.jsx(k,{children:e.jsx(as,{setIsUpdated:r})})}),e.jsx(O,{disableGutters:!0,children:e.jsx(k,{children:e.jsx(ns,{setIsUpdated:r})})}),e.jsx(O,{disableGutters:!0,children:e.jsx(k,{children:e.jsx(is,{app:s,setIsUpdated:r})})})]})),cs=({app:s,hasErrors:r,setIsUpdated:t})=>{n.debug(s,r);const i=B();return e.jsx(V,{type:"text",label:"App Name",error:r,fullWidth:!0,required:!0,helperText:"App name must be unique.",value:s.appName,autoFocus:!0,autoComplete:"off",onChange:u=>{i(As({appName:u.target.value})),t&&t(!0)}})},ds=({app:s,hasErrors:r,setIsUpdated:t})=>{n.debug(s,r);const i=B();return e.jsx(V,{type:"text",label:"App Title",error:r,fullWidth:!0,required:!0,helperText:"App title describes the purpose of the app.",value:s.appTitle,autoComplete:"off",onChange:u=>{i(ys({appTitle:u.target.value})),t&&t(!0)}})},us=({appType:s})=>s==A.APPCONTAINER?e.jsx(c,{sx:{fontSize:"26px",display:"flex",width:"28px",justifyContent:"center",alignContent:"center",marginRight:"5px"},children:e.jsx(Qs,{})}):s==A.DATAENTRY?e.jsx(c,{sx:{fontSize:"22px",display:"flex",width:"28px",justifyContent:"center",alignContent:"center",marginRight:"5px"},children:e.jsx(Xs,{})}):e.jsx(c,{sx:{fontSize:"20px",display:"flex",width:"28px",justifyContent:"center",alignContent:"center",marginRight:"5px"},children:e.jsx(vt,{})}),xs=({app:s,isNew:r,setIsUpdated:t})=>{n.debug(s);const i=B(),u=Ke(),p=r?"Select App Type *":"App Type *";return e.jsxs(E,{fullWidth:!0,children:[e.jsx(os,{variant:"outlined",children:p}),e.jsxs(ps,{MenuProps:{id:"pp-select-menu"},label:p,value:s.appType,disabled:r!==!0&&(s.appType==A.APPCONTAINER||s.appType==A.REGISTRATION),onChange:l=>{i(Ts({appType:l.target.value})),t&&t(!0)},sx:{"& .MuiSelect-select":{display:"flex",alignItems:"center"}},children:[...u.map(l=>{let m=l.id===A.DATATABLE||l.id===A.DATAENTRY||l.id===A.REGISTRATION||l.id===A.APPCONTAINER;return r!==!0&&(l.id===A.APPCONTAINER||l.id==A.REGISTRATION)&&(m=!1),e.jsxs(ie,{value:l.id,disabled:!m,children:[e.jsx(wt,{sx:{minWidth:"unset"},children:e.jsx(us,{appType:l.id})}),e.jsx(lr,{children:l.text})]})})]}),e.jsxs(H,{children:["Select ",e.jsx("strong",{children:"Data Table"})," to create a read-only app, or ",e.jsx("strong",{children:"Data Administration"})," to enable transactions. To create an app that contains one or more other apps, select ",e.jsx("strong",{children:"Data App"}),"."]})]})},ur=({app:s})=>{n.debug(s);const[r,t]=f.useState(!1),[i,u]=f.useState(void 0),p=()=>{switch(i){case"form":return"Reset Form Builder?";case"theme":return"Reset Theme?";default:return"Reset Table Builder?"}};return e.jsxs(e.Fragment,{children:[e.jsxs(O,{disableGutters:!0,children:[e.jsx(k,{expandIcon:e.jsx(se,{}),children:"Reset"}),e.jsx(le,{children:e.jsxs(E,{sx:{display:"grid",gridGap:"20px"},children:[e.jsx(J,{variant:"contained",color:"primary",onClick:()=>{u(Re.TABLE),t(!0)},children:"Reset Table Builder"}),e.jsx(J,{variant:"contained",color:"primary",onClick:()=>{u(Re.FORM),t(!0)},children:"Reset Form Builder"}),e.jsx(J,{variant:"contained",color:"primary",onClick:()=>{u(Re.THEME),t(!0)},children:"Reset Theme"}),e.jsxs(H,{sx:{display:"inline-grid",gridTemplateColumns:"20px auto",gridGap:"5px",alignItems:"center","& svg":{fontSize:"20px"}},error:!0,children:[e.jsx(Us,{}),"A reset cannot be undone!"]})]})})]}),e.jsx(pe,{title:p(),message:"Are you sure? This action cannot be undone!",open:r,setOpen:t,onConfirm:()=>{i!==void 0&&Pt(s.appDbId,s.appCntId,i,null,null,l=>{if(l!=null&&l.code&&(l==null?void 0:l.message)!==void 0)switch(l.code){case"ok":x(l.message,{variant:"success"});break;case"info":x(l.message,{variant:"info"});break;default:x(l.message??I.contactSupport,{variant:"error"})}else n.error(l),x(I.contactSupport,{variant:"error"})},l=>{n.error("error",l),x(l??I.contactSupport,{variant:"error"})})}})]})},hs=()=>{const s=F(r=>Ss(r));return n.debug("appMetaData",s),s},xr=()=>{const s=F(r=>Cs());return n.debug("appLanguage",s),s},gs=({app:s,setIsUpdated:r})=>{n.debug(s);const t=B();hs();const i=xr(),u=F(m=>vs(m));n.debug("updateSiteLanguage",u),f.useEffect(()=>{const m={appLanguage:Qe.defaultLanguage.code};t(Ms(m))},[]);const[p,l]=f.useState(!1);return e.jsxs(c,{sx:{width:"100%"},children:[e.jsxs(E,{fullWidth:!0,disabled:!0,children:[e.jsx(os,{variant:"outlined",children:"App Language"}),e.jsxs(ps,{MenuProps:{id:"pp-select-menu"},label:"App Language",value:i,onChange:m=>{},children:[..._t.map(m=>e.jsx(ie,{value:m.code,children:m.language},m.code))]}),e.jsx(H,{children:"Selected app language is applied to all (master and detail) tables and forms."})]}),!1,e.jsx(E,{children:e.jsxs(H,{component:"div",sx:{marginLeft:0},children:[e.jsx(c,{sx:{marginTop:"20px"},children:e.jsxs(X,{sx:{textDecoration:"none",cursor:"pointer",display:"inline-flex","& svg":{fontSize:"1rem",marginRight:"2px"}},onClick:()=>l(!p),children:[e.jsx(he,{}),"Which app information is localized?"]})}),p&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{sx:{marginTop:"20px"},children:[e.jsx("strong",{children:"Information provided in the selected app language:"}),e.jsxs("ul",{style:{listStyle:"disc",padding:"0 40px"},children:[e.jsx("li",{children:"Tooltips"}),e.jsx("li",{children:"Field labels"}),e.jsx("li",{children:"Field hints"}),e.jsx("li",{children:"Info and success messages"}),e.jsx("li",{children:"Most error messages"})]})]}),e.jsxs(c,{sx:{marginTop:"20px"},children:[e.jsx("strong",{children:"Information not provided in the selected language:"}),e.jsxs("ul",{style:{listStyle:"disc",padding:"0 40px"},children:[e.jsx("li",{children:"Builders, Wizards and Managers are provided in English"}),e.jsx("li",{children:"Database and server errors are not translated"})]})]}),e.jsx(c,{sx:{marginTop:"20px"},children:"If you discover any translation errors, please let us know. We are committed to improving our translations."})]})]})}),e.jsx(zt,{})]})},hr=()=>{const s=F(r=>ws(r));return n.debug("appFullscreen",s),s},gr=()=>{const s=F(r=>Rs(r));return n.debug("appSafeMode",s),s},mr=({app:s,setIsUpdated:r})=>{n.debug(s);const t=B(),i=hr(),u=gr();return e.jsxs(e.Fragment,{children:[e.jsx(Z,{control:e.jsx(Q,{checked:i,onChange:(p,l)=>{t(Is({fullScreen:l})),r&&r(!0),p.stopPropagation()}}),label:"Enable full screen support",labelPlacement:"end"}),e.jsx(E,{fullWidth:!0,children:e.jsx(H,{children:"Adds an icon to the app toolbar, allowing the user to switch to full-screen mode."})}),e.jsx(Z,{control:e.jsx(Q,{checked:u,onChange:(p,l)=>{t(Ds({safeMode:l})),r&&r(!0),p.stopPropagation()}}),label:"Enable safe mode",labelPlacement:"end"}),e.jsx(E,{fullWidth:!0,children:e.jsx(H,{children:"Disables all custom code, including hooks and computed code fields."})})]})},fr=()=>{const s=F(r=>Ns(r));return n.debug("appRegistration",s),s},jr=({app:s,setIsUpdated:r})=>{n.debug(s);const t=B(),i=fr();return e.jsxs(e.Fragment,{children:[e.jsx(E,{fullWidth:!0,children:e.jsx(Z,{control:e.jsx(Q,{checked:i.showMessage,onChange:(u,p)=>{t(Se({message:i.message,showMessage:p,allowUpdates:i.allowUpdates})),r&&r(!0),u.stopPropagation()}}),label:"Show message on submit",labelPlacement:"end"})}),i.showMessage&&e.jsx(V,{type:"text",label:"Message",fullWidth:!0,helperText:"Message shown when registration form is submitted.",value:i.message??"",autoComplete:"off",onChange:u=>{t(Se({message:u.target.value,showMessage:i.showMessage,allowUpdates:i.allowUpdates})),r&&r(!0),u.stopPropagation()},sx:{marginTop:"20px",marginBottom:"10px"}}),e.jsx(E,{fullWidth:!0,children:e.jsx(Z,{control:e.jsx(Q,{checked:i.allowUpdates,onChange:(u,p)=>{t(Se({message:i.message,showMessage:i.showMessage,allowUpdates:p})),r&&r(!0),u.stopPropagation()}}),label:"Allow updates after submit",labelPlacement:"end"})})]})},br=({app:s,setIsUpdated:r})=>(n.debug(s),e.jsxs(c,{children:[e.jsx(O,{disableGutters:!0,children:e.jsx(k,{children:e.jsx(cs,{app:s,hasErrors:!1,setIsUpdated:r})})}),e.jsx(O,{disableGutters:!0,children:e.jsx(k,{children:e.jsx(ds,{app:s,hasErrors:!1,setIsUpdated:r})})}),e.jsx(O,{disableGutters:!0,children:e.jsx(k,{children:e.jsx(xs,{app:s,setIsUpdated:r})})}),e.jsxs(O,{disableGutters:!0,children:[e.jsx(k,{expandIcon:e.jsx(se,{}),children:"Language"}),e.jsx(k,{children:e.jsx(gs,{app:s,setIsUpdated:r})})]}),e.jsxs(O,{disableGutters:!0,children:[e.jsx(k,{expandIcon:e.jsx(se,{}),children:"Settings"}),e.jsx(le,{children:e.jsx(mr,{app:s,setIsUpdated:r})})]}),s.appType==A.REGISTRATION&&e.jsxs(O,{disableGutters:!0,children:[e.jsx(k,{expandIcon:e.jsx(se,{}),children:"Registration Form Settings"}),e.jsx(le,{children:e.jsx(jr,{app:s,setIsUpdated:r})})]}),e.jsx(ur,{app:s})]})),ms=()=>{const s=F(r=>ks(r));return n.debug("apps",s),s},fs=({app:s,setIsUpdated:r})=>{const t=B(),[i,u]=f.useState(!1),p=ms(),l=p.filter(h=>s.appDbId!==h.appId&&h.appType!=A.APPCONTAINER),m=[];s.appApps.map(h=>{const o=p.filter(g=>g.appId===h);o.length===1&&m.push(o[0])});const T=h=>h.appName+(i?" ("+h.appTitle+")":"");return e.jsxs(E,{sx:{width:"100%",marginTop:"8px"},children:[e.jsx(be,{multiple:!0,options:l,value:m,disableCloseOnSelect:!0,getOptionLabel:h=>T(h),onChange:(h,o)=>{t(Es({appApps:o.map(g=>g.appId)})),r&&r(!0),h.stopPropagation()},renderInput:h=>e.jsx(V,{...h,label:"Apps"}),renderTags:(h,o)=>h.map((g,S)=>{const{key:w,...v}=o({index:S});return e.jsx(Ae,{variant:"outlined",label:T(g),...v},w)})}),e.jsxs(H,{component:"div",sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"Apps will be added in the order they are entered here."}),e.jsx(Z,{sx:{"& span.MuiFormControlLabel-label":{fontSize:"0.75rem"}},control:e.jsx(Q,{checked:i,onChange:h=>{u(!i),h.stopPropagation()}}),label:"Show title",labelPlacement:"end"})]})]})},Ar=({app:s,setIsUpdated:r})=>e.jsx(O,{disableGutters:!0,children:e.jsx(k,{children:e.jsx(fs,{app:s,setIsUpdated:r})})}),js=({setIsUpdated:s})=>{const r=B(),t=Te(),i=hs(),u=f.useMemo(()=>{const o=[];if((i==null?void 0:i.roles)!==void 0)for(const g in i.roles)o.push({key:g,value:i.roles[g]});return o},[i.roles]);n.debug(u);const p=f.useMemo(()=>{const o=[];if((i==null?void 0:i.users)!==void 0)for(const g in i.users)o.push({key:g,value:i.users[g]});return o},[i.users]);n.debug(p);const l=f.useMemo(()=>u.filter(o=>t.appRestApi.authorized_roles.includes(o.key)),[t.appRestApi.authorized_roles,u]),m=f.useMemo(()=>p.filter(o=>t.appRestApi.authorized_users.includes(o.key)),[t.appRestApi.authorized_users,p]),[T,h]=f.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("fieldset",{className:"pp-fieldset",style:{padding:"20px"},children:[e.jsx("legend",{children:"Authorization"}),e.jsx(E,{sx:{width:"100%"},children:e.jsxs(Jt,{children:[e.jsxs(ke,{className:"align-label-radio",sx:{cursor:"pointer"},children:[e.jsx(Je,{checked:t.appRestApi.authorization===ee.AUTHORIZED,onChange:o=>{r(ue({restApiActions:{...t.appRestApi,authorization:ee.AUTHORIZED}})),s&&s(!0),o.stopPropagation()}}),"Authorized access only"]}),e.jsxs(c,{sx:{display:"grid",gridGap:"10px",margin:"20px 20px 15px 42px"},children:[e.jsx(be,{multiple:!0,options:u,disableCloseOnSelect:!0,getOptionLabel:o=>o.value,value:l,onChange:(o,g)=>{r(ue({restApiActions:{...t.appRestApi,authorized_roles:g.map(S=>S.key)}})),s&&s(!0),o.stopPropagation()},renderInput:o=>e.jsx(V,{...o,label:"Roles"}),renderTags:(o,g)=>o.map((S,w)=>{const{key:v,...j}=g({index:w});return e.jsx(Ae,{variant:"outlined",label:S.value,...j},v)})}),e.jsx(be,{multiple:!0,options:p,disableCloseOnSelect:!0,getOptionLabel:o=>o.value,value:m,onChange:(o,g)=>{r(ue({restApiActions:{...t.appRestApi,authorized_users:g.map(S=>S.key)}})),s&&s(!0),o.stopPropagation()},renderInput:o=>e.jsx(V,{...o,label:"Users"}),renderTags:(o,g)=>o.map((S,w)=>{const{key:v,...j}=g({index:w});return e.jsx(Ae,{variant:"outlined",label:S.value,...j},v)})})]}),e.jsxs(ke,{className:"align-label-radio",sx:{cursor:"pointer"},children:[e.jsx(Je,{checked:t.appRestApi.authorization===ee.ANONYMOUS,onChange:o=>{r(ue({restApiActions:{...t.appRestApi,authorization:ee.ANONYMOUS}})),s&&s(!0),o.stopPropagation()}}),"Anonymous access"]})]})})]}),e.jsx(E,{children:e.jsxs(H,{component:"div",sx:{marginLeft:0},children:[e.jsx(c,{sx:{marginTop:"25px"},children:e.jsxs(X,{sx:{textDecoration:"none",cursor:"pointer",display:"inline-flex","& svg":{fontSize:"1rem",marginRight:"2px"}},onClick:()=>h(!T),children:[e.jsx(he,{}),"What is the difference between authorized and anonymous access?"]})}),T&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{sx:{marginTop:"20px"},children:[e.jsx("strong",{children:"Authorized access:"}),e.jsxs("ul",{style:{listStyle:"disc",padding:"0 40px"},children:[e.jsx("li",{children:"Users with the selected roles can access this app"}),e.jsx("li",{children:"Selected users can access this app"}),e.jsx("li",{children:"Other registered users cannot access this app"}),e.jsx("li",{children:"Anonymous users cannot access this app"})]})]}),e.jsxs(c,{sx:{marginTop:"20px"},children:[e.jsx("strong",{children:"Anonymous access:"}),e.jsx("ul",{style:{listStyle:"disc",padding:"0 40px"},children:e.jsx("li",{children:"Any user can access this app"})})]}),e.jsx(c,{sx:{marginTop:"20px"},children:"App authorization is applied to both back-end and front-end usage. Back-end access is restricted to registered users only. A Data Table app displayed on the front-end typically allows anonymous access, enabling visitors to view the table. In contrast, Data Management apps usually require authorized access to prevent unauthorized users from altering table data."})]})]})})]})},yr=({app:s,setIsUpdated:r})=>{n.debug(s);const t=B(),[i,u]=f.useState(!1);return e.jsxs(c,{sx:{display:"grid",gridGap:"30px"},children:[e.jsxs(c,{children:[e.jsx(c,{children:e.jsx(Z,{control:e.jsx(Q,{checked:s.appAddToMenu,onChange:(p,l)=>{t(Ls({appAddToMenu:l})),r&&r(!0),p.stopPropagation()}}),label:"Add App to WordPress dashboard menu",labelPlacement:"end"})}),e.jsx(E,{children:e.jsxs(H,{component:"div",children:[e.jsx(c,{children:e.jsxs(X,{sx:{textDecoration:"none",cursor:"pointer",display:"inline-flex","& svg":{fontSize:"1rem",marginRight:"2px"}},onClick:()=>u(!i),children:[e.jsx(he,{}),"What is a WordPress dashboard menu?"]})}),i&&e.jsx(c,{sx:{marginTop:"20px"},children:"The WordPress dashboard provides a navigation menu with options to navigate to built-in or custom pages. Enabling this option adds a menu item to the WordPress dashboard for all authorized users, allowing easy access to this app."})]})})]}),s.appAddToMenu&&e.jsx(V,{type:"text",label:"Title",fullWidth:!0,required:!0,helperText:"Title shown in WordPress dashboard menu.",value:s.appMenuTitle,autoComplete:"off",onChange:p=>{t(Ps({appMenuTitle:p.target.value})),r&&r(!0),p.stopPropagation()}})]})},Tr=({app:s,setIsUpdated:r})=>{n.debug(s);const t=()=>`[wpda_app app_id="${s.appDbId}"${i?' feedback="true"':""}${m?' builders="false"':""}]`,[i,u]=f.useState(!1),[p,l]=f.useState(!1),[m,T]=f.useState(!1),[h,o]=f.useState(!1),[g,S]=f.useState(t());return f.useEffect(()=>{S(t())},[i,m]),e.jsxs(c,{sx:{display:"grid",gridGap:"20px"},children:[e.jsxs(c,{children:[e.jsxs(ke,{children:["App short code",e.jsx(c,{sx:{marginLeft:"5px",display:"inline-block"},children:e.jsx(Vt.CopyToClipboard,{text:g,onCopy:()=>{x("Shortcode was copied to your clipboard",{variant:"info"})},children:e.jsx(W,{title:"Copy shortcode to clipboard",children:e.jsx(q,{children:e.jsx(et,{})})})})})]}),e.jsx(c,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center","& pre":{backgroundColor:"#ccc",padding:"4px"}},children:e.jsx("pre",{children:g})})]}),e.jsx(c,{children:e.jsxs(E,{children:[e.jsx(Z,{control:e.jsx(Q,{checked:i,onChange:(w,v)=>{u(v),r&&r(!0),w.stopPropagation()}}),label:"Feedback",labelPlacement:"end"}),e.jsxs(H,{component:"div",children:[e.jsxs(X,{sx:{textDecoration:"none",cursor:"pointer",display:"inline-flex","& svg":{fontSize:"1rem",marginRight:"2px"}},onClick:()=>{l(!p)},children:[e.jsx(he,{}),"Show authorization and usage errors"]}),p&&e.jsx(c,{sx:{marginTop:"20px"},children:"Authorization and usage errors are hidden by default to prevent errors from appearing on front-end pages for unauthorized users. If you want to display authorization and usage errors, enable feedback."})]})]})}),e.jsx(c,{children:e.jsxs(E,{children:[e.jsx(Z,{control:e.jsx(Q,{checked:m,onChange:(w,v)=>{T(v),r&&r(!0),w.stopPropagation()}}),label:"Disable builders on front-end",labelPlacement:"end"}),e.jsxs(H,{component:"div",children:[e.jsxs(X,{sx:{textDecoration:"none",cursor:"pointer",display:"inline-flex","& svg":{fontSize:"1rem",marginRight:"2px"}},onClick:()=>{o(!h)},children:[e.jsx(he,{}),"Disables builder access for administrators"]}),h&&e.jsx(c,{sx:{marginTop:"20px"},children:"Builder access is automatically enabled on front-end pages for administrators, allowing them to change app settings directly. Disabling builder access will remove all Table Builder and Form Builder icons from these pages. Please note that anonymous users and non-admin users cannot see these builder icons and have no access to app settings."})]})]})})]})},Sr=({app:s,setIsUpdated:r})=>(n.debug(s),e.jsxs(c,{children:[e.jsxs(O,{disableGutters:!0,children:[e.jsx(k,{expandIcon:e.jsx(se,{}),children:"Authorize Roles & Users"}),e.jsx(le,{children:e.jsx(js,{setIsUpdated:r})})]}),e.jsxs(O,{disableGutters:!0,children:[e.jsx(k,{expandIcon:e.jsx(se,{}),children:"Back-end Access"}),e.jsx(le,{children:e.jsx(yr,{app:s,setIsUpdated:r})})]}),e.jsxs(O,{disableGutters:!0,children:[e.jsx(k,{expandIcon:e.jsx(se,{}),children:"Front-end Access"}),e.jsx(le,{children:e.jsx(Tr,{app:s})})]})]})),Cr=({appDbId:s})=>{var L,P;n.debug(s);const r=B(),t=Te(),i=((L=ne)==null?void 0:L.palette.mode)===_s.LIGHT?(P=ne)==null?void 0:P.palette.primary.main:"",[u,p]=f.useState(!1);n.debug(u);const[l,m]=f.useState(!1);n.debug(l);const T=()=>{r(Xe({}))},h=()=>{u?m(!0):T()},o=()=>{if(!t.appName)return x("App name is required",{variant:"error"}),!1;if(!t.appTitle)return x("App title is required",{variant:"error"}),!1;if(t.appType==A.APPCONTAINER)t.appApps.length===0&&x("No apps added",{variant:"info"});else{if(!t.appDatabase)return x("Database is required",{variant:"error"}),!1;if(!t.appTable)return x("Table is required",{variant:"error"}),!1;if(t.appColumns.filter(y=>y.isSelected).length===0)return x("At least one column must be selected",{variant:"error"}),!1}return!0},g=()=>{o()&&Ot(t,y=>{if(n.debug(y),y!=null&&y.code&&(y==null?void 0:y.message)!==void 0)switch(y.code){case"ok":x(y.message,{variant:"success"}),r(je({}));break;case"info":x(y.message,{variant:"info"});break;default:n.error(y),x(y.message??I.contactSupport,{variant:"error"})}else n.error(y),x(I.contactSupport,{variant:"error"})},y=>{n.error("error",y),x(y??I.contactSupport,{variant:"error"})})},S=()=>{o()&&(g(),T())},w=y=>{r(zs({anchor:y}))},[v,j]=f.useState("1"),C=(y,_)=>{j(_)};return e.jsxs(e.Fragment,{children:[e.jsxs(At,{closeDrawer:h,children:[e.jsx(es,{position:"static",elevation:4,sx:{borderRadius:0},children:e.jsxs(ss,{className:"pp-setting-toolbar",sx:{borderRadius:0},children:[e.jsxs(c,{sx:{flexGrow:1},children:[e.jsx(oe,{variant:"h5",noWrap:!0,component:"div",className:"unselectable",sx:{paddingLeft:"6px"},children:"Manage App"}),e.jsx(oe,{sx:{fontSize:"10px",paddingLeft:"10px"},children:t.appName})]}),e.jsx(Me,{title:"Dock to left",position:"bottom",children:e.jsx(q,{onClick:()=>{w(Fe.LEFT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(yt,{})})}),e.jsx(Me,{title:"Dock to right",position:"bottom",children:e.jsx(q,{onClick:()=>{w(Fe.RIGHT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(Tt,{})})}),e.jsx(Me,{title:"Close",position:"bottom",children:e.jsx(q,{onClick:h,size:"large",color:"inherit",sx:{fontSize:"1.4em"},children:e.jsx(ts,{})})})]})}),e.jsx(De,{className:"pp-settings-container",children:e.jsx(Ne,{sx:{padding:0,margin:0},children:e.jsxs(St,{value:v,children:[e.jsxs(Ct,{variant:"fullWidth",textColor:"primary",onChange:C,sx:{width:"100%",height:"80px",padding:0,margin:0,backgroundColor:"rgb(242, 242, 242)"},children:[e.jsx(Ie,{label:"App Info",value:"1",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}}),e.jsx(Ie,{label:t.appType==A.APPCONTAINER?"Apps":"Data Source",value:"2",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}}),e.jsx(Ie,{label:"Access",value:"3",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}})]}),e.jsxs(c,{sx:{margin:0,padding:0,overflowY:"auto",height:"calc(100vh - 250px)","& > div.MuiTabPanel-root":{padding:0}},children:[e.jsx(we,{value:"1",children:e.jsx(br,{app:t,setIsUpdated:p})}),e.jsx(we,{value:"2",children:t.appType==A.APPCONTAINER?e.jsx(Ar,{app:t,setIsUpdated:p}):e.jsx(dr,{app:t,setIsUpdated:p})}),e.jsx(we,{value:"3",children:e.jsx(Sr,{app:t,setIsUpdated:p})})]})]})})}),e.jsx(De,{className:"pp-setting-footer",sx:{borderRadius:0,backgroundColor:i},children:e.jsxs(Ne,{className:"pp-setting-footer-buttons",sx:{borderRadius:0},children:[e.jsx(J,{variant:"outlined",className:"footer_action_button_apply",onClick:g,children:"Apply"}),e.jsx(J,{variant:"outlined",className:"footer_action_button",onClick:S,children:"OK"}),e.jsx(J,{variant:"outlined",className:"footer_action_button",onClick:h,children:"Cancel"})]})})]}),e.jsx(pe,{title:"Close App Manager?",message:"All uncommitted changes will be lost!",open:l,setOpen:m,onConfirm:()=>{T()},onKeep:()=>{T()}})]})},vr=()=>{const s=F(r=>Os(r));return n.debug("showAppStructure",s),s},Ve=({app:s,density:r})=>{var K,ge,ce,te;n.debug(s);const t=B(),[i,u]=f.useState(!1),[p,l]=f.useState(!1),[m,T]=f.useState(!1),[h,o]=f.useState(!1),g=a=>{let b={};try{b=JSON.parse(a.app_settings)}catch(d){b.rest_api={authorization:ee.AUTHORIZED,authorized_roles:[],authorized_users:[]},n.error("Invalid JSON - app settings"),n.error(d),x("Invalid JSON, check console",{variant:"error"})}return b},S=a=>{Ft(a,b=>{var M,G,Y,re,N,me,ae,fe,Ee,Le,Pe,_e,ze,Oe;const d=b==null?void 0:b.data;if(n.debug("response data",d),d.app&&d.app.app&&Array.isArray(d.app.app)&&d.app.container&&Array.isArray(d.app.container)&&d.app.apps&&Array.isArray(d.app.apps)){const z=d.app.app[0];if(n.debug(z),z.app_type==A.APPCONTAINER){const D=g(z),de=d.app.apps;n.debug(de),t(Ge({appDbId:a,appId:We(a),appName:z.app_name,appTitle:z.app_title,appType:z.app_type,appCntId:0,appCntSeqNr:0,appDatabase:null,appTable:null,appColumns:[],appRelationTable:null,appRelationColumns:[],appRestApi:D==null?void 0:D.rest_api,appAddToMenu:z.app_add_to_menu!=="0",appMenuTitle:((M=D==null?void 0:D.settings)==null?void 0:M.app_menu_title)??z.app_title,appMetaData:d,appLanguage:(G=D==null?void 0:D.settings)==null?void 0:G.app_language,fullScreen:((Y=D==null?void 0:D.settings)==null?void 0:Y.app_fullscreen)??!0,safeMode:((re=D==null?void 0:D.settings)==null?void 0:re.app_safe_mode)??!1,appApps:de}))}else{const D=d.app.container[0];n.debug(D);let de=[];try{de=JSON.parse(D.cnt_cls)}catch(bs){n.error("Invalid JSON - app columns"),n.error(bs),x("Invalid JSON, check console",{variant:"error"})}const R=g(z);t(Ge({appDbId:a,appId:We(a),appName:z.app_name,appTitle:z.app_title,appType:z.app_type,appCntId:D.cnt_id,appCntSeqNr:D.cnt_seq_nr,appDatabase:D.cnt_dbs,appTable:D.cnt_tbl,appColumns:de,appRelationTable:null,appRelationColumns:[],appRestApi:R==null?void 0:R.rest_api,appAddToMenu:z.app_add_to_menu!=="0",appMenuTitle:((N=R==null?void 0:R.settings)==null?void 0:N.app_menu_title)??z.app_title,appMetaData:d,appLanguage:(me=R==null?void 0:R.settings)==null?void 0:me.app_language,fullScreen:((ae=R==null?void 0:R.settings)==null?void 0:ae.app_fullscreen)??!0,safeMode:((fe=R==null?void 0:R.settings)==null?void 0:fe.app_safe_mode)??!1,registrationMessage:((Le=(Ee=R==null?void 0:R.settings)==null?void 0:Ee.app_registration)==null?void 0:Le.message)??void 0,registrationShowMessage:((_e=(Pe=R==null?void 0:R.settings)==null?void 0:Pe.app_registration)==null?void 0:_e.showMessage)??!1,registrationAllowUpdates:((Oe=(ze=R==null?void 0:R.settings)==null?void 0:ze.app_registration)==null?void 0:Oe.allowUpdates)??!0}))}}else x(I.contactSupport,{variant:"error"})},b=>{n.error("error",b),x(b??I.contactSupport,{variant:"error"})})},w=()=>{Bt(s.appId,a=>{if(n.debug(a),a!=null&&a.code&&(a==null?void 0:a.message)!==void 0)switch(a.code){case"ok":x(a.message,{variant:"success"}),t(je({}));break;case"info":x(a.message,{variant:"info"});break;default:n.error(a),x(a.message??I.contactSupport,{variant:"error"})}else n.error(a),x(I.contactSupport,{variant:"error"});u(!1)},a=>{n.error("error",a),x(a??I.contactSupport,{variant:"error"}),u(!1)})},v=()=>{Gt(s.appId,a=>{n.debug(a),a!=null&&a.code&&(a==null?void 0:a.message)!==void 0?a.data.data?Kt(new Blob([a.data.data],{type:"text/json;charset=utf-8"}),"wpda-export-"+s.appName+".sql"):(n.error(a),x(a.message??I.contactSupport,{variant:"error"})):(n.error(a),x(I.contactSupport,{variant:"error"})),u(!1)},a=>{n.error("error",a),x(a??I.contactSupport,{variant:"error"}),u(!1)})},j=a=>{Wt(a,b=>{if(n.debug(b),b!=null&&b.code&&(b==null?void 0:b.message)!==void 0)switch(b.code){case"ok":x(b.message,{variant:"success"}),t(je({}));break;case"info":x(b.message,{variant:"info"});break;default:n.error(b),x(b.message??I.contactSupport,{variant:"error"})}else n.error(b),x(I.contactSupport,{variant:"error"});T(!1)},b=>{n.error("error",b),x(b??I.contactSupport,{variant:"error"}),T(!1)})},C=()=>{if(j(s.appId),s.appType==A.APPCONTAINER&&h===!0){const a=Ze(Fs.getState());a[s.appId]!==void 0&&Array.isArray(a[s.appId])&&(n.debug("start deleting detail apps",a[s.appId]),a[s.appId].map(b=>{n.debug("delete detail app",b),j(b)}))}},L=ye("(max-width:700px)"),P=ye("(max-width:900px)"),[y,_]=f.useState(null),U=!!y;return e.jsxs(e.Fragment,{children:[e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center",padding:r==="small"?"8px 8px 8px 12px":r==="medium"?"16px":"24px",...P&&{".pp-row-actions":{width:0}},"&:hover":{".pp-row-title":{display:P?"inline-block":"none"},".pp-row-actions":{visibility:P?"hidden":"visible"}}},children:[e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"auto auto",alignItems:"center"},children:[e.jsxs(c,{sx:{width:"100%",display:"grid",gridTemplateColumns:"auto 1fr",gridGap:r==="small"?"3px":r==="medium"?"6px":"9px",justifyContent:"center",alignItems:"center"},children:[e.jsx(us,{appType:s.appType}),e.jsxs(c,{sx:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},children:[s.appName,e.jsxs(c,{className:"pp-row-title",sx:{display:"inline-block",marginLeft:"5px",fontSize:"80%"},children:["âˆ’",e.jsx(c,{sx:{display:"inline-block",width:"5px"}}),s.appTitle," (App ID: ",s.appId,")"]})]})]}),e.jsxs(c,{sx:{display:"grid",visibility:"hidden",gridTemplateColumns:"auto auto auto auto",gridGap:"10px",marginLeft:"10px",alignItems:"center"},className:"pp-row-actions",children:[e.jsx(c,{sx:{borderLeft:"1px solid black",height:"100%"}}),e.jsx(W,{title:"Manage App",children:e.jsx(X,{sx:{cursor:"pointer"},underline:"none",onClick:a=>{S(s.appId),a.preventDefault(),a.stopPropagation()},children:"Manage"})}),e.jsx(c,{sx:{borderLeft:"1px solid black",height:"100%"}}),e.jsx(W,{title:"Run & Build App",children:e.jsx(X,{sx:{cursor:"pointer"},underline:"none",onClick:a=>{t(Be({isActive:!0,appDbId:s.appId})),a.preventDefault(),a.stopPropagation()},children:"Run & Build"})})]})]}),e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"auto auto auto auto auto auto auto",justifyContent:L?"end":"space-evenly",alignItems:"center"},children:[e.jsx(c,{sx:{paddingRight:"10px"},children:L?"":Ue(s.appType)}),e.jsx(W,{title:"Manage App",children:e.jsx(q,{sx:{color:(K=ne)==null?void 0:K.palette.primary.main},onClick:a=>{S(s.appId),a.preventDefault(),a.stopPropagation()},children:e.jsx(st,{})})}),e.jsx(W,{title:"Run & Build App",children:e.jsx(q,{sx:{color:(ge=ne)==null?void 0:ge.palette.primary.main},onClick:a=>{t(Be({isActive:!0,appDbId:s.appId})),a.preventDefault(),a.stopPropagation()},children:e.jsx(tt,{})})}),e.jsx(W,{title:"More App actions",children:e.jsx(q,{sx:{color:(ce=ne)==null?void 0:ce.palette.primary.main},onClick:a=>{_(a.currentTarget),a.preventDefault(),a.stopPropagation()},children:e.jsx(rt,{})})}),e.jsxs(Lt,{id:"pp-app-builder-more-actions",anchorEl:y,open:U,onClose:()=>{_(null)},MenuListProps:{"aria-labelledby":"pp-app-builder-more-actions"},sx:{zIndex:9999999999},anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:[e.jsxs(ie,{onClick:a=>{_(null),u(!0),a.preventDefault(),a.stopPropagation()},children:[e.jsx(at,{}),e.jsx("span",{style:{margin:"0 10px"},children:"Copy"})]}),e.jsxs(ie,{onClick:a=>{_(null),l(!0),a.preventDefault(),a.stopPropagation()},children:[e.jsx(nt,{}),e.jsx("span",{style:{margin:"0 10px"},children:"Export"})]}),e.jsx(Zt,{text:`[wpda_app app_id="${s.appId}"]`,onCopy:()=>{x(`Shortcode [wpda_app app_id="${s.appId}"] was copied to your clipboard`,{variant:"info"})},children:e.jsxs(ie,{onClick:a=>{_(null),a.preventDefault(),a.stopPropagation()},children:[e.jsx(it,{}),e.jsx("span",{style:{margin:"0 10px"},children:"Shortcode"})]})}),e.jsxs(ie,{onClick:a=>{_(null),T(!0),o(!1),a.preventDefault(),a.stopPropagation()},sx:{color:(te=ne)==null?void 0:te.palette.error.main},children:[e.jsx(ot,{}),e.jsx("span",{style:{margin:"0 10px"},children:"Delete"})]})]})]})]}),i&&e.jsx(pe,{title:"Please confirm",message:"Copy this app including all containers?",open:i,setOpen:u,onConfirm:()=>w()}),p&&e.jsx(pe,{title:"Please confirm",message:"Export this app including all containers?",open:p,setOpen:l,onConfirm:()=>v()}),m&&e.jsx(pe,{title:"Delete App?",message:e.jsxs("div",{children:["Are you sure you want to delete app ",s.appName,"?",e.jsx("br",{}),e.jsx("strong",{children:"This action cannot be undone!"}),s.appType==A.APPCONTAINER&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("br",{}),e.jsx(E,{children:e.jsx(Z,{control:e.jsx(Qt,{checked:h,onChange:(a,b)=>{o(b)}}),label:"Delete detail app?"})})]})]}),open:m,setOpen:T,onConfirm:()=>C()})]})},Mr=({apps:s,appApps:r,search:t,types:i,isLoading:u,density:p})=>{n.debug(s,r,t,i);const l=vr(),m=o=>{if(i.length===0&&t.trim()==="")return!0;if(l&&r[o.appId]){let g=!1;if(r[o.appId].map(S=>{const w=s.filter(v=>v.appId==S)[0];w?(qe(w.appName+" "+w.appTitle,t)&&(g=!0),i.filter(v=>v.id===Number(w.appType)).length>0&&(g=!0)):n.error(`Detail app lost? Data App ${o.appId} cannot find detail app ${S}!`)}),g)return!0}return!(!qe(o.appName+" "+o.appTitle,t)||i.length>0&&i.filter(g=>g.id===Number(o.appType)).length===0)},T=s.filter(o=>m(o)?o:null),h=o=>r[o]?e.jsxs(c,{sx:{marginLeft:p==="small"?"48px":p==="medium"?"56px":"64px","& > div":{borderTop:"1px solid #ddd",borderRadius:"0 !important"}},children:[...r[o].map(g=>{const S=s.filter(w=>w.appId==g);return S.length>0?e.jsx(Ve,{app:S[0],density:p}):null})]}):null;return e.jsx(ls,{elevation:4,children:e.jsxs(c,{sx:{backgroundColor:"#fff",borderRadius:"4px",overflow:"hidden","& .MuiBox-root:first-of-type":{borderTopLeftRadius:"4px",borderTopRightRadius:"4px"},"& .MuiBox-root:hover":{backgroundColor:"rgb(242, 242, 242)"},"& .pp-app-details:nth-of-type(odd)":{backgroundColor:"#f9f9f9"}},children:[...s.map(o=>{const g=m(o);return l&&Object.keys(r).filter(S=>r[S].includes(Number(o.appId))).length>0?null:e.jsxs(c,{className:"pp-app-details"+(g?" pp-app-details-visible":""),sx:{visibility:g?"visible":"hidden",position:g?"relative":"fixed",borderTop:"1px solid #ddd","&:first-of-type":{borderTop:"unset"}},children:[e.jsx(Ve,{app:o,density:p}),l&&h(o.appId)]})}),T.length===0&&e.jsx(c,{sx:{padding:"35px",borderRadius:"4px"},children:u?e.jsx(pt,{title:"Loading apps...",align:Bs.LEFT}):e.jsx(c,{children:"No apps found"})})]})})},wr=({setMode:s})=>{const r=B(),t=Te(),i=()=>t.appType===A.APPCONTAINER,u=i()?["App info","Apps","Authorization"]:["App info","Data source","Authorization"],[p,l]=f.useState(0);f.useEffect(()=>{let j=null;switch(t.appType){case A.DATATABLE:j=ee.ANONYMOUS;break;case A.DATAENTRY:case A.MASTERDETAIL:case A.REGISTRATION:case A.UPDATEFORM:case A.APPCONTAINER:j=ee.AUTHORIZED;break}j!==null?r(ue({restApiActions:Gs(j)})):x(I.contactSupport,{variant:"error"})},[t.appType]);const[m,T]=f.useState({appName:!1,appTitle:!1,appDatabase:!1,appTable:!1,appColumns:!1});n.debug(m);const h=()=>{const j=Xt(Ws);j.table.transactions.insert=Number(t.appType)===A.DATAENTRY||Number(t.appType)===A.MASTERDETAIL||Number(t.appType)===A.REGISTRATION,j.table.transactions.update=Number(t.appType)===A.DATAENTRY||Number(t.appType)===A.MASTERDETAIL||Number(t.appType)===A.UPDATEFORM||Number(t.appType)===A.REGISTRATION,j.table.transactions.delete=Number(t.appType)===A.DATAENTRY||Number(t.appType)===A.MASTERDETAIL,qt(t,j,C=>{if(n.debug(C),C!=null&&C.code&&(C==null?void 0:C.message)!==void 0)switch(C.code){case"ok":x(C.message,{variant:"success"}),s($.TABLE),r(je({}));break;case"info":x(C.message,{variant:"info"});break;default:n.error(C),x(C.message??I.contactSupport,{variant:"error"})}else n.error(C),x(I.contactSupport,{variant:"error"})},C=>{n.error("error",C),x(C??I.contactSupport,{variant:"error"})}),t.updateSiteLanguage&&t.appLanguage!==void 0&&Ht(t.appLanguage,()=>{},()=>{})},o=()=>{var C,L;let j=!0;if(p===0){let P=!1,y=!1;t.appName.trim()===""&&(x("App name is required",{variant:"error"}),P=!0,j=!1),t.appTitle.trim()===""&&(x("App title is required",{variant:"error"}),y=!0,j=!1),T({...m,appName:P,appTitle:y})}if(p===1){let P=!1,y=!1,_=!1;i()?t.appApps.length===0&&x("No apps added",{variant:"info"}):(((C=t.appDatabase)==null?void 0:C.trim())===""&&(x("Database is required",{variant:"error"}),P=!0,j=!1),((L=t.appTable)==null?void 0:L.trim())===""&&(x("Table is required",{variant:"error"}),y=!0,j=!1),t.appColumns.filter(U=>U.isSelected===!0).length===0&&(x("No columns selected",{variant:"error"}),_=!0,j=!1)),T({...m,appDatabase:P,appTable:y,appColumns:_})}return p===u.length-1&&h(),n.debug(j),j},g=()=>e.jsxs(c,{sx:{textAlign:"right",display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[p>0?e.jsx(J,{variant:"outlined",size:"medium",sx:{width:"160px",marginRight:"10px"},onClick:()=>{l(p-1)},startIcon:e.jsx(lt,{}),children:e.jsx(c,{children:"Back"})}):e.jsx(c,{}),e.jsx(J,{variant:"contained",size:"medium",sx:{width:"160px"},onClick:()=>{o()&&p<u.length-1&&l(p+1)},startIcon:p>=u.length-1&&e.jsx(ct,{}),endIcon:p<u.length-1&&e.jsx(rs,{}),children:e.jsx(c,{children:p<u.length-1?"Next":"Finish"})})]}),S=()=>e.jsxs(e.Fragment,{children:[e.jsx(cs,{app:t,hasErrors:m.appName}),e.jsx(ds,{app:t,hasErrors:m.appName}),e.jsx(gs,{app:t}),g()]}),w=()=>i()?e.jsxs(e.Fragment,{children:[e.jsx(fs,{app:t}),g()]}):e.jsxs(e.Fragment,{children:[e.jsx(as,{}),e.jsx(c,{sx:{display:t.appDatabase?"block":"none"},children:e.jsx(ns,{})}),e.jsx(c,{sx:{display:t.appTable?"block":"none"},children:e.jsx(is,{app:t})}),g()]}),v=()=>e.jsxs(e.Fragment,{children:[e.jsx(c,{children:e.jsx(js,{})}),g()]});return e.jsxs(e.Fragment,{children:[e.jsx(Ut,{activeStep:p,sx:{margin:"10px 0 30px 0"},children:u.map((j,C)=>(n.debug(j,C),e.jsx(er,{children:e.jsx(sr,{children:j})},j)))}),e.jsxs("form",{onSubmit:j=>(j.preventDefault(),o()&&l(p+1),!1),style:{display:"grid",gridGap:"40px"},children:[p===0&&S(),p===1&&w(),p===2&&v(),e.jsx("input",{type:"submit",style:{display:"none"}})]})]})},Rr=({setMode:s})=>{const r=Te();n.debug(r);const[t,i]=f.useState(!1),[u,p]=f.useState(!1),l=t?`Add new ${Ue(r.appType)} app`:"Add new app";return e.jsxs(e.Fragment,{children:[e.jsxs(De,{sx:{padding:"50px 70px 40px 70px",display:"grid",gridGap:"40px"},elevation:4,children:[e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"start"},children:[e.jsx(tr,{title:"App Wizard",subheader:l,sx:{padding:0}}),e.jsx(c,{children:e.jsx(W,{title:"Close",children:e.jsx(X,{sx:{cursor:"pointer"},underline:"none",onClick:m=>{p(!0),m.preventDefault(),m.stopPropagation()},children:e.jsx(c,{sx:{fontSize:"1.5rem",color:"#000"},children:e.jsx(ts,{})})})})})]}),e.jsx(Ne,{sx:{padding:0,display:"grid",gridGap:"30px"},children:t?e.jsx(wr,{setMode:s}):e.jsxs(c,{sx:{display:"grid",gap:"10px"},children:[e.jsx(xs,{app:r,isNew:!0}),e.jsx(c,{sx:{textAlign:"end"},children:e.jsx(J,{variant:"contained",size:"medium",endIcon:e.jsx(rs,{}),onClick:()=>{i(!0)},sx:{width:"160px"},children:"Start Wizard"})})]})})]}),e.jsx(pe,{title:"Close App Wizard?",message:"All uncommitted changes will be lost!",open:u,setOpen:p,onConfirm:()=>{s($.TABLE)}})]})};const ga=()=>{const s=B(),r=f.useMemo(()=>dt(),[]),[t,i]=f.useState($.TABLE);n.debug(t),f.useEffect(()=>{const d=localStorage.getItem("ppAppsDbsSearch");d!==null&&s(He({dbSearch:d}));const M=localStorage.getItem("ppAppsDbsSearchType");if(M!==null){const Y=JSON.parse(M);s($e({dbTypes:Y}))}localStorage.getItem("ppAppsShowStructure")==="false"&&s(Ce({showAppStructure:!1}))},[]);const u=ms(),p=cr(),l=F(d=>qs(d));n.debug("appDbId",l);const m=F(d=>Hs(d));n.debug("dbSearch",m);const T=F(d=>$s(d));n.debug("dbTypes",T);const h=F(d=>Ys(d));n.debug("designMode",h);const o=F(d=>Js(d));n.debug("reload",o);const[g,S]=f.useState(!0);f.useEffect(()=>{v(),w()},[o]);const w=()=>{$t(function(d){const M=d==null?void 0:d.data;n.debug("response data",M);const G=d==null?void 0:d.context;if(n.debug("response context",G),Array.isArray(M)){const Y=[];for(let N=0;N<M.length;N++)Y.push({appId:M[N].app_id,appName:M[N].app_name,appTitle:M[N].app_title,appType:M[N].app_type,appSettings:M[N].app_settings,appAddToMenu:M[N].app_add_to_menu});const re=G.reduce((N,me)=>{const{app_id:ae,app_id_detail:fe}=me;return N[ae]=N[ae]??[],N[ae].push(Number(fe)),N},{});s(ve({appList:Y,appApps:re}))}else n.error(M),x((M==null?void 0:M.message)??I.contactSupport,{variant:"error"}),s(ve({appList:[],appApps:[]}));S(!1)},d=>{n.error("error",d),x(d??I.contactSupport,{variant:"error"}),s(ve({appList:[],appApps:[]})),S(!1)})},v=()=>{Yt(function(d){const M=d==null?void 0:d.data;n.debug("response data",M),s(Zs({appMetaData:M}))},d=>{n.error("error",d),x(d??I.contactSupport,{variant:"error"})})};f.useEffect(()=>{t===$.TABLE&&v()},[t]),f.useEffect(()=>{Qe.appPlugin&&(t===1||h.isActive===!0&&h.appDbId>0?window.document.documentElement.style.setProperty("--addAppIconVisibility","hidden"):window.document.documentElement.style.setProperty("--addAppIconVisibility","visible"),window.ppActionCreateApp=function(){t===0&&!(h.isActive===!0&&h.appDbId>0)&&i($.FORM)})},[t,h]);const[j,C]=f.useState(250),L=ye("(max-width: 600px)"),P=ye("(max-width: 900px)");f.useEffect(()=>{U.current&&C(U.current.offsetWidth)},[T]);const y=Ks(),_=Ke();n.debug(_);const U=f.useRef(),K=()=>h.isActive===!0&&h.appDbId>0,ge=()=>e.jsx(W,{title:"Add new app",children:e.jsx(q,{sx:{color:"inherit"},onClick:()=>{s(Xe({})),i($.FORM)},children:e.jsx(bt,{})})}),ce={};K()&&(ce.visibility="hidden");const te=localStorage.getItem("ppAppsDensity"),[a,b]=f.useState(te==="large"||te==="medium"?te:"small");return f.useEffect(()=>{localStorage.setItem("ppAppsDensity",a)},[a]),e.jsxs(ut,{theme:y,children:[e.jsxs(c,{className:"pp-applist",sx:{width:"100%",visibility:K()?"hidden":"visible",position:K()?"fixed":"auto",height:K()?0:"auto",...K()&&{visibility:"hidden",position:"absolute",left:-99999},"& .pp-app-details":{...ce}},children:[e.jsx(es,{position:"relative",elevation:4,sx:{margin:"0 0 5px 0"},children:e.jsxs(ss,{className:"pp-applist-toolbar",sx:{display:"grid",gap:"12px",paddingRight:"12px !important",...L?{gap:0,paddingRight:"10px",paddingBottom:"10px",paddingLeft:"10px","& .pp-applist-search":{gridTemplateColumns:"1fr",gridGap:"2px"}}:{...P?{gap:0,paddingRight:"10px",paddingBottom:"10px",paddingLeft:"10px","& .pp-applist-search":{justifyContent:"end",gridTemplateColumns:"auto auto auto"}}:{justifyContent:"space-between",gridTemplateColumns:"auto 1fr"}}},children:[e.jsxs(c,{className:"pp-applist-title",sx:{display:"inline-grid",gridTemplateColumns:"auto auto",justifyContent:"start",alignItems:"center",gridGap:"10px"},children:[e.jsx(c,{sx:{fontSize:"18px",lineHeight:"18px",fontWeight:"bold",whiteSpace:"nowrap"},children:"Apps"}),e.jsx(c,{children:ge()})]}),e.jsxs(c,{className:"pp-applist-search",sx:{display:"grid",gridTemplateColumns:"auto auto auto",gridGap:"10px",justifyContent:"end",alignItems:"center"},children:[e.jsxs(c,{children:[e.jsx(W,{title:"App View",children:e.jsx(q,{onClick:()=>{s(Ce({showAppStructure:!0})),localStorage.setItem("ppAppsShowStructure","true")},sx:{color:"#fff"},children:e.jsx(xt,{})})}),e.jsx(W,{title:"List View",children:e.jsx(q,{onClick:()=>{s(Ce({showAppStructure:!1})),localStorage.setItem("ppAppsShowStructure","false")},sx:{color:"#fff"},children:e.jsx(ht,{})})}),e.jsx(W,{title:"Toggle density",children:e.jsx(q,{onClick:()=>{b(a==="large"?"medium":a==="medium"?"small":"large")},sx:{color:"#fff"},children:a==="small"?e.jsx(gt,{}):a==="medium"?e.jsx(mt,{}):e.jsx(ft,{})})})]}),e.jsx(V,{value:m,type:"search",placeholder:"Search",disabled:t===$.FORM,onChange:d=>{s(He({dbSearch:d.target.value})),localStorage.setItem("ppAppsDbsSearch",d.target.value)},sx:{backgroundColor:"#fff",fontSize:"1em",margin:0,padding:0,borderRadius:"4px","&.MuiFormControl-root.MuiTextField-root .MuiInputBase-root":{paddingRight:0},"&.MuiFormControl-root.MuiTextField-root input":{padding:"8px"}},InputProps:{startAdornment:e.jsx(ar,{position:"end",sx:{fontSize:"1.5rem",padding:0,margin:0},children:e.jsx(jt,{})})}}),e.jsx(be,{multiple:!0,size:"small",options:_,getOptionLabel:d=>d.text,isOptionEqualToValue:(d,M)=>d.id===M.id,value:T,disableCloseOnSelect:!0,disabled:t===$.FORM,onChange:(d,M)=>{s($e({dbTypes:M.map(G=>({id:G.id,text:Object.values(Vs)[G.id]}))})),localStorage.setItem("ppAppsDbsSearchType",JSON.stringify(M))},PaperComponent:({children:d})=>e.jsx(ls,{sx:{width:`${j}px`},children:d}),renderInput:d=>e.jsx(c,{ref:U,children:e.jsx(V,{...d,sx:{minWidth:"250px","& .MuiInputBase-root":{backgroundColor:"#fff",padding:"0",maxHeight:"39px",overflow:"hidden"},"& .MuiButtonBase-root.MuiChip-root.MuiAutocomplete-tag":{height:"auto"}},placeholder:T.length===0?"Select app types":""})}),renderTags:(d,M)=>d.map((G,Y)=>{const{key:re,...N}=M({index:Y});return e.jsx(Ae,{variant:"outlined",label:G.text,...N},re)})})]})]})}),t===$.TABLE&&e.jsx(Mr,{apps:u,appApps:p,search:m,types:T,isLoading:g,density:a}),t===$.FORM&&e.jsx(Rr,{setMode:i}),l!==0&&l!==void 0&&e.jsx(Cr,{appDbId:l})]}),h.isActive===!0&&h.appDbId>0&&e.jsx(rr,{appId:r,appDbId:h.appDbId,designMode:!0,isExploring:!0})]})};export{ga as default};
