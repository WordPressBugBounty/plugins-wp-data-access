import{r as l,j as t,a1 as _,l as u,a2 as q,a3 as G,a4 as H,a5 as U,a6 as J,S as K,i as Q,a7 as V,a8 as X,a9 as Y,G as N,aa as Z,ab as I,e as P,C as S,A as ee,ac as te}from"./main-1.0.17.js";import{B as h,u as y,a as F,T as O,j as se,E as ae,v as ne,S as L,s as pe,A as re,g as oe,h as ie}from"./main-1.0.17-54ffa424.js";import{b as le}from"./ActionsApp-1.0.17-78ec1ee3.js";import{a as ce,B as ue,D as w,R as de,C as me,b as xe,c as ge,d as fe,e as he,A as Ae,f as k,S as D,T as Se}from"./usePrepareStore-1.0.17-a8be8b2f.js";import je from"./Alert-1.0.17-27b19721.js";import{I as B}from"./iconBase-1.0.17-8d991e6c.js";import{M as be}from"./MenuItem-1.0.17-ed8ab45a.js";import{M as ve}from"./Menu-1.0.17-09126381.js";const ye=({appRootId:e,appId:s,appDbId:r,isVisible:n,fullScreen:m})=>{const[x,o]=l.useState(!1);return l.useEffect(()=>{n&&!x&&o(!0)},[n]),x?t.jsx(h,{className:n?"":"pp-element-hide",sx:{"& .pp-app-container .pp-component header":{margin:0,visibility:"hidden",position:"absolute",left:-99999}},children:t.jsx(Re,{appId:s,appDbId:r,fullScreen:m,appRootId:e})}):null},Ce=e=>{const s=y(r=>_(r,e));return u.debug("activeAppId",s,e),s},Te=e=>{const s=y(r=>q(r,e));return u.debug("appData",s),s},Me=({appId:e})=>{const s=F(),r=ce(e),n=Te(e);return t.jsx(O,{title:t.jsx(ue,{details:r,mode:n==null?void 0:n.mode}),className:"pp-builder-button",children:t.jsx(B,{sx:{color:"inherit",padding:0},onClick:()=>{(n==null?void 0:n.mode)===w.FORM?s(G({appId:e})):s(H({appId:e}))},children:t.jsx(se,{})})})},Ee=({appDbId:e,appTitle:s,setActiveApp:r,handleClose:n})=>t.jsx(be,{onClick:()=>{r(e),n()},children:t.jsx("span",{children:s})}),Fe=({apps:e,setActiveApp:s})=>{const[r,n]=l.useState(null),m=!!r,x=a=>{n(a.currentTarget),a.stopPropagation()},o=()=>{n(null)};return t.jsxs(h,{sx:{position:"relative"},children:[t.jsx(B,{sx:{color:"inherit",padding:0},onClick:x,children:t.jsx(ae,{})}),t.jsxs(ve,{anchorEl:r,open:m,onClose:o,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},sx:{marginTop:"8px","& ul":{padding:"0 !important"},"& ul li":{padding:"12px 24px 12px 18px !important"}},children:[...e.apps.map(a=>e.titles[a]===void 0?null:t.jsx(Ee,{appDbId:a,appTitle:e.titles[a],setActiveApp:s,handleClose:o}))]})]})},Be=({appId:e})=>{var R;u.debug(e);const s=F(),r=de(),n=me(),m=l.useRef(null),x=l.useRef(null),o=y(p=>U(p,e));u.debug("apps",o);const a=l.useMemo(()=>{const p={};return Array.isArray(o.apps)&&o.apps.length>0&&o.apps.map(v=>{p[v]=ne()}),p},[]),j=xe(e),c=l.useMemo(()=>J(K.getState(),e),[]),A=l.useMemo(()=>{var p,v;return((v=(p=c==null?void 0:c.app)==null?void 0:p.app[0])==null?void 0:v.app_title)!==""?c.app.app[0].app_title:"WP Data Access"},[]),d=Ce(e),b=p=>{s(I({appId:e,activeAppId:p}))},C=ge(a[d]),T=fe(a[d]),M=he(a[d]),E=Ae(M,C,T),[g,f]=l.useState(Q.appOrig.appFullscreen===!0);u.debug("appFullScreen",g);const i=y(p=>V(p));u.debug("appData",i),l.useEffect(()=>{u.debug("setFullScreen",a,g),Object.keys(a).map(p=>{s(X({appId:a[Number(p)],fullScreen:g}))})},[i,g]);const z=((R=i[a[d]])==null?void 0:R.mode)??w.TABLE;u.debug("mode",z);let $={};const W=()=>null;return o===void 0||Object.keys(a).length===0?t.jsx(L,{}):t.jsx(pe,{theme:E,children:t.jsxs(h,{className:"pp-apps-container",ref:m,sx:{...g?$:{},"& .pp-element-hide":{visibility:"hidden",position:"absolute",left:-99999}},children:[t.jsx(re,{className:"pp-apps-header",ref:x,position:"relative",sx:{margin:"0 0 5px 0"},children:t.jsxs(oe,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(h,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center",gap:"5px","& span":{whiteSpace:"nowrap",fontSize:"18px",lineHeight:"18px",fontWeight:"bold"},"& span.pp-header-title":{minWidth:0,textOverflow:"ellipsis",overflow:"hidden",marginRight:"10px"}},children:[t.jsx("span",{children:t.jsx(Fe,{apps:o,setActiveApp:b})}),t.jsxs("span",{className:"pp-header-title",children:[A," - ",o.titles[d]]})]}),t.jsxs(h,{sx:{display:"flex",gap:"10px",justifyContent:"center",alignItems:"center"},children:[Y(c)&&t.jsx(Me,{appId:a[d]}),W(),(c==null?void 0:c.isExploring)&&t.jsx(O,{title:j.close,children:t.jsx(B,{sx:{color:"inherit",padding:0},onClick:()=>{s(N({isActive:!1,appDbId:0})),n(e),r(e),s(Z({})),Object.keys(a).map(p=>{n(a[p]),r(a[p])})},children:t.jsx(ie,{})})})]})]})}),...o.apps.map(p=>t.jsx(ye,{appRootId:e,appId:a[p],appDbId:p,isVisible:p===d,fullScreen:g}))]})})},Re=({appId:e,appDbId:s,designMode:r,staticFilter:n,shortcodeArgs:m,fullScreen:x,isExploring:o,appRootId:a})=>{u.debug(e,s,r,n,m,x,o);const j=F(),[c,A]=l.useState(""),[d,b]=l.useState(!1),[C,T]=l.useState(!1),{prepareAppStore:M}=k(e,D.APP),{prepareApp:E}=k(e,D.APP);l.useEffect(()=>{d||g()},[s]);const g=()=>{le(s,f=>{const i=f==null?void 0:f.data;u.debug("response data",i),i.app&&i.app.app&&Array.isArray(i.app.app)&&i.app.container&&Array.isArray(i.app.container)&&i.app.apps&&Array.isArray(i.app.apps)?i.app.app[0].app_type===ee.APPCONTAINER.toString()?(E(i,o),T(!0),b(!0)):M(s,i,r===!0,void 0,a,()=>{})?(j(te({appId:e,staticFilter:n,shortcodeArgs:m})),b(!0)):A(S.contactSupport):(P(S.contactSupport,{variant:"error"}),A(S.contactSupport))},f=>{u.error("error",f),P(f??S.contactSupport,{variant:"error"}),A(f??S.contactSupport)})};return c!==""?t.jsx(l.Suspense,{children:t.jsx(je,{severity:"error",message:c,close:!0,setClose:()=>{j(N({isActive:!1,appDbId:0}))}})}):d?C?t.jsx(Be,{appId:e}):t.jsx(h,{id:"pp-app-"+e,className:"pp-app-container pp-app-"+s,sx:{[`&#pp-app-${e} .pp-column-search-field ul`]:{marginLeft:0,padding:0},[`&#pp-app-${e} .pp-global-search-field input, &#pp-app-${e} .pp-column-search-field input`]:{boxSizing:"content-box"},[`&#pp-app-${e} .pp-form form input`]:{boxSizing:"content-box"}},children:t.jsx(Se,{appId:e})}):t.jsx(h,{sx:{padding:"50px"},children:t.jsx(L,{})})};export{Re as A};
