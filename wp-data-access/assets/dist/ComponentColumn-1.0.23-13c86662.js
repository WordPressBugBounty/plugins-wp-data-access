import{u as x,a as M}from"./RestApi-1.0.23-cc179eb9.js";import{l as r,cQ as H,cR as z,cS as q,cT as _,r as h,w as A,j as e,e as v,C,B as T,cU as I,cV as O,cW as Y,cX as Q,cY as X,cZ as Z,a as G,n as F,c_ as J}from"./main-1.0.23.js";import{h as K,d as E,e as W}from"./ActionsExplorer-1.0.23-02905de3.js";import{F as S,a as w}from"./FormHelperText-1.0.23-83597bdf.js";import{A as N}from"./Autocomplete-1.0.23-a5bc1209.js";import{T as V}from"./TextField-1.0.23-1657e9d4.js";import{w as $,E as U,k as B}from"./index.esm-1.0.23-ba0465a2.js";import{A as ee}from"./AdminTheme-1.0.23-7044caf5.js";import{k as ae}from"./ActionsApp-1.0.23-18ccdb55.js";import{B as D,S as te}from"./Spinner-1.0.23-90ab83ff.js";import{P as se,I as re}from"./iconBase-1.0.23-43ac6f06.js";import{F as oe}from"./FormLabel-1.0.23-71a056b2.js";import{F as ne}from"./FormControlLabel-1.0.23-1ad68af6.js";import{C as le}from"./Checkbox-1.0.23-e63c68aa.js";import{T as ie}from"./Tooltip-1.0.23-1b58a848.js";import{L}from"./Link-1.0.23-48d9bdb4.js";const Se=()=>{const t=x(c=>c.apps.app);return r.debug("app",t),t},we=({setIsUpdated:t})=>{const c=M(),o=x(a=>H(a));r.debug("databases",o);const d=x(a=>z(a));r.debug("wpDatabase",d);const m=x(a=>q(a));r.debug("defaultDatabase",m);const i=x(a=>_(a));r.debug("appDatabase",i),h.useEffect(()=>{o.length===0?K(function(a){const n=a==null?void 0:a.data;r.debug("response data",n);const s=[];let l="",y="";n.map(u=>{var j;r.debug(u),(u==null?void 0:u.dbs)!==void 0&&(s.push(u.dbs),((j=u==null?void 0:u.dbs_type)==null?void 0:j.toLocaleLowerCase())==="wp"&&(l=u.dbs,y=u.dbs))}),s.sort((u,j)=>u.localeCompare(j,void 0,{sensitivity:"base"})),c(T({property:"databases",propertyValue:s})),c(T({property:"wpDatabase",propertyValue:l})),c(T({property:"defaultDatabase",propertyValue:y})),i===null&&c(A({appDatabase:y})),r.debug(s,l,y)},a=>{r.error("error",a),v(a??C.contactSupport,{variant:"error"})}):i===null&&c(A({appDatabase:m}))},[]);const g=h.useRef(!0);return h.useEffect(()=>{g.current?g.current=!1:i!==null&&o.includes(i)&&(E(i,function(a){const n=a==null?void 0:a.data;r.debug("response data",n),c(T({property:"tables",propertyValue:n}))},a=>{r.error("error",a),v(a??C.contactSupport,{variant:"error"})}),W(i,function(a){const n=a==null?void 0:a.data;r.debug("response data",n),c(T({property:"views",propertyValue:n}))},a=>{r.error("error",a),v(a??C.contactSupport,{variant:"error"})}))},[i]),e.jsxs(S,{sx:{width:"100%",marginTop:"8px"},children:[e.jsx(N,{options:o,value:i,onChange:(a,n)=>{c(A({appDatabase:n??null})),t&&t(!0)},getOptionLabel:a=>d===a?a+" (WordPress database)":a,renderInput:a=>e.jsx(V,{...a,label:"Database *",variant:"outlined"}),sx:{width:"100%"}}),e.jsx(w,{children:"Select a database from the list."})]})},ke=({setIsUpdated:t,isDetail:c,isRelationTable:o})=>{const d=M(),m=x(s=>_(s));r.debug("appDatabase",m);const i=x(s=>I(s));r.debug("tables",i);const g=x(s=>O(s));r.debug("views",g);const a=x(s=>Y(s));r.debug("appTable",a);const n=x(s=>Q(s));return r.debug("appRelationTable",n),h.useEffect(()=>{m!==null&&(i.length===0||g.length===0)&&(E(m,function(s){const l=s==null?void 0:s.data;r.debug("response data",l),d(T({property:"tables",propertyValue:l}))},s=>{r.error("error",s),v(s??C.contactSupport,{variant:"error"})}),W(m,function(s){const l=s==null?void 0:s.data;r.debug("response data",l),d(T({property:"views",propertyValue:l}))},s=>{r.error("error",s),v(s??C.contactSupport,{variant:"error"})}))},[m]),e.jsxs(S,{sx:{width:"100%",marginTop:"8px"},children:[e.jsx(N,{options:m!==null?i.concat(g).sort():[],value:o?n:a,onChange:(s,l)=>{d(o?X({appRelationTable:l??null}):Z({appTable:l??null})),t&&t(!0)},renderInput:s=>e.jsx(V,{...s,label:"Table *",variant:"outlined"}),sx:{width:"100%"}}),e.jsxs(w,{children:["Select a table from the list",c===void 0&&e.jsx(e.Fragment,{children:"Â (additional tables can be added in the Table and Form Builders)"}),"."]})]})},Ae=({app:t,setIsUpdated:c,isRelationTable:o})=>{r.debug(t,o);const d=M(),[m,i]=h.useState(!1),g=h.useRef(!0);h.useEffect(()=>{g.current?g.current=!1:a()},[t.appDatabase,t.appTable,t.appRelationTable,d]);const a=()=>{t.appDatabase!==null&&(!o&&t.appTable!==null||o&&t.appRelationTable!==null)&&(i(!0),ae(t.appDatabase,o?t.appRelationTable??"":t.appTable??"",!1,function(p){const f=p==null?void 0:p.data;if(r.debug("response data",t.appDatabase,o?t.appRelationTable:t.appTable,f),!f.columns)v(C.contactSupport,{variant:"error"});else{const b=[];f.columns.map(k=>{k.column_name!==void 0&&b.push({columnName:k.column_name,isSelected:!0})}),d(o?F({property:{appRelationColumns:b}}):J({appColumns:b,appMetaData:f}))}i(!1)},p=>{r.error("error",p),v(p??C.contactSupport,{variant:"error"}),i(!1)}))},[n,s]=h.useState(!1);r.debug("hasErrors",n);const l=o?t.appRelationColumns:t.appColumns;r.debug("columns",l);const[y,u]=h.useState(!1),[j,P]=h.useState(!1);return h.useEffect(()=>{Number(t.appType)!==G.DATATABLE&&t.appMetaData.primary_key!==void 0?s(t.appMetaData.primary_key.length===0||t.appMetaData.primary_key.filter(p=>l.filter(b=>b.isSelected).map(b=>b.isSelected?b.columnName:!1).includes(p)).length!==t.appMetaData.primary_key.length):s(!1)},[t,l]),e.jsxs(D,{sx:{position:"relative"},children:[e.jsxs(S,{fullWidth:!0,children:[e.jsxs(D,{component:"fieldset",sx:{borderWidth:1,borderRadius:"4px","& .MuiPaper-root":{border:"none",padding:"15px 20px"},"& .MuiFormHelperText-root":{marginLeft:"20px",marginBottom:"20px"}},children:[e.jsx("legend",{style:{fontSize:"0.75rem",fontWeight:400,color:"rgba(0, 0, 0, 0.6)"},children:"Select columns *"}),e.jsx(se,{variant:"outlined",sx:{padding:"15px 30px"},children:m?e.jsxs(D,{sx:{"& div":{display:"block"}},children:[e.jsx(te,{}),e.jsx("span",{})]}):e.jsxs(e.Fragment,{children:[l.length===0&&e.jsx(S,{fullWidth:!0,sx:{margin:"5px 0"},children:e.jsx(oe,{sx:{color:"inherit"},children:"No table selected"})}),...l.map((p,f)=>{var b;return e.jsx(ne,{control:e.jsx(le,{checked:p.isSelected,onChange:(k,R)=>{d(o?F({property:{appRelationColumns:[...t.appRelationColumns.slice(0,f),{columnName:p.columnName,isSelected:R},...t.appRelationColumns.slice(f+1)]}}):F({property:{appColumns:[...t.appColumns.slice(0,f),{columnName:p.columnName,isSelected:R},...t.appColumns.slice(f+1)]}})),c&&c(!0)}}),label:e.jsx(D,{sx:{color:n&&t.appMetaData.primary_key.includes(p.columnName)?(b=ee)==null?void 0:b.palette.error.main:""},children:p.columnName+(n&&t.appMetaData.primary_key.includes(p.columnName)?" (primary key column)":"")}),sx:{width:"100%"}})})]})})]}),e.jsx(w,{children:"Only selected columns are available in tables and forms. Unselected columns are excluded from responses. At least one column must be selected."}),!m&&t.appDatabase!==null&&(!o&&t.appTable!==null||!o&&t.appRelationTable!==null)&&n&&e.jsxs(w,{error:!0,sx:{marginTop:"20px",width:"fit-content",display:"inline-grid",gridTemplateColumns:"40px auto",justifyContent:"space-around",alignItems:"center"},children:[e.jsx($,{size:"24px"}),e.jsx("span",{children:t.appMetaData.primary_key.length===0?e.jsx(e.Fragment,{children:"This table contains no primary key. Transactions are not supported for tables without a primary key. Please create a primary key to continue or select app type Data Table in the app info tab."}):e.jsx(e.Fragment,{children:"Transactions require all primary key columns to be selected. With the current settings transactions will be disabled."})})]})]}),e.jsx(D,{sx:{position:"absolute",top:"15px",right:"10px"},children:e.jsx(ie,{title:"Refresh column list",children:e.jsx(re,{onClick:()=>{a()},children:e.jsx(U,{})})})}),e.jsx(S,{fullWidth:!0,children:e.jsxs(w,{component:"div",sx:{marginTop:"20px",marginLeft:0},children:[e.jsxs(L,{sx:{textDecoration:"none",cursor:"pointer",display:"inline-flex",marginBottom:0,"& svg":{fontSize:"1rem",marginRight:"2px"}},onClick:()=>u(!y),children:[e.jsx(B,{}),"Which columns should be included | excluded?"]}),y&&e.jsx(D,{sx:{marginTop:"20px",marginBottom:"25px"},children:"In most cases, you can simply select all columns. You can hide specific columns later in the Table Builder and Form Builder. Only if your table contains columns with sensitive data that you absolutely do not want to share with anyone, should you deselect them here. This ensures that the contents of these columns will not be included in server responses, maintaining their privacy."})]})}),e.jsx(S,{fullWidth:!0,children:e.jsxs(w,{component:"div",sx:{marginTop:0,marginBottom:"10px",marginLeft:0},children:[e.jsxs(L,{sx:{textDecoration:"none",cursor:"pointer",display:"inline-flex","& svg":{fontSize:"1rem",marginRight:"2px"}},onClick:()=>P(!j),children:[e.jsx(B,{}),"What to do when a table structure changes?"]}),j&&e.jsx(D,{sx:{marginTop:"20px"},children:"Click the refresh icon and save the new structure. Proceed to use the Table Builder and Form Builder sequentially to apply the updated structure."})]})})]})};export{we as C,ke as a,Ae as b,Se as u};
