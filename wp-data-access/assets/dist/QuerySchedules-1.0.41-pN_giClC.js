import{j as e}from"./cm-1.0.41-DxZ4itL_.js";import{r as x}from"./redux-1.0.41-DJjpZqD1.js";import{P as _,b as H,a as M}from"./index-1.0.41-Wbyk3QBm.js";import{al as P,k as O}from"./index-1.0.41-CpXj521P.js";import{P as A}from"./PremiumFeature-1.0.41-CNKLpmFu.js";import{u as I}from"./MainQueryBuilder-1.0.41-M8KmYGqb.js";import{d as R}from"./dayjs.min-1.0.41-CD-l-E21.js";import{B as Y,C as z}from"./ConfirmDialog-1.0.41-NKESMhfW.js";import{c as E,g as F}from"./QueryBuilder-1.0.41-hvN5SRs8.js";import{e as y}from"./notistack-1.0.41-Bq-EKqc7.js";import{l as C}from"./lib-1.0.41-DFdWuh_n.js";import{T as B}from"./Tooltip-1.0.41-g4uuOuci.js";import{I as N}from"./iconBase-1.0.41-BNQFQdHp.js";import{P as $}from"./Menu-1.0.41-DBfdBNVU.js";import{C as L,a as W}from"./CardContent-1.0.41-Cwtu331C.js";import{C as G}from"./CardHeader-1.0.41-DfJVb3rg.js";import{B as k}from"./Spinner-1.0.41-fWZy8imI.js";import{T as J,b as w,c as s,a as U}from"./TableRow-1.0.41-CTJevnEe.js";import{T as V}from"./TableHead-1.0.41-R3d_gFkF.js";import{C as X}from"./CardActions-1.0.41-CXPPUffK.js";import"./vendor-1.0.41-CN03Eozo.js";import"./index-1.0.41-Ca6zW1RM.js";import"./Typography-1.0.41-BIN1Ddvh.js";import"./useEnhancedEffect-1.0.41-BVsyj6AW.js";import"./index-1.0.41-B2jO0d0P.js";import"./AdminTheme-1.0.41-4tiUoVeb.js";import"./FormLabel-1.0.41-CgxisugM.js";import"./useFormControl-1.0.41-1E9QEnRo.js";import"./main-1.0.41.js";import"./loglevel-1.0.41-BZ7XahX3.js";import"./lodash-1.0.41-Cd8grAqB.js";import"./moment-1.0.41-C5S46NFB.js";import"./hooks-1.0.41-sDnKeMy7.js";import"./ActionsExplorer-1.0.41-DSAyrNr3.js";import"./RestApi-1.0.41-CZ_yORv3.js";import"./DatabaseTypeEnum-1.0.41-DeJfpW1u.js";import"./ThemeProvider-1.0.41-D1lNQgXT.js";import"./lang-1.0.41-Bm0VdcRH.js";import"./index-1.0.41-DGYaemnA.js";import"./SanitizeComponent-1.0.41-B18z6eJi.js";import"./dompurify-1.0.41-DhD2mIk-.js";import"./FormHelperText-1.0.41-BPSj83yP.js";import"./utils-1.0.41-iop7lDec.js";import"./FormControlLabel-1.0.41-OBCouq3I.js";import"./Checkbox-1.0.41-C_619ZQC.js";import"./SwitchBase-1.0.41-C_lqznV-.js";import"./useControlled-1.0.41-BEhJe3xs.js";import"./createSvgIcon-1.0.41-0lRWzB2Q.js";import"./Divider-1.0.41-CupjOoMR.js";import"./MenuItem-1.0.41-DCc8qvzQ.js";import"./TextField-1.0.41-CGPjmVeQ.js";import"./Select-1.0.41-aTzlc-HZ.js";import"./InputAdornment-1.0.41-BaGp3m3T.js";import"./TabPanel-1.0.41-BJuUpIHA.js";import"./useThemeProps-1.0.41-BJkkrkB6.js";import"./getThemeProps-1.0.41-BXG_2HDV.js";import"./TabList-1.0.41-WNj_9XSz.js";import"./Tabs-1.0.41-C8-7orxg.js";import"./Switch-1.0.41-BrkxB2Jy.js";/* empty css                    */import"./Popper-1.0.41-Dl4_0sfD.js";const Z=m=>{const t=I(),[c,h]=x.useState([]),f=()=>{var p,d,r,o,i,n,S,v,T;const l=[],j=t.queries[m].queryName,a=t.queries[m].access;for(let g in t.cron.cron)if(t.cron.cron[g].wpda_run_scheduled_sql){const u=t.cron.cron[g].wpda_run_scheduled_sql,b=Object.keys(u)[0],q=(r=(d=(p=u[b])==null?void 0:p.args)==null?void 0:d.args)==null?void 0:r.name,D=(n=(i=(o=u[b])==null?void 0:o.args)==null?void 0:i.args)==null?void 0:n.access,Q=(T=(v=(S=u[b])==null?void 0:S.args)==null?void 0:v.args)==null?void 0:T.params;q===j&&D===a&&l.push({dt:R.unix(Number(g)).format("YYYY-MM-DD HH:mm:ss"),name:q,access:D,params:Q})}h(l)};return x.useEffect(()=>{f()},[t.cron.cron]),c},nr=({queryKey:m,queryBuilderState:t})=>{const c=Z(m),h=E(),[f,l]=x.useState({}),[j,a]=x.useState(!1),p=r=>r?Object.keys(r).map(o=>`${o} = ${r[o]}`).join(", "):"",d=r=>{var o;if((o=r==null?void 0:r.notify)!=null&&o.email){let i=r.notify.email;const n=[];return r.notify.csv&&n.push("csv"),r.notify.json&&n.push("json"),r.notify.xml&&n.push("xml"),n.length>0?i+" ("+n.join(",")+")":i}else return""};return e.jsxs(e.Fragment,{children:[e.jsx(_,{variant:"popover",children:r=>e.jsxs(e.Fragment,{children:[e.jsx(B,{title:"Query Schedules",children:e.jsx(N,{...H(r),sx:{color:"inherit","&.Mui-disabled":{color:"grey"}},disabled:c.length===0,children:e.jsx(P,{})})}),e.jsx($,{...M(r),anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:e.jsxs(L,{sx:{padding:"4px"},children:[e.jsx(G,{title:"Query Schedules",sx:{paddingBottom:"4px"}}),e.jsxs(W,{children:[c.length===0?e.jsx(k,{children:"This query is currently not scheduled."}):e.jsx(k,{sx:{marginTop:0,border:"1px solid rgba(0, 0, 0, 0.23)",borderRadius:"4px",padding:"0 0 10px 0"},children:e.jsxs(J,{sx:{width:"100%","& *":{border:"none !important"},"& td":{padding:"10px",lineHeight:1},"& th":{padding:"10px",fontWeight:"bold"}},children:[e.jsx(V,{children:e.jsxs(w,{children:[e.jsx(s,{}),e.jsx(s,{children:"Next run"}),e.jsx(s,{children:"Parameters"}),e.jsx(s,{children:"Notify"}),e.jsx(s,{})]})}),e.jsxs(U,{children:[...c.map(o=>{var i;return e.jsxs(w,{children:[e.jsx(s,{sx:{paddingLeft:"20px !important"},children:e.jsx(P,{})}),e.jsx(s,{children:o.dt}),e.jsx(s,{children:p((i=o.params)==null?void 0:i.params)}),e.jsx(s,{children:d(o.params)}),e.jsx(s,{sx:{paddingRight:"20px !important"},children:e.jsx(B,{title:"Delete",children:e.jsx(N,{color:"error",size:"small",onClick:()=>{l(o.params),a(!0)},children:e.jsx(O,{})})})})]},o.dt)})]})]})}),e.jsx(A,{})]}),e.jsx(X,{sx:{justifyContent:"end",padding:"8px 16px 16px 16px"},children:e.jsx(Y,{color:"primary",variant:"contained",sx:{width:"90px"},onClick:()=>{r.close()},children:"Done"})})]})})]})}),e.jsx(z,{title:"Delete Schedule?",message:"Are you sure you want to delete this schedule? This action cannot be undone!",open:j,setOpen:a,onConfirm:()=>{F(t.queries[m].queryName,t.queries[m].access,f,r=>{C.debug(r),(r==null?void 0:r.code)==="ok"&&(r!=null&&r.message)?(h(),y(r.message,{variant:"success"})):(C.error("Invalid response"),y("Invalid response",{variant:"error"}))},r=>{C.error(r),y(r,{variant:"error"})})}})]})};export{nr as default};
