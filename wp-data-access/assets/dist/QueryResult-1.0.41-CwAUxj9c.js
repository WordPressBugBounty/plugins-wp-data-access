const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./QueryResultTable-1.0.41-kcosQAHi.js","./cm-1.0.41-DxZ4itL_.js","./redux-1.0.41-DJjpZqD1.js","./vendor-1.0.41-CN03Eozo.js","./Spinner-1.0.41-fWZy8imI.js","./lib-1.0.41-DFdWuh_n.js","./loglevel-1.0.41-BZ7XahX3.js","./lodash-1.0.41-Cd8grAqB.js","./moment-1.0.41-C5S46NFB.js","./Typography-1.0.41-BIN1Ddvh.js","./QueryResultsResponse-1.0.41-BJVn9xwA.js","./jsonview-1.0.41-BigrZHyl.js","./QueryResultsResponse-1.0.41-DeIZ423H.css"])))=>i.map(i=>d[i]);
import{_ as E}from"./main-1.0.41.js";import{j as t}from"./cm-1.0.41-DxZ4itL_.js";import{r as h}from"./redux-1.0.41-DJjpZqD1.js";import{n as z,o as M,p as P}from"./index-1.0.41-DGYaemnA.js";import{j as Q,G as J,B as X,L as $}from"./jstoxml-1.0.41-Di389-xj.js";import{ca as V,cb as W}from"./lib-1.0.41-DFdWuh_n.js";import{F as I}from"./FileSaver.min-1.0.41-CFZnymRv.js";import{o as K,p as G,K as H,J as N,z as U}from"./index-1.0.41-CpXj521P.js";import{u as Y}from"./QueryBuilder-1.0.41-hvN5SRs8.js";import{P as Z}from"./index-1.0.41-fBbZNnTO.js";import{C as u}from"./index-1.0.41-DIUNb9YZ.js";import{e as y}from"./notistack-1.0.41-Bq-EKqc7.js";import{a as R}from"./hooks-1.0.41-sDnKeMy7.js";import{T as q,a as B}from"./TabPanel-1.0.41-BJuUpIHA.js";import{B as e}from"./Spinner-1.0.41-fWZy8imI.js";import{T as f}from"./Tooltip-1.0.41-g4uuOuci.js";import{I as c,P as O}from"./iconBase-1.0.41-BNQFQdHp.js";import{T as tt}from"./TabList-1.0.41-WNj_9XSz.js";import{T as D}from"./Tabs-1.0.41-C8-7orxg.js";import"./vendor-1.0.41-CN03Eozo.js";import"./loglevel-1.0.41-BZ7XahX3.js";import"./lodash-1.0.41-Cd8grAqB.js";import"./moment-1.0.41-C5S46NFB.js";import"./jstoxml-1.0.41-DkGlThlH.js";import"./Typography-1.0.41-BIN1Ddvh.js";import"./useEnhancedEffect-1.0.41-BVsyj6AW.js";import"./ConfirmDialog-1.0.41-NKESMhfW.js";import"./AdminTheme-1.0.41-4tiUoVeb.js";import"./MainQueryBuilder-1.0.41-M8KmYGqb.js";import"./ActionsExplorer-1.0.41-DSAyrNr3.js";import"./RestApi-1.0.41-CZ_yORv3.js";import"./DatabaseTypeEnum-1.0.41-DeJfpW1u.js";import"./ThemeProvider-1.0.41-D1lNQgXT.js";import"./index-1.0.41-Wbyk3QBm.js";import"./index-1.0.41-Ca6zW1RM.js";import"./SanitizeComponent-1.0.41-B18z6eJi.js";import"./dompurify-1.0.41-DhD2mIk-.js";import"./FormHelperText-1.0.41-BPSj83yP.js";import"./utils-1.0.41-iop7lDec.js";import"./useFormControl-1.0.41-1E9QEnRo.js";import"./FormControlLabel-1.0.41-OBCouq3I.js";import"./Checkbox-1.0.41-C_619ZQC.js";import"./SwitchBase-1.0.41-C_lqznV-.js";import"./useControlled-1.0.41-BEhJe3xs.js";import"./createSvgIcon-1.0.41-0lRWzB2Q.js";import"./Menu-1.0.41-DBfdBNVU.js";import"./Divider-1.0.41-CupjOoMR.js";import"./MenuItem-1.0.41-DCc8qvzQ.js";import"./TextField-1.0.41-CGPjmVeQ.js";import"./Select-1.0.41-aTzlc-HZ.js";import"./FormLabel-1.0.41-CgxisugM.js";import"./InputAdornment-1.0.41-BaGp3m3T.js";import"./Switch-1.0.41-BrkxB2Jy.js";/* empty css                    */import"./ctc-1.0.41-D6Hg2DQJ.js";import"./useThemeProps-1.0.41-BJkkrkB6.js";import"./getThemeProps-1.0.41-BXG_2HDV.js";import"./Popper-1.0.41-Dl4_0sfD.js";const ot=(j,r)=>{const o=()=>{var a;if(Array.isArray((a=r==null?void 0:r.status)==null?void 0:a.last_result)&&r.status.last_result.length>0){const x=J({filename:j,fieldSeparator:",",decimalSeparator:".",useKeysAsHeaders:!0}),i=X(x)(m());$(x)(i)}},w=()=>{var a;Array.isArray((a=r==null?void 0:r.status)==null?void 0:a.last_result)&&r.status.last_result.length>0&&I(new Blob([JSON.stringify(m())],{type:"text/json;charset=utf-8"}),`${j}.json`)},p=()=>{var a;if(Array.isArray((a=r==null?void 0:r.status)==null?void 0:a.last_result)&&r.status.last_result.length>0){const x=r.status.last_result.map(n=>{const s={};return Object.keys(n).map(l=>{s[l]=n[l]}),{row:s}}),i=Q.toXML({table:x});I(new Blob([i],{type:"text/plain;charset=utf-8"}),`${j}.xml`)}},m=()=>{const a=[];return Array.isArray(r==null?void 0:r.columns)&&r.columns.map(i=>{if(i.Field&&i.Type){const n=i.Type.indexOf("(")>0?i.Type.substring(0,i.Type.indexOf("(")).toLowerCase():i.Type;V(n)==="number"&&a.push(i.Field)}}),r.status.last_result.map(i=>{const n={};return Object.keys(i).map(s=>{a.includes(s)?n[s]=Number(i[s]):n[s]=i[s]}),n})};return{downloadCsv:o,downloadJson:w,downloadXml:p}},rt=h.lazy(()=>E(()=>import("./QueryResultTable-1.0.41-kcosQAHi.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url)),it=h.lazy(()=>E(()=>import("./QueryResultsResponse-1.0.41-BJVn9xwA.js"),__vite__mapDeps([10,1,2,3,11,12]),import.meta.url)),po=({queries:j,queryKey:r,queryResults:o,tabs:w,index:p,setIndex:m})=>{const a=R(),{getQueryKey:x}=Y(),{downloadCsv:i,downloadJson:n,downloadXml:s}=ot(x(r),o),[l,L]=h.useState("table"),[d,g]=h.useState(!1),F=()=>{var b,C,v,T,k,S,A;return((b=o==null?void 0:o.status)==null?void 0:b.last_error)!==""?t.jsxs(e,{sx:{display:"grid",gridTemplateColumns:"1fr auto",justifyContent:"space-between",alignItems:"center",gap:"5px"},children:[t.jsxs(e,{sx:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},children:["ERROR: ",o.status.last_error]}),t.jsxs(e,{children:[t.jsx(u,{text:o.status.last_error,onCopy:()=>{y("Error successfully copied to clipboard",{variant:"info"})},children:t.jsx(f,{title:"Copy to clipboard",children:t.jsx(c,{size:"small",children:t.jsx(U,{})})})}),t.jsx(f,{title:"Ask AI Assistant for help",children:t.jsx(c,{size:"small",onClick:()=>{a(W({prompt:`This SQL query:

${j[r].query}

Returns the following error:

${o.status.last_error}

Can you help?`,queryKey:r}))},children:t.jsx(Z,{})})})]})]}):o!=null&&o.cmd.trim().startsWith("select")?((v=o==null?void 0:o.status)==null?void 0:v.num_rows)+(((T=o==null?void 0:o.status)==null?void 0:T.num_rows)===1?" row":" rows")+(((k=o==null?void 0:o.status)==null?void 0:k.queries)===null?"":" ("+((A=o==null?void 0:o.status)==null?void 0:A.queries[((S=o==null?void 0:o.status)==null?void 0:S.num_queries)-1][1].toFixed(5))+" sec)"):((C=o==null?void 0:o.status)==null?void 0:C.rows_affected)+" rows affected"},_=b=>t.jsxs(e,{sx:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",fontSize:"11px",position:"absolute",top:b,left:0,right:0},children:[t.jsx(c,{size:"small",color:"primary",disableRipple:!0,onClick:()=>{g(!d)},children:t.jsx(N,{})}),t.jsx(e,{sx:{display:"inline-block",cursor:"pointer"},onClick:()=>{g(!d)},children:l==="table"?"full-screen query result":"full-screen server response"})]});return Object.keys(o).length===0?null:t.jsxs(q,{value:l,children:[t.jsxs(e,{sx:{marginBottom:"2px",display:"grid",gridTemplateColumns:"auto 1fr 1fr 1fr",justifyContent:"space-between",alignItems:"center"},children:[w!==void 0?t.jsxs(e,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"5px"},children:[t.jsx(f,{title:"Previous query",children:t.jsx(c,{disabled:p===0,onClick:()=>{p!==void 0&&m!==void 0&&m(p-1)},children:t.jsx(K,{})})}),t.jsx(e,{children:(p??0)+1}),t.jsx(f,{title:"Next query",children:t.jsx(c,{disabled:w-1===p,onClick:()=>{p!==void 0&&m!==void 0&&m(p+1)},children:t.jsx(G,{})})})]}):t.jsx(e,{}),t.jsxs(tt,{onChange:(b,C)=>{g(!1),L(C)},children:[t.jsx(D,{label:"Query Result",value:"table"}),t.jsx(D,{label:"Server Response",value:"response"})]}),t.jsxs(e,{sx:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",fontSize:"11px"},children:[t.jsx(c,{size:"small",color:"primary",disableRipple:!0,onClick:()=>{g(!d)},children:t.jsx(H,{})}),t.jsx(e,{sx:{display:"inline-block",cursor:"pointer"},onClick:()=>{g(!d)},children:l==="table"?"full-screen query result":"full-screen server response"})]}),t.jsxs(e,{sx:{display:"flex",flexDirection:"row",justifyContent:"end",alignItems:"center"},children:[t.jsx(f,{title:"Export to CSV",children:t.jsx(c,{onClick:()=>{i()},children:t.jsx(z,{})})}),t.jsx(f,{title:"Export to JSON",children:t.jsx(c,{onClick:()=>{n()},children:t.jsx(M,{})})}),t.jsx(f,{title:"Export to XML",children:t.jsx(c,{onClick:()=>{s()},children:t.jsx(P,{})})})]})]}),t.jsxs(e,{className:"pp-sql-query-builder-results",children:[t.jsx(B,{value:"table",keepMounted:!0,sx:{padding:0},children:t.jsxs(O,{sx:{marginTop:"5px",padding:0,backgroundColor:"#ddd",display:"grid",gridTemplateRows:"1fr auto",borderRadius:"4px",...l==="table"&&d&&{width:"calc(100vw - 100px) !important",height:"calc(100vh - 100px) !important",position:"fixed",top:0,left:0,zIndex:9999999,margin:0,padding:"50px !important","& table.pp-sql-query-builder-table tbody":{height:"calc(100vh - 160px) !important"}}},children:[d&&_("10px"),t.jsx(h.Suspense,{children:t.jsx(rt,{queryResults:o})}),t.jsx(e,{sx:{display:"flex",flexDirection:"row",alignItems:"center",height:"30px",paddingLeft:"5px",paddingRight:"5px",backgroundColor:"#eee",borderBottomLeftRadius:"4px",borderBottomRightRadius:"4px"},children:F()})]})}),t.jsx(B,{value:"response",keepMounted:!0,sx:{padding:0},children:t.jsxs(O,{className:"pp-sql-query-builder-response-paper",sx:{marginTop:"5px",padding:"30px",height:"240px",...l==="response"&&d&&{width:"calc(100vw - 100px) !important",height:"calc(100vh - 100px) !important",position:"fixed",top:0,left:0,zIndex:9999999,margin:0,padding:"50px !important",backgroundColor:"#ddd"}},children:[d&&_("10px"),t.jsx(e,{sx:{height:"240px",overflow:"auto","& code":{padding:0,margin:0,backgroundColor:"transparent"},...l==="response"&&d&&{height:"calc(100vh - 145px) !important",backgroundColor:"#fff",padding:"20px !important",borderRadius:"4px"}},className:"pp-sql-query-builder-response",children:t.jsx(h.Suspense,{children:t.jsx(it,{queryResults:o})})})]})})]})]})};export{po as default};
