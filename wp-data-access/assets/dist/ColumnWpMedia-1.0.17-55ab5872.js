import{l as t,r as F,j as e,i as _,cj as E,e5 as k}from"./main-1.0.17.js";import{a as I}from"./main-1.0.17-54ffa424.js";import{i as J,j as R,k as V,l as B,m as T}from"./index.esm-1.0.17-78a91bbf.js";import{M as z}from"./index.esm-1.0.17-3107c6b2.js";import{F as D}from"./Select-1.0.17-745624d0.js";import{B as W}from"./useScreenSize-1.0.17-44173319.js";import"./iconBase-1.0.17-8d991e6c.js";import"./Menu-1.0.17-09126381.js";import"./createSvgIcon-1.0.17-f0c1dc0a.js";const L="Upload or select %s from your WordPress media library",j=({appId:d,columnName:o,columnValue:f,columnMetaData:x,onColumnChange:h,columnMedia:u,mediaType:p,locale:M,language:U})=>{t.debug(d,o,f,x,u,p);const S=F.useRef(null),m=I(),w=F.useMemo(()=>z,[]),y=s=>{if(t.debug(s),s!=null&&s.id&&(s!=null&&s.url)&&(s!=null&&s.mime)&&(s!=null&&s.title))return{value:s.id,media:{url:s.url,mime_type:s.mime,title:s.title}}},N=()=>{t.debug("update media");const s=E(x.data_type)!=="number";t.debug(s);let r="media",n="";switch(p){case"WP-Image":r="images(s)",n="image";break;case"WP-Audio":r="audio",n="audio";break;case"WP-Video":r="video(s)",n="video";break}t.debug(r,n);const a=window.wp.media({title:L.replace("%s",r),button:{text:"Select"},library:{type:n},multiple:s,render:!1});t.debug(a),a.on("select",function(){const l=[];if(s){const i=a.state().get("selection").toJSON();t.debug(i),i.map(v=>{t.debug(v);const P=y(v);P&&l.push(P)})}else{const i=y(a.state().get("selection").first().toJSON());i&&l.push(i)}t.debug(l);const c=[],g=[];for(let i=0;i<l.length;i++)c.push(l[i].value),g.push(JSON.stringify(l[i].media));t.debug(c,g),h(o,c.toString()),m(k({appId:d,columnName:o,columnValue:g}))}),a.open()},A=()=>{t.debug("delete media"),h(o,null),m(k({appId:d,columnName:o,columnValue:[]}))},C=s=>{switch(p){case"WP-Image":return e.jsx("img",{src:s.url,title:s.title,alt:s.title});case"WP-Attachment":{const r=s.mime_type.split("/");return e.jsxs("a",{href:s.url,title:s.title,target:"_blank",className:"pp-hyperlink",children:[e.jsxs("div",{children:[r[0]==="image"&&e.jsx(J,{}),r[0]==="audio"&&e.jsx(R,{}),r[0]==="video"&&e.jsx(V,{}),r[0]==="application"?r[1]==="pdf"?e.jsx(B,{}):e.jsx(T,{}):e.jsx(e.Fragment,{})]}),e.jsx("div",{className:"link-label",children:s.title})]})}case"WP-Audio":return e.jsx("audio",{controls:!0,children:e.jsx("source",{src:s.url,type:s.mime_type})});case"WP-Video":return e.jsx("video",{controls:!0,children:e.jsx("source",{src:s.url,type:s.mime_type})})}};return e.jsxs("div",{className:`media ${p}`,children:[e.jsxs(D,{children:[u==null?void 0:u.map(s=>{try{if(s===null||s==="")return null;const r=JSON.parse(s);return r!=null&&r.url?e.jsx("div",{ref:S,className:"content",children:C(r)},r.url):null}catch(r){return t.error("Invalid media properties",r),e.jsx("span",{children:"Error reading media"})}}),e.jsx("input",{type:"hidden",value:f??""})]}),e.jsxs("div",{className:"actions",children:[e.jsx(W,{variant:"outlined",onClick:N,disabled:!_.appPlugin,children:w.select}),e.jsx(W,{variant:"outlined",onClick:A,disabled:!_.appPlugin,children:M.delete})]})]})};export{j as default};
