import{j as t}from"./cm-1.0.41-DxZ4itL_.js";import{r as m}from"./redux-1.0.41-DJjpZqD1.js";import{u as f,a as C}from"./hooks-1.0.41-sDnKeMy7.js";import{l as u,A as D,W as R,X as W,Y as z,Z as H,S as L,v as G,G as I,_ as U,d as X,$ as Y,a0 as Z}from"./lib-1.0.41-DFdWuh_n.js";import{A as $}from"./AppContainerSelector-1.0.41-C9pS32qV.js";import{B as x,S as q}from"./Spinner-1.0.41-fWZy8imI.js";import{u as J,a as K}from"./useChartSettings-1.0.41-B9jmOMx5.js";import{u as v}from"./useMetadata-1.0.41-DKmF8A3i.js";import{u as Q}from"./useRemoveAppFromStore-1.0.41-CfqgzE5H.js";import{u as V,B as ee,C as te}from"./useFormDetails-1.0.41-B5EIEVl2.js";import{f as se,H as pe,A as oe,T as ne,M as re}from"./index-1.0.41-CpXj521P.js";import{D as y}from"./DynamicModeEnum-1.0.41-BXuL5kgA.js";import{T as M}from"./Tooltip-1.0.41-g4uuOuci.js";import{I as g}from"./iconBase-1.0.41-BNQFQdHp.js";import{M as ie}from"./MenuItem-1.0.41-DCc8qvzQ.js";import{M as ae}from"./Menu-1.0.41-DBfdBNVU.js";import{u as le}from"./useTableSettings-1.0.41-Bn9BidSd.js";import{u as ce}from"./useStoreFormSettings-1.0.41-6QwIhzSX.js";import{u as me,A as ue}from"./AppTheme-1.0.41-BMrYDtWL.js";import{T as de}from"./ThemeProvider-1.0.41-D1lNQgXT.js";import"./vendor-1.0.41-CN03Eozo.js";import"./loglevel-1.0.41-BZ7XahX3.js";import"./lodash-1.0.41-Cd8grAqB.js";import"./moment-1.0.41-C5S46NFB.js";import"./main-1.0.41.js";import"./notistack-1.0.41-Bq-EKqc7.js";import"./FallbackSpinner-1.0.41-2QUzxGrn.js";import"./useLoadAppMetaData-1.0.41-DlCzMh1q.js";import"./ActionsApp-1.0.41-Cz0T7QKd.js";import"./RestApi-1.0.41-CZ_yORv3.js";import"./StoreTypeEnum-1.0.41-s2ixWw7u.js";import"./MapPrepare-1.0.41-DTWLc2Gj.js";import"./Typography-1.0.41-BIN1Ddvh.js";import"./lang-1.0.41-Bm0VdcRH.js";import"./useEnhancedEffect-1.0.41-BVsyj6AW.js";import"./useControlled-1.0.41-BEhJe3xs.js";import"./Popper-1.0.41-Dl4_0sfD.js";import"./index-1.0.41-zQwWCc96.js";import"./getThemeProps-1.0.41-BXG_2HDV.js";const xe=()=>{const e=f(s=>s.appData);return u.debug("appData",e),e},he=({appRootId:e,appId:s,appDbId:r,isVisible:a,fullScreen:o})=>{const[p,l]=m.useState(!1);return m.useEffect(()=>{a&&!p&&l(!0)},[a]),p?t.jsx(x,{className:"pp-apps-root"+(a?"":" pp-element-hide"),sx:{"& .pp-app-container .pp-component header.pp-header":{margin:0,visibility:"hidden",position:"absolute",left:-99999,top:-99999}},children:t.jsx($,{appId:s,appDbId:r,fullScreen:o,appRootId:e})}):null},fe=e=>{const s=f(r=>r.appApps[e]!==void 0?r.appApps[e].activeAppId??r.appApps[e].apps[0]:0);return u.debug("activeAppId",s,e),s},ge=e=>{const s=f(r=>r.appData[e]);return u.debug("appData",s),s},Ae=({appId:e})=>{const s=C(),r=V(e),a=v(e),o=ge(e);return t.jsx(M,{title:t.jsx(ee,{details:r,mode:o==null?void 0:o.mode}),className:"pp-builder-button",children:t.jsx(g,{sx:{color:"inherit",padding:0},onClick:()=>{var p,l;((l=(p=a==null?void 0:a.app)==null?void 0:p.app[0])==null?void 0:l.app_type)==D.CHART?s(R({appId:e})):(o==null?void 0:o.mode)===y.FORM?s(W({appId:e})):s(z({appId:e}))},children:t.jsx(se,{})})})},je=({appDbId:e,appTitle:s,setActiveApp:r,handleClose:a})=>t.jsx(ie,{onClick:()=>{r(e),a()},children:t.jsx("span",{children:s})}),Se=({apps:e,setActiveApp:s})=>{const[r,a]=m.useState(null),o=!!r,p=n=>{a(n.currentTarget),n.stopPropagation()},l=()=>{a(null)};return t.jsxs(x,{sx:{position:"relative"},children:[t.jsx(g,{sx:{color:"inherit",padding:0},onClick:p,children:t.jsx(pe,{})}),t.jsxs(ae,{anchorEl:r,open:o,onClose:l,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},sx:{marginTop:"8px","& ul":{padding:"0 !important"},"& ul li":{padding:"12px 24px 12px 18px !important"}},children:[...e.apps.map(n=>e.titles[n]===void 0?null:t.jsx(je,{appDbId:n,appTitle:e.titles[n],setActiveApp:s,handleClose:l}))]})]})},it=({appId:e})=>{var j,S,b,T;u.debug(e);const s=C(),r=Q(),a=te(),o=H.getSelectors().selectApps(L.getState().appApps,e),p=m.useMemo(()=>{const i={};return Array.isArray(o.apps)&&o.apps.length>0&&o.apps.map(h=>{i[h]=G()}),i},[]),l=J(e),n=v(e),F=m.useMemo(()=>{var i,h;return((h=(i=n==null?void 0:n.app)==null?void 0:i.app[0])==null?void 0:h.app_title)!==""?n.app.app[0].app_title:"WP Data Access"},[]),c=fe(e),E=i=>{s(Z({appId:e,activeAppId:i}))};K(p[c]);const B=le(p[c]),k=ce(p[c]),w=me(p[c]),O=ue(w,B,k),[d,be]=m.useState(((b=window.PP_APP_CONFIG[(S=(j=n==null?void 0:n.app)==null?void 0:j.app[0])==null?void 0:S.app_id])==null?void 0:b.appFullscreen)===!0);u.debug("appFullScreen",d);const A=xe();m.useEffect(()=>{u.debug("setFullScreen",p,d),Object.keys(p).map(i=>{s(I({appId:p[Number(i)],property:{fullScreen:d??!1}}))})},[A,d]);const P=((T=A[p[c]])==null?void 0:T.mode)??y.TABLE;u.debug("mode",P);let N={};const _=()=>null;return o===void 0||Object.keys(p).length===0?t.jsx(q,{}):t.jsx(de,{theme:O,children:t.jsxs(x,{className:"pp-apps-container",sx:{...d?N:{},"& .pp-element-hide":{visibility:"hidden",position:"absolute",left:-99999,top:-99999}},children:[t.jsx(oe,{className:"pp-apps-header",position:"relative",sx:{margin:"0 0 5px 0"},children:t.jsxs(ne,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(x,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center",gap:"5px","& span":{whiteSpace:"nowrap",fontSize:"18px",lineHeight:"18px",fontWeight:"bold"},"& span.pp-header-title":{minWidth:0,textOverflow:"ellipsis",overflow:"hidden",marginRight:"10px"}},children:[t.jsx("span",{children:t.jsx(Se,{apps:o,setActiveApp:E})}),t.jsxs("span",{className:"pp-header-title",children:[F," - ",o.titles[c]]})]}),t.jsxs(x,{sx:{display:"flex",gap:"10px",justifyContent:"center",alignItems:"center"},children:[U(n)&&t.jsx(Ae,{appId:p[c]}),_(),(n==null?void 0:n.isExploring)&&t.jsx(M,{title:l.close,children:t.jsx(g,{sx:{color:"inherit",padding:0},onClick:()=>{s(X({isActive:!1,appDbId:0})),a(e),r(e),s(Y()),Object.keys(p).map(i=>{a(p[i]),r(p[i])})},children:t.jsx(re,{})})})]})]})}),...o.apps.map(i=>t.jsx(he,{appRootId:e,appId:p[i],appDbId:i,isVisible:i===c,fullScreen:d}))]})})};export{it as default};
