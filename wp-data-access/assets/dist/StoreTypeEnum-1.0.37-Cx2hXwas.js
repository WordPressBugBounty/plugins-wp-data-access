import{l as t,ag as Pe,F as he,A as w,a6 as f,r as j,ah as M,ai as Se,aj as Ne,ak as _e,b as Ae,a5 as q,al as Y,a7 as Ce,a8 as de,g as Te,am as Je,S as xe,an as De,ao as we,ap as Fe,aq as Ie,ar as Re,a9 as Ue}from"./lib-1.0.37-Czwr-8r3.js";import{a as Be}from"./hooks-1.0.37-DW0_oiBB.js";const Ee=(m,F)=>({app_id:m,cnt_id:F}),Ve=(m,F)=>({dbs:m,tbl:F}),Ye=(m,F)=>{t.debug(m,F);const y=Be(),Oe=(i,u,e,_)=>{var o,A,x,a,N,T,O,I,R,U,B,E,s,r,h,G,L,W,z,H,K,Q,X,Z,$,ee,le,se,te,ne,re,ue,oe,ce,me,ie,pe,be,ge,fe,ae;t.debug(e);const S=(o=e.access.insert)==null?void 0:o.some(n=>n.toUpperCase()==="POST"),v=(A=e.access.update)==null?void 0:A.some(n=>n.toUpperCase()==="POST"),b=(x=e.access.delete)==null?void 0:x.some(n=>n.toUpperCase()==="POST");e.src=Ve(i,u),e.privs={select:!0,insert:S,update:v,delete:b};let l={};((T=(N=(a=e==null?void 0:e.settings)==null?void 0:a.ui)==null?void 0:N.global)==null?void 0:T.table)!==!1?(l=f({},j,(R=(I=(O=e==null?void 0:e.settings)==null?void 0:O.ui)==null?void 0:I.global)==null?void 0:R.table),(h=(r=(s=(E=(B=(U=e==null?void 0:e.settings)==null?void 0:U.ui)==null?void 0:B.global)==null?void 0:E.table)==null?void 0:s.table)==null?void 0:r.pagination)!=null&&h.rowsPerPage&&(l.table.pagination.rowsPerPage=[...e.settings.ui.global.table.table.pagination.rowsPerPage]),(H=(z=(W=(L=(G=e==null?void 0:e.settings)==null?void 0:G.ui)==null?void 0:L.global)==null?void 0:W.table)==null?void 0:z.table)!=null&&H.defaultOrderBy&&(l.table.defaultOrderBy=[...e.settings.ui.global.table.table.defaultOrderBy])):l=f({},j,{table:{transactions:{insert:S,update:v,delete:b},bulkActions:{pdf:!1,csv:!0,json:!0,excel:!1,xml:!0,sql:!0,delete:(K=e==null?void 0:e.privs)==null?void 0:K.delete}}});const D=[];for(let n=0;n<e.columns.length;n++)D[n]=M(e.columns[n].column_name,e.table_labels[e.columns[n].column_name]??e.columns[n].column_name);const g=[];if(Array.isArray(l.columns)&&l.columns.length>0){for(let n=0;n<l.columns.length;n++){const V=Te(e,l.columns[n].columnName);V!==void 0?g.push(f({},D[V],l.columns[n])):g.push(f({},M(e.columns[n].column_name),l.columns[n]))}l.columns=g}else l.columns=D;l.table.largeTableSupport.saved===Ne.AUTO?l.table.largeTableSupport.actual=_e(e):l.table.largeTableSupport.actual=l.table.largeTableSupport.saved,t.debug(l);let c={...q};((Z=(X=(Q=e==null?void 0:e.settings)==null?void 0:Q.ui)==null?void 0:X.global)==null?void 0:Z.form)!==!1&&(c=f({},q,(le=(ee=($=e==null?void 0:e.settings)==null?void 0:$.ui)==null?void 0:ee.global)==null?void 0:le.form));const P=[];for(let n=0;n<e.columns.length;n++)P[n]=Y(e.columns[n].column_name,e.form_labels[e.columns[n].column_name]??e.columns[n].column_name);const C=[];if(Array.isArray(c.columns)&&c.columns.length>0){for(let n=0;n<c.columns.length;n++){const V=Te(e,c.columns[n].columnName);V!==void 0?C.push(f({},P[V],c.columns[n])):C.push(f({},Y(c.columns[n].column_name),c.columns[n]))}c.columns=C}else c.columns=P;const d=Je.getSelectors().selectSelected(xe.getState().explorer);t.debug("selected",d),d&&d[i]==="wp"&&((te=(se=e==null?void 0:e.settings)==null?void 0:se.wp)==null?void 0:te.tables)!==void 0&&Array.isArray(e.settings.wp.tables)&&e.settings.wp.tables.includes(u)&&(c.form={...De},c.form.preserveSpacesOnUpdate=!0);let J={};if(((ue=(re=(ne=e==null?void 0:e.settings)==null?void 0:ne.ui)==null?void 0:re.global)==null?void 0:ue.theme)!==void 0&&((me=(ce=(oe=e==null?void 0:e.settings)==null?void 0:oe.ui)==null?void 0:ce.global)==null?void 0:me.theme)!==null&&((be=(pe=(ie=e==null?void 0:e.settings)==null?void 0:ie.ui)==null?void 0:pe.global)==null?void 0:be.theme)!=="")try{J=JSON.parse((ae=(fe=(ge=e==null?void 0:e.settings)==null?void 0:ge.ui)==null?void 0:fe.global)==null?void 0:ae.theme)}catch(n){t.error("Invalid JSON - theme settings"),t.error(n)}J===!1&&(J={});const p=f({},we,J);return k(e,l,c,p,_===!0)},ye=(i,u,e,_,S,v)=>{var R,U,B,E;t.debug(i,u,e,_,S);const b=u.app.app[0];t.debug(b);const l=u.app.container[0];t.debug(l);let D={};try{D=JSON.parse(b.app_settings)}catch(s){t.error("Invalid JSON - app settings"),t.error(s)}t.debug(D);let g={};try{g=JSON.parse(l.cnt_cls)}catch(s){t.error("Invalid JSON - app columns"),t.error(s)}t.debug(g);const c=b.app_type,P=Number(c)===w.DATAENTRY||Number(c)===w.REGISTRATION,C=Number(c)===w.DATAENTRY||Number(c)===w.REGISTRATION||Number(c)===w.UPDATEFORM,d=Number(c)===w.DATAENTRY;t.debug(P,C,d),u.src=Ee(i,l.cnt_id),u.privs={select:!0,insert:P,update:C,delete:d};const J=f({},j,{table:{transactions:{insert:P,update:C,delete:d},bulkActions:{pdf:!1,csv:!0,json:!0,excel:!1,xml:!0,sql:!0,delete:(R=u==null?void 0:u.privs)==null?void 0:R.delete}}});t.debug(J);let p={};if(l.cnt_table!==void 0&&l.cnt_table!==null&&l.cnt_table!=="")try{p=JSON.parse(l.cnt_table)}catch(s){t.error("Invalid JSON - table settings"),t.error(s)}t.debug(p);const o=f({},J,p);(B=(U=p==null?void 0:p.table)==null?void 0:U.pagination)!=null&&B.rowsPerPage&&(o.table.pagination.rowsPerPage=[...p.table.pagination.rowsPerPage]),(E=p==null?void 0:p.table)!=null&&E.defaultOrderBy&&(o.table.defaultOrderBy=[...p.table.defaultOrderBy]),t.debug(o);const A=[];for(let s=0;s<g.length;s++)g[s].isSelected===!0&&A.push(M(g[s].columnName,u.table_labels[g[s].columnName]??g[s].columnName,!0));if(t.debug(A),Array.isArray(o.columns)&&o.columns.length>0){const s=[];for(let r=0;r<o.columns.length;r++)if(o.columns[r].computedField!==void 0)s.push(f({},M(o.columns[r].columnName),o.columns[r]));else{const h=Se(A,o.columns[r].columnName);h!==void 0&&s.push(f({},A[h],o.columns[r]))}A.map(r=>{s.filter(h=>h.columnName===r.columnName).length===0&&s.push(r)}),t.debug(s),o.columns=s}else o.columns=A;if(o.table.largeTableSupport.saved===Ne.AUTO?o.table.largeTableSupport.actual=_e(u):o.table.largeTableSupport.actual=o.table.largeTableSupport.saved,(u==null?void 0:u.isRelationSelectionTable)===!0&&(p==null?void 0:p.columns)!==void 0&&Array.isArray(p.columns)){const s=[];p.columns.map(r=>{if(r.columnName.startsWith(Ae.relationTablePrefix)){const h={...r};h.columnName=r.columnName.substring(Ae.relationTablePrefix.length),s.push(h)}}),o.columns=[...s]}t.debug(o);let x={};if((l==null?void 0:l.cnt_form)!==void 0&&(l==null?void 0:l.cnt_form)!==null&&(l==null?void 0:l.cnt_form)!==""||u.useRform===!0&&(l==null?void 0:l.cnt_rform)!==void 0&&(l==null?void 0:l.cnt_rform)!==null&&(l==null?void 0:l.cnt_rform)!=="")try{u.useRform===!0?x=JSON.parse(l.cnt_rform):x=JSON.parse(l.cnt_form)}catch(s){t.error("Invalid JSON - form settings"),t.error(s)}t.debug(x);const a=f({},q,x);t.debug(a);const N=[];for(let s=0;s<g.length;s++)g[s].isSelected===!0&&N.push(Y(g[s].columnName,u.form_labels[g[s].columnName]??g[s].columnName,!0));if(t.debug(N),Array.isArray(a.columns)&&a.columns.length>0){const s=[];for(let r=0;r<a.columns.length;r++)if(a.columns[r].computedField!==void 0)s.push(f({},N[r],a.columns[r]));else{const h=Se(N,a.columns[r].columnName);h!==void 0&&s.push(f({},N[h],a.columns[r]))}N.map(r=>{s.filter(h=>h.columnName===r.columnName).length===0&&s.push(r)}),a.columns=s}else a.columns=N;t.debug(a);let T={};if((b==null?void 0:b.app_theme)!==void 0&&(b==null?void 0:b.app_theme)!==null&&(b==null?void 0:b.app_theme)!=="")try{T=JSON.parse(b.app_theme)}catch(s){t.error("Invalid JSON - theme settings"),t.error(s)}T===!1&&(T={}),t.debug(T),S!==void 0&&(u.appRootId=S);let O={};if((l==null?void 0:l.cnt_chart)!==void 0&&(l==null?void 0:l.cnt_chart)!==null&&(l==null?void 0:l.cnt_chart)!=="")try{O=JSON.parse(l.cnt_chart)}catch(s){t.error("Invalid JSON - chart settings"),t.error(s)}O===!1&&(O={}),t.debug(O);const I=f({},Ce,O);return t.debug(I),y(de({appId:m,chartState:I})),k(u,o,a,T,e===!0,v)},ve=(i,u)=>{t.debug(i);const e=i.app.app[0];t.debug(e);let _={};try{_=JSON.parse(e.app_settings)}catch(S){t.error("Invalid JSON - app settings"),t.error(S)}return t.debug(_),y(Pe({appId:m,apps:i.app.apps,titles:i.app.titles,appSettings:_})),y(he({appId:m,metaData:{...i,isExploring:u??!1}})),!0},k=(i,u,e,_,S,v)=>(t.debug(i),y(he({appId:m,metaData:{...i}})),y(Fe({appId:m,tableState:u,tableAccess:{insert:i.privs.insert,update:i.privs.update,delete:i.privs.delete},isView:Ie(i),exploring:S})),y(Re({appId:m,formState:e})),y(Ue({appId:m,themeState:_})),v!==void 0&&v(),!0);return{prepareAdminStore:Oe,prepareAppStore:ye,prepareApp:ve}};var Me=(m=>(m[m.ADMIN=0]="ADMIN",m[m.APP=1]="APP",m))(Me||{});export{Ee as D,Me as S,Ye as u};
